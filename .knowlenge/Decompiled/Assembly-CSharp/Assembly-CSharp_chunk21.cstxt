using System;
using System.Collections.Generic;
using System.IO;
using Cysharp.Text;
using Facepunch;
using Facepunch.Rust;
using Newtonsoft.Json;
using UnityEngine;

public class EventRecord : IPooled
{
	public static readonly long NSPerTick = 100L;

	public DateTime Timestamp;

	[NonSerialized]
	public bool IsServer;

	public List<EventRecordField> Data = new List<EventRecordField>();

	public int TimesCreated;

	public int TimesSubmitted;

	public static readonly Guid SessionId = Guid.NewGuid();

	public string EventType { get; private set; }

	public void EnterPool()
	{
		Timestamp = default(DateTime);
		EventType = null;
		IsServer = false;
		foreach (EventRecordField datum in Data)
		{
			MemoryStream bytes = datum.Bytes;
			if (bytes != null)
			{
				Pool.FreeUnmanaged(ref bytes);
			}
		}
		Data.Clear();
	}

	public void LeavePool()
	{
	}

	public static EventRecord CSV()
	{
		EventRecord eventRecord = Pool.Get<EventRecord>();
		eventRecord.IsServer = true;
		eventRecord.TimesCreated++;
		return eventRecord;
	}

	public static EventRecord New(string type, bool isServer = true)
	{
		EventRecord eventRecord = Pool.Get<EventRecord>();
		eventRecord.EventType = type;
		eventRecord.AddField("type", type);
		eventRecord.AddField("guid", Guid.NewGuid());
		BuildInfo current = BuildInfo.Current;
		bool num = (current.Scm.Branch != null && current.Scm.Branch == "experimental/release") || current.Scm.Branch == "release";
		bool isEditor = Application.isEditor;
		string value = ((num && !isEditor) ? "release" : (isEditor ? "editor" : "staging"));
		eventRecord.AddField("environment", value);
		eventRecord.IsServer = isServer;
		if (isServer && SaveRestore.WipeId != null)
		{
			eventRecord.AddField("wipe_id", SaveRestore.WipeId);
		}
		eventRecord.AddField("frame_count", ServerMgr.FrameCount);
		eventRecord.Timestamp = DateTime.UtcNow;
		eventRecord.TimesCreated++;
		return eventRecord;
	}

	public EventRecord AddObject(string key, object data)
	{
		if (data == null)
		{
			return this;
		}
		Data.Add(new EventRecordField(key)
		{
			String = JsonConvert.SerializeObject(data),
			IsObject = true
		});
		return this;
	}

	public EventRecord SetTimestamp(DateTime timestamp)
	{
		Timestamp = timestamp;
		return this;
	}

	public EventRecord AddField(string key, DateTime time)
	{
		Data.Add(new EventRecordField(key)
		{
			DateTime = time
		});
		return this;
	}

	public EventRecord AddField(string key, bool value)
	{
		Data.Add(new EventRecordField(key)
		{
			String = (value ? "true" : "false")
		});
		return this;
	}

	public EventRecord AddField(string key, string value)
	{
		Data.Add(new EventRecordField(key)
		{
			String = value
		});
		return this;
	}

	public EventRecord AddField(string key, byte value)
	{
		return AddField(key, (int)value);
	}

	public EventRecord AddField(string key, sbyte value)
	{
		return AddField(key, (int)value);
	}

	public EventRecord AddField(string key, short value)
	{
		return AddField(key, (int)value);
	}

	public EventRecord AddField(string key, ushort value)
	{
		return AddField(key, (int)value);
	}

	public EventRecord AddField(string key, int value)
	{
		return AddField(key, (long)value);
	}

	public EventRecord AddField(string key, uint value)
	{
		return AddField(key, (long)value);
	}

	public EventRecord AddField(string key, ulong value)
	{
		return AddField(key, (long)value);
	}

	[Obsolete("Char not supported, either cast to int or string", true)]
	public EventRecord AddField(string key, char value)
	{
		throw new NotImplementedException();
	}

	public EventRecord AddField(string key, float value)
	{
		return AddField(key, (double)value);
	}

	public EventRecord AddField(string key, long value)
	{
		Data.Add(new EventRecordField(key)
		{
			Number = value
		});
		return this;
	}

	public EventRecord AddField(string key, double value)
	{
		Data.Add(new EventRecordField(key)
		{
			Float = value
		});
		return this;
	}

	public EventRecord AddField(string key, TimeSpan value)
	{
		Data.Add(new EventRecordField(key)
		{
			Number = value.Ticks * NSPerTick
		});
		return this;
	}

	public EventRecord AddLegacyTimespan(string key, TimeSpan value)
	{
		Data.Add(new EventRecordField(key)
		{
			Float = value.TotalSeconds
		});
		return this;
	}

	public EventRecord AddField(string key, Guid value)
	{
		Data.Add(new EventRecordField(key)
		{
			Guid = value
		});
		return this;
	}

	public EventRecord AddField(string key, Vector3 value)
	{
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		Data.Add(new EventRecordField(key)
		{
			Vector = value
		});
		return this;
	}

	public EventRecord AddField(string key, string key2, byte[] bytes)
	{
		EventRecordField item = new EventRecordField(key, key2);
		item.Bytes = Pool.Get<MemoryStream>();
		item.Bytes.Write(bytes);
		Data.Add(item);
		return this;
	}

	public EventRecord AddField(string key, string key2, MemoryStream bytes)
	{
		EventRecordField item = new EventRecordField(key, key2);
		item.Bytes = Pool.Get<MemoryStream>();
		item.Bytes.Write(bytes.GetBuffer(), (int)bytes.Position, (int)bytes.Length);
		Data.Add(item);
		return this;
	}

	public EventRecord AddField(string key, BaseNetworkable entity)
	{
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_0361: Unknown result type (might be due to invalid IL or missing references)
		//IL_0375: Unknown result type (might be due to invalid IL or missing references)
		//IL_037a: Unknown result type (might be due to invalid IL or missing references)
		//IL_037e: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)entity == (Object)null || entity.net == null)
		{
			return this;
		}
		if (entity is BasePlayer { IsNpc: false, IsBot: false } basePlayer)
		{
			string userWipeId = SingletonComponent<ServerMgr>.Instance.persistance.GetUserWipeId(basePlayer.userID);
			AddField(key, "_userid", userWipeId);
			AddField(key, "_steamid", basePlayer.UserIDString);
			AddField(key, "_modelstate", (basePlayer.modelStateTick ?? basePlayer.modelState).flags);
			AddField(key, "_tickViewAngles", basePlayer.tickViewAngles);
			AddField(key, "_mouse_delta", basePlayer.tickMouseDelta);
			AddField(key, "_heldentity", ((Object)(object)basePlayer.GetHeldEntity() != (Object)null) ? basePlayer.GetHeldEntity().ShortPrefabName : "");
			AddField(key, "_mounted", Object.op_Implicit((Object)(object)basePlayer.GetMounted()));
			AddField(key, "_parented", basePlayer.HasParent());
			if (basePlayer.IsAdmin || basePlayer.IsDeveloper)
			{
				AddField(key, "_admin", value: true);
			}
		}
		if (entity is BaseEntity { skinID: not 0uL } baseEntity)
		{
			AddField(key, "_skin", baseEntity.skinID);
		}
		if (entity is BaseProjectile baseProjectile)
		{
			Item item = baseProjectile.GetItem();
			if (item != null && (item.contents?.itemList?.Count).GetValueOrDefault() > 0)
			{
				List<string> list = Pool.Get<List<string>>();
				foreach (Item item2 in item.contents.itemList)
				{
					list.Add(item2.info.shortname);
				}
				AddObject(key + "_inventory", list);
				Pool.FreeUnmanaged<string>(ref list);
			}
		}
		if (entity is DroppedItem droppedItem && droppedItem.DroppedTime != default(DateTime) && droppedItem.DroppedTime >= DateTime.UnixEpoch)
		{
			string userWipeId2 = SingletonComponent<ServerMgr>.Instance.persistance.GetUserWipeId(droppedItem.DroppedBy);
			AddField("dropped_at", ((DateTimeOffset)droppedItem.DroppedTime).ToUnixTimeMilliseconds());
			AddField("dropped_by", userWipeId2);
			AddField("dropped_by_steam_id", droppedItem.DroppedBy);
		}
		if (entity is Door door)
		{
			AddField(key, "_building_id", door.buildingID);
		}
		if (entity is CodeLock codeLock && (Object)(object)codeLock.GetParentEntity() != (Object)null && codeLock.GetParentEntity() is DecayEntity entity2)
		{
			AddField("parent", (BaseNetworkable)entity2);
		}
		if (entity is BuildingBlock buildingBlock)
		{
			AddField(key, "_grade", (int)buildingBlock.grade);
			AddField(key, "_building_id", (int)buildingBlock.buildingID);
		}
		AddField(key, "_prefab", entity.ShortPrefabName);
		Transform transform = ((Component)entity).transform;
		AddField(key, "_pos", transform.position);
		Quaternion rotation = transform.rotation;
		AddField(key, "_rot", ((Quaternion)(ref rotation)).eulerAngles);
		AddField(key, "_id", entity.net.ID.Value);
		return this;
	}

	public EventRecord AddShortEntityField(string key, BaseEntity ent, bool includePos)
	{
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)ent == (Object)null || ent.net == null)
		{
			return this;
		}
		AddField(key, "_id", ent.net.ID.Value);
		AddField(key, "_prefab_id", ent.prefabID);
		if (includePos)
		{
			Transform transform = ((Component)ent).transform;
			AddField(key, "_pos", transform.position);
			Quaternion rotation = transform.rotation;
			AddField(key, "_rot", ((Quaternion)(ref rotation)).eulerAngles);
		}
		return this;
	}

	public EventRecord AddField(string key, Item item)
	{
		if (item == null)
		{
			return this;
		}
		AddField(key, "_name", item.info.shortname);
		AddField(key, "_amount", item.amount);
		AddField(key, "_skin", item.skin);
		AddField(key, "_condition", item.conditionNormalized);
		return this;
	}

	public void MarkSubmitted()
	{
		TimesSubmitted++;
		if (TimesCreated != TimesSubmitted)
		{
			Debug.LogError((object)$"EventRecord pooling error: event has been submitted ({TimesSubmitted}) a different amount of times than it was created ({TimesCreated})");
		}
	}

	public void Submit()
	{
		if (Analytics.UseV2)
		{
			if (IsServer)
			{
				Analytics.AzureWebInterface.GameplayEventsTableServer.Append(this);
				if (Analytics.AzureWebInterface.server.GameplayBulkUploader.NeedsCreation())
				{
					Analytics.AzureWebInterface.server.GameplayBulkUploader = null;
				}
			}
		}
		else if (IsServer)
		{
			Analytics.AzureWebInterface.server.EnqueueEvent(this);
		}
	}

	public void SerializeAsCSV(ref Utf8ValueStringBuilder writer)
	{
		if (Data.Count == 0)
		{
			return;
		}
		bool flag = false;
		foreach (EventRecordField datum in Data)
		{
			if (flag)
			{
				((Utf8ValueStringBuilder)(ref writer)).Append(',');
			}
			else
			{
				flag = true;
			}
			((Utf8ValueStringBuilder)(ref writer)).Append('"');
			datum.Serialize(ref writer, AnalyticsDocumentMode.CSV);
			((Utf8ValueStringBuilder)(ref writer)).Append('"');
		}
	}

	public void SerializeAsJson(ref Utf8ValueStringBuilder writer, bool useDataObject = true)
	{
		((Utf8ValueStringBuilder)(ref writer)).Append("{\"Timestamp\":\"");
		((Utf8ValueStringBuilder)(ref writer)).Append(Timestamp, StandardFormats.DateTime_ISO);
		bool flag = false;
		if (useDataObject)
		{
			((Utf8ValueStringBuilder)(ref writer)).Append("\",\"Data\":{");
		}
		else
		{
			((Utf8ValueStringBuilder)(ref writer)).Append("\"");
			flag = true;
		}
		foreach (EventRecordField datum in Data)
		{
			if (flag)
			{
				((Utf8ValueStringBuilder)(ref writer)).Append(',');
			}
			else
			{
				flag = true;
			}
			((Utf8ValueStringBuilder)(ref writer)).Append("\"");
			((Utf8ValueStringBuilder)(ref writer)).Append(datum.Key1);
			if (datum.Key2 != null)
			{
				((Utf8ValueStringBuilder)(ref writer)).Append(datum.Key2);
			}
			((Utf8ValueStringBuilder)(ref writer)).Append("\":");
			if (!datum.IsObject)
			{
				((Utf8ValueStringBuilder)(ref writer)).Append('"');
			}
			datum.Serialize(ref writer, AnalyticsDocumentMode.JSON);
			if (!datum.IsObject)
			{
				((Utf8ValueStringBuilder)(ref writer)).Append("\"");
			}
		}
		if (useDataObject)
		{
			((Utf8ValueStringBuilder)(ref writer)).Append('}');
		}
		((Utf8ValueStringBuilder)(ref writer)).Append('}');
	}

	public EventRecord AddField(byte value)
	{
		return AddField((long)value);
	}

	public EventRecord AddField(short value)
	{
		return AddField((long)value);
	}

	public EventRecord AddField(ushort value)
	{
		return AddField((long)value);
	}

	public EventRecord AddField(int value)
	{
		return AddField((long)value);
	}

	public EventRecord AddField(uint value)
	{
		return AddField((long)value);
	}

	public EventRecord AddField(ulong value)
	{
		return AddField((long)value);
	}

	public EventRecord AddField(float value)
	{
		return AddField((double)value);
	}

	[Obsolete("Char not supported, either cast to int or string")]
	public EventRecord AddField(char value)
	{
		throw new NotImplementedException();
	}

	public EventRecord AddField(long value)
	{
		Data.Add(new EventRecordField
		{
			Number = value
		});
		return this;
	}

	public EventRecord AddField(double value)
	{
		Data.Add(new EventRecordField
		{
			Float = value
		});
		return this;
	}

	public EventRecord AddField(string value)
	{
		Data.Add(new EventRecordField
		{
			String = value
		});
		return this;
	}

	public EventRecord AddField(bool value)
	{
		Data.Add(new EventRecordField
		{
			String = (value ? "true" : "false")
		});
		return this;
	}

	public EventRecord AddField(DateTime value)
	{
		Data.Add(new EventRecordField
		{
			DateTime = value
		});
		return this;
	}

	public EventRecord AddField(TimeSpan value)
	{
		Data.Add(new EventRecordField
		{
			Number = value.Ticks * NSPerTick
		});
		return this;
	}

	public EventRecord AddField(Guid value)
	{
		Data.Add(new EventRecordField
		{
			Guid = value
		});
		return this;
	}

	public EventRecord AddField(Vector3 vector)
	{
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		Data.Add(new EventRecordField
		{
			Vector = vector
		});
		return this;
	}

	public EventRecord AddField(byte[] bytes)
	{
		return AddField(null, null, bytes);
	}

	public EventRecord AddField(MemoryStream bytes)
	{
		return AddField(null, null, bytes);
	}

	public EventRecord AddField(string key1, string key2, byte value)
	{
		return AddField(key1, key2, (long)value);
	}

	public EventRecord AddField(string key1, string key2, short value)
	{
		return AddField(key1, key2, (long)value);
	}

	public EventRecord AddField(string key1, string key2, ushort value)
	{
		return AddField(key1, key2, (long)value);
	}

	public EventRecord AddField(string key1, string key2, int value)
	{
		return AddField(key1, key2, (long)value);
	}

	public EventRecord AddField(string key1, string key2, uint value)
	{
		return AddField(key1, key2, (long)value);
	}

	public EventRecord AddField(string key1, string key2, ulong value)
	{
		return AddField(key1, key2, (long)value);
	}

	public EventRecord AddField(string key1, string key2, float value)
	{
		return AddField(key1, key2, (double)value);
	}

	[Obsolete("Char not supported, either cast to int or string")]
	public EventRecord AddField(string key1, string key2, char value)
	{
		throw new NotImplementedException();
	}

	public EventRecord AddField(string key1, string key2, long value)
	{
		Data.Add(new EventRecordField(key1, key2)
		{
			Number = value
		});
		return this;
	}

	public EventRecord AddField(string key1, string key2, double value)
	{
		Data.Add(new EventRecordField(key1, key2)
		{
			Float = value
		});
		return this;
	}

	public EventRecord AddField(string key1, string key2, string value)
	{
		Data.Add(new EventRecordField(key1, key2)
		{
			String = value
		});
		return this;
	}

	public EventRecord AddField(string key1, string key2, bool value)
	{
		Data.Add(new EventRecordField(key1, key2)
		{
			String = (value ? "true" : "false")
		});
		return this;
	}

	public EventRecord AddField(string key1, string key2, DateTime value)
	{
		Data.Add(new EventRecordField(key1, key2)
		{
			DateTime = value
		});
		return this;
	}

	public EventRecord AddField(string key1, string key2, TimeSpan value)
	{
		Data.Add(new EventRecordField(key1, key2)
		{
			Number = value.Ticks * NSPerTick
		});
		return this;
	}

	public EventRecord AddField(string key1, string key2, Guid value)
	{
		Data.Add(new EventRecordField(key1, key2)
		{
			Guid = value
		});
		return this;
	}

	public EventRecord AddField(string key1, string key2, Vector3 vector)
	{
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		Data.Add(new EventRecordField(key1, key2)
		{
			Vector = vector
		});
		return this;
	}

	public EventRecord AddField(string key, byte[] bytes)
	{
		return AddField(key, null, bytes);
	}

	public EventRecord AddField(string key, MemoryStream bytes)
	{
		return AddField(key, null, bytes);
	}
}


using System;
using System.Buffers;
using System.IO;
using Cysharp.Text;
using Facepunch.Rust;
using UnityEngine;

public struct EventRecordField
{
	public string Key1;

	public string Key2;

	public string String;

	public long? Number;

	public double? Float;

	public Vector3? Vector;

	public Guid? Guid;

	public DateTime DateTime;

	public bool IsObject;

	public MemoryStream Bytes;

	public EventRecordField(string key1)
	{
		Key1 = key1;
		Key2 = null;
		String = null;
		Number = null;
		Float = null;
		Vector = null;
		Guid = null;
		IsObject = false;
		DateTime = default(DateTime);
		Bytes = null;
	}

	public EventRecordField(string key1, string key2)
	{
		Key1 = key1;
		Key2 = key2;
		String = null;
		Number = null;
		Float = null;
		Vector = null;
		Guid = null;
		IsObject = false;
		DateTime = default(DateTime);
		Bytes = null;
	}

	public void Serialize(ref Utf8ValueStringBuilder writer, AnalyticsDocumentMode format)
	{
		//IL_0195: Unknown result type (might be due to invalid IL or missing references)
		//IL_019a: Unknown result type (might be due to invalid IL or missing references)
		if (String != null)
		{
			if (IsObject)
			{
				((Utf8ValueStringBuilder)(ref writer)).Append(String);
				return;
			}
			string @string = String;
			int length = String.Length;
			for (int i = 0; i < length; i++)
			{
				char c = @string[i];
				if (c == '\\' && format == AnalyticsDocumentMode.JSON)
				{
					((Utf8ValueStringBuilder)(ref writer)).Append("\\\\");
					continue;
				}
				switch (c)
				{
				case '"':
					if (format == AnalyticsDocumentMode.JSON)
					{
						((Utf8ValueStringBuilder)(ref writer)).Append("\\\"");
					}
					else
					{
						((Utf8ValueStringBuilder)(ref writer)).Append("\"\"");
					}
					break;
				case '\n':
					((Utf8ValueStringBuilder)(ref writer)).Append("\\n");
					break;
				case '\r':
					((Utf8ValueStringBuilder)(ref writer)).Append("\\r");
					break;
				case '\t':
					((Utf8ValueStringBuilder)(ref writer)).Append("\\t");
					break;
				default:
					((Utf8ValueStringBuilder)(ref writer)).Append(c);
					break;
				}
			}
		}
		else if (Float.HasValue)
		{
			Span<char> destination = stackalloc char[128];
			Float.Value.TryFormat(destination, out var charsWritten);
			((Utf8ValueStringBuilder)(ref writer)).Append((ReadOnlySpan<char>)destination.Slice(0, charsWritten));
		}
		else if (Number.HasValue)
		{
			((Utf8ValueStringBuilder)(ref writer)).Append(Number.Value);
		}
		else if (Guid.HasValue)
		{
			StandardFormat standardFormat = new StandardFormat('N');
			((Utf8ValueStringBuilder)(ref writer)).Append(Guid.Value, standardFormat);
		}
		else if (Vector.HasValue)
		{
			Span<char> destination2 = stackalloc char[128];
			Vector3 value = Vector.Value;
			value.x.TryFormat(destination2, out var charsWritten2);
			((Utf8ValueStringBuilder)(ref writer)).Append((ReadOnlySpan<char>)destination2.Slice(0, charsWritten2));
			((Utf8ValueStringBuilder)(ref writer)).Append(',');
			value.y.TryFormat(destination2, out charsWritten2);
			((Utf8ValueStringBuilder)(ref writer)).Append((ReadOnlySpan<char>)destination2.Slice(0, charsWritten2));
			((Utf8ValueStringBuilder)(ref writer)).Append(',');
			value.z.TryFormat(destination2, out charsWritten2);
			((Utf8ValueStringBuilder)(ref writer)).Append((ReadOnlySpan<char>)destination2.Slice(0, charsWritten2));
		}
		else if (DateTime != default(DateTime))
		{
			((Utf8ValueStringBuilder)(ref writer)).Append(DateTime, StandardFormats.DateTime_ISO);
		}
		else if (Bytes != null)
		{
			Span<char> chars = stackalloc char[128];
			int num = 64;
			byte[] buffer = Bytes.GetBuffer();
			for (int j = 0; j < Bytes.Length; j += num)
			{
				int length2 = Mathf.Min(num, (int)Bytes.Length - j);
				Convert.TryToBase64Chars(new Span<byte>(buffer, j, length2), chars, out var charsWritten3);
				Span<char> span = chars.Slice(0, charsWritten3);
				((Utf8ValueStringBuilder)(ref writer)).Append((ReadOnlySpan<char>)span);
			}
		}
	}
}


using System;
using System.Collections;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Reflection;
using System.Threading.Tasks;
using ConVar;
using Facepunch;
using Facepunch.Ping;
using Facepunch.Rust;
using Network;
using UnityEngine;

public class PerformanceLogging
{
	private enum FrameType : byte
	{
		InGame
	}

	private struct LagSpike
	{
		public int FrameIndex;

		public TimeSpan Time;

		public bool WasGC;
	}

	private struct GarbageCollect
	{
		public int FrameIndex;

		public TimeSpan Time;
	}

	private class PerformancePool
	{
		public List<TimeSpan> Frametimes;

		public List<int> Ping;
	}

	[JsonModel]
	private struct PluginInfo
	{
		public string Name;

		public string Author;

		public string Version;
	}

	[JsonModel]
	private struct ProcessInfo
	{
		public string Name;

		public long WorkingSet;
	}

	public static PerformanceLogging server = new PerformanceLogging(client: false);

	public static PerformanceLogging client = new PerformanceLogging(client: true);

	private readonly TimeSpan ClientInterval = TimeSpan.FromMinutes(10.0);

	private readonly TimeSpan ServerInterval = TimeSpan.FromMinutes(1.0);

	private readonly TimeSpan PublicServerInterval = TimeSpan.FromHours(1.0);

	private readonly TimeSpan PingInterval = TimeSpan.FromSeconds(5.0);

	private List<TimeSpan> Frametimes = new List<TimeSpan>();

	private List<int> PingHistory = new List<int>();

	private List<LagSpike> lagSpikes = new List<LagSpike>();

	private List<GarbageCollect> garbageCollections = new List<GarbageCollect>();

	private Dictionary<string, int> pendingTimings = new Dictionary<string, int>();

	private bool isClient;

	private Stopwatch frameWatch = new Stopwatch();

	private DateTime nextPingTime;

	private DateTime nextFlushTime;

	private DateTime connectedTime;

	private int serverIndex;

	private Guid serverSessionId;

	private int lastFrameGC;

	private int nonGCLagSpikes;

	private Type oxideType;

	private bool hasOxideType;

	public PerformanceLogging(bool client)
	{
		isClient = client;
	}

	private TimeSpan GetLagSpikeThreshold()
	{
		if (!isClient)
		{
			return TimeSpan.FromMilliseconds(200.0);
		}
		return TimeSpan.FromMilliseconds(100.0);
	}

	public void OnFrame()
	{
		if (!isClient && !Analytics.ServerPerformanceConVar)
		{
			ResetMeasurements();
			return;
		}
		TimeSpan elapsed = frameWatch.Elapsed;
		FrameType frameType = FrameType.InGame;
		if (!isClient)
		{
			frameType = GetServerFrameType();
		}
		if (frameType == FrameType.InGame)
		{
			Frametimes.Add(elapsed);
		}
		frameWatch.Restart();
		DateTime utcNow = DateTime.UtcNow;
		int num = System.GC.CollectionCount(0);
		bool flag = lastFrameGC != num;
		lastFrameGC = num;
		if (flag)
		{
			GarbageCollect item = new GarbageCollect
			{
				FrameIndex = Frametimes.Count - 1,
				Time = elapsed
			};
			if (frameType == FrameType.InGame)
			{
				garbageCollections.Add(item);
			}
		}
		if (elapsed > GetLagSpikeThreshold())
		{
			LagSpike item2 = new LagSpike
			{
				FrameIndex = Frametimes.Count - 1,
				Time = elapsed,
				WasGC = flag
			};
			if (frameType == FrameType.InGame)
			{
				lagSpikes.Add(item2);
			}
			if (!flag)
			{
				nonGCLagSpikes++;
			}
		}
		if (utcNow > nextFlushTime)
		{
			try
			{
				FlushMainThread();
			}
			catch (Exception ex)
			{
				Debug.LogError((object)("Failed to flush analytics: " + ex));
			}
		}
		static FrameType GetServerFrameType()
		{
			return FrameType.InGame;
		}
	}

	private Dictionary<string, string> FindModifiedConvars()
	{
		Dictionary<string, string> dictionary = new Dictionary<string, string>();
		Command[] all = Index.All;
		foreach (Command val in all)
		{
			if (val.DefaultValue != null && val.GetOveride != null)
			{
				string text = val.GetOveride();
				if (text != val.DefaultValue)
				{
					dictionary[val.FullName] = text;
				}
			}
		}
		return dictionary;
	}

	public void FlushMainThread()
	{
		nextFlushTime = DateTime.UtcNow.Add(GetFlushInterval());
		if (!isClient && (BasePlayer.activePlayerList.Count == 0 || !Analytics.ServerPerformanceConVar))
		{
			ResetMeasurements();
			return;
		}
		Stopwatch stopwatch = Stopwatch.StartNew();
		EventRecord record = EventRecord.New(isClient ? "client_performance" : "server_performance", !isClient);
		record.AddObject("modified_convars", FindModifiedConvars());
		record.AddField("command_line", CommandLine.FullSafe);
		bool flag = false;
		if (!lagSpikes.IsEmpty())
		{
			record.AddField("lag_spike_count", lagSpikes.Count);
			flag = true;
		}
		if (nonGCLagSpikes > 0)
		{
			record.AddField("lag_spike_no_gc_count", nonGCLagSpikes);
			flag = true;
		}
		if (flag)
		{
			record.AddLegacyTimespan("lag_spike_threshold", GetLagSpikeThreshold());
		}
		if (!garbageCollections.IsEmpty())
		{
			record.AddField("gc_count", garbageCollections.Count);
		}
		record.AddField("ram_managed", System.GC.GetTotalMemory(forceFullCollection: false)).AddField("ram_total", SystemInfoEx.systemMemoryUsed).AddField("uptime", (int)Time.realtimeSinceStartup)
			.AddField("map_url", World.Url)
			.AddField("world_size", World.Size)
			.AddField("world_seed", World.Seed)
			.AddField("world_ts", World.Timestamp)
			.AddField("active_scene", LevelManager.CurrentLevelName);
		if (pendingTimings.Count > 0)
		{
			record.AddObject("load_times", pendingTimings);
			pendingTimings.Clear();
		}
		IPingEstimateResults estimateToAllRegions = PingEstimater.GetEstimateToAllRegions();
		if (estimateToAllRegions != null)
		{
			record.AddObject("ping_regions", estimateToAllRegions.GetAllRegions());
		}
		if (!isClient && !isClient)
		{
			int value = (int)((Net.sv != null) ? ((BaseNetwork)Net.sv).GetStat((Connection)null, (StatTypeLong)3) : 0);
			int value2 = (int)((Net.sv != null) ? ((BaseNetwork)Net.sv).GetStat((Connection)null, (StatTypeLong)1) : 0);
			record.AddField("is_official", Server.official && Server.stats).AddField("bot_count", BasePlayer.bots.Count).AddField("player_count", BasePlayer.activePlayerList.Count)
				.AddField("max_players", Server.maxplayers)
				.AddField("ent_count", BaseNetworkable.serverEntities.Count)
				.AddField("hostname", Server.hostname)
				.AddField("net_in", value)
				.AddField("net_out", value2);
		}
		if (!isClient)
		{
			try
			{
				if (!hasOxideType)
				{
					oxideType = Type.GetType("Oxide.Core.Interface,Oxide.Core");
					hasOxideType = true;
				}
				if (oxideType != null)
				{
					record.AddField("is_oxide", value: true);
					object obj = oxideType.GetProperty("Oxide", BindingFlags.Static | BindingFlags.Public)?.GetValue(null);
					if (obj != null)
					{
						object obj2 = obj.GetType().GetProperty("RootPluginManager", BindingFlags.Instance | BindingFlags.Public | BindingFlags.NonPublic)?.GetValue(obj);
						if (obj2 != null)
						{
							List<PluginInfo> list = new List<PluginInfo>();
							foreach (object item in obj2.GetType().GetMethod("GetPlugins")?.Invoke(obj2, null) as IEnumerable)
							{
								if (item != null)
								{
									string name = item.GetType().GetProperty("Name")?.GetValue(item) as string;
									string author = item.GetType().GetProperty("Author")?.GetValue(item) as string;
									string version = item.GetType().GetProperty("Version")?.GetValue(item)?.ToString();
									list.Add(new PluginInfo
									{
										Name = name,
										Author = author,
										Version = version
									});
								}
							}
							record.AddObject("oxide_plugins", list);
							record.AddField("oxide_plugin_count", list.Count);
						}
					}
				}
			}
			catch (Exception arg)
			{
				Debug.LogError((object)$"Failed to get oxide when flushing server performance: {arg}");
			}
			try
			{
				List<ProcessInfo> list2 = new List<ProcessInfo>();
				Process[] processes = Process.GetProcesses();
				Process currentProcess = Process.GetCurrentProcess();
				Process[] array = processes;
				foreach (Process process in array)
				{
					try
					{
						if (currentProcess.Id != process.Id && process.ProcessName.Contains("RustDedicated"))
						{
							list2.Add(new ProcessInfo
							{
								Name = process.ProcessName,
								WorkingSet = process.WorkingSet64
							});
						}
					}
					catch (Exception ex)
					{
						if (!(ex is InvalidOperationException))
						{
							Debug.LogWarning((object)$"Failed to get memory from process when flushing performance info: {ex}");
							list2.Add(new ProcessInfo
							{
								Name = process.ProcessName,
								WorkingSet = -1L
							});
						}
					}
				}
				record.AddObject("other_servers", list2);
				record.AddField("other_server_count", list2.Count);
			}
			catch (Exception arg2)
			{
				Debug.LogError((object)$"Failed to log processes when flushing performance info: {arg2}");
			}
		}
		if (!isClient)
		{
			IEnumerable<HarmonyModInfo> harmonyMods = HarmonyLoader.GetHarmonyMods();
			record.AddObject("harmony_mods", harmonyMods);
			record.AddField("harmony_mod_count", harmonyMods.Count());
		}
		record.AddObject("hardware", Analytics.Azure.GetHardwareData()).AddObject("application", Analytics.Azure.GetApplicationData());
		stopwatch.Stop();
		record.AddField("flush_ms", stopwatch.ElapsedMilliseconds);
		List<TimeSpan> frametimes = Frametimes;
		List<int> ping = PingHistory;
		List<long> gpuFrameTimes = null;
		List<TimeSpan> mainMenuFrametimes = null;
		List<TimeSpan> inventoryFrametimes = null;
		List<TimeSpan> craftingFrametimes = null;
		List<TimeSpan> contactsFrametimes = null;
		List<TimeSpan> mapFrametimes = null;
		Task.Run(async delegate
		{
			try
			{
				await ProcessPerformanceData(record, frametimes, mainMenuFrametimes, inventoryFrametimes, craftingFrametimes, contactsFrametimes, mapFrametimes, gpuFrameTimes, ping);
			}
			catch (Exception ex2)
			{
				Debug.LogException(ex2);
			}
		});
		ResetMeasurements();
	}

	private TimeSpan GetFlushInterval()
	{
		if (!isClient)
		{
			if (Analytics.Azure.GameplayAnalytics)
			{
				return ServerInterval;
			}
			return PublicServerInterval;
		}
		return TimeSpan.FromHours(1.0);
	}

	private void ResetMeasurements()
	{
		nextFlushTime = DateTime.UtcNow.Add(GetFlushInterval());
		if (Frametimes.Count != 0)
		{
			Frametimes = Pool.Get<List<TimeSpan>>();
			PingHistory = Pool.Get<List<int>>();
			lagSpikes.Clear();
			garbageCollections.Clear();
			nonGCLagSpikes = 0;
		}
	}

	private Task ProcessPerformanceData(EventRecord record, List<TimeSpan> frametimes, List<TimeSpan> mainMenuFrametimes, List<TimeSpan> inventoryFrametimes, List<TimeSpan> craftingFrametimes, List<TimeSpan> contactsFrametimes, List<TimeSpan> mapFrametimes, List<long> gpuFrameTimes, List<int> ping)
	{
		int num = frametimes.Count;
		if (isClient)
		{
			num += mainMenuFrametimes.Count;
			num += inventoryFrametimes.Count;
			num += craftingFrametimes.Count;
			num += contactsFrametimes.Count;
			num += mapFrametimes.Count;
		}
		if (num == 0)
		{
			return Task.CompletedTask;
		}
		ApendFrameTimes(record, "", frametimes);
		if (isClient)
		{
			ApendFrameTimes(record, "mainmenu_", mainMenuFrametimes);
			ApendFrameTimes(record, "inventory_", inventoryFrametimes);
			ApendFrameTimes(record, "crafting_", craftingFrametimes);
			ApendFrameTimes(record, "contacts_", contactsFrametimes);
			ApendFrameTimes(record, "map_", mapFrametimes);
		}
		record.AddField("gc_generations", System.GC.MaxGeneration).AddField("gc_total", System.GC.CollectionCount(System.GC.MaxGeneration));
		if (isClient)
		{
			record.AddField("ping_average", (ping.Count != 0) ? ((int)ping.Average()) : 0).AddField("ping_count", ping.Count);
		}
		record.Submit();
		Pool.FreeUnmanaged<TimeSpan>(ref frametimes);
		if (isClient)
		{
			Pool.FreeUnmanaged<TimeSpan>(ref mainMenuFrametimes);
			Pool.FreeUnmanaged<TimeSpan>(ref inventoryFrametimes);
			Pool.FreeUnmanaged<TimeSpan>(ref craftingFrametimes);
			Pool.FreeUnmanaged<TimeSpan>(ref contactsFrametimes);
			Pool.FreeUnmanaged<TimeSpan>(ref mapFrametimes);
		}
		Pool.FreeUnmanaged<int>(ref ping);
		if (gpuFrameTimes != null)
		{
			Pool.FreeUnmanaged<long>(ref gpuFrameTimes);
		}
		return Task.CompletedTask;
		static void ApendFrameTimes(EventRecord record, string prefix, List<TimeSpan> times)
		{
			if (times.Count <= 1)
			{
				return;
			}
			PooledList<TimeSpan> val = Pool.Get<PooledList<TimeSpan>>();
			try
			{
				((List<TimeSpan>)(object)val).AddRange((IEnumerable<TimeSpan>)times);
				((List<TimeSpan>)(object)val).Sort();
				int count = times.Count;
				Mathf.Max(1, times.Count / 100);
				Mathf.Max(1, times.Count / 1000);
				TimeSpan value = default(TimeSpan);
				for (int i = 0; i < count; i++)
				{
					TimeSpan timeSpan = ((List<TimeSpan>)(object)val)[i];
					value += timeSpan;
				}
				double frametime_average = value.TotalMilliseconds / (double)count;
				double value2 = Math.Sqrt(((IEnumerable<TimeSpan>)val).Sum((TimeSpan x) => Math.Pow(x.TotalMilliseconds - frametime_average, 2.0)) / (double)(((List<TimeSpan>)(object)val).Count - 1));
				record.AddLegacyTimespan(prefix + "total_time", value).AddField(prefix + "frames", count).AddField(prefix + "frametime_average", value.TotalSeconds / (double)count)
					.AddLegacyTimespan(prefix + "frametime_99_9", ((List<TimeSpan>)(object)val)[Mathf.Clamp(count - count / 1000, 0, count - 1)])
					.AddLegacyTimespan(prefix + "frametime_99", ((List<TimeSpan>)(object)val)[Mathf.Clamp(count - count / 100, 0, count - 1)])
					.AddLegacyTimespan(prefix + "frametime_90", ((List<TimeSpan>)(object)val)[Mathf.Clamp(count - count / 10, 0, count - 1)])
					.AddLegacyTimespan(prefix + "frametime_75", ((List<TimeSpan>)(object)val)[Mathf.Clamp(count - count / 4, 0, count - 1)])
					.AddLegacyTimespan(prefix + "frametime_50", ((List<TimeSpan>)(object)val)[count / 2])
					.AddLegacyTimespan(prefix + "frametime_25", ((List<TimeSpan>)(object)val)[count / 4])
					.AddLegacyTimespan(prefix + "frametime_10", ((List<TimeSpan>)(object)val)[count / 10])
					.AddLegacyTimespan(prefix + "frametime_1", ((List<TimeSpan>)(object)val)[count / 100])
					.AddLegacyTimespan(prefix + "frametime_0_1", ((List<TimeSpan>)(object)val)[count / 1000])
					.AddField(prefix + "frametime_std_dev", value2);
			}
			finally
			{
				((IDisposable)val)?.Dispose();
			}
		}
	}

	public void SetTiming(string category, TimeSpan elapsed)
	{
		pendingTimings[category] = (int)elapsed.TotalMilliseconds;
	}
}


private enum FrameType : byte
{
	InGame
}


using System;

private struct LagSpike
{
	public int FrameIndex;

	public TimeSpan Time;

	public bool WasGC;
}


using System;

private struct GarbageCollect
{
	public int FrameIndex;

	public TimeSpan Time;
}


using System;
using System.Collections.Generic;

private class PerformancePool
{
	public List<TimeSpan> Frametimes;

	public List<int> Ping;
}


[JsonModel]
private struct PluginInfo
{
	public string Name;

	public string Author;

	public string Version;
}


[JsonModel]
private struct ProcessInfo
{
	public string Name;

	public long WorkingSet;
}


using System;
using System.Diagnostics;
using System.Runtime.CompilerServices;
using System.Runtime.InteropServices;
using UnityEngine;

[StructLayout(LayoutKind.Auto)]
private struct <<FlushMainThread>b__0>d : IAsyncStateMachine
{
	public int <>1__state;

	public AsyncTaskMethodBuilder <>t__builder;

	public <>c__DisplayClass32_0 <>4__this;

	private TaskAwaiter <>u__1;

	private void MoveNext()
	{
		int num = <>1__state;
		<>c__DisplayClass32_0 <>c__DisplayClass32_ = <>4__this;
		try
		{
			try
			{
				TaskAwaiter awaiter;
				if (num != 0)
				{
					awaiter = <>c__DisplayClass32_.<>4__this.ProcessPerformanceData(<>c__DisplayClass32_.record, <>c__DisplayClass32_.frametimes, <>c__DisplayClass32_.mainMenuFrametimes, <>c__DisplayClass32_.inventoryFrametimes, <>c__DisplayClass32_.craftingFrametimes, <>c__DisplayClass32_.contactsFrametimes, <>c__DisplayClass32_.mapFrametimes, <>c__DisplayClass32_.gpuFrameTimes, <>c__DisplayClass32_.ping).GetAwaiter();
					if (!awaiter.IsCompleted)
					{
						num = (<>1__state = 0);
						<>u__1 = awaiter;
						<>t__builder.AwaitUnsafeOnCompleted(ref awaiter, ref this);
						return;
					}
				}
				else
				{
					awaiter = <>u__1;
					<>u__1 = default(TaskAwaiter);
					num = (<>1__state = -1);
				}
				awaiter.GetResult();
			}
			catch (Exception ex)
			{
				Debug.LogException(ex);
			}
		}
		catch (Exception exception)
		{
			<>1__state = -2;
			<>t__builder.SetException(exception);
			return;
		}
		<>1__state = -2;
		<>t__builder.SetResult();
	}

	void IAsyncStateMachine.MoveNext()
	{
		//ILSpy generated this explicit interface implementation from .override directive in MoveNext
		this.MoveNext();
	}

	[DebuggerHidden]
	private void SetStateMachine(IAsyncStateMachine stateMachine)
	{
		<>t__builder.SetStateMachine(stateMachine);
	}

	void IAsyncStateMachine.SetStateMachine(IAsyncStateMachine stateMachine)
	{
		//ILSpy generated this explicit interface implementation from .override directive in SetStateMachine
		this.SetStateMachine(stateMachine);
	}
}


using System;
using Facepunch;
using Facepunch.Rust;
using UnityEngine;

public class TickLogging
{
	private static int tickUploaderInterval = 60;

	public static AzureAnalyticsUploader tickUploader;

	public static AnalyticsTable TickTable = new AnalyticsTable(GetTickTableName(), TimeSpan.FromSeconds(tick_uploader_lifetime), AnalyticsDocumentMode.CSV);

	[Help("time (in seconds) before the tick uploader is disposed and recreated")]
	[ServerVar]
	public static int tick_uploader_lifetime
	{
		get
		{
			return tickUploaderInterval;
		}
		set
		{
			tickUploaderInterval = value;
			TimeSpan uploadInterval = TimeSpan.FromSeconds(tickUploaderInterval);
			TickTable.UploadInterval = uploadInterval;
		}
	}

	private static string GetTickTableName()
	{
		BuildInfo current = BuildInfo.Current;
		bool num = (current.Scm.Branch != null && current.Scm.Branch == "experimental/release") || current.Scm.Branch == "release";
		bool isEditor = Application.isEditor;
		string text = ((num && !isEditor) ? "release" : (isEditor ? "editor" : "staging"));
		return "player_ticks_" + text;
	}

	public static void RegisterForAnalytics(AnalyticsManager manager)
	{
		manager.AddTable(TickTable, manager.AzureBulkUploader);
	}
}


using System.Net;
using ConVar;

public static class HttpManager
{
	public static void UpdateMaxConnections()
	{
		ServicePointManager.DefaultConnectionLimit = Server.http_connection_limit;
	}
}


using System;
using System.Collections.Generic;
using System.Runtime.CompilerServices;
using ConVar;
using Facepunch.Rust;
using Facepunch.Rust.Profiling;
using Rust;
using UnityEngine;

public static class EntityProfiler
{
	public class EntityCounter
	{
		public string Name;

		public int count;

		public int spawned;

		public int killed;

		public bool queued;

		public EntityCounter(string name)
		{
			Name = name;
		}

		[MethodImpl(MethodImplOptions.AggressiveInlining)]
		public void Reset()
		{
			spawned = 0;
			killed = 0;
			queued = false;
		}
	}

	public static int mode = 0;

	public static TimeSpan aggregateEntityCountDelay = TimeSpan.FromSeconds(300.0);

	public static int spawned;

	public static int killed;

	public static Dictionary<uint, EntityCounter> counts = new Dictionary<uint, EntityCounter>();

	public static List<EntityCounter> list = new List<EntityCounter>();

	private static DateTime aggregateEntityCountCooldown;

	public static void OnSpawned(BaseNetworkable entity)
	{
		if (!counts.TryGetValue(entity.prefabID, out var value))
		{
			value = new EntityCounter(entity.ShortPrefabName);
			counts[entity.prefabID] = value;
		}
		if (!value.queued)
		{
			list.Add(value);
			value.queued = true;
		}
		value.spawned++;
		value.count++;
	}

	public static void OnKilled(BaseNetworkable entity)
	{
		if (!counts.TryGetValue(entity.prefabID, out var value))
		{
			value = new EntityCounter(entity.ShortPrefabName);
			counts[entity.prefabID] = value;
		}
		if (!value.queued)
		{
			list.Add(value);
			value.queued = true;
		}
		value.killed++;
		value.count--;
	}

	public static void Reset()
	{
		killed = 0;
		spawned = 0;
		foreach (EntityCounter item in list)
		{
			item.Reset();
		}
		list.Clear();
	}

	public static void TrySerializeEntityAggregates(int frameIndex, DateTime timestamp, AzureAnalyticsUploader uploader, AnalyticsTable table)
	{
		if (mode < 3 || Application.isLoadingSave || aggregateEntityCountCooldown > DateTime.UtcNow)
		{
			return;
		}
		aggregateEntityCountCooldown = DateTime.UtcNow + aggregateEntityCountDelay;
		foreach (EntityCounter value in counts.Values)
		{
			EventRecord eventRecord = EventRecord.CSV();
			eventRecord.AddField("", timestamp).AddField("", ConVar.Server.server_id).AddField("", frameIndex)
				.AddField("", value.Name)
				.AddField("", value.count);
			if (Analytics.UseV2)
			{
				table.Append(eventRecord);
			}
			else
			{
				uploader.Append(eventRecord);
			}
		}
	}

	public static void Serialize(EventRecord record, int frameIndex, DateTime timestamp, AzureAnalyticsUploader uploader, AnalyticsTable table)
	{
		if (mode == 0)
		{
			return;
		}
		try
		{
			record.AddField("entities_spawned", spawned);
			record.AddField("entities_killed", killed);
			if (mode < 3)
			{
				return;
			}
			foreach (EntityCounter item in list)
			{
				EventRecord eventRecord = EventRecord.CSV();
				eventRecord.AddField("", timestamp).AddField("", ConVar.Server.server_id).AddField("", frameIndex)
					.AddField("", item.Name)
					.AddField("", item.spawned)
					.AddField("", item.killed);
				if (Analytics.UseV2)
				{
					table.Append(eventRecord);
				}
				else
				{
					uploader.Append(eventRecord);
				}
			}
		}
		catch (Exception ex)
		{
			Debug.LogException(ex);
		}
	}
}


using System.Runtime.CompilerServices;

public class EntityCounter
{
	public string Name;

	public int count;

	public int spawned;

	public int killed;

	public bool queued;

	public EntityCounter(string name)
	{
		Name = name;
	}

	[MethodImpl(MethodImplOptions.AggressiveInlining)]
	public void Reset()
	{
		spawned = 0;
		killed = 0;
		queued = false;
	}
}


using System;
using System.Collections.Generic;
using ConVar;
using Facepunch;
using Facepunch.Extend;
using Facepunch.Rust;
using Network;
using UnityEngine;

public static class LagSpikeProfiler
{
	public static bool enabled = false;

	private static List<EventRecord> pendingEvents = new List<EventRecord>();

	public static void Serialize(AzureAnalyticsUploader uploader, AnalyticsTable table, int frameIndex, DateTime timestamp)
	{
		try
		{
			if (!enabled)
			{
				return;
			}
			foreach (EventRecord pendingEvent in pendingEvents)
			{
				pendingEvent.Timestamp = timestamp;
				pendingEvent.AddField("frame_index", frameIndex);
				if (Analytics.UseV2)
				{
					table.Append(pendingEvent);
				}
				else
				{
					uploader.Append(pendingEvent);
				}
			}
		}
		catch (Exception ex)
		{
			Debug.LogError((object)("Failed to serialize lag spikes: " + ex.Message));
		}
	}

	public static void Reset()
	{
		pendingEvents.Clear();
	}

	private static void AddPendingRecord(EventRecord record)
	{
		pendingEvents.Add(record);
		if (pendingEvents.Count > 5000)
		{
			Pool.Free<EventRecord>(ref record);
		}
	}

	public static void RPC(TimeSpan time, Message packet, BaseEntity entity, uint rpcId)
	{
		if (enabled)
		{
			string value = StringPool.Get(rpcId);
			AddPendingRecord(CreateRecord(time, "rpc").AddField("entity", (BaseNetworkable)entity).AddField("rpc", value).AddField("connection_user", ((packet == null) ? ((ulong?)null) : packet.connection?.userid).GetValueOrDefault()));
		}
	}

	public static void ConsoleCommand(TimeSpan time, Message packet, string command)
	{
		if (enabled)
		{
			string value = StringExtensions.Truncate(command, 4096, (string)null);
			AddPendingRecord(CreateRecord(time, "console_command").AddField("command", value).AddField("command_length", command.Length).AddField("connection_user", ((packet == null) ? ((ulong?)null) : packet.connection?.userid).GetValueOrDefault()));
		}
	}

	public static void RconCommand(TimeSpan time, string command)
	{
		if (enabled)
		{
			string value = StringExtensions.Truncate(command, 4096, (string)null);
			AddPendingRecord(CreateRecord(time, "console_command").AddField("command", value).AddField("command_length", command.Length));
		}
	}

	private static EventRecord CreateRecord(TimeSpan duration, string reason)
	{
		return EventRecord.New("lag_spike").AddField("duration", duration).AddField("reason", reason)
			.AddField("server_id", Server.server_id);
	}
}


using System;
using System.Collections.Concurrent;
using System.Collections.Generic;
using System.Diagnostics;
using System.IO;
using System.Text;
using ConVar;
using Facepunch;
using Facepunch.Rust;
using Facepunch.Rust.Profiling;
using Network;
using Unity.Profiling;
using Unity.Profiling.LowLevel;
using Unity.Profiling.LowLevel.Unsafe;
using UnityEngine;

[Factory("profile")]
public static class RuntimeProfiler
{
	private static class ProfilerCategories
	{
		public static readonly ProfilerCategory VSync = new ProfilerCategory("VSync");

		public static readonly ProfilerCategory PlayerLoop = new ProfilerCategory("PlayerLoop");
	}

	private static int profilingPreset = 0;

	private static int _profilingInterval = 60;

	private static bool _init = false;

	private static Stopwatch serializationTimer = new Stopwatch();

	private static AzureAnalyticsUploader frameProfilingUploader;

	private static AzureAnalyticsUploader entityProfilingUploader;

	private static AzureAnalyticsUploader entityAggregateUploader;

	private static AzureAnalyticsUploader invokeDetailsUploader;

	private static AzureAnalyticsUploader methodUploader;

	private static AzureAnalyticsUploader objectWorkQueueUploader;

	private static AzureAnalyticsUploader packetUploader;

	private static AzureAnalyticsUploader lagSpikeUploader;

	private static AzureAnalyticsUploader rconUploader;

	private static AzureAnalyticsUploader raknetUploader;

	private static AzureAnalyticsUploader poolUploader;

	public static AnalyticsTable FrameProfilingTable = new AnalyticsTable("frame_profiling", TimeSpan.FromSeconds(runtime_profiling_interval));

	public static AnalyticsTable EntityProfilingTable = new AnalyticsTable("entity_profiling", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);

	public static AnalyticsTable EntityAggregateTable = new AnalyticsTable("entity_aggregates", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);

	public static AnalyticsTable InvokeDetailsTable = new AnalyticsTable("invoke_minute_breakdown", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);

	public static AnalyticsTable MethodTable = new AnalyticsTable("unity_methods", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);

	public static AnalyticsTable ObjectWorkQueueTable = new AnalyticsTable("object_work_queue", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);

	public static AnalyticsTable PacketTable = new AnalyticsTable("packets_per_type", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);

	public static AnalyticsTable LagSpikeTable = new AnalyticsTable("lag_spikes", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.JSON, useJsonDataObject: true);

	public static AnalyticsTable RconTable = new AnalyticsTable("rcon_profiling", TimeSpan.FromSeconds(runtime_profiling_interval));

	public static AnalyticsTable RaknetTable = new AnalyticsTable("raknet", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);

	public static AnalyticsTable PoolTable = new AnalyticsTable("pool_profiling", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.JSON, useJsonDataObject: true);

	public static TimeSpan ServerMgr_Update;

	public static TimeSpan Net_Cycle;

	public static TimeSpan Physics_SyncTransforms;

	public static TimeSpan Companion_Tick;

	public static TimeSpan BasePlayer_ServerCycle;

	private static DateTime nextPoolFlush;

	private static DateTime lastInvokeSerialization = DateTime.UtcNow;

	private static readonly ProfilerRecorderOptions PhysicsRecorderOptions = (ProfilerRecorderOptions)8;

	private static readonly List<RustProfilerRecorder> recorders = new List<RustProfilerRecorder>
	{
		new RustProfilerRecorder("cpu_total", ProfilerCategory.Scripts, "CPU Total Frame Time", 1, (ProfilerRecorderOptions)24),
		new RustProfilerRecorder("main_thread", ProfilerCategory.Scripts, "CPU Main Thread Frame Time", 1, (ProfilerRecorderOptions)24),
		new RustProfilerRecorder("gc_collect_time", ProfilerCategory.Memory, "GC.Collect", 1, (ProfilerRecorderOptions)24),
		new RustProfilerRecorder("player_loop", ProfilerCategories.PlayerLoop, "PlayerLoop", 1, (ProfilerRecorderOptions)24),
		new RustProfilerRecorder("wait_for_target_fps", ProfilerCategories.VSync, "WaitForTargetFPS", 1, (ProfilerRecorderOptions)24),
		new RustProfilerRecorder("ram_app_resident", ProfilerCategory.Memory, "App Resident Memory", 1, (ProfilerRecorderOptions)24),
		new RustProfilerRecorder("ram_total_used", ProfilerCategory.Memory, "Total Used Memory", 1, (ProfilerRecorderOptions)24),
		new RustProfilerRecorder("ram_gc_used", ProfilerCategory.Memory, "GC Used Memory", 1, (ProfilerRecorderOptions)24),
		new RustProfilerRecorder("gc_alloc_bytes", ProfilerCategory.Memory, "GC Allocated In Frame", 1, (ProfilerRecorderOptions)24),
		new RustProfilerRecorder("gc_alloc_count", ProfilerCategory.Memory, "GC Allocation In Frame Count", 1, (ProfilerRecorderOptions)24),
		new RustProfilerRecorder("active_dynamic_bodies", ProfilerCategory.Physics, "ctive Dynamic Bodies", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("active_kinematic_bodies", ProfilerCategory.Physics, "Active Kinematic Bodies", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("static_colliders", ProfilerCategory.Physics, "Static Colliders", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("dynamic_bodies", ProfilerCategory.Physics, "Dynamic Bodies", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("articulation_bodies", ProfilerCategory.Physics, "Articulation Bodies", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("active_constraints", ProfilerCategory.Physics, "Active Constraints", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("overlaps", ProfilerCategory.Physics, "Overlaps", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("discreet_overlaps", ProfilerCategory.Physics, "Discreet Overlaps", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("continuous_overlaps", ProfilerCategory.Physics, "Continuous Overlaps", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("modified_overlaps", ProfilerCategory.Physics, "Modified Overlaps", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("trigger_overlaps", ProfilerCategory.Physics, "Trigger Overlaps", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("colliders_synced", ProfilerCategory.Physics, "Colliders Synced", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("rigidbodies_synced", ProfilerCategory.Physics, "Rigidbodies Synced", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("physics_queries", ProfilerCategory.Physics, "Physics Queries", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("broadphase_adds_removes", ProfilerCategory.Physics, "Broadphase Adds/Removes", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("broadphase_adds", ProfilerCategory.Physics, "Broadphase Adds", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("broadphase_removes", ProfilerCategory.Physics, "Broadphase Removes", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("narrowphase_touches", ProfilerCategory.Physics, "Narrowphase Touches", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("narrowphase_new_touches", ProfilerCategory.Physics, "Narrowphase New Touches", 1, PhysicsRecorderOptions),
		new RustProfilerRecorder("narrowphase_lost_touches", ProfilerCategory.Physics, "Narrowphase Lost Touches", 1, PhysicsRecorderOptions)
	};

	private static Stopwatch invokeExecutionResetTimer = new Stopwatch();

	[RconVar]
	public static int rpc_lagspike_threshold
	{
		get
		{
			return (int)RpcWarningThreshold.TotalMilliseconds;
		}
		set
		{
			RpcWarningThreshold = TimeSpan.FromMilliseconds(value);
		}
	}

	[RconVar]
	public static int command_lagspike_threshold
	{
		get
		{
			return (int)ConsoleCommandWarningThreshold.TotalMilliseconds;
		}
		set
		{
			ConsoleCommandWarningThreshold = TimeSpan.FromMilliseconds(value);
		}
	}

	[RconVar]
	public static int rcon_lagspike_threshold
	{
		get
		{
			return (int)RconCommandWarningThreshold.TotalMilliseconds;
		}
		set
		{
			RconCommandWarningThreshold = TimeSpan.FromMilliseconds(value);
		}
	}

	public static TimeSpan RpcWarningThreshold { get; private set; } = TimeSpan.FromMilliseconds(40.0);

	public static TimeSpan ConsoleCommandWarningThreshold { get; private set; } = TimeSpan.FromMilliseconds(40.0);

	public static TimeSpan RconCommandWarningThreshold { get; private set; } = TimeSpan.FromMilliseconds(40.0);

	[RconVar(Saved = true, Help = "0 = off, 1 = basic, 2 = everything. This will reset all profiling convars, however they can be modified afterwards")]
	public static int runtime_profiling
	{
		get
		{
			return profilingPreset;
		}
		set
		{
			profilingPreset = Mathf.Max(0, value);
			OnProfilingPresetChanged();
		}
	}

	[RconVar(Saved = true, Help = "Enable to allow runtime profiling to persist across restarts")]
	public static bool runtime_profiling_persist { get; set; } = false;

	[RconVar(Help = "Record inbound RPC & ConsoleCommands that cause lag spikes")]
	public static bool profiling_lagspikes
	{
		get
		{
			return LagSpikeProfiler.enabled;
		}
		set
		{
			LagSpikeProfiler.enabled = value;
		}
	}

	[RconVar(Help = "Record type of packets inbound/outbound per frame")]
	public static bool profiling_packets
	{
		get
		{
			return PacketProfiler.enabled;
		}
		set
		{
			PacketProfiler.enabled = value;
		}
	}

	[RconVar(Help = "0 = off, 1 = stats per frame, 2 = stats per method")]
	public static int profiling_invokes
	{
		get
		{
			return InvokeProfiler.update.mode;
		}
		set
		{
			InvokeProfiler.update.mode = Mathf.Max(0, value);
		}
	}

	[RconVar(Help = "0 = off, 1 = stats per frame, 2 = stats per method")]
	public static int profiling_fixed_invokes
	{
		get
		{
			return InvokeProfiler.fixedUpdate.mode;
		}
		set
		{
			InvokeProfiler.fixedUpdate.mode = Mathf.Max(0, value);
		}
	}

	[RconVar(Help = "0 = off, 1 = spawn/kill, 2 = spawn/kill per entity, 3 = count every '5 min'")]
	public static int profiling_entities
	{
		get
		{
			return EntityProfiler.mode;
		}
		set
		{
			EntityProfiler.mode = Mathf.Max(0, value);
		}
	}

	[RconVar(Help = "How frequently to count all entities across the server")]
	public static int profiling_entity_count_interval
	{
		get
		{
			return (int)EntityProfiler.aggregateEntityCountDelay.TotalSeconds;
		}
		set
		{
			EntityProfiler.aggregateEntityCountDelay = TimeSpan.FromSeconds(Mathf.Max(60, value));
		}
	}

	[RconVar(Help = "Record execution time of ObjectWorkQueues per frame")]
	public static bool profiling_work_queue
	{
		get
		{
			return WorkQueueProfiler.enabled;
		}
		set
		{
			WorkQueueProfiler.enabled = value;
		}
	}

	[RconVar(Help = "0 = off, 1 = count per frame, 2 = connection attempts, 3 = messages")]
	public static int profiling_rcon
	{
		get
		{
			return RconProfiler.mode;
		}
		set
		{
			RconProfiler.mode = Mathf.Max(0, value);
		}
	}

	[RconVar(Help = "Clamp the length of logged RCON messages to prevent the profiler from being flooded with large messages")]
	public static int profiling_rcon_message_length
	{
		get
		{
			return RconProfiler.ClampedMessageLength;
		}
		set
		{
			RconProfiler.ClampedMessageLength = Mathf.Max(64, value);
		}
	}

	[RconVar]
	public static int runtime_profiling_interval
	{
		get
		{
			return _profilingInterval;
		}
		set
		{
			_profilingInterval = Mathf.Clamp(value, 60, 1800);
			TimeSpan uploadInterval = TimeSpan.FromSeconds(runtime_profiling_interval);
			FrameProfilingTable.UploadInterval = uploadInterval;
			EntityProfilingTable.UploadInterval = uploadInterval;
			EntityAggregateTable.UploadInterval = uploadInterval;
			InvokeDetailsTable.UploadInterval = uploadInterval;
			MethodTable.UploadInterval = uploadInterval;
			ObjectWorkQueueTable.UploadInterval = uploadInterval;
			PacketTable.UploadInterval = uploadInterval;
			LagSpikeTable.UploadInterval = uploadInterval;
			RconTable.UploadInterval = uploadInterval;
			RaknetTable.UploadInterval = uploadInterval;
			PoolTable.UploadInterval = uploadInterval;
		}
	}

	[RconVar(Help = "Should analytics bulk uploaders use pooling")]
	public static bool runtime_profiling_uploader_pooling
	{
		get
		{
			return AzureAnalyticsUploader.UsePooling;
		}
		set
		{
			AzureAnalyticsUploader.UsePooling = value;
		}
	}

	[RconVar(Help = "Raknet statistics, 0 = off, 2 = per connection")]
	public static int profiling_ping
	{
		get
		{
			return PlayerNetworkingProfiler.level;
		}
		set
		{
			PlayerNetworkingProfiler.level = Mathf.Max(0, value);
		}
	}

	[RconVar(Help = "0 = off, 1 = flush every 5 minutes")]
	public static int runtime_profiling_pooling { get; set; }

	[RconVar(Help = "How often to flush raknet stats per second")]
	public static float profiling_ping_interval
	{
		get
		{
			return (float)PlayerNetworkingProfiler.MinFlushInterval.TotalSeconds;
		}
		set
		{
			PlayerNetworkingProfiler.MinFlushInterval = TimeSpan.FromSeconds(value);
		}
	}

	[RconVar]
	public static int profiling_ping_per_frame
	{
		get
		{
			return PlayerNetworkingProfiler.ConnectionsPerFrame;
		}
		set
		{
			PlayerNetworkingProfiler.ConnectionsPerFrame = Mathf.Max(1, value);
		}
	}

	[RconVar(Help = "How often to flush pooling stats in seconds")]
	public static int runtime_profiling_pool_flush_interval { get; set; } = 300;

	[ClientVar(ClientAdmin = true)]
	[ServerVar]
	public static void dump_profile_recorders(Arg arg)
	{
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		List<ProfilerRecorderHandle> list = new List<ProfilerRecorderHandle>();
		ProfilerRecorderHandle.GetAvailable(list);
		StringBuilder stringBuilder = new StringBuilder();
		stringBuilder.AppendLine("Name,Category,UnitType,Flags");
		foreach (ProfilerRecorderHandle item in list)
		{
			ProfilerRecorderDescription description = ProfilerRecorderHandle.GetDescription(item);
			StringBuilder stringBuilder2 = stringBuilder.Append(((ProfilerRecorderDescription)(ref description)).Name).Append(",");
			ProfilerCategory category = ((ProfilerRecorderDescription)(ref description)).Category;
			StringBuilder stringBuilder3 = stringBuilder2.Append(((object)(ProfilerCategory)(ref category)/*cast due to .constrained prefix*/).ToString()).Append(",");
			ProfilerMarkerDataUnit unitType = ((ProfilerRecorderDescription)(ref description)).UnitType;
			StringBuilder stringBuilder4 = stringBuilder3.Append(((object)(ProfilerMarkerDataUnit)(ref unitType)/*cast due to .constrained prefix*/).ToString()).Append(",");
			MarkerFlags flags = ((ProfilerRecorderDescription)(ref description)).Flags;
			stringBuilder4.Append(((object)(MarkerFlags)(ref flags)/*cast due to .constrained prefix*/).ToString()).AppendLine();
		}
		string contents = stringBuilder.ToString();
		File.WriteAllText("profiler_recorders.csv", contents);
		arg.ReplyWith($"Successfully dumped '{list.Count}' markers");
	}

	public static void Disable()
	{
		runtime_profiling = 0;
	}

	private static void Start()
	{
		Analytics.Manager.AddTable(FrameProfilingTable, Analytics.Manager.AzureBulkUploader);
		Analytics.Manager.AddTable(EntityProfilingTable, Analytics.Manager.AzureBulkUploader);
		Analytics.Manager.AddTable(EntityAggregateTable, Analytics.Manager.AzureBulkUploader);
		Analytics.Manager.AddTable(InvokeDetailsTable, Analytics.Manager.AzureBulkUploader);
		Analytics.Manager.AddTable(MethodTable, Analytics.Manager.AzureBulkUploader);
		Analytics.Manager.AddTable(ObjectWorkQueueTable, Analytics.Manager.AzureBulkUploader);
		Analytics.Manager.AddTable(PacketTable, Analytics.Manager.AzureBulkUploader);
		Analytics.Manager.AddTable(LagSpikeTable, Analytics.Manager.AzureBulkUploader);
		Analytics.Manager.AddTable(RconTable, Analytics.Manager.AzureBulkUploader);
		Analytics.Manager.AddTable(RaknetTable, Analytics.Manager.AzureBulkUploader);
		Analytics.Manager.AddTable(PoolTable, Analytics.Manager.AzureBulkUploader);
		ResetAllMeasurements();
	}

	private static void OnProfilingPresetChanged()
	{
		profiling_lagspikes = false;
		profiling_packets = false;
		profiling_invokes = 0;
		profiling_fixed_invokes = 0;
		profiling_entities = 0;
		profiling_work_queue = false;
		profiling_rcon = 0;
		if (profilingPreset >= 1)
		{
			profiling_entities = 1;
			profiling_lagspikes = true;
			profiling_rcon = 1;
			runtime_profiling_pooling = 1;
		}
		if (profilingPreset >= 2)
		{
			profiling_packets = true;
			profiling_invokes = 2;
			profiling_fixed_invokes = 2;
			profiling_entities = 3;
			profiling_work_queue = true;
			profiling_rcon = 3;
			profiling_ping = 2;
		}
	}

	public static void Update()
	{
		if (!Bootstrap.bootstrapInitRun)
		{
			return;
		}
		if (runtime_profiling == 0)
		{
			_init = false;
		}
		else if (!string.IsNullOrEmpty(Analytics.BulkUploadConnectionString) || !string.IsNullOrEmpty(Analytics.BulkContainerUrl))
		{
			if (!_init)
			{
				Start();
				_init = true;
			}
			EnsureUploadersCreated();
			CollectLastFrameStats();
		}
	}

	private static void EnsureUploadersCreated()
	{
		if (frameProfilingUploader.NeedsCreation())
		{
			if (Analytics.UseV2)
			{
				frameProfilingUploader = null;
			}
			else
			{
				frameProfilingUploader = AzureAnalyticsUploader.Create("frame_profiling", TimeSpan.FromSeconds(runtime_profiling_interval));
			}
		}
		if (entityProfilingUploader.NeedsCreation())
		{
			if (Analytics.UseV2)
			{
				entityProfilingUploader = null;
			}
			else
			{
				entityProfilingUploader = AzureAnalyticsUploader.Create("entity_profiling", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);
			}
		}
		if (entityAggregateUploader.NeedsCreation())
		{
			if (Analytics.UseV2)
			{
				entityAggregateUploader = null;
			}
			else
			{
				entityAggregateUploader = AzureAnalyticsUploader.Create("entity_aggregates", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);
			}
		}
		if (invokeDetailsUploader.NeedsCreation())
		{
			if (Analytics.UseV2)
			{
				invokeDetailsUploader = null;
			}
			else
			{
				invokeDetailsUploader = AzureAnalyticsUploader.Create("invoke_minute_breakdown", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);
			}
		}
		if (methodUploader.NeedsCreation())
		{
			if (Analytics.UseV2)
			{
				methodUploader = null;
			}
			else
			{
				methodUploader = AzureAnalyticsUploader.Create("unity_methods", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);
			}
		}
		if (objectWorkQueueUploader.NeedsCreation())
		{
			if (Analytics.UseV2)
			{
				objectWorkQueueUploader = null;
			}
			else
			{
				objectWorkQueueUploader = AzureAnalyticsUploader.Create("object_work_queue", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);
			}
		}
		if (packetUploader.NeedsCreation())
		{
			if (Analytics.UseV2)
			{
				packetUploader = null;
			}
			else
			{
				packetUploader = AzureAnalyticsUploader.Create("packets_per_type", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);
			}
		}
		if (lagSpikeUploader.NeedsCreation())
		{
			if (Analytics.UseV2)
			{
				lagSpikeUploader = null;
			}
			else
			{
				lagSpikeUploader = AzureAnalyticsUploader.Create("lag_spikes", TimeSpan.FromSeconds(runtime_profiling_interval));
				lagSpikeUploader.UseJsonDataObject = true;
			}
		}
		if (rconUploader.NeedsCreation())
		{
			if (Analytics.UseV2)
			{
				rconUploader = null;
			}
			else
			{
				rconUploader = AzureAnalyticsUploader.Create("rcon_profiling", TimeSpan.FromSeconds(runtime_profiling_interval));
			}
		}
		if (raknetUploader.NeedsCreation())
		{
			if (Analytics.UseV2)
			{
				raknetUploader = null;
			}
			else
			{
				raknetUploader = AzureAnalyticsUploader.Create("raknet", TimeSpan.FromSeconds(runtime_profiling_interval), AnalyticsDocumentMode.CSV);
			}
		}
		if (poolUploader.NeedsCreation())
		{
			if (Analytics.UseV2)
			{
				poolUploader = null;
				return;
			}
			poolUploader = AzureAnalyticsUploader.Create("pool_profiling", TimeSpan.FromSeconds(runtime_profiling_interval));
			poolUploader.UseJsonDataObject = true;
		}
	}

	private static void CollectLastFrameStats()
	{
		WriteFrameData(Time.frameCount - 1);
	}

	private static void WriteFrameData(int frameIndex)
	{
		serializationTimer.Restart();
		RconProfilerStats currentStats = RconProfiler.GetCurrentStats(true);
		DateTime utcNow = DateTime.UtcNow;
		EventRecord eventRecord = EventRecord.New("frame_profiling").AddField("frame_index", frameIndex);
		eventRecord.Timestamp = utcNow;
		LagSpikeProfiler.Serialize(lagSpikeUploader, LagSpikeTable, frameIndex, utcNow);
		SerializeCommon(eventRecord, currentStats);
		SerializeNetworking(eventRecord, frameIndex, utcNow);
		SerializeInvokes(eventRecord);
		if (DateTime.UtcNow >= lastInvokeSerialization + TimeSpan.FromSeconds(60.0))
		{
			SerializeInvokeExecutionTime(InvokeProfiler.update, invokeDetailsUploader, InvokeDetailsTable, utcNow);
			SerializeInvokeExecutionTime(InvokeProfiler.fixedUpdate, invokeDetailsUploader, InvokeDetailsTable, utcNow);
			lastInvokeSerialization = DateTime.UtcNow;
		}
		SerializeProfilingSamples(eventRecord);
		EntityProfiler.Serialize(eventRecord, frameIndex, utcNow, entityProfilingUploader, EntityProfilingTable);
		EntityProfiler.TrySerializeEntityAggregates(frameIndex, utcNow, entityAggregateUploader, EntityAggregateTable);
		WorkQueueProfiler.Serialize(objectWorkQueueUploader, ObjectWorkQueueTable, frameIndex, utcNow);
		PlayerNetworkingProfiler.Serialize(raknetUploader, RaknetTable, frameIndex, utcNow);
		SerializeRconEvents(rconUploader, RconTable, frameIndex, utcNow, currentStats);
		SerializeMemoryPool(poolUploader, PoolTable, frameIndex, utcNow);
		ResetAllMeasurements();
		Pool.Free<RconProfilerStats>(ref currentStats);
		eventRecord.AddField("serialization_time", serializationTimer.Elapsed);
		if (Analytics.UseV2)
		{
			FrameProfilingTable.Append(eventRecord);
		}
		else
		{
			frameProfilingUploader.Append(eventRecord);
		}
	}

	private static void ResetAllMeasurements()
	{
		LagSpikeProfiler.Reset();
		PacketProfiler.Reset();
		InvokeProfiler update = InvokeProfiler.update;
		if (update != null)
		{
			update.Reset();
		}
		InvokeProfiler fixedUpdate = InvokeProfiler.fixedUpdate;
		if (fixedUpdate != null)
		{
			fixedUpdate.Reset();
		}
		EntityProfiler.Reset();
		WorkQueueProfiler.Reset();
		EntityProfiler.Reset();
		RconProfiler.Reset();
	}

	private static void SerializeCommon(EventRecord record, RconProfilerStats rconStats)
	{
		try
		{
			string hostname = Server.hostname;
			PerformanceSamplePoint lastFrame = PerformanceMetrics.LastFrame;
			record.AddField("server_id", Server.server_id).AddField("hostname", hostname).AddField("unity_time", Time.time)
				.AddField("unity_realtime", Time.realtimeSinceStartup)
				.AddField("garbage_collects", System.GC.CollectionCount(0))
				.AddField("ram_get_total_memory", System.GC.GetTotalMemory(forceFullCollection: false))
				.AddField("players_connected", BasePlayer.activePlayerList.Count)
				.AddField("players_sleeping", BasePlayer.sleepingPlayerList.Count)
				.AddField("connection_count", Net.sv.connections.Count)
				.AddField("entity_count", BaseNetworkable.serverEntities.Count)
				.AddField("servermgr_update", ServerMgr_Update)
				.AddField("net_cycle", Net_Cycle)
				.AddField("physics_sync_time", Physics_SyncTransforms)
				.AddField("companion_tick", Companion_Tick)
				.AddField("baseplayer_tick", BasePlayer_ServerCycle)
				.AddField("fixed_update_scripts", lastFrame.FixedUpdate)
				.AddField("update_scripts", lastFrame.Update)
				.AddField("late_update_scripts", lastFrame.LateUpdate)
				.AddField("physics_update", lastFrame.PhysicsUpdate)
				.AddField("rcon_execution_time", RconProfiler.ExecutionTime)
				.AddField("rcon_new_connections", rconStats.NewConnectionCount)
				.AddField("rcon_failed_connections", rconStats.FailedConnectionCount)
				.AddField("rcon_connection_count", rconStats.ConnectionCount)
				.AddField("rcon_message_count", rconStats.MessageCount)
				.AddField("rcon_messages_length", rconStats.MessageLengthSum)
				.AddField("rcon_errors", rconStats.ErrorCount);
		}
		catch (Exception ex)
		{
			Debug.LogError((object)("Failed to serialize common data: " + ex.Message));
		}
	}

	private static void SerializeNetworking(EventRecord frameRecord, int frameIndex, DateTime timestamp)
	{
		if (!PacketProfiler.enabled)
		{
			return;
		}
		try
		{
			int num = 0;
			int num2 = 0;
			int num3 = 0;
			int num4 = 0;
			int num5 = 0;
			for (int i = 0; i < 29; i++)
			{
				int num6 = PacketProfiler.inboundCount[i];
				int num7 = PacketProfiler.inboundBytes[i];
				int num8 = PacketProfiler.outboundCount[i];
				int num9 = PacketProfiler.outboundSum[i];
				int num10 = PacketProfiler.outboundBytes[i];
				num += num6;
				num2 += num7;
				num3 += num8;
				num4 += num9;
				num5 += num10;
				if (num6 > 0 || num8 > 0)
				{
					EventRecord eventRecord = EventRecord.CSV();
					eventRecord.AddField("", frameIndex).AddField("", timestamp).AddField("", AnalyticsKeys.MessageType[i])
						.AddField("", num6)
						.AddField("", num7)
						.AddField("", num8)
						.AddField("", num9)
						.AddField("", num10)
						.AddField("", Server.server_id);
					if (Analytics.UseV2)
					{
						PacketTable.Append(eventRecord);
					}
					else
					{
						packetUploader.Append(eventRecord);
					}
				}
			}
			frameRecord.AddField("inbound_count_total", num);
			frameRecord.AddField("inbound_bytes_total", num2);
			frameRecord.AddField("outbound_count_total", num3);
			frameRecord.AddField("outbound_sum_total", num4);
			frameRecord.AddField("outbound_bytes_total", num5);
		}
		catch (Exception ex)
		{
			Debug.LogError((object)("Failed to serialize networking data: " + ex.Message));
		}
	}

	private static void SerializeInvokes(EventRecord record)
	{
		try
		{
			if (InvokeProfiler.update.mode != 0)
			{
				record.AddField("invokes_elapsed_time", InvokeProfiler.update.elapsedTime).AddField("invokes_executed", InvokeProfiler.update.executedCount).AddField("invokes_count", InvokeProfiler.update.tickCount)
					.AddField("invokes_added", InvokeProfiler.update.addCount)
					.AddField("invokes_removed", InvokeProfiler.update.deletedCount);
			}
			if (InvokeProfiler.fixedUpdate.mode != 0)
			{
				record.AddField("invokes_fixed_elapsed_time", InvokeProfiler.fixedUpdate.elapsedTime).AddField("invokes_fixed_executed", InvokeProfiler.fixedUpdate.executedCount).AddField("invokes_fixed_count", InvokeProfiler.fixedUpdate.tickCount)
					.AddField("invokes_fixed_added", InvokeProfiler.fixedUpdate.addCount)
					.AddField("invokes_fixed_removed", InvokeProfiler.fixedUpdate.deletedCount);
			}
		}
		catch (Exception ex)
		{
			Debug.LogError((object)("Failed to serialize invoke data: " + ex.Message));
		}
	}

	private static void SerializeInvokeExecutionTime(InvokeProfiler profiler, AzureAnalyticsUploader uploader, AnalyticsTable table, DateTime timestamp, bool reset = true)
	{
		if (profiler.mode < 2)
		{
			return;
		}
		try
		{
			invokeExecutionResetTimer.Restart();
			foreach (InvokeTrackingData trackingData in profiler.trackingDataList)
			{
				if (trackingData.Calls != 0)
				{
					EventRecord eventRecord = EventRecord.CSV();
					eventRecord.AddField("", timestamp).AddField("", profiler.Name).AddField("", trackingData.TypeName)
						.AddField("", trackingData.Key.MethodName)
						.AddField("", trackingData.ExecutionTime)
						.AddField("", trackingData.Calls)
						.AddField("", Server.server_id);
					if (Analytics.UseV2)
					{
						table.Append(eventRecord);
					}
					else
					{
						uploader.Append(eventRecord);
					}
					if (reset)
					{
						trackingData.Reset();
					}
				}
			}
			invokeExecutionResetTimer.Stop();
			EventRecord eventRecord2 = EventRecord.CSV();
			eventRecord2.AddField("", timestamp).AddField("", "Update").AddField("", "RuntimeProfiler")
				.AddField("", "Invoke_Execution_Serialization")
				.AddField("", invokeExecutionResetTimer.Elapsed)
				.AddField("", 1)
				.AddField("", Server.server_id);
			if (Analytics.UseV2)
			{
				table.Append(eventRecord2);
			}
			else
			{
				uploader.Append(eventRecord2);
			}
		}
		catch (Exception ex)
		{
			Debug.LogError((object)("Failed to serialize '" + profiler.Name + "' invoke execution time: " + ex.Message));
		}
	}

	private static void SerializeProfilingSamples(EventRecord record)
	{
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		try
		{
			foreach (RustProfilerRecorder recorder2 in recorders)
			{
				string columnName = recorder2.ColumnName;
				ProfilerRecorder recorder = recorder2.Recorder;
				record.AddField(columnName, ((ProfilerRecorder)(ref recorder)).LastValue);
			}
		}
		catch (Exception ex)
		{
			Debug.LogError((object)("Failed to serialize profiling samples: " + ex.Message));
		}
	}

	private static void SerializeRconEvents(AzureAnalyticsUploader uploader, AnalyticsTable table, int frameIndex, DateTime timestamp, RconProfilerStats rconStats)
	{
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f5: Unknown result type (might be due to invalid IL or missing references)
		//IL_0106: Unknown result type (might be due to invalid IL or missing references)
		//IL_0117: Unknown result type (might be due to invalid IL or missing references)
		//IL_016c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0171: Unknown result type (might be due to invalid IL or missing references)
		//IL_0184: Unknown result type (might be due to invalid IL or missing references)
		//IL_0195: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a6: Unknown result type (might be due to invalid IL or missing references)
		foreach (RconConnectionAttempt connectionAttempt in rconStats.ConnectionAttempts)
		{
			EventRecord record = CreatePoint("rcon_connection_attempt", frameIndex, timestamp).AddField("ip", connectionAttempt.IP).AddField("port", connectionAttempt.Port).AddField("connection_id", connectionAttempt.ConnectionId)
				.AddField("password", connectionAttempt.PasswordAttempt)
				.AddField("success", connectionAttempt.Success);
			if (Analytics.UseV2)
			{
				table.Append(record);
			}
			else
			{
				uploader.Append(record);
			}
		}
		foreach (RconMessageStats message in rconStats.Messages)
		{
			EventRecord record2 = CreatePoint("rcon_message", frameIndex, timestamp).AddField("ip", message.IP).AddField("port", message.Port).AddField("connection_id", message.ConnectionId)
				.AddField("message", message.Message)
				.AddField("message_length", message.MessageLength);
			if (Analytics.UseV2)
			{
				table.Append(record2);
			}
			else
			{
				uploader.Append(record2);
			}
		}
		foreach (RconDisconnects disconnect in rconStats.Disconnects)
		{
			EventRecord record3 = CreatePoint("rcon_disconnect", frameIndex, timestamp).AddField("ip", disconnect.IP).AddField("port", disconnect.Port).AddField("connection_id", disconnect.ConnectionId);
			if (Analytics.UseV2)
			{
				table.Append(record3);
			}
			else
			{
				uploader.Append(record3);
			}
		}
	}

	private static void SerializeMemoryPool(AzureAnalyticsUploader uploader, AnalyticsTable table, int frameIndex, DateTime timestamp)
	{
		if (runtime_profiling_pooling == 0 || !(timestamp > nextPoolFlush))
		{
			return;
		}
		nextPoolFlush = timestamp.AddSeconds(runtime_profiling_pool_flush_interval);
		foreach (KeyValuePair<Type, IPoolCollection> item in Pool.Directory)
		{
			IPoolCollection value = item.Value;
			string name = TypeNameCache.GetName(item.Key);
			EventRecord record = CreatePoint("pool_facepunch", frameIndex, timestamp).AddField("type_name", name).AddField("capacity", value.ItemsCapacity).AddField("stack", value.ItemsInStack)
				.AddField("used", value.ItemsInUse)
				.AddField("created", value.ItemsCreated)
				.AddField("taken", value.ItemsTaken)
				.AddField("spilled", value.ItemsSpilled)
				.AddField("max_used", value.MaxItemsInUse);
			if (Analytics.UseV2)
			{
				table.Append(record);
			}
			else
			{
				uploader.Append(record);
			}
		}
		ArrayPool<byte> arrayPool = BaseNetwork.ArrayPool;
		ConcurrentQueue<byte[]>[] buffer = arrayPool.GetBuffer();
		for (int i = 0; i < buffer.Length; i++)
		{
			ConcurrentQueue<byte[]> concurrentQueue = buffer[i];
			EventRecord record2 = CreatePoint("pool_networking", frameIndex, timestamp).AddField("size", arrayPool.IndexToSize(i)).AddField("amount", concurrentQueue.Count);
			if (Analytics.UseV2)
			{
				table.Append(record2);
			}
			else
			{
				uploader.Append(record2);
			}
		}
	}

	private static EventRecord CreatePoint(string type, int frameIndex, DateTime timestamp)
	{
		return EventRecord.New(type).AddField("frame_index", frameIndex).SetTimestamp(timestamp)
			.AddField("server_id", Server.server_id);
	}
}


using Unity.Profiling;

private static class ProfilerCategories
{
	public static readonly ProfilerCategory VSync = new ProfilerCategory("VSync");

	public static readonly ProfilerCategory PlayerLoop = new ProfilerCategory("PlayerLoop");
}


using Unity.Profiling;

public struct RustProfilerRecorder
{
	public string ColumnName;

	public ProfilerRecorder Recorder;

	public RustProfilerRecorder(string column, ProfilerCategory category, string sample, int sampleCount = 1, ProfilerRecorderOptions options = 24)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		ColumnName = column;
		Recorder = ProfilerRecorder.StartNew(category, sample, sampleCount, options);
	}
}


using System;
using System.Collections.Generic;
using System.Linq;
using ConVar;
using Facepunch.Rust;
using Facepunch.Rust.Profiling;
using Unity.Profiling;
using Unity.Profiling.LowLevel.Unsafe;
using UnityEngine;

public static class UnityProfiler
{
	private struct RecorderInfo
	{
		public string MethodName;

		public ProfilerRecorder Recorder;
	}

	private static List<RecorderInfo> ActiveRecorders = new List<RecorderInfo>();

	private static bool _enabled;

	public static bool enabled
	{
		get
		{
			return _enabled;
		}
		set
		{
			SetEnabled(value);
		}
	}

	private static void SetEnabled(bool state)
	{
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Invalid comparison between Unknown and I4
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
		_enabled = state;
		Unload();
		if (!state)
		{
			return;
		}
		List<ProfilerRecorderHandle> list = new List<ProfilerRecorderHandle>();
		ProfilerRecorderHandle.GetAvailable(list);
		foreach (ProfilerRecorderDescription item2 in list.Select((ProfilerRecorderHandle x) => ProfilerRecorderHandle.GetDescription(x)).ToList())
		{
			ProfilerRecorderDescription current = item2;
			if ((int)((ProfilerRecorderDescription)(ref current)).UnitType == 1 && ProfilerCategory.op_Implicit(((ProfilerRecorderDescription)(ref current)).Category) == ProfilerCategory.op_Implicit(ProfilerCategory.Scripts))
			{
				ProfilerRecorder recorder = ProfilerRecorder.StartNew(((ProfilerRecorderDescription)(ref current)).Category, ((ProfilerRecorderDescription)(ref current)).Name, 2, (ProfilerRecorderOptions)24);
				RecorderInfo recorderInfo = default(RecorderInfo);
				recorderInfo.MethodName = ((ProfilerRecorderDescription)(ref current)).Name;
				recorderInfo.Recorder = recorder;
				RecorderInfo item = recorderInfo;
				ActiveRecorders.Add(item);
			}
		}
	}

	public static void Unload()
	{
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		foreach (RecorderInfo activeRecorder in ActiveRecorders)
		{
			ProfilerRecorder recorder = activeRecorder.Recorder;
			((ProfilerRecorder)(ref recorder)).Dispose();
		}
		ActiveRecorders.Clear();
	}

	public static void Serialize(AzureAnalyticsUploader uploader, AnalyticsTable table, DateTime timestamp, int frameIndex)
	{
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		if (!enabled)
		{
			return;
		}
		try
		{
			foreach (RecorderInfo activeRecorder in ActiveRecorders)
			{
				ProfilerRecorder recorder = activeRecorder.Recorder;
				if (((ProfilerRecorder)(ref recorder)).LastValue != 0L)
				{
					EventRecord eventRecord = EventRecord.CSV();
					EventRecord eventRecord2 = eventRecord.AddField("", frameIndex).AddField("", timestamp).AddField("", activeRecorder.MethodName);
					recorder = activeRecorder.Recorder;
					eventRecord2.AddField("", ((ProfilerRecorder)(ref recorder)).LastValue).AddField("", Server.server_id);
					if (Analytics.UseV2)
					{
						table.Append(eventRecord);
					}
					else
					{
						uploader.Append(eventRecord);
					}
				}
			}
		}
		catch (Exception ex)
		{
			Debug.LogError((object)("Failed to serialize profiler data: " + ex.Message));
		}
	}
}


using Unity.Profiling;

private struct RecorderInfo
{
	public string MethodName;

	public ProfilerRecorder Recorder;
}


using System;
using ConVar;
using Facepunch.Rust;
using UnityEngine;

public static class WorkQueueProfiler
{
	public static bool enabled;

	public static void Serialize(AzureAnalyticsUploader uploader, AnalyticsTable table, int frameIndex, DateTime timestamp)
	{
		if (!enabled)
		{
			return;
		}
		try
		{
			foreach (ObjectWorkQueue item in ObjectWorkQueue.All)
			{
				if (item.LastProcessedCount != 0)
				{
					EventRecord eventRecord = EventRecord.CSV();
					eventRecord.AddField("", frameIndex).AddField("", timestamp).AddField("", item.Name)
						.AddField("", item.LastQueueLength)
						.AddField("", item.LastExecutionTime)
						.AddField("", item.LastProcessedCount)
						.AddField("", Server.server_id);
					if (Analytics.UseV2)
					{
						table.Append(eventRecord);
					}
					else
					{
						uploader.Append(eventRecord);
					}
				}
			}
			foreach (PersistentObjectWorkQueue item2 in PersistentObjectWorkQueue.All)
			{
				if (item2.ListLength != 0)
				{
					EventRecord eventRecord2 = EventRecord.CSV();
					eventRecord2.AddField("", frameIndex).AddField("", timestamp).AddField("", item2.Name)
						.AddField("", item2.ListLength)
						.AddField("", item2.LastExecutionTime)
						.AddField("", item2.LastProcessedCount)
						.AddField("", Server.server_id);
					if (Analytics.UseV2)
					{
						table.Append(eventRecord2);
					}
					else
					{
						uploader.Append(eventRecord2);
					}
				}
			}
		}
		catch (Exception ex)
		{
			Debug.LogError((object)("Failed to serialize work queues: " + ex.Message));
		}
	}

	public static void Reset()
	{
	}
}


using System;
using ModelViewer;
using UnityEngine;
using UnityEngine.Rendering;
using UnityEngine.Rendering.PostProcessing;

[Serializable]
public class ModelViewer_RenderParameters
{
	public enum SampleCountLevel
	{
		Low,
		Medium,
		High,
		VeryHigh
	}

	public enum renderResolution
	{
		_16,
		_32,
		_64,
		_128,
		_256,
		_512,
		_1024,
		_2048
	}

	[Header("Anti Aliasing")]
	public PostProcessLayer.Antialiasing antialiasing = PostProcessLayer.Antialiasing.TemporalAntialiasing;

	[Header("Shadows")]
	[Range(1f, 4f)]
	public int shadowCascades = 4;

	[Range(1f, 3f)]
	public int shadowLights = 3;

	[Range(1f, 4f)]
	public int shadowMode = 4;

	public float shadowDistance = 50f;

	[Range(0f, 3f)]
	public int shadowQuality = 3;

	[Range(0f, 0.02f)]
	public float shadowSoftness = 0.01f;

	[Range(0f, 2f)]
	public float sunShadowBias = 0.01f;

	[Header("Contact Shadows")]
	[Header("                ")]
	public bool enableContactShadows = true;

	[Range(0f, 1f)]
	public float blendStrength = 1f;

	[Range(0f, 1f)]
	public float accumulation = 0.9f;

	[Range(0.1f, 5f)]
	public float lengthFade = 0.7f;

	[Range(0.01f, 5f)]
	public float range = 0.7f;

	[Range(0f, 1f)]
	public float zThickness = 0.1f;

	[Range(2f, 92f)]
	public int samples = 32;

	[Range(0.5f, 4f)]
	public float nearSampleQuality = 1.5f;

	[Range(0f, 1f)]
	public float traceBias = 0.03f;

	[Header("Ambient Occlusion")]
	[Header("                ")]
	public bool enableAmbientOcclusion = true;

	public SampleCountLevel SampleCount = SampleCountLevel.Medium;

	public float Intensity = 1f;

	public Color Tint = Color.black;

	[Tooltip("Radius spread of the occlusion.")]
	[Range(0f, 32f)]
	public float Radius = 2f;

	[Range(0f, 16f)]
	[Tooltip("Power exponent attenuation of the occlusion.")]
	public float PowerExponent = 1.8f;

	[Range(0f, 0.99f)]
	[Tooltip("Controls the initial occlusion contribution offset.")]
	public float Bias = 0.05f;

	[Tooltip("Controls the thickness occlusion contribution.")]
	[Range(0f, 1f)]
	public float Thickness = 1f;

	[Tooltip("Compute the Occlusion and Blur at half of the resolution.")]
	public bool Downsample = true;

	[Tooltip("Control parameters at faraway.")]
	public bool FadeEnabled;

	[Tooltip("Distance in Unity unities that start to fade.")]
	public float FadeStart = 100f;

	[Tooltip("Length distance to performe the transition.")]
	public float FadeLength = 50f;

	[Tooltip("Final Intensity parameter.")]
	[Range(0f, 1f)]
	public float FadeToIntensity;

	public Color FadeToTint = Color.black;

	[Tooltip("Final Radius parameter.")]
	[Range(0f, 32f)]
	public float FadeToRadius = 2f;

	[Tooltip("Final PowerExponent parameter.")]
	[Range(0f, 16f)]
	public float FadeToPowerExponent = 1.8f;

	[Tooltip("Final Thickness parameter.")]
	[Range(0f, 1f)]
	public float FadeToThickness = 1f;

	[Header("                ")]
	[Header("Reflections")]
	public ReflectionProbeMode Type = (ReflectionProbeMode)1;

	public ReflectionProbeRefreshMode RefreshMode = (ReflectionProbeRefreshMode)1;

	public ReflectionProbeTimeSlicingMode TimeSlicing = (ReflectionProbeTimeSlicingMode)1;

	public renderResolution resolution;

	public float reflectionShadowDistance = 100f;

	public LayerMask cullingMask;

	public float reflectionClippingPlaneNear = 0.1f;

	public float reflectionClippingPlaneFar = 100f;
}


public enum SampleCountLevel
{
	Low,
	Medium,
	High,
	VeryHigh
}


public enum renderResolution
{
	_16,
	_32,
	_64,
	_128,
	_256,
	_512,
	_1024,
	_2048
}


using System;
using ModelViewer;
using UnityEngine;

[Serializable]
public class ModelViewer_MainCameraParameters
{
	public enum OverlayType
	{
		None,
		RuleOfThirds,
		GoldenRatio,
		CrossHair,
		AspectRatio,
		SafeFrames
	}

	public enum TonemappingMode
	{
		None,
		Neutral,
		ACES
	}

	[Header("Control")]
	public float orbitSpeed = 4f;

	public float mouseZoomSpeed = 1.2f;

	public float scrollZoomSpeed = 0.1f;

	public float panSpeed = 0.1f;

	public float moveSpeed = 0.05f;

	public float followLag;

	[Header("                ")]
	[Range(0.01f, 360f)]
	[Header("Lens")]
	public float fieldOfView = 15f;

	public float nearPlane = 0.05f;

	public float farPlane = 2500f;

	public OverlayType overlayType;

	[Range(0.01f, 100f)]
	public float Aspect = 4f;

	[Range(0.01f, 100f)]
	public float Ratio = 3f;

	[Header("Focus")]
	[Header("                ")]
	public bool depthOfField;

	public float focalLength = 3f;

	public float focalSize = 0.1f;

	public float apeture = 80f;

	public float maxBlurSize = 7f;

	public bool debugMode;

	[Header("                ")]
	[Range(0f, 360f)]
	[Header("Motion Blur")]
	public float shutterAngle;

	[Header("Distortion")]
	[Header("                ")]
	[Range(-100f, 100f)]
	public float barrelAndPincushion;

	[Range(0f, 1f)]
	public float chromaticAbberation;

	[Header("Post Effects")]
	[Header("                ")]
	public TonemappingMode ToneMapping = TonemappingMode.Neutral;

	public float Exposure = 2.34f;

	[Range(-100f, 100f)]
	public float Contrast;

	[Range(-100f, 100f)]
	public float Saturation;

	[Header("Sharpen")]
	[Header("                ")]
	public float Strength;

	public float limit;

	[Header("God Rays")]
	[Header("                ")]
	public bool GodRays = true;

	[Header("Bloom")]
	[Header("                ")]
	public float Brightness = 0.15f;

	public float Threshold = 1f;

	[Range(0f, 1f)]
	public float SoftKnee = 0.5f;

	public float Clamp;

	[Range(0f, 10f)]
	public float Diffusion = 8f;

	[Range(0f, 1f)]
	public float AnamorphicRatio = 0.55f;

	public Color Color = Color.white;

	[Header("Vignette")]
	[Header("                ")]
	public float Darkness;

	public float Sharpness;

	[Header("Grain")]
	[Header("                ")]
	public bool Coloured = true;

	[Range(0f, 1f)]
	public float Intensity;

	[Range(0.3f, 3f)]
	public float Size = 1f;

	[Range(0f, 1f)]
	public float luminanceContribution = 0.8f;
}


public enum OverlayType
{
	None,
	RuleOfThirds,
	GoldenRatio,
	CrossHair,
	AspectRatio,
	SafeFrames
}


public enum TonemappingMode
{
	None,
	Neutral,
	ACES
}


using System;
using UnityEngine;

[Serializable]
public class ModelViewer_SkyParameters
{
	[Range(0f, 1f)]
	[Header("Sky")]
	public float skyBrightness = 1f;

	[Tooltip("Current hour of the day.")]
	[Header("                ")]
	[Header("Time of Day")]
	public float Hour = 9f;

	[Tooltip("Current day of the month.")]
	public int Day = 20;

	[Tooltip("Current month of the year.")]
	public int Month = 5;

	[Tooltip("Current year.")]
	[TOD_Range(1f, 9999f)]
	public int Year = 2000;

	[Range(-90f, 90f)]
	[Tooltip("Latitude of the current location in degrees.")]
	public float Latitude = -10f;

	[Tooltip("Longitude of the current location in degrees.")]
	[Range(-180f, 180f)]
	public float Longitude = -25f;

	[Tooltip("UTC/GMT time zone of the current location in hours.")]
	[Range(-14f, 14f)]
	public float UTC;

	[Header("                ")]
	[Header("Atmosphere")]
	public float skyContrast = 1.2f;

	public float skyFogginess = 0.2f;

	public float cloudCoverage;
}


using ModelViewer;
using Rust.UI;
using UnityEngine;
using UnityEngine.Rendering.PostProcessing;
using UnityEngine.UI;

public class modelviewer : MonoBehaviour, IEditorComponent
{
	public GameObject cameraTarget;

	[Header("                ")]
	public ModelViewer_RenderParameters Render;

	public ModelViewer_MainCameraParameters MainCamera;

	public ModelViewer_SkyParameters Sky;

	[Header("                ")]
	[Header("Junk to clean up:")]
	[Header("                ")]
	public GameObject ruleOfThirds;

	public GameObject goldenRatio;

	public GameObject crosshair;

	public GameObject aspectRatio;

	public GameObject safeFrames;

	private GameObject enabledOverlay;

	public AspectRatioFitter aspectRatioFitter;

	public AspectRatioFitter safeFrameAspectRatioFigger;

	public RustText aspectRatioLabel;

	private Vector3 startpos = new Vector3(0f, 130f, 60f);

	public Camera maincamera;

	public GameObject modelHolder;

	public Transform skyDome;

	public float skyrotateSpeed;

	public Light sunLight;

	public NGSS_Directional sunLightSoftShadows;

	private GameObject orbitVector;

	private Quaternion orbt_rot_original;

	private Vector3 orbt_xform_original;

	private SEScreenSpaceShadows screenSpaceShadows;

	private AmplifyOcclusionBase ambientOcclusion;

	public ReflectionProbe[] reflectionProbes;

	private TOD_Sky todSky;

	private PostProcessVolume[] colorGradingVolumes;

	public PostProcessVolume basePostProcess;

	public PostProcessVolume sharpenvignettePostProcess;

	public PostProcessVolume colorGradingPostProcess;

	private LensDistortion lensDistortion;

	private ChromaticAberration chromaticAbberation;

	private SharpenAndVignette sharpenAndVignette;

	private Bloom bloom;

	private Grain grain;

	private ColorGrading colorGrading;

	private GodRays godRays;

	private MotionBlur motionBlur;

	public Vector3 skyRotation;

	public Vector3 cameraPosition;

	public Vector3 cameraRotation;

	public float cameraZoom;

	public Vector3 orbitVectorPosition;
}


using FIMSpace;
using UnityEngine;

public static class FAnimatorMethods
{
	public static void LerpFloatValue(this Animator animator, string name = "RunWalk", float value = 0f, float deltaSpeed = 8f)
	{
		float @float = animator.GetFloat(name);
		@float = Mathf.Lerp(@float, value, Time.deltaTime * deltaSpeed);
		animator.SetFloat(name, @float);
	}

	public static bool CheckAnimationEnd(this Animator animator, int layer = 0, bool reverse = false, bool checkAnimLoop = true)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		AnimatorStateInfo currentAnimatorStateInfo = animator.GetCurrentAnimatorStateInfo(layer);
		if (!animator.IsInTransition(layer))
		{
			if (checkAnimLoop)
			{
				if (!((AnimatorStateInfo)(ref currentAnimatorStateInfo)).loop && !reverse)
				{
					if (((AnimatorStateInfo)(ref currentAnimatorStateInfo)).normalizedTime > 0.98f)
					{
						return true;
					}
					if (((AnimatorStateInfo)(ref currentAnimatorStateInfo)).normalizedTime < 0.02f)
					{
						return true;
					}
				}
			}
			else if (!reverse)
			{
				if (((AnimatorStateInfo)(ref currentAnimatorStateInfo)).normalizedTime > 0.98f)
				{
					return true;
				}
				if (((AnimatorStateInfo)(ref currentAnimatorStateInfo)).normalizedTime < 0.02f)
				{
					return true;
				}
			}
		}
		return false;
	}

	public static void ResetLayersWeights(this Animator animator, float speed = 10f)
	{
		for (int i = 1; i < animator.layerCount; i++)
		{
			animator.SetLayerWeight(i, animator.GetLayerWeight(i).Lerp(0f, Time.deltaTime * speed));
		}
	}

	public static void LerpLayerWeight(this Animator animator, int layer = 0, float newValue = 1f, float speed = 8f)
	{
		float num = animator.GetLayerWeight(layer);
		num.Lerp(newValue, Time.deltaTime * speed);
		if (newValue == 1f && num > 0.999f)
		{
			num = 1f;
		}
		if (newValue == 0f && num < 0.01f)
		{
			num = 0f;
		}
		animator.SetLayerWeight(layer, num);
	}

	public static bool StateExists(this Animator animator, string clipName, int layer = 0)
	{
		int num = Animator.StringToHash(clipName);
		return animator.HasState(layer, num);
	}
}


using System.Globalization;
using FIMSpace;
using UnityEngine;

public static class FColorMethods
{
	public static Color ChangeColorAlpha(this Color color, float alpha)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		return new Color(color.r, color.g, color.b, alpha);
	}

	public static Color ToGammaSpace(Color hdrColor)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		float num = hdrColor.r;
		if (hdrColor.g > num)
		{
			num = hdrColor.g;
		}
		if (hdrColor.b > num)
		{
			num = hdrColor.b;
		}
		if (hdrColor.a > num)
		{
			num = hdrColor.a;
		}
		if (num <= 0f)
		{
			return Color.clear;
		}
		return hdrColor / num;
	}

	public static Color ChangeColorsValue(this Color color, float brightenOrDarken = 0f)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		return new Color(color.r + brightenOrDarken, color.g + brightenOrDarken, color.b + brightenOrDarken, color.a);
	}

	public static Color32 HexToColor(this string hex)
	{
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		if (string.IsNullOrEmpty(hex))
		{
			Debug.Log((object)"<color=red>Trying convert from hex to color empty string!</color>");
			return Color32.op_Implicit(Color.white);
		}
		uint result = 255u;
		hex = hex.Replace("#", "");
		hex = hex.Replace("0x", "");
		if (!uint.TryParse(hex, NumberStyles.HexNumber, null, out result))
		{
			Debug.Log((object)"Error during converting hex string.");
			return Color32.op_Implicit(Color.white);
		}
		return new Color32((byte)((result & -16777216) >> 24), (byte)((result & 0xFF0000) >> 16), (byte)((result & 0xFF00) >> 8), (byte)(result & 0xFF));
	}

	public static string ColorToHex(this Color32 color, bool addHash = true)
	{
		string text = "";
		if (addHash)
		{
			text = "#";
		}
		return text + string.Format("{0}{1}{2}{3}", (color.r.ToString("X").Length == 1) ? string.Format("0{0}", color.r.ToString("X")) : color.r.ToString("X"), (color.g.ToString("X").Length == 1) ? string.Format("0{0}", color.g.ToString("X")) : color.g.ToString("X"), (color.b.ToString("X").Length == 1) ? string.Format("0{0}", color.b.ToString("X")) : color.b.ToString("X"), (color.a.ToString("X").Length == 1) ? string.Format("0{0}", color.a.ToString("X")) : color.a.ToString("X"));
	}

	public static string ColorToHex(this Color color, bool addHash = true)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		return FColorMethods.ColorToHex(new Color32((byte)(color.r * 255f), (byte)(color.g * 255f), (byte)(color.b * 255f), (byte)(color.a * 255f)), addHash);
	}

	public static void LerpMaterialColor(this Material mat, string property, Color targetColor, float deltaMultiplier = 8f)
	{
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		if (!((Object)(object)mat == (Object)null))
		{
			if (!mat.HasProperty(property))
			{
				Debug.LogError((object)("Material " + ((Object)mat).name + " don't have property '" + property + "'  in shader " + ((Object)mat.shader).name));
			}
			else
			{
				Color color = mat.GetColor(property);
				mat.SetColor(property, Color.Lerp(color, targetColor, Time.deltaTime * deltaMultiplier));
			}
		}
	}
}


using System.Diagnostics;
using UnityEngine;

public static class FDebug
{
	private static readonly Stopwatch _debugWatch = new Stopwatch();

	public static long _LastMeasureMilliseconds = 0L;

	public static long _LastMeasureTicks = 0L;

	public static void Log(string log)
	{
		Debug.Log((object)("LOG: " + log));
	}

	public static void Log(string log, string category)
	{
		Debug.Log((object)(MarkerColor("#1A6600") + "[" + category + "]" + EndColorMarker() + " " + log));
	}

	public static void LogRed(string log)
	{
		Debug.Log((object)(MarkerColor("red") + log + EndColorMarker()));
	}

	public static void LogOrange(string log)
	{
		Debug.Log((object)(MarkerColor("#D1681D") + log + EndColorMarker()));
	}

	public static void LogYellow(string log)
	{
		Debug.Log((object)(MarkerColor("#E0D300") + log + EndColorMarker()));
	}

	public static void StartMeasure()
	{
		_debugWatch.Reset();
		_debugWatch.Start();
	}

	public static void PauseMeasure()
	{
		_debugWatch.Stop();
	}

	public static void ResumeMeasure()
	{
		_debugWatch.Start();
	}

	public static void EndMeasureAndLog(string v)
	{
		_debugWatch.Stop();
		_LastMeasureMilliseconds = _debugWatch.ElapsedMilliseconds;
		_LastMeasureTicks = _debugWatch.ElapsedTicks;
		Debug.Log((object)("Measure " + v + ": " + _debugWatch.ElapsedTicks + " ticks   " + _debugWatch.ElapsedMilliseconds + "ms"));
	}

	public static long EndMeasureAndGetTicks()
	{
		_debugWatch.Stop();
		_LastMeasureMilliseconds = _debugWatch.ElapsedMilliseconds;
		_LastMeasureTicks = _debugWatch.ElapsedTicks;
		return _debugWatch.ElapsedTicks;
	}

	public static string MarkerColor(string color)
	{
		return "<color='" + color + "'>";
	}

	public static string EndColorMarker()
	{
		return "</color>";
	}

	public static void DrawBounds2D(this Bounds b, Color c, float y = 0f, float scale = 1f, float duration = 1.1f)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0093: Unknown result type (might be due to invalid IL or missing references)
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_0095: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = new Vector3(((Bounds)(ref b)).max.x, y, ((Bounds)(ref b)).max.z) * scale;
		Vector3 val2 = new Vector3(((Bounds)(ref b)).max.x, y, ((Bounds)(ref b)).min.z) * scale;
		Vector3 val3 = new Vector3(((Bounds)(ref b)).min.x, y, ((Bounds)(ref b)).min.z) * scale;
		Vector3 val4 = new Vector3(((Bounds)(ref b)).min.x, y, ((Bounds)(ref b)).max.z) * scale;
		Debug.DrawLine(val, val2, c, duration);
		Debug.DrawLine(val2, val3, c, duration);
		Debug.DrawLine(val2, val3, c, duration);
		Debug.DrawLine(val3, val4, c, duration);
		Debug.DrawLine(val4, val, c, duration);
	}

	public static void DrawBounds3D(this Bounds b, Color c, float scale = 1f, float time = 1.01f)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00db: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ef: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_0111: Unknown result type (might be due to invalid IL or missing references)
		//IL_0117: Unknown result type (might be due to invalid IL or missing references)
		//IL_011c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0120: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0138: Unknown result type (might be due to invalid IL or missing references)
		//IL_0142: Unknown result type (might be due to invalid IL or missing references)
		//IL_0148: Unknown result type (might be due to invalid IL or missing references)
		//IL_014d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0151: Unknown result type (might be due to invalid IL or missing references)
		//IL_015d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0169: Unknown result type (might be due to invalid IL or missing references)
		//IL_0173: Unknown result type (might be due to invalid IL or missing references)
		//IL_0179: Unknown result type (might be due to invalid IL or missing references)
		//IL_017e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0182: Unknown result type (might be due to invalid IL or missing references)
		//IL_018e: Unknown result type (might be due to invalid IL or missing references)
		//IL_019a: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_01af: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_01be: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c7: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d2: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01dd: Unknown result type (might be due to invalid IL or missing references)
		//IL_01df: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_01fc: Unknown result type (might be due to invalid IL or missing references)
		//IL_01fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0205: Unknown result type (might be due to invalid IL or missing references)
		//IL_0206: Unknown result type (might be due to invalid IL or missing references)
		//IL_0208: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = new Vector3(((Bounds)(ref b)).max.x, ((Bounds)(ref b)).min.y, ((Bounds)(ref b)).max.z) * scale;
		Vector3 val2 = new Vector3(((Bounds)(ref b)).max.x, ((Bounds)(ref b)).min.y, ((Bounds)(ref b)).min.z) * scale;
		Vector3 val3 = new Vector3(((Bounds)(ref b)).min.x, ((Bounds)(ref b)).min.y, ((Bounds)(ref b)).min.z) * scale;
		Vector3 val4 = new Vector3(((Bounds)(ref b)).min.x, ((Bounds)(ref b)).min.y, ((Bounds)(ref b)).max.z) * scale;
		Debug.DrawLine(val, val2, c, time);
		Debug.DrawLine(val2, val3, c, time);
		Debug.DrawLine(val2, val3, c, time);
		Debug.DrawLine(val3, val4, c, time);
		Debug.DrawLine(val4, val, c, time);
		Vector3 val5 = new Vector3(((Bounds)(ref b)).max.x, ((Bounds)(ref b)).max.y, ((Bounds)(ref b)).max.z) * scale;
		Vector3 val6 = new Vector3(((Bounds)(ref b)).max.x, ((Bounds)(ref b)).max.y, ((Bounds)(ref b)).min.z) * scale;
		Vector3 val7 = new Vector3(((Bounds)(ref b)).min.x, ((Bounds)(ref b)).max.y, ((Bounds)(ref b)).min.z) * scale;
		Vector3 val8 = new Vector3(((Bounds)(ref b)).min.x, ((Bounds)(ref b)).max.y, ((Bounds)(ref b)).max.z) * scale;
		Debug.DrawLine(val5, val6, c, time);
		Debug.DrawLine(val6, val7, c, time);
		Debug.DrawLine(val6, val7, c, time);
		Debug.DrawLine(val7, val8, c, time);
		Debug.DrawLine(val8, val5, c, time);
		Debug.DrawLine(val, val, c, time);
		Debug.DrawLine(val6, val2, c, time);
		Debug.DrawLine(val3, val7, c, time);
		Debug.DrawLine(val4, val8, c, time);
	}
}


public static class FStringMethods
{
	public static string IntToString(this int value, int signs)
	{
		string text = value.ToString();
		int num = signs - text.Length;
		if (num > 0)
		{
			string text2 = "0";
			for (int i = 1; i < num; i++)
			{
				text2 += 0;
			}
			text = text2 + text;
		}
		return text;
	}

	public static string CapitalizeOnlyFirstLetter(this string text)
	{
		if (string.IsNullOrEmpty(text))
		{
			return text;
		}
		return text[0].ToString().ToUpper() + ((text.Length > 1) ? text.Substring(1) : "");
	}

	public static string CapitalizeFirstLetter(this string text)
	{
		if (string.IsNullOrEmpty(text))
		{
			return text;
		}
		return text[0].ToString().ToUpper() + text.Substring(1);
	}

	public static string ReplaceSpacesWithUnderline(this string text)
	{
		if (text.Contains(" "))
		{
			text = text.Replace(" ", "_");
		}
		return text;
	}

	public static string GetEndOfStringFromSeparator(this string source, char[] separators, int which = 1, bool fromEnd = false)
	{
		bool flag = false;
		int num = 0;
		int num2 = 0;
		int num3 = 0;
		for (num3 = source.Length - 1; num3 >= 0; num3--)
		{
			num2++;
			for (int i = 0; i < separators.Length; i++)
			{
				if (source[num3] == separators[i])
				{
					num++;
					if (num == which)
					{
						num3++;
						flag = true;
						break;
					}
				}
			}
			if (flag)
			{
				break;
			}
		}
		if (flag)
		{
			if (!fromEnd)
			{
				return source.Substring(0, source.Length - num2);
			}
			return source.Substring(num3, source.Length - num3);
		}
		return "";
	}

	public static string GetEndOfStringFromStringSeparator(this string source, string[] separators, int which = 1, bool rest = false)
	{
		bool flag = false;
		int num = 0;
		int num2 = 0;
		int num3 = 0;
		for (num3 = 0; num3 < source.Length; num3++)
		{
			num2++;
			for (int i = 0; i < separators.Length && num3 + separators[i].Length <= source.Length; i++)
			{
				if (source.Substring(num3, separators[i].Length) == separators[i])
				{
					num++;
					if (num == which)
					{
						num3++;
						num3 += separators[i].Length - 1;
						flag = true;
						break;
					}
				}
			}
			if (flag)
			{
				break;
			}
		}
		if (flag)
		{
			if (rest)
			{
				return source.Substring(0, source.Length - num2);
			}
			return source.Substring(num3, source.Length - num3);
		}
		return "";
	}
}


using System;
using System.Collections.Generic;
using UnityEngine;

public static class FEngineering
{
	private static Plane axis2DProjection;

	private static PhysicMaterial _slidingMat;

	private static PhysicMaterial _frictMat;

	private static PhysicsMaterial2D _slidingMat2D;

	private static PhysicsMaterial2D _frictMat2D;

	public static PhysicMaterial PMSliding
	{
		get
		{
			//IL_0017: Unknown result type (might be due to invalid IL or missing references)
			//IL_0021: Expected O, but got Unknown
			if (Object.op_Implicit((Object)(object)_slidingMat))
			{
				return _slidingMat;
			}
			_slidingMat = new PhysicMaterial("Slide");
			_slidingMat.frictionCombine = (PhysicMaterialCombine)2;
			_slidingMat.dynamicFriction = 0f;
			_slidingMat.staticFriction = 0f;
			return _slidingMat;
		}
	}

	public static PhysicMaterial PMFrict
	{
		get
		{
			//IL_0017: Unknown result type (might be due to invalid IL or missing references)
			//IL_0021: Expected O, but got Unknown
			if (Object.op_Implicit((Object)(object)_frictMat))
			{
				return _frictMat;
			}
			_frictMat = new PhysicMaterial("Friction");
			_frictMat.frictionCombine = (PhysicMaterialCombine)3;
			_frictMat.dynamicFriction = 10f;
			_frictMat.staticFriction = 10f;
			return _frictMat;
		}
	}

	public static PhysicsMaterial2D PMSliding2D
	{
		get
		{
			//IL_0017: Unknown result type (might be due to invalid IL or missing references)
			//IL_0021: Expected O, but got Unknown
			if (Object.op_Implicit((Object)(object)_slidingMat2D))
			{
				return _slidingMat2D;
			}
			_slidingMat2D = new PhysicsMaterial2D("Slide2D");
			_slidingMat2D.friction = 0f;
			return _slidingMat2D;
		}
	}

	public static PhysicsMaterial2D PMFrict2D
	{
		get
		{
			//IL_0017: Unknown result type (might be due to invalid IL or missing references)
			//IL_0021: Expected O, but got Unknown
			if (Object.op_Implicit((Object)(object)_frictMat2D))
			{
				return _frictMat2D;
			}
			_frictMat2D = new PhysicsMaterial2D("Friction2D");
			_frictMat2D.friction = 5f;
			return _frictMat2D;
		}
	}

	public static bool VIsZero(this Vector3 vec)
	{
		if (((Vector3)(ref vec)).sqrMagnitude == 0f)
		{
			return true;
		}
		return false;
	}

	public static bool VIsSame(this Vector3 vec1, Vector3 vec2)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		if (vec1.x != vec2.x)
		{
			return false;
		}
		if (vec1.y != vec2.y)
		{
			return false;
		}
		if (vec1.z != vec2.z)
		{
			return false;
		}
		return true;
	}

	public static Vector3 TransformVector(this Quaternion parentRot, Vector3 parentLossyScale, Vector3 childLocalPos)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		return parentRot * Vector3.Scale(childLocalPos, parentLossyScale);
	}

	public static Vector3 TransformInDirection(this Quaternion childRotation, Vector3 parentLossyScale, Vector3 childLocalPos)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		return childRotation * Vector3.Scale(childLocalPos, new Vector3((float)((parentLossyScale.x > 0f) ? 1 : (-1)), (float)((parentLossyScale.y > 0f) ? 1 : (-1)), (float)((parentLossyScale.y > 0f) ? 1 : (-1))));
	}

	public static Vector3 InverseTransformVector(this Quaternion tRotation, Vector3 tLossyScale, Vector3 worldPos)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		worldPos = Quaternion.Inverse(tRotation) * worldPos;
		return new Vector3(worldPos.x / tLossyScale.x, worldPos.y / tLossyScale.y, worldPos.z / tLossyScale.z);
	}

	public static Vector3 VAxis2DLimit(this Transform parent, Vector3 parentPos, Vector3 childPos, int axis = 3)
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		switch (axis)
		{
		case 3:
			((Plane)(ref axis2DProjection)).SetNormalAndPosition(parent.forward, parentPos);
			break;
		case 2:
			((Plane)(ref axis2DProjection)).SetNormalAndPosition(parent.up, parentPos);
			break;
		default:
			((Plane)(ref axis2DProjection)).SetNormalAndPosition(parent.right, parentPos);
			break;
		}
		return ((Plane)(ref axis2DProjection)).normal * ((Plane)(ref axis2DProjection)).GetDistanceToPoint(childPos);
	}

	public static Quaternion QToLocal(this Quaternion parentRotation, Quaternion worldRotation)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		return Quaternion.Inverse(parentRotation) * worldRotation;
	}

	public static Quaternion QToWorld(this Quaternion parentRotation, Quaternion localRotation)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		return parentRotation * localRotation;
	}

	public static Quaternion QRotateChild(this Quaternion offset, Quaternion parentRot, Quaternion childLocalRot)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		return offset * parentRot * childLocalRot;
	}

	public static Quaternion ClampRotation(this Vector3 current, Vector3 bounds)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00aa: Unknown result type (might be due to invalid IL or missing references)
		WrapVector(current);
		if (current.x < 0f - bounds.x)
		{
			current.x = 0f - bounds.x;
		}
		else if (current.x > bounds.x)
		{
			current.x = bounds.x;
		}
		if (current.y < 0f - bounds.y)
		{
			current.y = 0f - bounds.y;
		}
		else if (current.y > bounds.y)
		{
			current.y = bounds.y;
		}
		if (current.z < 0f - bounds.z)
		{
			current.z = 0f - bounds.z;
		}
		else if (current.z > bounds.z)
		{
			current.z = bounds.z;
		}
		return Quaternion.Euler(current);
	}

	public static Vector3 QToAngularVelocity(this Quaternion deltaRotation, bool fix = false)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		return QToAngularVelocity(deltaRotation, fix ? (1f / Time.fixedDeltaTime) : 1f);
	}

	public static Vector3 QToAngularVelocity(this Quaternion deltaRotation, float multiplyAngle)
	{
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		float num = default(float);
		Vector3 val = default(Vector3);
		((Quaternion)(ref deltaRotation)).ToAngleAxis(ref num, ref val);
		if (num != 0f)
		{
			num = Mathf.DeltaAngle(0f, num);
			val *= num * (MathF.PI / 180f) * multiplyAngle;
			if (float.IsNaN(val.x))
			{
				return Vector3.zero;
			}
			if (float.IsNaN(val.y))
			{
				return Vector3.zero;
			}
			if (float.IsNaN(val.z))
			{
				return Vector3.zero;
			}
			return val;
		}
		return Vector3.zero;
	}

	public static Vector3 QToAngularVelocity(this Quaternion currentRotation, Quaternion targetRotation, bool fix = false)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		return QToAngularVelocity(targetRotation * Quaternion.Inverse(currentRotation), fix);
	}

	public static Vector3 QToAngularVelocity(this Quaternion currentRotation, Quaternion targetRotation, float multiply)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		return QToAngularVelocity(targetRotation * Quaternion.Inverse(currentRotation), multiply);
	}

	public static bool QIsZero(this Quaternion rot)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		if (rot.x != 0f)
		{
			return false;
		}
		if (rot.y != 0f)
		{
			return false;
		}
		if (rot.z != 0f)
		{
			return false;
		}
		return true;
	}

	public static bool QIsSame(this Quaternion rot1, Quaternion rot2)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		if (rot1.x != rot2.x)
		{
			return false;
		}
		if (rot1.y != rot2.y)
		{
			return false;
		}
		if (rot1.z != rot2.z)
		{
			return false;
		}
		if (rot1.w != rot2.w)
		{
			return false;
		}
		return true;
	}

	public static float WrapAngle(float angle)
	{
		angle %= 360f;
		if (angle > 180f)
		{
			return angle - 360f;
		}
		return angle;
	}

	public static Vector3 WrapVector(Vector3 angles)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(WrapAngle(angles.x), WrapAngle(angles.y), WrapAngle(angles.z));
	}

	public static float UnwrapAngle(float angle)
	{
		if (angle >= 0f)
		{
			return angle;
		}
		angle = (0f - angle) % 360f;
		return 360f - angle;
	}

	public static Vector3 UnwrapVector(Vector3 angles)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(UnwrapAngle(angles.x), UnwrapAngle(angles.y), UnwrapAngle(angles.z));
	}

	public static Quaternion SmoothDampRotation(this Quaternion current, Quaternion target, ref Quaternion velocityRef, float duration, float delta)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		return SmoothDampRotation(current, target, ref velocityRef, duration, float.PositiveInfinity, delta);
	}

	public static Quaternion SmoothDampRotation(this Quaternion current, Quaternion target, ref Quaternion velocityRef, float duration, float maxSpeed, float delta)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ec: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f5: Unknown result type (might be due to invalid IL or missing references)
		//IL_0105: Unknown result type (might be due to invalid IL or missing references)
		//IL_0115: Unknown result type (might be due to invalid IL or missing references)
		//IL_0125: Unknown result type (might be due to invalid IL or missing references)
		//IL_012d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0133: Unknown result type (might be due to invalid IL or missing references)
		//IL_0139: Unknown result type (might be due to invalid IL or missing references)
		//IL_013f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0145: Unknown result type (might be due to invalid IL or missing references)
		float num = ((Quaternion.Dot(current, target) > 0f) ? 1f : (-1f));
		target.x *= num;
		target.y *= num;
		target.z *= num;
		target.w *= num;
		Vector4 val = new Vector4(Mathf.SmoothDamp(current.x, target.x, ref velocityRef.x, duration, maxSpeed, delta), Mathf.SmoothDamp(current.y, target.y, ref velocityRef.y, duration, maxSpeed, delta), Mathf.SmoothDamp(current.z, target.z, ref velocityRef.z, duration, maxSpeed, delta), Mathf.SmoothDamp(current.w, target.w, ref velocityRef.w, duration, maxSpeed, delta));
		Vector4 normalized = ((Vector4)(ref val)).normalized;
		Vector4 val2 = Vector4.Project(new Vector4(velocityRef.x, velocityRef.y, velocityRef.z, velocityRef.w), normalized);
		velocityRef.x -= val2.x;
		velocityRef.y -= val2.y;
		velocityRef.z -= val2.z;
		velocityRef.w -= val2.w;
		return new Quaternion(normalized.x, normalized.y, normalized.z, normalized.w);
	}

	public static float PerlinNoise3D(float x, float y, float z)
	{
		y += 1f;
		z += 2f;
		float num = Mathf.Sin(MathF.PI * Mathf.PerlinNoise(x, y));
		float num2 = Mathf.Sin(MathF.PI * Mathf.PerlinNoise(x, z));
		float num3 = Mathf.Sin(MathF.PI * Mathf.PerlinNoise(y, z));
		float num4 = Mathf.Sin(MathF.PI * Mathf.PerlinNoise(y, x));
		float num5 = Mathf.Sin(MathF.PI * Mathf.PerlinNoise(z, x));
		float num6 = Mathf.Sin(MathF.PI * Mathf.PerlinNoise(z, y));
		return num * num2 * num3 * num4 * num5 * num6;
	}

	public static float PerlinNoise3D(Vector3 pos)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		return PerlinNoise3D(pos.x, pos.y, pos.z);
	}

	public static bool SameDirection(this float a, float b)
	{
		if (!(a > 0f) || !(b > 0f))
		{
			if (a < 0f)
			{
				return b < 0f;
			}
			return false;
		}
		return true;
	}

	public static float PointDisperse01(int index, int baseV = 2)
	{
		float num = 0f;
		float num2 = 1f / (float)baseV;
		int num3 = index;
		while (num3 > 0)
		{
			num += num2 * (float)(num3 % baseV);
			num3 = Mathf.FloorToInt((float)(num3 / baseV));
			num2 /= (float)baseV;
		}
		return num;
	}

	public static float PointDisperse(int index, int baseV = 2)
	{
		float num = 0f;
		float num2 = 1f / (float)baseV;
		int num3 = index;
		while (num3 > 0)
		{
			num += num2 * (float)(num3 % baseV);
			num3 = Mathf.FloorToInt((float)(num3 / baseV));
			num2 /= (float)baseV;
		}
		return num - 0.5f;
	}

	public static float GetScaler(this Transform transform)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		if (transform.lossyScale.x > transform.lossyScale.y)
		{
			if (transform.lossyScale.y > transform.lossyScale.z)
			{
				return transform.lossyScale.y;
			}
			return transform.lossyScale.z;
		}
		return transform.lossyScale.x;
	}

	public static Vector3 PosFromMatrix(this Matrix4x4 m)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		return Vector4.op_Implicit(((Matrix4x4)(ref m)).GetColumn(3));
	}

	public static Quaternion RotFromMatrix(this Matrix4x4 m)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		return Quaternion.LookRotation(Vector4.op_Implicit(((Matrix4x4)(ref m)).GetColumn(2)), Vector4.op_Implicit(((Matrix4x4)(ref m)).GetColumn(1)));
	}

	public static Vector3 ScaleFromMatrix(this Matrix4x4 m)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		Vector4 column = ((Matrix4x4)(ref m)).GetColumn(0);
		float magnitude = ((Vector4)(ref column)).magnitude;
		column = ((Matrix4x4)(ref m)).GetColumn(1);
		float magnitude2 = ((Vector4)(ref column)).magnitude;
		column = ((Matrix4x4)(ref m)).GetColumn(2);
		return new Vector3(magnitude, magnitude2, ((Vector4)(ref column)).magnitude);
	}

	public static Bounds TransformBounding(Bounds b, Transform by)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		return TransformBounding(b, by.localToWorldMatrix);
	}

	public static Bounds TransformBounding(Bounds b, Matrix4x4 mx)
	{
		//IL_0004: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ((Matrix4x4)(ref mx)).MultiplyPoint(((Bounds)(ref b)).min);
		Vector3 val2 = ((Matrix4x4)(ref mx)).MultiplyPoint(((Bounds)(ref b)).max);
		Vector3 val3 = ((Matrix4x4)(ref mx)).MultiplyPoint(new Vector3(((Bounds)(ref b)).max.x, ((Bounds)(ref b)).center.y, ((Bounds)(ref b)).min.z));
		Vector3 val4 = ((Matrix4x4)(ref mx)).MultiplyPoint(new Vector3(((Bounds)(ref b)).min.x, ((Bounds)(ref b)).center.y, ((Bounds)(ref b)).max.z));
		((Bounds)(ref b))..ctor(val, Vector3.zero);
		((Bounds)(ref b)).Encapsulate(val);
		((Bounds)(ref b)).Encapsulate(val2);
		((Bounds)(ref b)).Encapsulate(val3);
		((Bounds)(ref b)).Encapsulate(val4);
		return b;
	}

	public static Bounds RotateBoundsByMatrix(this Bounds b, Quaternion rotation)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fa: Unknown result type (might be due to invalid IL or missing references)
		//IL_0105: Unknown result type (might be due to invalid IL or missing references)
		//IL_0111: Unknown result type (might be due to invalid IL or missing references)
		//IL_011d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0127: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0131: Unknown result type (might be due to invalid IL or missing references)
		//IL_0137: Unknown result type (might be due to invalid IL or missing references)
		//IL_0143: Unknown result type (might be due to invalid IL or missing references)
		//IL_014f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0159: Unknown result type (might be due to invalid IL or missing references)
		//IL_015e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0163: Unknown result type (might be due to invalid IL or missing references)
		//IL_0169: Unknown result type (might be due to invalid IL or missing references)
		//IL_0175: Unknown result type (might be due to invalid IL or missing references)
		//IL_0181: Unknown result type (might be due to invalid IL or missing references)
		//IL_018b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0190: Unknown result type (might be due to invalid IL or missing references)
		//IL_0195: Unknown result type (might be due to invalid IL or missing references)
		//IL_019b: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c7: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01dd: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		if (QIsZero(rotation))
		{
			return b;
		}
		Matrix4x4 val = Matrix4x4.Rotate(rotation);
		Bounds result = default(Bounds);
		Vector3 val2 = ((Matrix4x4)(ref val)).MultiplyPoint(new Vector3(((Bounds)(ref b)).max.x, ((Bounds)(ref b)).min.y, ((Bounds)(ref b)).max.z));
		Vector3 val3 = ((Matrix4x4)(ref val)).MultiplyPoint(new Vector3(((Bounds)(ref b)).max.x, ((Bounds)(ref b)).min.y, ((Bounds)(ref b)).min.z));
		Vector3 val4 = ((Matrix4x4)(ref val)).MultiplyPoint(new Vector3(((Bounds)(ref b)).min.x, ((Bounds)(ref b)).min.y, ((Bounds)(ref b)).min.z));
		Vector3 val5 = ((Matrix4x4)(ref val)).MultiplyPoint(new Vector3(((Bounds)(ref b)).min.x, ((Bounds)(ref b)).min.y, ((Bounds)(ref b)).max.z));
		((Bounds)(ref result)).Encapsulate(val2);
		((Bounds)(ref result)).Encapsulate(val3);
		((Bounds)(ref result)).Encapsulate(val4);
		((Bounds)(ref result)).Encapsulate(val5);
		Vector3 val6 = ((Matrix4x4)(ref val)).MultiplyPoint(new Vector3(((Bounds)(ref b)).max.x, ((Bounds)(ref b)).max.y, ((Bounds)(ref b)).max.z));
		Vector3 val7 = ((Matrix4x4)(ref val)).MultiplyPoint(new Vector3(((Bounds)(ref b)).max.x, ((Bounds)(ref b)).max.y, ((Bounds)(ref b)).min.z));
		Vector3 val8 = ((Matrix4x4)(ref val)).MultiplyPoint(new Vector3(((Bounds)(ref b)).min.x, ((Bounds)(ref b)).max.y, ((Bounds)(ref b)).min.z));
		Vector3 val9 = ((Matrix4x4)(ref val)).MultiplyPoint(new Vector3(((Bounds)(ref b)).min.x, ((Bounds)(ref b)).max.y, ((Bounds)(ref b)).max.z));
		((Bounds)(ref result)).Encapsulate(val6);
		((Bounds)(ref result)).Encapsulate(val7);
		((Bounds)(ref result)).Encapsulate(val8);
		((Bounds)(ref result)).Encapsulate(val9);
		return result;
	}

	public static Bounds RotateLocalBounds(this Bounds b, Quaternion rotation)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		float num = Quaternion.Angle(rotation, Quaternion.identity);
		if (num > 45f && num < 135f)
		{
			((Bounds)(ref b)).size = new Vector3(((Bounds)(ref b)).size.z, ((Bounds)(ref b)).size.y, ((Bounds)(ref b)).size.x);
		}
		if (num < 315f && num > 225f)
		{
			((Bounds)(ref b)).size = new Vector3(((Bounds)(ref b)).size.z, ((Bounds)(ref b)).size.y, ((Bounds)(ref b)).size.x);
		}
		return b;
	}

	public static int[] GetLayermaskValues(int mask, int optionsCount)
	{
		List<int> list = new List<int>();
		for (int i = 0; i < optionsCount; i++)
		{
			int num = 1 << i;
			if ((mask & num) != 0)
			{
				list.Add(i);
			}
		}
		return list.ToArray();
	}

	public static LayerMask GetLayerMaskUsingPhysicsProjectSettingsMatrix(int maskForLayer)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		LayerMask val = LayerMask.op_Implicit(0);
		for (int i = 0; i < 32; i++)
		{
			if (!Physics.GetIgnoreLayerCollision(maskForLayer, i))
			{
				val = LayerMask.op_Implicit(LayerMask.op_Implicit(val) | (1 << i));
			}
		}
		return val;
	}

	public static float DistanceTo_2D(Vector3 aPos, Vector3 bPos)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		return Vector2.Distance(new Vector2(aPos.x, aPos.z), new Vector2(bPos.x, bPos.z));
	}

	public static float DistanceTo_2DSqrt(Vector3 aPos, Vector3 bPos)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		return Vector2.SqrMagnitude(new Vector2(aPos.x, aPos.z) - new Vector2(bPos.x, bPos.z));
	}

	public static Vector2 GetAngleDirection2D(float angle)
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		float num = angle * (MathF.PI / 180f);
		return new Vector2(Mathf.Sin(num), Mathf.Cos(num));
	}

	public static Vector3 GetAngleDirection(float angle)
	{
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		float num = angle * (MathF.PI / 180f);
		return new Vector3(Mathf.Sin(num), 0f, Mathf.Cos(num));
	}

	public static Vector3 GetAngleDirectionXZ(float angle)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		return GetAngleDirection(angle);
	}

	public static Vector3 GetAngleDirectionZX(float angle)
	{
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		float num = angle * (MathF.PI / 180f);
		return new Vector3(Mathf.Cos(num), 0f, Mathf.Sin(num));
	}

	public static Vector3 GetAngleDirectionXY(float angle, float radOffset = 0f, float secAxisRadOffset = 0f)
	{
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		float num = angle * (MathF.PI / 180f);
		return new Vector3(Mathf.Sin(num + radOffset), Mathf.Cos(num + secAxisRadOffset), 0f);
	}

	public static Vector3 GetAngleDirectionYX(float angle, float firstAxisRadOffset = 0f, float secAxisRadOffset = 0f)
	{
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		float num = angle * (MathF.PI / 180f);
		return new Vector3(Mathf.Cos(num + secAxisRadOffset), Mathf.Sin(num + firstAxisRadOffset), 0f);
	}

	public static Vector3 GetAngleDirectionYZ(float angle)
	{
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		float num = angle * (MathF.PI / 180f);
		return new Vector3(0f, Mathf.Sin(num), Mathf.Cos(num));
	}

	public static Vector3 GetAngleDirectionZY(float angle)
	{
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		float num = angle * (MathF.PI / 180f);
		return new Vector3(0f, Mathf.Cos(num), Mathf.Sin(num));
	}

	public static Vector3 V2ToV3TopDown(Vector2 v)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(v.x, 0f, v.y);
	}

	public static Vector2 V3ToV2(Vector3 a)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		return new Vector2(a.x, a.z);
	}

	public static Vector2 V3TopDownDiff(Vector3 target, Vector3 me)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		return V3ToV2(target) - V3ToV2(me);
	}

	public static float GetAngleDeg(Vector3 v)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		return GetAngleDeg(v.x, v.z);
	}

	public static float GetAngleDeg(Vector2 v)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		return GetAngleDeg(v.x, v.y);
	}

	public static float GetAngleDeg(float x, float z)
	{
		return GetAngleRad(x, z) * 57.29578f;
	}

	public static float GetAngleRad(float x, float z)
	{
		return Mathf.Atan2(x, z);
	}

	public static float Rnd(float val, int dec = 0)
	{
		if (dec <= 0)
		{
			return Mathf.Round(val);
		}
		return (float)Math.Round(val, dec);
	}

	internal static float ManhattanTopDown2D(Vector3 probePos, Vector3 worldPosition)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		float num = probePos.x - worldPosition.x;
		if (num < 0f)
		{
			num = 0f - num;
		}
		float num2 = probePos.z - worldPosition.z;
		if (num2 < 0f)
		{
			num2 = 0f - num2;
		}
		return num + num2;
	}

	internal static bool IsInSqureBounds2D(Vector3 probePos, Vector3 boundsPos, float boundsRange)
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		if (boundsRange <= 0f)
		{
			return false;
		}
		if (probePos.x > boundsPos.x - boundsRange && probePos.x < boundsPos.x + boundsRange && probePos.z > boundsPos.z - boundsRange && probePos.z < boundsPos.z + boundsRange)
		{
			return true;
		}
		return false;
	}

	internal static bool IsInSqureBounds2D(Vector3 boundsAPos, float boundsAHalfRange, Vector3 boundsBPos, float boundsBHRange)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		if (boundsAPos.x - boundsAHalfRange <= boundsBPos.x + boundsBHRange && boundsAPos.x + boundsAHalfRange >= boundsBPos.x - boundsBHRange && boundsAPos.z - boundsAHalfRange <= boundsBPos.z + boundsBHRange)
		{
			return boundsAPos.z + boundsAHalfRange >= boundsBPos.z - boundsBHRange;
		}
		return false;
	}

	internal static Vector3 GetDirectionTowards(Vector3 me, Vector3 target)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(target.x - me.x, 0f, target.z - me.z);
	}
}


using System.Collections.Generic;
using UnityEngine;

public static class FLogicMethods
{
	public static float Lerp(this float from, float to, float value)
	{
		if (to != from)
		{
			return Mathf.Clamp((value - from) / (to - from), -1f, 1f);
		}
		return 0f;
	}

	public static float InverseLerp(float from, float to, float value)
	{
		if (to != from)
		{
			return Mathf.Clamp((value - from) / (to - from), -1f, 1f);
		}
		return 0f;
	}

	public static float InverseLerpUnclamped(float xx, float yy, float value)
	{
		if (yy - xx == 0f)
		{
			return 0f;
		}
		return (value - xx) / (yy - xx);
	}

	public static float FLerp(float a, float b, float t, float factor = 0.01f)
	{
		float num = b;
		b = ((!(num > a)) ? (b - factor) : (b + factor));
		float num2 = Mathf.LerpUnclamped(a, b, t);
		if (num > a)
		{
			if (num2 >= num)
			{
				return num;
			}
		}
		else if (num2 <= num)
		{
			return num;
		}
		return num2;
	}

	public static int IntLerp(int a, int b, float t)
	{
		int source = 0;
		IntLerp(ref source, a, b, t);
		return source;
	}

	public static void IntLerp(ref int source, int a, int b, float t)
	{
		source = Mathf.RoundToInt((float)a * (1f - t)) + Mathf.RoundToInt((float)b * t);
	}

	public static void IntLerp(ref int source, int b, float t)
	{
		IntLerp(ref source, source, b, t);
	}

	public static float FAbs(this float value)
	{
		if (value < 0f)
		{
			value = 0f - value;
		}
		return value;
	}

	public static float HyperCurve(this float value)
	{
		return 0f - 1f / (3.2f * value - 4f) - 0.25f;
	}

	public static float TopDownDistanceManhattan(this Vector3 a, Vector3 b)
	{
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		return 0f + FAbs(a.x - b.x) + FAbs(a.z - b.z);
	}

	public static float TopDownDistance(this Vector3 a, Vector3 b)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		a.y = a.z;
		b.y = b.z;
		return Vector2.Distance(Vector2.op_Implicit(a), Vector2.op_Implicit(b));
	}

	public static float DistanceManhattan(this Vector3 a, Vector3 b)
	{
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		return 0f + FAbs(a.x - b.x) + FAbs(a.y - b.y) + FAbs(a.z - b.z);
	}

	public static float WrapAngle(float angle)
	{
		angle %= 360f;
		if (angle > 180f)
		{
			return angle - 360f;
		}
		return angle;
	}

	public static Vector3 WrapVector(Vector3 angles)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(WrapAngle(angles.x), WrapAngle(angles.y), WrapAngle(angles.z));
	}

	public static float UnwrapAngle(float angle)
	{
		if (angle >= 0f)
		{
			return angle;
		}
		angle = (0f - angle) % 360f;
		return 360f - angle;
	}

	public static Vector3 UnwrapVector(Vector3 angles)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(UnwrapAngle(angles.x), UnwrapAngle(angles.y), UnwrapAngle(angles.z));
	}

	public static bool IsAlmostEqual(float val, float to, int afterComma = 2, float addRange = 0f)
	{
		float num = 1f / Mathf.Pow(10f, (float)afterComma) + addRange;
		if ((val > to - num && val < to + num) || val == to)
		{
			return true;
		}
		return false;
	}

	public static Quaternion TopDownAngle(Vector3 from, Vector3 to)
	{
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		from.y = 0f;
		to.y = 0f;
		return Quaternion.LookRotation(to - from);
	}

	public static Quaternion TopDownAnglePosition2D(Vector2 from, Vector2 to, float offset = 0f)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = to - from;
		return Quaternion.AngleAxis(Mathf.Atan2(val.y, val.x) * 57.29578f + offset, Vector3.forward);
	}

	public static bool ContainsIndex<T>(this List<T> list, int i, bool falseIfNull = true) where T : class
	{
		if (list == null)
		{
			return false;
		}
		if (i < 0)
		{
			return false;
		}
		if (i >= list.Count)
		{
			return false;
		}
		if (falseIfNull && list[i] == null)
		{
			return false;
		}
		return true;
	}

	public static bool ContainsIndex<T>(this List<T> list, int i) where T : struct
	{
		if (list == null)
		{
			return false;
		}
		if (i < 0)
		{
			return false;
		}
		if (i >= list.Count)
		{
			return false;
		}
		return true;
	}

	public static bool ContainsIndex<T>(this T[] list, int i, bool falseIfNull) where T : class
	{
		if (list == null)
		{
			return false;
		}
		if (i < 0)
		{
			return false;
		}
		if (i >= list.Length)
		{
			return false;
		}
		if (falseIfNull && list[i] == null)
		{
			return false;
		}
		return true;
	}
}


using System.Collections.Generic;
using UnityEngine;

public static class FTransformMethods
{
	public static Transform FindChildByNameInDepth(string name, Transform transform, bool findInDeactivated = true, string[] additionalContains = null)
	{
		if (((Object)transform).name == name)
		{
			return transform;
		}
		Transform[] componentsInChildren = ((Component)transform).GetComponentsInChildren<Transform>(findInDeactivated);
		foreach (Transform val in componentsInChildren)
		{
			if (!((Object)val).name.ToLower().Contains(name.ToLower()))
			{
				continue;
			}
			bool flag = false;
			if (additionalContains == null || additionalContains.Length == 0)
			{
				flag = true;
			}
			else
			{
				for (int j = 0; j < additionalContains.Length; j++)
				{
					if (((Object)val).name.ToLower().Contains(additionalContains[j].ToLower()))
					{
						flag = true;
						break;
					}
				}
			}
			if (flag)
			{
				return val;
			}
		}
		return null;
	}

	public static List<T> FindComponentsInAllChildren<T>(Transform transformToSearchIn, bool includeInactive = false, bool tryGetMultipleOutOfSingleObject = false) where T : Component
	{
		List<T> list = new List<T>();
		T[] components = ((Component)transformToSearchIn).GetComponents<T>();
		foreach (T val in components)
		{
			if (Object.op_Implicit((Object)(object)val))
			{
				list.Add(val);
			}
		}
		Transform[] componentsInChildren = ((Component)transformToSearchIn).GetComponentsInChildren<Transform>(includeInactive);
		foreach (Transform val2 in componentsInChildren)
		{
			if (!tryGetMultipleOutOfSingleObject)
			{
				T component = ((Component)val2).GetComponent<T>();
				if (Object.op_Implicit((Object)(object)component) && !list.Contains(component))
				{
					list.Add(component);
				}
				continue;
			}
			components = ((Component)val2).GetComponents<T>();
			foreach (T val3 in components)
			{
				if (Object.op_Implicit((Object)(object)val3) && !list.Contains(val3))
				{
					list.Add(val3);
				}
			}
		}
		return list;
	}

	public static T FindComponentInAllChildren<T>(Transform transformToSearchIn) where T : Component
	{
		Transform[] componentsInChildren = ((Component)transformToSearchIn).GetComponentsInChildren<Transform>();
		for (int i = 0; i < componentsInChildren.Length; i++)
		{
			T component = ((Component)componentsInChildren[i]).GetComponent<T>();
			if (Object.op_Implicit((Object)(object)component))
			{
				return component;
			}
		}
		return default(T);
	}

	public static T FindComponentInAllParents<T>(Transform transformToSearchIn) where T : Component
	{
		Transform parent = transformToSearchIn.parent;
		for (int i = 0; i < 100; i++)
		{
			T component = ((Component)parent).GetComponent<T>();
			if (Object.op_Implicit((Object)(object)component))
			{
				return component;
			}
			parent = parent.parent;
			if ((Object)(object)parent == (Object)null)
			{
				return default(T);
			}
		}
		return default(T);
	}

	public static void ChangeActiveChildrenInside(Transform parentOfThem, bool active)
	{
		for (int i = 0; i < parentOfThem.childCount; i++)
		{
			((Component)parentOfThem.GetChild(i)).gameObject.SetActive(active);
		}
	}

	public static void ChangeActiveThroughParentTo(Transform start, Transform end, bool active, bool changeParentsChildrenActivation = false)
	{
		((Component)start).gameObject.SetActive(active);
		Transform parent = start.parent;
		for (int i = 0; i < 100; i++)
		{
			if ((Object)(object)parent == (Object)(object)end)
			{
				break;
			}
			if ((Object)(object)parent == (Object)null)
			{
				break;
			}
			if (changeParentsChildrenActivation)
			{
				ChangeActiveChildrenInside(parent, active);
			}
			parent = parent.parent;
		}
	}

	public static Transform GetObjectByPath(Transform root, string path)
	{
		if ((Object)(object)root == (Object)null)
		{
			return null;
		}
		string[] array = path.Split('/');
		Transform val = root;
		for (int i = 0; i < array.Length; i++)
		{
			Transform val2 = val.Find(array[i]);
			if ((Object)(object)val2 == (Object)null)
			{
				return null;
			}
			val = val2;
		}
		return val;
	}

	public static string CalculateTransformPath(Transform child, Transform root)
	{
		if ((Object)(object)child.parent == (Object)null)
		{
			return "";
		}
		string text = "";
		bool flag = true;
		while ((Object)(object)child != (Object)(object)root)
		{
			if ((Object)(object)child == (Object)null)
			{
				return "";
			}
			text = ((!flag) ? (((Object)child).name + "/" + text) : ((Object)child).name);
			flag = false;
			child = child.parent;
		}
		return text;
	}
}


using UnityEngine;

public static class FVectorMethods
{
	public static Vector3 RandomVector(float rangeA, float rangeB)
	{
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(Random.Range(rangeA, rangeB), Random.Range(rangeA, rangeB), Random.Range(rangeA, rangeB));
	}

	public static float VectorSum(Vector3 vector)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		return vector.x + vector.y + vector.z;
	}

	public static Vector3 RandomVectorNoY(float rangeA, float rangeB)
	{
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(Random.Range(rangeA, rangeB), 0f, Random.Range(rangeA, rangeB));
	}

	public static Vector3 RandomVectorMinMax(float min, float max)
	{
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		float num = 1f;
		if (Random.Range(0, 2) == 1)
		{
			num = -1f;
		}
		float num2 = 1f;
		if (Random.Range(0, 2) == 1)
		{
			num2 = -1f;
		}
		float num3 = 1f;
		if (Random.Range(0, 2) == 1)
		{
			num3 = -1f;
		}
		return new Vector3(Random.Range(min, max) * num, Random.Range(min, max) * num2, Random.Range(min, max) * num3);
	}

	public static Vector3 RandomVectorNoYMinMax(float min, float max)
	{
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		float num = 1f;
		if (Random.Range(0, 2) == 1)
		{
			num = -1f;
		}
		float num2 = 1f;
		if (Random.Range(0, 2) == 1)
		{
			num2 = -1f;
		}
		return new Vector3(Random.Range(min, max) * num, 0f, Random.Range(min, max) * num2);
	}

	public static Vector3 GetUIPositionFromWorldPosition(Vector3 position, Camera camera, RectTransform canvas)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		Vector3 result = camera.WorldToViewportPoint(position);
		result.x *= canvas.sizeDelta.x;
		result.y *= canvas.sizeDelta.y;
		result.x -= canvas.sizeDelta.x * canvas.pivot.x;
		result.y -= canvas.sizeDelta.y * canvas.pivot.y;
		return result;
	}

	public static Vector2 XOZ(this Vector3 toBeFlattened)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		return new Vector2(toBeFlattened.x, toBeFlattened.z);
	}

	public static Vector3 XOZ(this Vector3 toBeFlattened, float yValue = 0f)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(toBeFlattened.x, yValue, toBeFlattened.z);
	}

	public static float DistanceTopDown(Vector3 from, Vector3 to)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		return Vector2.Distance(XOZ(from), XOZ(to));
	}

	public static float DistanceTopDownManhattan(Vector3 from, Vector3 to)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		return Mathf.Abs(from.x - to.x) + Mathf.Abs(from.z - to.z);
	}

	public static float BoundsSizeOnAxis(this Bounds bounds, Vector3 normalized)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = Vector3.Scale(((Bounds)(ref bounds)).size, normalized);
		return ((Vector3)(ref val)).magnitude;
	}

	public static Vector3 ChooseDominantAxis(Vector3 axis)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = default(Vector3);
		((Vector3)(ref val))..ctor(Mathf.Abs(axis.x), Mathf.Abs(axis.y), Mathf.Abs(axis.z));
		if (val.x > val.y)
		{
			if (val.z > val.x)
			{
				return new Vector3(0f, 0f, (axis.z > 0f) ? 1f : (-1f));
			}
			return new Vector3((axis.x > 0f) ? 1f : (-1f), 0f, 0f);
		}
		if (val.z > val.y)
		{
			return new Vector3(0f, 0f, (axis.z > 0f) ? 1f : (-1f));
		}
		return new Vector3(0f, (axis.y > 0f) ? 1f : (-1f), 0f);
	}

	public static Vector3 GetRounded(Vector3 dir)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(Mathf.Round(dir.x), Mathf.Round(dir.y), Mathf.Round(dir.z));
	}

	public static Vector3 GetCounterAxis(Vector3 axis)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(axis.z, axis.x, axis.y);
	}

	public static Color GetAxisColor(Vector3 axis, float alpha = 0.75f)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		return new Color(axis.z, axis.x, axis.y, alpha);
	}

	public static Vector3 FlattenVector(Vector3 v, float to = 90f)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		v.x = Mathf.Round(v.x / to) * to;
		v.y = Mathf.Round(v.y / to) * to;
		v.z = Mathf.Round(v.z / to) * to;
		return v;
	}

	public static Vector3 FlattenVectorFlr(Vector3 v, float to = 90f)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		v.x = Mathf.Floor(v.x / to) * to;
		v.y = Mathf.Floor(v.y / to) * to;
		v.z = Mathf.Floor(v.z / to) * to;
		return v;
	}

	public static Vector3 FlattenVectorCeil(Vector3 v, float to = 90f)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		v.x = Mathf.Ceil(v.x / to) * to;
		v.y = Mathf.Ceil(v.y / to) * to;
		v.z = Mathf.Ceil(v.z / to) * to;
		return v;
	}

	public static Vector3 FlattenVector(Vector3 v, Vector3 to)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		v.x = Mathf.Round(v.x / to.x) * to.x;
		v.y = Mathf.Round(v.y / to.y) * to.y;
		v.z = Mathf.Round(v.z / to.z) * to.z;
		return v;
	}

	public static Vector3Int V3toV3Int(Vector3 v)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3Int(Mathf.RoundToInt(v.x), Mathf.RoundToInt(v.y), Mathf.RoundToInt(v.z));
	}

	public static Vector3 FlattenNormal(Quaternion orientation, Vector3? forward = null, float to = 90f)
	{
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ((!forward.HasValue) ? Vector3.forward : forward.Value);
		return Quaternion.Euler(FlattenVector(((Quaternion)(ref orientation)).eulerAngles, to)) * val;
	}

	public static Vector3 EqualVector(float valueAll)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		return new Vector3(valueAll, valueAll, valueAll);
	}

	public static Quaternion FlattenRotation(Quaternion orientation, float to = 90f)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		return Quaternion.Euler(FlattenVector(((Quaternion)(ref orientation)).eulerAngles, to));
	}
}


using FIMSpace;
using UnityEngine;

public abstract class FImp_ColliderData_Base
{
	public enum EFColliderType
	{
		Box,
		Sphere,
		Capsule,
		Mesh,
		Terrain
	}

	public bool Is2D;

	protected Vector3 previousPosition = Vector3.zero;

	protected Quaternion previousRotation = Quaternion.identity;

	protected Vector3 previousScale = Vector3.one;

	public Transform Transform { get; protected set; }

	public Collider Collider { get; protected set; }

	public Collider2D Collider2D { get; protected set; }

	public bool IsStatic { get; private set; }

	public EFColliderType ColliderType { get; protected set; }

	public static FImp_ColliderData_Base GetColliderDataFor(Collider collider)
	{
		SphereCollider val = (SphereCollider)(object)((collider is SphereCollider) ? collider : null);
		if (Object.op_Implicit((Object)(object)val))
		{
			return new FImp_ColliderData_Sphere(val);
		}
		CapsuleCollider val2 = (CapsuleCollider)(object)((collider is CapsuleCollider) ? collider : null);
		if (Object.op_Implicit((Object)(object)val2))
		{
			return new FImp_ColliderData_Capsule(val2);
		}
		BoxCollider val3 = (BoxCollider)(object)((collider is BoxCollider) ? collider : null);
		if (Object.op_Implicit((Object)(object)val3))
		{
			return new FImp_ColliderData_Box(val3);
		}
		MeshCollider val4 = (MeshCollider)(object)((collider is MeshCollider) ? collider : null);
		if (Object.op_Implicit((Object)(object)val4))
		{
			return new FImp_ColliderData_Mesh(val4);
		}
		TerrainCollider val5 = (TerrainCollider)(object)((collider is TerrainCollider) ? collider : null);
		if (Object.op_Implicit((Object)(object)val5))
		{
			return new FImp_ColliderData_Terrain(val5);
		}
		CharacterController val6 = (CharacterController)(object)((collider is CharacterController) ? collider : null);
		if (Object.op_Implicit((Object)(object)val6))
		{
			return new FImp_ColliderData_CharacterCapsule(val6);
		}
		return null;
	}

	public static FImp_ColliderData_Base GetColliderDataFor(Collider2D collider)
	{
		CircleCollider2D val = (CircleCollider2D)(object)((collider is CircleCollider2D) ? collider : null);
		if (Object.op_Implicit((Object)(object)val))
		{
			return new FImp_ColliderData_Sphere(val);
		}
		CapsuleCollider2D val2 = (CapsuleCollider2D)(object)((collider is CapsuleCollider2D) ? collider : null);
		if (Object.op_Implicit((Object)(object)val2))
		{
			return new FImp_ColliderData_Capsule(val2);
		}
		BoxCollider2D val3 = (BoxCollider2D)(object)((collider is BoxCollider2D) ? collider : null);
		if (Object.op_Implicit((Object)(object)val3))
		{
			return new FImp_ColliderData_Box(val3);
		}
		PolygonCollider2D val4 = (PolygonCollider2D)(object)((collider is PolygonCollider2D) ? collider : null);
		if (Object.op_Implicit((Object)(object)val4))
		{
			return new FImp_ColliderData_Mesh(val4);
		}
		return null;
	}

	public virtual void RefreshColliderData()
	{
		if (((Component)Transform).gameObject.isStatic)
		{
			IsStatic = true;
		}
		else
		{
			IsStatic = false;
		}
	}

	public virtual bool PushIfInside(ref Vector3 point, float pointRadius, Vector3 pointOffset)
	{
		Collider collider = Collider;
		if (Object.op_Implicit((Object)(object)((collider is SphereCollider) ? collider : null)))
		{
			Debug.Log((object)"It shouldn't appear");
		}
		return false;
	}

	public virtual bool PushIfInside2D(ref Vector3 point, float pointRadius, Vector3 pointOffset)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		return PushIfInside(ref point, pointRadius, pointOffset);
	}

	public static bool VIsSame(Vector3 vec1, Vector3 vec2)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		if (vec1.x != vec2.x)
		{
			return false;
		}
		if (vec1.y != vec2.y)
		{
			return false;
		}
		if (vec1.z != vec2.z)
		{
			return false;
		}
		return true;
	}
}


public enum EFColliderType
{
	Box,
	Sphere,
	Capsule,
	Mesh,
	Terrain
}


using FIMSpace;
using UnityEngine;

public class FImp_ColliderData_Box : FImp_ColliderData_Base
{
	private Vector3 boxCenter;

	private Vector3 right;

	private Vector3 up;

	private Vector3 forward;

	private Vector3 rightN;

	private Vector3 upN;

	private Vector3 forwardN;

	private Vector3 scales;

	public BoxCollider Box { get; private set; }

	public BoxCollider2D Box2D { get; private set; }

	public FImp_ColliderData_Box(BoxCollider collider)
	{
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		Is2D = false;
		base.Collider = (Collider)(object)collider;
		base.Transform = ((Component)collider).transform;
		Box = collider;
		base.ColliderType = EFColliderType.Box;
		RefreshColliderData();
		previousPosition = base.Transform.position + Vector3.forward * Mathf.Epsilon;
	}

	public FImp_ColliderData_Box(BoxCollider2D collider2D)
	{
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		Is2D = true;
		base.Collider2D = (Collider2D)(object)collider2D;
		base.Transform = ((Component)collider2D).transform;
		Box2D = collider2D;
		base.ColliderType = EFColliderType.Box;
		RefreshColliderData();
		previousPosition = base.Transform.position + Vector3.forward * Mathf.Epsilon;
	}

	public override void RefreshColliderData()
	{
		//IL_0188: Unknown result type (might be due to invalid IL or missing references)
		//IL_018d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0193: Unknown result type (might be due to invalid IL or missing references)
		//IL_0198: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_02d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_02d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01fd: Unknown result type (might be due to invalid IL or missing references)
		//IL_0202: Unknown result type (might be due to invalid IL or missing references)
		//IL_0213: Unknown result type (might be due to invalid IL or missing references)
		//IL_021d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0228: Unknown result type (might be due to invalid IL or missing references)
		//IL_0232: Unknown result type (might be due to invalid IL or missing references)
		//IL_0237: Unknown result type (might be due to invalid IL or missing references)
		//IL_023c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0248: Unknown result type (might be due to invalid IL or missing references)
		//IL_024d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0259: Unknown result type (might be due to invalid IL or missing references)
		//IL_025e: Unknown result type (might be due to invalid IL or missing references)
		//IL_026a: Unknown result type (might be due to invalid IL or missing references)
		//IL_026f: Unknown result type (might be due to invalid IL or missing references)
		//IL_028a: Unknown result type (might be due to invalid IL or missing references)
		//IL_028f: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_02ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_02ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_02b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Unknown result type (might be due to invalid IL or missing references)
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0101: Unknown result type (might be due to invalid IL or missing references)
		//IL_010d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0112: Unknown result type (might be due to invalid IL or missing references)
		//IL_011e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0123: Unknown result type (might be due to invalid IL or missing references)
		//IL_012f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0134: Unknown result type (might be due to invalid IL or missing references)
		//IL_0140: Unknown result type (might be due to invalid IL or missing references)
		//IL_0145: Unknown result type (might be due to invalid IL or missing references)
		//IL_0151: Unknown result type (might be due to invalid IL or missing references)
		//IL_0161: Unknown result type (might be due to invalid IL or missing references)
		//IL_0166: Unknown result type (might be due to invalid IL or missing references)
		//IL_016b: Unknown result type (might be due to invalid IL or missing references)
		if (base.IsStatic)
		{
			return;
		}
		if ((Object)(object)base.Collider2D == (Object)null)
		{
			bool flag = false;
			if (!base.Transform.position.VIsSame(previousPosition))
			{
				flag = true;
			}
			else if (!base.Transform.rotation.QIsSame(previousRotation))
			{
				flag = true;
			}
			if (flag)
			{
				right = ((Component)Box).transform.TransformVector(Vector3.right / 2f * Box.size.x);
				up = ((Component)Box).transform.TransformVector(Vector3.up / 2f * Box.size.y);
				forward = ((Component)Box).transform.TransformVector(Vector3.forward / 2f * Box.size.z);
				rightN = ((Vector3)(ref right)).normalized;
				upN = ((Vector3)(ref up)).normalized;
				forwardN = ((Vector3)(ref forward)).normalized;
				boxCenter = GetBoxCenter(Box);
				scales = Vector3.Scale(Box.size, ((Component)Box).transform.lossyScale);
				((Vector3)(ref scales)).Normalize();
			}
		}
		else
		{
			bool flag2 = false;
			if (Vector2.Distance(Vector2.op_Implicit(base.Transform.position), Vector2.op_Implicit(previousPosition)) > Mathf.Epsilon)
			{
				flag2 = true;
			}
			else if (!base.Transform.rotation.QIsSame(previousRotation))
			{
				flag2 = true;
			}
			if (flag2)
			{
				right = ((Component)Box2D).transform.TransformVector(Vector3.right / 2f * Box2D.size.x);
				up = ((Component)Box2D).transform.TransformVector(Vector3.up / 2f * Box2D.size.y);
				rightN = ((Vector3)(ref right)).normalized;
				upN = ((Vector3)(ref up)).normalized;
				boxCenter = GetBoxCenter(Box2D);
				boxCenter.z = 0f;
				Vector3 lossyScale = base.Transform.lossyScale;
				lossyScale.z = 1f;
				scales = Vector3.Scale(Vector2.op_Implicit(Box2D.size), lossyScale);
				((Vector3)(ref scales)).Normalize();
			}
		}
		base.RefreshColliderData();
		previousPosition = base.Transform.position;
		previousRotation = base.Transform.rotation;
	}

	public override bool PushIfInside(ref Vector3 segmentPosition, float segmentRadius, Vector3 segmentOffset)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0103: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0127: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0142: Unknown result type (might be due to invalid IL or missing references)
		//IL_0148: Unknown result type (might be due to invalid IL or missing references)
		//IL_014d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0153: Unknown result type (might be due to invalid IL or missing references)
		//IL_0158: Unknown result type (might be due to invalid IL or missing references)
		//IL_0183: Unknown result type (might be due to invalid IL or missing references)
		//IL_0189: Unknown result type (might be due to invalid IL or missing references)
		//IL_018e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0194: Unknown result type (might be due to invalid IL or missing references)
		//IL_0199: Unknown result type (might be due to invalid IL or missing references)
		//IL_019e: Unknown result type (might be due to invalid IL or missing references)
		//IL_017c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0181: Unknown result type (might be due to invalid IL or missing references)
		//IL_0222: Unknown result type (might be due to invalid IL or missing references)
		//IL_020e: Unknown result type (might be due to invalid IL or missing references)
		//IL_022e: Unknown result type (might be due to invalid IL or missing references)
		//IL_022f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0234: Unknown result type (might be due to invalid IL or missing references)
		//IL_0235: Unknown result type (might be due to invalid IL or missing references)
		//IL_023a: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c7: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0258: Unknown result type (might be due to invalid IL or missing references)
		//IL_025c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0262: Unknown result type (might be due to invalid IL or missing references)
		//IL_0267: Unknown result type (might be due to invalid IL or missing references)
		//IL_026c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0240: Unknown result type (might be due to invalid IL or missing references)
		//IL_0244: Unknown result type (might be due to invalid IL or missing references)
		//IL_024a: Unknown result type (might be due to invalid IL or missing references)
		//IL_024f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0254: Unknown result type (might be due to invalid IL or missing references)
		//IL_0274: Unknown result type (might be due to invalid IL or missing references)
		//IL_0279: Unknown result type (might be due to invalid IL or missing references)
		//IL_027b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0280: Unknown result type (might be due to invalid IL or missing references)
		//IL_0297: Unknown result type (might be due to invalid IL or missing references)
		//IL_029c: Unknown result type (might be due to invalid IL or missing references)
		//IL_029e: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a3: Unknown result type (might be due to invalid IL or missing references)
		int num = 0;
		Vector3 val = Vector3.zero;
		Vector3 val2 = segmentPosition + segmentOffset;
		float planeDistance = PlaneDistance(boxCenter + up, upN, val2);
		if (SphereInsidePlane(planeDistance, segmentRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentRadius))
		{
			num++;
			val = up;
		}
		planeDistance = PlaneDistance(boxCenter - up, -upN, val2);
		if (SphereInsidePlane(planeDistance, segmentRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentRadius))
		{
			num++;
			val = -up;
		}
		planeDistance = PlaneDistance(boxCenter - right, -rightN, val2);
		if (SphereInsidePlane(planeDistance, segmentRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentRadius))
		{
			num++;
			val = -right;
		}
		planeDistance = PlaneDistance(boxCenter + right, rightN, val2);
		if (SphereInsidePlane(planeDistance, segmentRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentRadius))
		{
			num++;
			val = right;
		}
		bool flag = false;
		if ((Object)(object)base.Collider2D == (Object)null)
		{
			planeDistance = PlaneDistance(boxCenter + forward, forwardN, val2);
			if (SphereInsidePlane(planeDistance, segmentRadius))
			{
				num++;
			}
			else if (SphereIntersectsPlane(planeDistance, segmentRadius))
			{
				num++;
				val = forward;
			}
			planeDistance = PlaneDistance(boxCenter - forward, -forwardN, val2);
			if (SphereInsidePlane(planeDistance, segmentRadius))
			{
				num++;
			}
			else if (SphereIntersectsPlane(planeDistance, segmentRadius))
			{
				num++;
				val = -forward;
			}
			if (num == 6)
			{
				flag = true;
			}
		}
		else if (num == 4)
		{
			flag = true;
		}
		if (flag)
		{
			bool flag2 = false;
			if (((Vector3)(ref val)).sqrMagnitude == 0f)
			{
				flag2 = true;
			}
			else if ((Object)(object)base.Collider2D == (Object)null)
			{
				if (IsInsideBoxCollider(Box, val2))
				{
					flag2 = true;
				}
			}
			else if (IsInsideBoxCollider(Box2D, val2))
			{
				flag2 = true;
			}
			Vector3 val3 = GetNearestPoint(val2) - val2;
			val3 = ((!flag2) ? (val3 - ((Vector3)(ref val3)).normalized * segmentRadius) : (val3 + ((Vector3)(ref val3)).normalized * segmentRadius));
			if (flag2)
			{
				segmentPosition += val3;
			}
			else if (((Vector3)(ref val3)).sqrMagnitude > 0f)
			{
				segmentPosition += val3;
			}
			return true;
		}
		return false;
	}

	public static void PushOutFromBoxCollider(BoxCollider box, Collision collision, float segmentColliderRadius, ref Vector3 segmentPosition, bool is2D = false)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00db: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f4: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ((Component)box).transform.TransformVector(Vector3.right / 2f * box.size.x + box.center.x * Vector3.right);
		Vector3 val2 = ((Component)box).transform.TransformVector(Vector3.up / 2f * box.size.y + box.center.y * Vector3.up);
		Vector3 val3 = ((Component)box).transform.TransformVector(Vector3.forward / 2f * box.size.z + box.center.z * Vector3.forward);
		Vector3 val4 = Vector3.Scale(box.size, ((Component)box).transform.lossyScale);
		((Vector3)(ref val4)).Normalize();
		PushOutFromBoxCollider(box, collision, segmentColliderRadius, ref segmentPosition, val, val2, val3, val4, is2D);
	}

	public static void PushOutFromBoxCollider(BoxCollider box, float segmentColliderRadius, ref Vector3 segmentPosition, bool is2D = false)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00db: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fa: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ff: Unknown result type (might be due to invalid IL or missing references)
		//IL_0103: Unknown result type (might be due to invalid IL or missing references)
		//IL_0108: Unknown result type (might be due to invalid IL or missing references)
		//IL_010c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0111: Unknown result type (might be due to invalid IL or missing references)
		//IL_0116: Unknown result type (might be due to invalid IL or missing references)
		//IL_011b: Unknown result type (might be due to invalid IL or missing references)
		//IL_011d: Unknown result type (might be due to invalid IL or missing references)
		//IL_011f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0120: Unknown result type (might be due to invalid IL or missing references)
		//IL_0125: Unknown result type (might be due to invalid IL or missing references)
		//IL_0128: Unknown result type (might be due to invalid IL or missing references)
		//IL_015b: Unknown result type (might be due to invalid IL or missing references)
		//IL_015d: Unknown result type (might be due to invalid IL or missing references)
		//IL_015e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0163: Unknown result type (might be due to invalid IL or missing references)
		//IL_0165: Unknown result type (might be due to invalid IL or missing references)
		//IL_016b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0158: Unknown result type (might be due to invalid IL or missing references)
		//IL_0159: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_019b: Unknown result type (might be due to invalid IL or missing references)
		//IL_019c: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0229: Unknown result type (might be due to invalid IL or missing references)
		//IL_022b: Unknown result type (might be due to invalid IL or missing references)
		//IL_022c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0231: Unknown result type (might be due to invalid IL or missing references)
		//IL_0234: Unknown result type (might be due to invalid IL or missing references)
		//IL_0226: Unknown result type (might be due to invalid IL or missing references)
		//IL_0227: Unknown result type (might be due to invalid IL or missing references)
		//IL_0267: Unknown result type (might be due to invalid IL or missing references)
		//IL_0269: Unknown result type (might be due to invalid IL or missing references)
		//IL_026a: Unknown result type (might be due to invalid IL or missing references)
		//IL_026f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0271: Unknown result type (might be due to invalid IL or missing references)
		//IL_0277: Unknown result type (might be due to invalid IL or missing references)
		//IL_0264: Unknown result type (might be due to invalid IL or missing references)
		//IL_0265: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_02ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_02cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_02eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_02f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_02f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_02fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0324: Unknown result type (might be due to invalid IL or missing references)
		//IL_0328: Unknown result type (might be due to invalid IL or missing references)
		//IL_032f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0339: Unknown result type (might be due to invalid IL or missing references)
		//IL_033e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0343: Unknown result type (might be due to invalid IL or missing references)
		//IL_0301: Unknown result type (might be due to invalid IL or missing references)
		//IL_0305: Unknown result type (might be due to invalid IL or missing references)
		//IL_030c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0316: Unknown result type (might be due to invalid IL or missing references)
		//IL_031b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0320: Unknown result type (might be due to invalid IL or missing references)
		//IL_034b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0350: Unknown result type (might be due to invalid IL or missing references)
		//IL_0352: Unknown result type (might be due to invalid IL or missing references)
		//IL_0357: Unknown result type (might be due to invalid IL or missing references)
		//IL_036d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0372: Unknown result type (might be due to invalid IL or missing references)
		//IL_0374: Unknown result type (might be due to invalid IL or missing references)
		//IL_0379: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ((Component)box).transform.TransformVector(Vector3.right / 2f * box.size.x + box.center.x * Vector3.right);
		Vector3 val2 = ((Component)box).transform.TransformVector(Vector3.up / 2f * box.size.y + box.center.y * Vector3.up);
		Vector3 val3 = ((Component)box).transform.TransformVector(Vector3.forward / 2f * box.size.z + box.center.z * Vector3.forward);
		Vector3 val4 = Vector3.Scale(box.size, ((Component)box).transform.lossyScale);
		((Vector3)(ref val4)).Normalize();
		Vector3 val5 = GetBoxCenter(box);
		Vector3 normalized = ((Vector3)(ref val2)).normalized;
		Vector3 normalized2 = ((Vector3)(ref val)).normalized;
		Vector3 normalized3 = ((Vector3)(ref val3)).normalized;
		int num = 0;
		Vector3 val6 = Vector3.zero;
		float planeDistance = PlaneDistance(val5 + val2, normalized, segmentPosition);
		if (SphereInsidePlane(planeDistance, segmentColliderRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentColliderRadius))
		{
			num++;
			val6 = val2;
		}
		planeDistance = PlaneDistance(val5 - val2, -normalized, segmentPosition);
		if (SphereInsidePlane(planeDistance, segmentColliderRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentColliderRadius))
		{
			num++;
			val6 = -val2;
		}
		planeDistance = PlaneDistance(val5 - val, -normalized2, segmentPosition);
		if (SphereInsidePlane(planeDistance, segmentColliderRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentColliderRadius))
		{
			num++;
			val6 = -val;
		}
		planeDistance = PlaneDistance(val5 + val, normalized2, segmentPosition);
		if (SphereInsidePlane(planeDistance, segmentColliderRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentColliderRadius))
		{
			num++;
			val6 = val;
		}
		planeDistance = PlaneDistance(val5 + val3, normalized3, segmentPosition);
		if (SphereInsidePlane(planeDistance, segmentColliderRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentColliderRadius))
		{
			num++;
			val6 = val3;
		}
		planeDistance = PlaneDistance(val5 - val3, -normalized3, segmentPosition);
		if (SphereInsidePlane(planeDistance, segmentColliderRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentColliderRadius))
		{
			num++;
			val6 = -val3;
		}
		if (num == 6)
		{
			bool flag = false;
			if (((Vector3)(ref val6)).sqrMagnitude == 0f)
			{
				flag = true;
			}
			else if (IsInsideBoxCollider(box, segmentPosition))
			{
				flag = true;
			}
			Vector3 val7 = GetNearestPoint(segmentPosition, val5, val, val2, val3, is2D) - segmentPosition;
			val7 = ((!flag) ? (val7 - ((Vector3)(ref val7)).normalized * segmentColliderRadius * 1.01f) : (val7 + ((Vector3)(ref val7)).normalized * segmentColliderRadius * 1.01f));
			if (flag)
			{
				segmentPosition += val7;
			}
			else if (((Vector3)(ref val7)).sqrMagnitude > 0f)
			{
				segmentPosition += val7;
			}
		}
	}

	public static void PushOutFromBoxCollider(BoxCollider box, Collision collision, float segmentColliderRadius, ref Vector3 pos, Vector3 right, Vector3 up, Vector3 forward, Vector3 scales, bool is2D = false)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0103: Unknown result type (might be due to invalid IL or missing references)
		//IL_010d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0113: Unknown result type (might be due to invalid IL or missing references)
		//IL_0118: Unknown result type (might be due to invalid IL or missing references)
		//IL_011d: Unknown result type (might be due to invalid IL or missing references)
		//IL_011f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0120: Unknown result type (might be due to invalid IL or missing references)
		//IL_0122: Unknown result type (might be due to invalid IL or missing references)
		//IL_0127: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_0146: Unknown result type (might be due to invalid IL or missing references)
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_014d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0152: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00de: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ((ContactPoint)(ref collision.contacts[0])).point;
		Vector3 val2 = pos - val;
		Vector3 val3 = GetBoxCenter(box);
		if (((Vector3)(ref val2)).sqrMagnitude == 0f)
		{
			val2 = pos - val3;
		}
		float num = 1f;
		if (IsInsideBoxCollider(box, pos))
		{
			float boxAverageScale = GetBoxAverageScale(box);
			Vector3 targetPlaneNormal = GetTargetPlaneNormal(box, pos, right, up, forward, scales);
			Vector3 normalized = ((Vector3)(ref targetPlaneNormal)).normalized;
			RaycastHit val4 = default(RaycastHit);
			val = ((!((Collider)box).Raycast(new Ray(pos - normalized * boxAverageScale * 3f, normalized), ref val4, boxAverageScale * 4f)) ? GetIntersectOnBoxFromInside(box, val3, pos, targetPlaneNormal) : ((RaycastHit)(ref val4)).point);
			val2 = val - pos;
			num = 100f;
		}
		Vector3 val5 = pos - (val2 / num + ((Vector3)(ref val2)).normalized * 1.15f) / 2f * segmentColliderRadius;
		val5 = val - val5;
		float sqrMagnitude = ((Vector3)(ref val5)).sqrMagnitude;
		if (sqrMagnitude > 0f && sqrMagnitude < segmentColliderRadius * segmentColliderRadius * num)
		{
			pos += val5;
		}
	}

	public static void PushOutFromBoxCollider(BoxCollider2D box2D, float segmentColliderRadius, ref Vector3 segmentPosition)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0093: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ef: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0103: Unknown result type (might be due to invalid IL or missing references)
		//IL_0105: Unknown result type (might be due to invalid IL or missing references)
		//IL_010b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0143: Unknown result type (might be due to invalid IL or missing references)
		//IL_0145: Unknown result type (might be due to invalid IL or missing references)
		//IL_0146: Unknown result type (might be due to invalid IL or missing references)
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0150: Unknown result type (might be due to invalid IL or missing references)
		//IL_0152: Unknown result type (might be due to invalid IL or missing references)
		//IL_0157: Unknown result type (might be due to invalid IL or missing references)
		//IL_015d: Unknown result type (might be due to invalid IL or missing references)
		//IL_013b: Unknown result type (might be due to invalid IL or missing references)
		//IL_013c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0141: Unknown result type (might be due to invalid IL or missing references)
		//IL_019a: Unknown result type (might be due to invalid IL or missing references)
		//IL_019c: Unknown result type (might be due to invalid IL or missing references)
		//IL_019d: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_018d: Unknown result type (might be due to invalid IL or missing references)
		//IL_018e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0193: Unknown result type (might be due to invalid IL or missing references)
		//IL_0198: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f9: Unknown result type (might be due to invalid IL or missing references)
		//IL_01fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0200: Unknown result type (might be due to invalid IL or missing references)
		//IL_0206: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ef: Unknown result type (might be due to invalid IL or missing references)
		//IL_0236: Unknown result type (might be due to invalid IL or missing references)
		//IL_0237: Unknown result type (might be due to invalid IL or missing references)
		//IL_023c: Unknown result type (might be due to invalid IL or missing references)
		//IL_025e: Unknown result type (might be due to invalid IL or missing references)
		//IL_026e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0273: Unknown result type (might be due to invalid IL or missing references)
		//IL_0278: Unknown result type (might be due to invalid IL or missing references)
		//IL_027a: Unknown result type (might be due to invalid IL or missing references)
		//IL_027b: Unknown result type (might be due to invalid IL or missing references)
		//IL_027c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0282: Unknown result type (might be due to invalid IL or missing references)
		//IL_0287: Unknown result type (might be due to invalid IL or missing references)
		//IL_028c: Unknown result type (might be due to invalid IL or missing references)
		//IL_02b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_02b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_02c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_02ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_02cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_02d4: Unknown result type (might be due to invalid IL or missing references)
		//IL_0292: Unknown result type (might be due to invalid IL or missing references)
		//IL_0296: Unknown result type (might be due to invalid IL or missing references)
		//IL_029d: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_02ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_02b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_02dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_02fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0303: Unknown result type (might be due to invalid IL or missing references)
		//IL_0305: Unknown result type (might be due to invalid IL or missing references)
		//IL_030a: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = Vector2.op_Implicit(((Component)box2D).transform.TransformVector(Vector3.right / 2f * box2D.size.x + ((Collider2D)box2D).offset.x * Vector3.right));
		Vector2 val2 = Vector2.op_Implicit(((Component)box2D).transform.TransformVector(Vector3.up / 2f * box2D.size.y + ((Collider2D)box2D).offset.y * Vector3.up));
		Vector3 lossyScale = ((Component)box2D).transform.lossyScale;
		lossyScale.z = 1f;
		Vector2 val3 = Vector2.op_Implicit(Vector3.Scale(Vector2.op_Implicit(box2D.size), lossyScale));
		((Vector2)(ref val3)).Normalize();
		Vector2 val4 = Vector2.op_Implicit(GetBoxCenter(box2D));
		Vector2 normalized = ((Vector2)(ref val2)).normalized;
		Vector2 normalized2 = ((Vector2)(ref val)).normalized;
		int num = 0;
		Vector3 val5 = Vector3.zero;
		float planeDistance = PlaneDistance(Vector2.op_Implicit(val4 + val2), Vector2.op_Implicit(normalized), segmentPosition);
		if (SphereInsidePlane(planeDistance, segmentColliderRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentColliderRadius))
		{
			num++;
			val5 = Vector2.op_Implicit(val2);
		}
		planeDistance = PlaneDistance(Vector2.op_Implicit(val4 - val2), Vector2.op_Implicit(-normalized), segmentPosition);
		if (SphereInsidePlane(planeDistance, segmentColliderRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentColliderRadius))
		{
			num++;
			val5 = Vector2.op_Implicit(-val2);
		}
		planeDistance = PlaneDistance(Vector2.op_Implicit(val4 - val), Vector2.op_Implicit(-normalized2), segmentPosition);
		if (SphereInsidePlane(planeDistance, segmentColliderRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentColliderRadius))
		{
			num++;
			val5 = Vector2.op_Implicit(-val);
		}
		planeDistance = PlaneDistance(Vector2.op_Implicit(val4 + val), Vector2.op_Implicit(normalized2), segmentPosition);
		if (SphereInsidePlane(planeDistance, segmentColliderRadius))
		{
			num++;
		}
		else if (SphereIntersectsPlane(planeDistance, segmentColliderRadius))
		{
			num++;
			val5 = Vector2.op_Implicit(val);
		}
		if (num == 4)
		{
			bool flag = false;
			if (((Vector3)(ref val5)).sqrMagnitude == 0f)
			{
				flag = true;
			}
			else if (IsInsideBoxCollider(box2D, segmentPosition))
			{
				flag = true;
			}
			Vector3 val6 = GetNearestPoint2D(Vector2.op_Implicit(segmentPosition), val4, val, val2) - segmentPosition;
			val6 = ((!flag) ? (val6 - ((Vector3)(ref val6)).normalized * segmentColliderRadius * 1.01f) : (val6 + ((Vector3)(ref val6)).normalized * segmentColliderRadius * 1.01f));
			if (flag)
			{
				segmentPosition += val6;
			}
			else if (((Vector3)(ref val6)).sqrMagnitude > 0f)
			{
				segmentPosition += val6;
			}
		}
	}

	private Vector3 GetNearestPoint(Vector3 point)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_0126: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0101: Unknown result type (might be due to invalid IL or missing references)
		//IL_0106: Unknown result type (might be due to invalid IL or missing references)
		//IL_0144: Unknown result type (might be due to invalid IL or missing references)
		//IL_0134: Unknown result type (might be due to invalid IL or missing references)
		//IL_0152: Unknown result type (might be due to invalid IL or missing references)
		//IL_0158: Unknown result type (might be due to invalid IL or missing references)
		//IL_0171: Unknown result type (might be due to invalid IL or missing references)
		//IL_0160: Unknown result type (might be due to invalid IL or missing references)
		//IL_0191: Unknown result type (might be due to invalid IL or missing references)
		//IL_0197: Unknown result type (might be due to invalid IL or missing references)
		//IL_024e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0255: Unknown result type (might be due to invalid IL or missing references)
		//IL_025a: Unknown result type (might be due to invalid IL or missing references)
		//IL_025d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0262: Unknown result type (might be due to invalid IL or missing references)
		//IL_0237: Unknown result type (might be due to invalid IL or missing references)
		//IL_023e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0243: Unknown result type (might be due to invalid IL or missing references)
		//IL_0245: Unknown result type (might be due to invalid IL or missing references)
		//IL_024a: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_019f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0263: Unknown result type (might be due to invalid IL or missing references)
		//IL_021a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0221: Unknown result type (might be due to invalid IL or missing references)
		//IL_0226: Unknown result type (might be due to invalid IL or missing references)
		//IL_0229: Unknown result type (might be due to invalid IL or missing references)
		//IL_022e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0202: Unknown result type (might be due to invalid IL or missing references)
		//IL_0209: Unknown result type (might be due to invalid IL or missing references)
		//IL_020e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0211: Unknown result type (might be due to invalid IL or missing references)
		//IL_0216: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f0: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01dd: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = point;
		Vector3 one = Vector3.one;
		one.x = PlaneDistance(boxCenter + right, rightN, point);
		one.y = PlaneDistance(boxCenter + up, upN, point);
		if ((Object)(object)base.Collider2D == (Object)null)
		{
			one.z = PlaneDistance(boxCenter + forward, forwardN, point);
		}
		Vector3 one2 = Vector3.one;
		one2.x = PlaneDistance(boxCenter - right, -rightN, point);
		one2.y = PlaneDistance(boxCenter - up, -upN, point);
		if ((Object)(object)base.Collider2D == (Object)null)
		{
			one2.z = PlaneDistance(boxCenter - forward, -forwardN, point);
		}
		float num = 1f;
		float num2 = 1f;
		float num3 = 1f;
		float x;
		if (one.x > one2.x)
		{
			x = one.x;
			num = -1f;
		}
		else
		{
			x = one2.x;
			num = 1f;
		}
		float y;
		if (one.y > one2.y)
		{
			y = one.y;
			num2 = -1f;
		}
		else
		{
			y = one2.y;
			num2 = 1f;
		}
		if ((Object)(object)base.Collider2D == (Object)null)
		{
			float z;
			if (one.z > one2.z)
			{
				z = one.z;
				num3 = -1f;
			}
			else
			{
				z = one2.z;
				num3 = 1f;
			}
			if (x > z)
			{
				if (x > y)
				{
					return ProjectPointOnPlane(right * num, point, x);
				}
				return ProjectPointOnPlane(up * num2, point, y);
			}
			if (z > y)
			{
				return ProjectPointOnPlane(forward * num3, point, z);
			}
			return ProjectPointOnPlane(up * num2, point, y);
		}
		if (x > y)
		{
			return ProjectPointOnPlane(right * num, point, x);
		}
		return ProjectPointOnPlane(up * num2, point, y);
	}

	private static Vector3 GetNearestPoint(Vector3 point, Vector3 boxCenter, Vector3 right, Vector3 up, Vector3 forward, bool is2D = false)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_0099: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_00de: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ec: Unknown result type (might be due to invalid IL or missing references)
		//IL_010a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0110: Unknown result type (might be due to invalid IL or missing references)
		//IL_0129: Unknown result type (might be due to invalid IL or missing references)
		//IL_0118: Unknown result type (might be due to invalid IL or missing references)
		//IL_013f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0145: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f0: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01dd: Unknown result type (might be due to invalid IL or missing references)
		//IL_015e: Unknown result type (might be due to invalid IL or missing references)
		//IL_014d: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_01be: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0189: Unknown result type (might be due to invalid IL or missing references)
		//IL_018c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0191: Unknown result type (might be due to invalid IL or missing references)
		//IL_0194: Unknown result type (might be due to invalid IL or missing references)
		//IL_0199: Unknown result type (might be due to invalid IL or missing references)
		//IL_0177: Unknown result type (might be due to invalid IL or missing references)
		//IL_017a: Unknown result type (might be due to invalid IL or missing references)
		//IL_017f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0181: Unknown result type (might be due to invalid IL or missing references)
		//IL_0186: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = point;
		Vector3 one = Vector3.one;
		one.x = PlaneDistance(boxCenter + right, ((Vector3)(ref right)).normalized, point);
		one.y = PlaneDistance(boxCenter + up, ((Vector3)(ref up)).normalized, point);
		if (!is2D)
		{
			one.z = PlaneDistance(boxCenter + forward, ((Vector3)(ref forward)).normalized, point);
		}
		Vector3 one2 = Vector3.one;
		one2.x = PlaneDistance(boxCenter - right, -((Vector3)(ref right)).normalized, point);
		one2.y = PlaneDistance(boxCenter - up, -((Vector3)(ref up)).normalized, point);
		if (!is2D)
		{
			one2.z = PlaneDistance(boxCenter - forward, -((Vector3)(ref forward)).normalized, point);
		}
		float num = 1f;
		float num2 = 1f;
		float num3 = 1f;
		float x;
		if (one.x > one2.x)
		{
			x = one.x;
			num = -1f;
		}
		else
		{
			x = one2.x;
			num = 1f;
		}
		float y;
		if (one.y > one2.y)
		{
			y = one.y;
			num2 = -1f;
		}
		else
		{
			y = one2.y;
			num2 = 1f;
		}
		if (!is2D)
		{
			float z;
			if (one.z > one2.z)
			{
				z = one.z;
				num3 = -1f;
			}
			else
			{
				z = one2.z;
				num3 = 1f;
			}
			if (x > z)
			{
				if (x > y)
				{
					return ProjectPointOnPlane(right * num, point, x);
				}
				return ProjectPointOnPlane(up * num2, point, y);
			}
			if (z > y)
			{
				return ProjectPointOnPlane(forward * num3, point, z);
			}
			return ProjectPointOnPlane(up * num2, point, y);
		}
		if (x > y)
		{
			return ProjectPointOnPlane(right * num, point, x);
		}
		return ProjectPointOnPlane(up * num2, point, y);
	}

	private static Vector3 GetNearestPoint2D(Vector2 point, Vector2 boxCenter, Vector2 right, Vector2 up)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_0098: Unknown result type (might be due to invalid IL or missing references)
		//IL_0099: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ff: Unknown result type (might be due to invalid IL or missing references)
		//IL_0105: Unknown result type (might be due to invalid IL or missing references)
		//IL_011e: Unknown result type (might be due to invalid IL or missing references)
		//IL_010d: Unknown result type (might be due to invalid IL or missing references)
		//IL_014e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0151: Unknown result type (might be due to invalid IL or missing references)
		//IL_0156: Unknown result type (might be due to invalid IL or missing references)
		//IL_015b: Unknown result type (might be due to invalid IL or missing references)
		//IL_015c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0163: Unknown result type (might be due to invalid IL or missing references)
		//IL_0168: Unknown result type (might be due to invalid IL or missing references)
		//IL_0132: Unknown result type (might be due to invalid IL or missing references)
		//IL_0135: Unknown result type (might be due to invalid IL or missing references)
		//IL_013a: Unknown result type (might be due to invalid IL or missing references)
		//IL_013f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0140: Unknown result type (might be due to invalid IL or missing references)
		//IL_0146: Unknown result type (might be due to invalid IL or missing references)
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0169: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = Vector2.op_Implicit(point);
		Vector3 one = Vector3.one;
		one.x = PlaneDistance(Vector2.op_Implicit(boxCenter + right), Vector2.op_Implicit(((Vector2)(ref right)).normalized), Vector2.op_Implicit(point));
		one.y = PlaneDistance(Vector2.op_Implicit(boxCenter + up), Vector2.op_Implicit(((Vector2)(ref up)).normalized), Vector2.op_Implicit(point));
		Vector3 one2 = Vector3.one;
		one2.x = PlaneDistance(Vector2.op_Implicit(boxCenter - right), Vector2.op_Implicit(-((Vector2)(ref right)).normalized), Vector2.op_Implicit(point));
		one2.y = PlaneDistance(Vector2.op_Implicit(boxCenter - up), Vector2.op_Implicit(-((Vector2)(ref up)).normalized), Vector2.op_Implicit(point));
		float num = 1f;
		float num2 = 1f;
		float x;
		if (one.x > one2.x)
		{
			x = one.x;
			num = -1f;
		}
		else
		{
			x = one2.x;
			num = 1f;
		}
		float y;
		if (one.y > one2.y)
		{
			y = one.y;
			num2 = -1f;
		}
		else
		{
			y = one2.y;
			num2 = 1f;
		}
		if (x > y)
		{
			return ProjectPointOnPlane(Vector2.op_Implicit(right * num), Vector2.op_Implicit(point), x);
		}
		return ProjectPointOnPlane(Vector2.op_Implicit(up * num2), Vector2.op_Implicit(point), y);
	}

	public static Vector3 GetNearestPointOnBox(BoxCollider boxCollider, Vector3 point, bool is2D = false)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00da: Unknown result type (might be due to invalid IL or missing references)
		//IL_00df: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fd: Unknown result type (might be due to invalid IL or missing references)
		//IL_0102: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0141: Unknown result type (might be due to invalid IL or missing references)
		//IL_0148: Unknown result type (might be due to invalid IL or missing references)
		//IL_0112: Unknown result type (might be due to invalid IL or missing references)
		//IL_0114: Unknown result type (might be due to invalid IL or missing references)
		//IL_0115: Unknown result type (might be due to invalid IL or missing references)
		//IL_011a: Unknown result type (might be due to invalid IL or missing references)
		//IL_011c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0121: Unknown result type (might be due to invalid IL or missing references)
		//IL_0163: Unknown result type (might be due to invalid IL or missing references)
		//IL_0151: Unknown result type (might be due to invalid IL or missing references)
		//IL_0173: Unknown result type (might be due to invalid IL or missing references)
		//IL_017a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0195: Unknown result type (might be due to invalid IL or missing references)
		//IL_0183: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_0254: Unknown result type (might be due to invalid IL or missing references)
		//IL_0257: Unknown result type (might be due to invalid IL or missing references)
		//IL_025c: Unknown result type (might be due to invalid IL or missing references)
		//IL_025f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0264: Unknown result type (might be due to invalid IL or missing references)
		//IL_0241: Unknown result type (might be due to invalid IL or missing references)
		//IL_0244: Unknown result type (might be due to invalid IL or missing references)
		//IL_0249: Unknown result type (might be due to invalid IL or missing references)
		//IL_024c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0251: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_01bb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0265: Unknown result type (might be due to invalid IL or missing references)
		//IL_0228: Unknown result type (might be due to invalid IL or missing references)
		//IL_022b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0230: Unknown result type (might be due to invalid IL or missing references)
		//IL_0233: Unknown result type (might be due to invalid IL or missing references)
		//IL_0238: Unknown result type (might be due to invalid IL or missing references)
		//IL_0215: Unknown result type (might be due to invalid IL or missing references)
		//IL_0218: Unknown result type (might be due to invalid IL or missing references)
		//IL_021d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0220: Unknown result type (might be due to invalid IL or missing references)
		//IL_0225: Unknown result type (might be due to invalid IL or missing references)
		//IL_01fc: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ff: Unknown result type (might be due to invalid IL or missing references)
		//IL_0204: Unknown result type (might be due to invalid IL or missing references)
		//IL_0207: Unknown result type (might be due to invalid IL or missing references)
		//IL_020c: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ec: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f9: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ((Component)boxCollider).transform.TransformVector(Vector3.right / 2f);
		Vector3 val2 = ((Component)boxCollider).transform.TransformVector(Vector3.up / 2f);
		Vector3 val3 = Vector3.forward;
		if (!is2D)
		{
			val3 = ((Component)boxCollider).transform.TransformVector(Vector3.forward / 2f);
		}
		Vector3 val4 = point;
		Vector3 val5 = GetBoxCenter(boxCollider);
		Vector3 normalized = ((Vector3)(ref val)).normalized;
		Vector3 normalized2 = ((Vector3)(ref val2)).normalized;
		Vector3 normalized3 = ((Vector3)(ref val3)).normalized;
		Vector3 one = Vector3.one;
		one.x = PlaneDistance(val5 + val, normalized, point);
		one.y = PlaneDistance(val5 + val2, normalized2, point);
		if (!is2D)
		{
			one.z = PlaneDistance(val5 + val3, normalized3, point);
		}
		Vector3 one2 = Vector3.one;
		one2.x = PlaneDistance(val5 - val, -normalized, point);
		one2.y = PlaneDistance(val5 - val2, -normalized2, point);
		if (!is2D)
		{
			one2.z = PlaneDistance(val5 - val3, -normalized3, point);
		}
		float num = 1f;
		float num2 = 1f;
		float num3 = 1f;
		float x;
		if (one.x > one2.x)
		{
			x = one.x;
			num = -1f;
		}
		else
		{
			x = one2.x;
			num = 1f;
		}
		float y;
		if (one.y > one2.y)
		{
			y = one.y;
			num2 = -1f;
		}
		else
		{
			y = one2.y;
			num2 = 1f;
		}
		if (!is2D)
		{
			float z;
			if (one.z > one2.z)
			{
				z = one.z;
				num3 = -1f;
			}
			else
			{
				z = one2.z;
				num3 = 1f;
			}
			if (x > z)
			{
				if (x > y)
				{
					return ProjectPointOnPlane(val * num, point, x);
				}
				return ProjectPointOnPlane(val2 * num2, point, y);
			}
			if (z > y)
			{
				return ProjectPointOnPlane(val3 * num3, point, z);
			}
			return ProjectPointOnPlane(val2 * num2, point, y);
		}
		if (x > y)
		{
			return ProjectPointOnPlane(val * num, point, x);
		}
		return ProjectPointOnPlane(val2 * num2, point, y);
	}

	private static float PlaneDistance(Vector3 planeCenter, Vector3 planeNormal, Vector3 point)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		return Vector3.Dot(point - planeCenter, planeNormal);
	}

	private static Vector3 ProjectPointOnPlane(Vector3 planeNormal, Vector3 point, float distance)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ((Vector3)(ref planeNormal)).normalized * distance;
		return point + val;
	}

	private static bool SphereInsidePlane(float planeDistance, float pointRadius)
	{
		return 0f - planeDistance > pointRadius;
	}

	private static bool SphereOutsidePlane(float planeDistance, float pointRadius)
	{
		return planeDistance > pointRadius;
	}

	private static bool SphereIntersectsPlane(float planeDistance, float pointRadius)
	{
		return Mathf.Abs(planeDistance) <= pointRadius;
	}

	public static bool IsInsideBoxCollider(BoxCollider collider, Vector3 point, bool is2D = false)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		point = ((Component)collider).transform.InverseTransformPoint(point) - collider.center;
		float num = collider.size.x * 0.5f;
		float num2 = collider.size.y * 0.5f;
		float num3 = collider.size.z * 0.5f;
		if (point.x < num && point.x > 0f - num && point.y < num2 && point.y > 0f - num2 && point.z < num3)
		{
			return point.z > 0f - num3;
		}
		return false;
	}

	public static bool IsInsideBoxCollider(BoxCollider2D collider, Vector3 point)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		point = Vector2.op_Implicit(Vector2.op_Implicit(((Component)collider).transform.InverseTransformPoint(point)) - ((Collider2D)collider).offset);
		float num = collider.size.x * 0.5f;
		float num2 = collider.size.y * 0.5f;
		if (point.x < num && point.x > 0f - num && point.y < num2)
		{
			return point.y > 0f - num2;
		}
		return false;
	}

	protected static float GetBoxAverageScale(BoxCollider box)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		Vector3 lossyScale = ((Component)box).transform.lossyScale;
		lossyScale = Vector3.Scale(lossyScale, box.size);
		return (lossyScale.x + lossyScale.y + lossyScale.z) / 3f;
	}

	protected static Vector3 GetBoxCenter(BoxCollider box)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		return ((Component)box).transform.position + ((Component)box).transform.TransformVector(box.center);
	}

	protected static Vector3 GetBoxCenter(BoxCollider2D box)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		return ((Component)box).transform.position + ((Component)box).transform.TransformVector(Vector2.op_Implicit(((Collider2D)box).offset));
	}

	protected static Vector3 GetTargetPlaneNormal(BoxCollider boxCollider, Vector3 point, bool is2D = false)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_00af: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ((Component)boxCollider).transform.TransformVector(Vector3.right / 2f * boxCollider.size.x);
		Vector3 val2 = ((Component)boxCollider).transform.TransformVector(Vector3.up / 2f * boxCollider.size.y);
		Vector3 val3 = Vector3.forward;
		if (!is2D)
		{
			val3 = ((Component)boxCollider).transform.TransformVector(Vector3.forward / 2f * boxCollider.size.z);
		}
		Vector3 val4 = Vector3.Scale(boxCollider.size, ((Component)boxCollider).transform.lossyScale);
		((Vector3)(ref val4)).Normalize();
		return GetTargetPlaneNormal(boxCollider, point, val, val2, val3, val4, is2D);
	}

	protected static Vector3 GetTargetPlaneNormal(BoxCollider boxCollider, Vector3 point, Vector3 right, Vector3 up, Vector3 forward, Vector3 scales, bool is2D = false)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		//IL_0098: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00df: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fa: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_0115: Unknown result type (might be due to invalid IL or missing references)
		//IL_011b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0109: Unknown result type (might be due to invalid IL or missing references)
		//IL_015f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0165: Unknown result type (might be due to invalid IL or missing references)
		//IL_0123: Unknown result type (might be due to invalid IL or missing references)
		//IL_0129: Unknown result type (might be due to invalid IL or missing references)
		//IL_0186: Unknown result type (might be due to invalid IL or missing references)
		//IL_0188: Unknown result type (might be due to invalid IL or missing references)
		//IL_0193: Unknown result type (might be due to invalid IL or missing references)
		//IL_0198: Unknown result type (might be due to invalid IL or missing references)
		//IL_0172: Unknown result type (might be due to invalid IL or missing references)
		//IL_0173: Unknown result type (might be due to invalid IL or missing references)
		//IL_017e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0183: Unknown result type (might be due to invalid IL or missing references)
		//IL_014a: Unknown result type (might be due to invalid IL or missing references)
		//IL_014c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0157: Unknown result type (might be due to invalid IL or missing references)
		//IL_015c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0136: Unknown result type (might be due to invalid IL or missing references)
		//IL_0137: Unknown result type (might be due to invalid IL or missing references)
		//IL_0142: Unknown result type (might be due to invalid IL or missing references)
		//IL_0147: Unknown result type (might be due to invalid IL or missing references)
		//IL_0199: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = GetBoxCenter(boxCollider) - point;
		Vector3 normalized = ((Vector3)(ref val)).normalized;
		Vector3 val2 = default(Vector3);
		val2.x = Vector3.Dot(normalized, ((Vector3)(ref right)).normalized);
		val2.y = Vector3.Dot(normalized, ((Vector3)(ref up)).normalized);
		val2.x = val2.x * scales.y * scales.z;
		val2.y = val2.y * scales.x * scales.z;
		if (!is2D)
		{
			val2.z = Vector3.Dot(normalized, ((Vector3)(ref forward)).normalized);
			val2.z = val2.z * scales.y * scales.x;
		}
		else
		{
			val2.z = 0f;
		}
		((Vector3)(ref val2)).Normalize();
		Vector3 val3 = val2;
		if (val2.x < 0f)
		{
			val3.x = 0f - val2.x;
		}
		if (val2.y < 0f)
		{
			val3.y = 0f - val2.y;
		}
		if (val2.z < 0f)
		{
			val3.z = 0f - val2.z;
		}
		if (val3.x > val3.y)
		{
			if (val3.x > val3.z || is2D)
			{
				return right * Mathf.Sign(val2.x);
			}
			return forward * Mathf.Sign(val2.z);
		}
		if (val3.y > val3.z || is2D)
		{
			return up * Mathf.Sign(val2.y);
		}
		return forward * Mathf.Sign(val2.z);
	}

	protected static Vector3 GetTargetPlaneNormal(BoxCollider2D boxCollider, Vector2 point, Vector2 right, Vector2 up, Vector2 scales)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_0099: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00da: Unknown result type (might be due to invalid IL or missing references)
		//IL_00df: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fe: Unknown result type (might be due to invalid IL or missing references)
		Vector2 val = Vector2.op_Implicit(GetBoxCenter(boxCollider)) - point;
		Vector2 normalized = ((Vector2)(ref val)).normalized;
		Vector2 val2 = default(Vector2);
		val2.x = Vector3.Dot(Vector2.op_Implicit(normalized), Vector2.op_Implicit(((Vector2)(ref right)).normalized));
		val2.y = Vector3.Dot(Vector2.op_Implicit(normalized), Vector2.op_Implicit(((Vector2)(ref up)).normalized));
		val2.x *= scales.y;
		val2.y *= scales.x;
		((Vector2)(ref val2)).Normalize();
		Vector2 val3 = val2;
		if (val2.x < 0f)
		{
			val3.x = 0f - val2.x;
		}
		if (val2.y < 0f)
		{
			val3.y = 0f - val2.y;
		}
		if (val3.x > val3.y)
		{
			return Vector2.op_Implicit(right * Mathf.Sign(val2.x));
		}
		return Vector2.op_Implicit(up * Mathf.Sign(val2.y));
	}

	protected static Vector3 GetIntersectOnBoxFromInside(BoxCollider boxCollider, Vector3 from, Vector3 to, Vector3 planeNormal)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = to - from;
		Plane val2 = default(Plane);
		((Plane)(ref val2))..ctor(-planeNormal, GetBoxCenter(boxCollider) + planeNormal);
		Vector3 result = to;
		float num = 0f;
		Ray val3 = default(Ray);
		((Ray)(ref val3))..ctor(from, val);
		if (((Plane)(ref val2)).Raycast(val3, ref num))
		{
			result = ((Ray)(ref val3)).GetPoint(num);
		}
		return result;
	}
}


using FIMSpace;
using UnityEngine;

public class FImp_ColliderData_Capsule : FImp_ColliderData_Base
{
	private Vector3 Top;

	private Vector3 Bottom;

	private Vector3 Direction;

	private float radius;

	private float scaleFactor;

	private float preRadius;

	public CapsuleCollider Capsule { get; private set; }

	public CapsuleCollider2D Capsule2D { get; private set; }

	public FImp_ColliderData_Capsule(CapsuleCollider collider)
	{
		Is2D = false;
		base.Transform = ((Component)collider).transform;
		base.Collider = (Collider)(object)collider;
		base.Transform = ((Component)collider).transform;
		Capsule = collider;
		base.ColliderType = EFColliderType.Capsule;
		CalculateCapsuleParameters(Capsule, ref Direction, ref radius, ref scaleFactor);
		RefreshColliderData();
	}

	public FImp_ColliderData_Capsule(CapsuleCollider2D collider)
	{
		Is2D = true;
		base.Transform = ((Component)collider).transform;
		base.Collider2D = (Collider2D)(object)collider;
		base.Transform = ((Component)collider).transform;
		Capsule2D = collider;
		base.ColliderType = EFColliderType.Capsule;
		CalculateCapsuleParameters(Capsule2D, ref Direction, ref radius, ref scaleFactor);
		RefreshColliderData();
	}

	public override void RefreshColliderData()
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_014f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0154: Unknown result type (might be due to invalid IL or missing references)
		//IL_0160: Unknown result type (might be due to invalid IL or missing references)
		//IL_0165: Unknown result type (might be due to invalid IL or missing references)
		//IL_0171: Unknown result type (might be due to invalid IL or missing references)
		//IL_0176: Unknown result type (might be due to invalid IL or missing references)
		//IL_00af: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0101: Unknown result type (might be due to invalid IL or missing references)
		if (base.IsStatic)
		{
			return;
		}
		bool flag = false;
		if (!previousPosition.VIsSame(base.Transform.position))
		{
			flag = true;
		}
		else if (!base.Transform.rotation.QIsSame(previousRotation))
		{
			flag = true;
		}
		else if (!Is2D)
		{
			if (preRadius != Capsule.radius || !previousScale.VIsSame(base.Transform.lossyScale))
			{
				CalculateCapsuleParameters(Capsule, ref Direction, ref radius, ref scaleFactor);
			}
		}
		else if (preRadius != GetCapsule2DRadius(Capsule2D) || !previousScale.VIsSame(base.Transform.lossyScale))
		{
			CalculateCapsuleParameters(Capsule2D, ref Direction, ref radius, ref scaleFactor);
		}
		if (flag)
		{
			if (!Is2D)
			{
				GetCapsuleHeadsPositions(Capsule, ref Top, ref Bottom, Direction, radius, scaleFactor);
			}
			else
			{
				GetCapsuleHeadsPositions(Capsule2D, ref Top, ref Bottom, Direction, radius, scaleFactor);
			}
		}
		base.RefreshColliderData();
		previousPosition = base.Transform.position;
		previousRotation = base.Transform.rotation;
		previousScale = base.Transform.lossyScale;
		if (!Is2D)
		{
			preRadius = Capsule.radius;
		}
		else
		{
			preRadius = GetCapsule2DRadius(Capsule2D);
		}
	}

	public override bool PushIfInside(ref Vector3 point, float pointRadius, Vector3 pointOffset)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		return PushOutFromCapsuleCollider(pointRadius, ref point, Top, Bottom, radius, pointOffset, Is2D);
	}

	public static bool PushOutFromCapsuleCollider(CapsuleCollider capsule, float segmentColliderRadius, ref Vector3 pos, Vector3 segmentOffset)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		Vector3 direction = Vector3.zero;
		float trueRadius = capsule.radius;
		float scalerFactor = 1f;
		CalculateCapsuleParameters(capsule, ref direction, ref trueRadius, ref scalerFactor);
		Vector3 upper = Vector3.zero;
		Vector3 bottom = Vector3.zero;
		GetCapsuleHeadsPositions(capsule, ref upper, ref bottom, direction, trueRadius, scalerFactor);
		return PushOutFromCapsuleCollider(segmentColliderRadius, ref pos, upper, bottom, trueRadius, segmentOffset);
	}

	public static bool PushOutFromCapsuleCollider(float segmentColliderRadius, ref Vector3 segmentPos, Vector3 capSphereCenter1, Vector3 capSphereCenter2, float capsuleRadius, Vector3 segmentOffset, bool is2D = false)
	{
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ff: Unknown result type (might be due to invalid IL or missing references)
		//IL_0104: Unknown result type (might be due to invalid IL or missing references)
		//IL_0109: Unknown result type (might be due to invalid IL or missing references)
		//IL_010e: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00da: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_0133: Unknown result type (might be due to invalid IL or missing references)
		//IL_0138: Unknown result type (might be due to invalid IL or missing references)
		//IL_0140: Unknown result type (might be due to invalid IL or missing references)
		//IL_0145: Unknown result type (might be due to invalid IL or missing references)
		//IL_014a: Unknown result type (might be due to invalid IL or missing references)
		float num = capsuleRadius + segmentColliderRadius;
		Vector3 val = capSphereCenter2 - capSphereCenter1;
		Vector3 val2 = segmentPos + segmentOffset - capSphereCenter1;
		if (is2D)
		{
			val.z = 0f;
			val2.z = 0f;
		}
		float num2 = Vector3.Dot(val2, val);
		if (num2 <= 0f)
		{
			float sqrMagnitude = ((Vector3)(ref val2)).sqrMagnitude;
			if (sqrMagnitude > 0f && sqrMagnitude < num * num)
			{
				segmentPos = capSphereCenter1 - segmentOffset + val2 * (num / Mathf.Sqrt(sqrMagnitude));
				return true;
			}
		}
		else
		{
			float sqrMagnitude2 = ((Vector3)(ref val)).sqrMagnitude;
			if (num2 >= sqrMagnitude2)
			{
				val2 = segmentPos + segmentOffset - capSphereCenter2;
				float sqrMagnitude3 = ((Vector3)(ref val2)).sqrMagnitude;
				if (sqrMagnitude3 > 0f && sqrMagnitude3 < num * num)
				{
					segmentPos = capSphereCenter2 - segmentOffset + val2 * (num / Mathf.Sqrt(sqrMagnitude3));
					return true;
				}
			}
			else if (sqrMagnitude2 > 0f)
			{
				val2 -= val * (num2 / sqrMagnitude2);
				float sqrMagnitude4 = ((Vector3)(ref val2)).sqrMagnitude;
				if (sqrMagnitude4 > 0f && sqrMagnitude4 < num * num)
				{
					float num3 = Mathf.Sqrt(sqrMagnitude4);
					segmentPos += val2 * ((num - num3) / num3);
					return true;
				}
			}
		}
		return false;
	}

	protected static void CalculateCapsuleParameters(CapsuleCollider capsule, ref Vector3 direction, ref float trueRadius, ref float scalerFactor)
	{
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ef: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		Transform transform = ((Component)capsule).transform;
		float num;
		if (capsule.direction == 1)
		{
			direction = Vector3.up;
			scalerFactor = transform.lossyScale.y;
			num = ((transform.lossyScale.x > transform.lossyScale.z) ? transform.lossyScale.x : transform.lossyScale.z);
		}
		else if (capsule.direction == 0)
		{
			direction = Vector3.right;
			scalerFactor = transform.lossyScale.x;
			num = ((transform.lossyScale.y > transform.lossyScale.z) ? transform.lossyScale.y : transform.lossyScale.z);
		}
		else
		{
			direction = Vector3.forward;
			scalerFactor = transform.lossyScale.z;
			num = ((transform.lossyScale.y > transform.lossyScale.x) ? transform.lossyScale.y : transform.lossyScale.x);
		}
		trueRadius = capsule.radius * num;
	}

	private static float GetCapsule2DRadius(CapsuleCollider2D capsule)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		if ((int)capsule.direction == 0)
		{
			return capsule.size.x / 2f;
		}
		return capsule.size.y / 2f;
	}

	private static float GetCapsule2DHeight(CapsuleCollider2D capsule)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		if ((int)capsule.direction == 0)
		{
			return capsule.size.y / 2f;
		}
		return capsule.size.x / 2f;
	}

	protected static void CalculateCapsuleParameters(CapsuleCollider2D capsule, ref Vector3 direction, ref float trueRadius, ref float scalerFactor)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Invalid comparison between Unknown and I4
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		Transform transform = ((Component)capsule).transform;
		if ((int)capsule.direction == 0)
		{
			direction = Vector3.up;
			scalerFactor = transform.lossyScale.y;
			float num = ((transform.lossyScale.x > transform.lossyScale.z) ? transform.lossyScale.x : transform.lossyScale.z);
			trueRadius = capsule.size.x / 2f * num;
		}
		else if ((int)capsule.direction == 1)
		{
			direction = Vector3.right;
			scalerFactor = transform.lossyScale.x;
			float num = ((transform.lossyScale.y > transform.lossyScale.z) ? transform.lossyScale.y : transform.lossyScale.z);
			trueRadius = capsule.size.y / 2f * num;
		}
	}

	protected static void GetCapsuleHeadsPositions(CapsuleCollider capsule, ref Vector3 upper, ref Vector3 bottom, Vector3 direction, float radius, float scalerFactor)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_0093: Unknown result type (might be due to invalid IL or missing references)
		//IL_0098: Unknown result type (might be due to invalid IL or missing references)
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = direction * (capsule.height / 2f * scalerFactor - radius);
		upper = ((Component)capsule).transform.position + ((Component)capsule).transform.TransformDirection(val) + ((Component)capsule).transform.TransformVector(capsule.center);
		Vector3 val2 = -direction * (capsule.height / 2f * scalerFactor - radius);
		bottom = ((Component)capsule).transform.position + ((Component)capsule).transform.TransformDirection(val2) + ((Component)capsule).transform.TransformVector(capsule.center);
	}

	protected static void GetCapsuleHeadsPositions(CapsuleCollider2D capsule, ref Vector3 upper, ref Vector3 bottom, Vector3 direction, float radius, float scalerFactor)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_008b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = direction * (GetCapsule2DHeight(capsule) * scalerFactor - radius);
		upper = ((Component)capsule).transform.position + ((Component)capsule).transform.TransformDirection(val) + ((Component)capsule).transform.TransformVector(Vector2.op_Implicit(((Collider2D)capsule).offset));
		upper.z = 0f;
		Vector3 val2 = -direction * (GetCapsule2DHeight(capsule) * scalerFactor - radius);
		bottom = ((Component)capsule).transform.position + ((Component)capsule).transform.TransformDirection(val2) + ((Component)capsule).transform.TransformVector(Vector2.op_Implicit(((Collider2D)capsule).offset));
		bottom.z = 0f;
	}
}


using FIMSpace;
using UnityEngine;

public class FImp_ColliderData_CharacterCapsule : FImp_ColliderData_Base
{
	private Vector3 Top;

	private Vector3 Bottom;

	private Vector3 Direction;

	private float radius;

	private float scaleFactor;

	private float preRadius;

	public CharacterController Capsule { get; private set; }

	public FImp_ColliderData_CharacterCapsule(CharacterController collider)
	{
		Is2D = false;
		base.Transform = ((Component)collider).transform;
		base.Collider = (Collider)(object)collider;
		base.Transform = ((Component)collider).transform;
		Capsule = collider;
		base.ColliderType = EFColliderType.Capsule;
		CalculateCapsuleParameters(Capsule, ref Direction, ref radius, ref scaleFactor);
		RefreshColliderData();
	}

	public override void RefreshColliderData()
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00da: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		if (!base.IsStatic)
		{
			bool flag = false;
			if (!previousPosition.VIsSame(base.Transform.position))
			{
				flag = true;
			}
			else if (!base.Transform.rotation.QIsSame(previousRotation))
			{
				flag = true;
			}
			else if (preRadius != Capsule.radius || !previousScale.VIsSame(base.Transform.lossyScale))
			{
				CalculateCapsuleParameters(Capsule, ref Direction, ref radius, ref scaleFactor);
			}
			if (flag)
			{
				GetCapsuleHeadsPositions(Capsule, ref Top, ref Bottom, Direction, radius, scaleFactor);
			}
			base.RefreshColliderData();
			previousPosition = base.Transform.position;
			previousRotation = base.Transform.rotation;
			previousScale = base.Transform.lossyScale;
			preRadius = Capsule.radius;
		}
	}

	public override bool PushIfInside(ref Vector3 point, float pointRadius, Vector3 pointOffset)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		return PushOutFromCapsuleCollider(pointRadius, ref point, Top, Bottom, radius, pointOffset);
	}

	public static bool PushOutFromCapsuleCollider(float segmentColliderRadius, ref Vector3 segmentPos, Vector3 capSphereCenter1, Vector3 capSphereCenter2, float capsuleRadius, Vector3 segmentOffset, bool is2D = false)
	{
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0083: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_0095: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d2: Unknown result type (might be due to invalid IL or missing references)
		//IL_0117: Unknown result type (might be due to invalid IL or missing references)
		//IL_011c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0124: Unknown result type (might be due to invalid IL or missing references)
		//IL_0129: Unknown result type (might be due to invalid IL or missing references)
		//IL_012e: Unknown result type (might be due to invalid IL or missing references)
		float num = capsuleRadius + segmentColliderRadius;
		Vector3 val = capSphereCenter2 - capSphereCenter1;
		Vector3 val2 = segmentPos + segmentOffset - capSphereCenter1;
		float num2 = Vector3.Dot(val2, val);
		if (num2 <= 0f)
		{
			float sqrMagnitude = ((Vector3)(ref val2)).sqrMagnitude;
			if (sqrMagnitude > 0f && sqrMagnitude < num * num)
			{
				segmentPos = capSphereCenter1 - segmentOffset + val2 * (num / Mathf.Sqrt(sqrMagnitude));
				return true;
			}
		}
		else
		{
			float sqrMagnitude2 = ((Vector3)(ref val)).sqrMagnitude;
			if (num2 >= sqrMagnitude2)
			{
				val2 = segmentPos + segmentOffset - capSphereCenter2;
				float sqrMagnitude3 = ((Vector3)(ref val2)).sqrMagnitude;
				if (sqrMagnitude3 > 0f && sqrMagnitude3 < num * num)
				{
					segmentPos = capSphereCenter2 - segmentOffset + val2 * (num / Mathf.Sqrt(sqrMagnitude3));
					return true;
				}
			}
			else if (sqrMagnitude2 > 0f)
			{
				val2 -= val * (num2 / sqrMagnitude2);
				float sqrMagnitude4 = ((Vector3)(ref val2)).sqrMagnitude;
				if (sqrMagnitude4 > 0f && sqrMagnitude4 < num * num)
				{
					float num3 = Mathf.Sqrt(sqrMagnitude4);
					segmentPos += val2 * ((num - num3) / num3);
					return true;
				}
			}
		}
		return false;
	}

	protected static void CalculateCapsuleParameters(CharacterController capsule, ref Vector3 direction, ref float trueRadius, ref float scalerFactor)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		Transform transform = ((Component)capsule).transform;
		direction = Vector3.up;
		scalerFactor = transform.lossyScale.y;
		float num = ((transform.lossyScale.x > transform.lossyScale.z) ? transform.lossyScale.x : transform.lossyScale.z);
		trueRadius = capsule.radius * num;
	}

	protected static void GetCapsuleHeadsPositions(CharacterController capsule, ref Vector3 upper, ref Vector3 bottom, Vector3 direction, float radius, float scalerFactor)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_0093: Unknown result type (might be due to invalid IL or missing references)
		//IL_0098: Unknown result type (might be due to invalid IL or missing references)
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = direction * (capsule.height / 2f * scalerFactor - radius);
		upper = ((Component)capsule).transform.position + ((Component)capsule).transform.TransformDirection(val) + ((Component)capsule).transform.TransformVector(capsule.center);
		Vector3 val2 = -direction * (capsule.height / 2f * scalerFactor - radius);
		bottom = ((Component)capsule).transform.position + ((Component)capsule).transform.TransformDirection(val2) + ((Component)capsule).transform.TransformVector(capsule.center);
	}
}


using FIMSpace;
using UnityEngine;

public class FImp_ColliderData_Mesh : FImp_ColliderData_Base
{
	private ContactFilter2D filter;

	private RaycastHit2D[] r;

	public MeshCollider Mesh { get; private set; }

	public PolygonCollider2D Poly2D { get; private set; }

	public FImp_ColliderData_Mesh(MeshCollider collider)
	{
		Is2D = false;
		base.Transform = ((Component)collider).transform;
		base.Collider = (Collider)(object)collider;
		Mesh = collider;
		base.ColliderType = EFColliderType.Mesh;
	}

	public FImp_ColliderData_Mesh(PolygonCollider2D collider)
	{
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		Is2D = true;
		base.Transform = ((Component)collider).transform;
		Poly2D = collider;
		base.Collider2D = (Collider2D)(object)collider;
		base.ColliderType = EFColliderType.Mesh;
		filter = default(ContactFilter2D);
		filter.useTriggers = false;
		filter.useDepth = false;
		r = (RaycastHit2D[])(object)new RaycastHit2D[1];
	}

	public override bool PushIfInside(ref Vector3 segmentPosition, float segmentRadius, Vector3 segmentOffset)
	{
		//IL_02bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_02c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_02c5: Unknown result type (might be due to invalid IL or missing references)
		//IL_02ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_02cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_02d7: Unknown result type (might be due to invalid IL or missing references)
		//IL_03b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_03b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_03bb: Unknown result type (might be due to invalid IL or missing references)
		//IL_02e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_02ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_02f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_02f7: Unknown result type (might be due to invalid IL or missing references)
		//IL_02f9: Unknown result type (might be due to invalid IL or missing references)
		//IL_02fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0303: Unknown result type (might be due to invalid IL or missing references)
		//IL_0319: Unknown result type (might be due to invalid IL or missing references)
		//IL_031e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0322: Unknown result type (might be due to invalid IL or missing references)
		//IL_0327: Unknown result type (might be due to invalid IL or missing references)
		//IL_032f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0334: Unknown result type (might be due to invalid IL or missing references)
		//IL_0338: Unknown result type (might be due to invalid IL or missing references)
		//IL_033d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0346: Unknown result type (might be due to invalid IL or missing references)
		//IL_034b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0350: Unknown result type (might be due to invalid IL or missing references)
		//IL_0364: Unknown result type (might be due to invalid IL or missing references)
		//IL_0369: Unknown result type (might be due to invalid IL or missing references)
		//IL_036d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ef: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f8: Unknown result type (might be due to invalid IL or missing references)
		//IL_0105: Unknown result type (might be due to invalid IL or missing references)
		//IL_010a: Unknown result type (might be due to invalid IL or missing references)
		//IL_010f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0124: Unknown result type (might be due to invalid IL or missing references)
		//IL_0126: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_03bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_03bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_03c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_03c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_03ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_03cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_03d1: Unknown result type (might be due to invalid IL or missing references)
		//IL_03d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_03d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_03a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_03a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_03aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_038a: Unknown result type (might be due to invalid IL or missing references)
		//IL_038f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0394: Unknown result type (might be due to invalid IL or missing references)
		//IL_0399: Unknown result type (might be due to invalid IL or missing references)
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_014d: Unknown result type (might be due to invalid IL or missing references)
		//IL_014f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0154: Unknown result type (might be due to invalid IL or missing references)
		//IL_0158: Unknown result type (might be due to invalid IL or missing references)
		//IL_015d: Unknown result type (might be due to invalid IL or missing references)
		//IL_015f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0161: Unknown result type (might be due to invalid IL or missing references)
		//IL_0170: Unknown result type (might be due to invalid IL or missing references)
		//IL_0175: Unknown result type (might be due to invalid IL or missing references)
		//IL_0179: Unknown result type (might be due to invalid IL or missing references)
		//IL_017e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0188: Unknown result type (might be due to invalid IL or missing references)
		//IL_018d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0192: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_0144: Unknown result type (might be due to invalid IL or missing references)
		//IL_0149: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0092: Unknown result type (might be due to invalid IL or missing references)
		//IL_0409: Unknown result type (might be due to invalid IL or missing references)
		//IL_0417: Unknown result type (might be due to invalid IL or missing references)
		//IL_041d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0422: Unknown result type (might be due to invalid IL or missing references)
		//IL_0427: Unknown result type (might be due to invalid IL or missing references)
		//IL_042c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0202: Unknown result type (might be due to invalid IL or missing references)
		//IL_0206: Unknown result type (might be due to invalid IL or missing references)
		//IL_020b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0210: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_0224: Unknown result type (might be due to invalid IL or missing references)
		//IL_0229: Unknown result type (might be due to invalid IL or missing references)
		//IL_022b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0230: Unknown result type (might be due to invalid IL or missing references)
		//IL_024e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0252: Unknown result type (might be due to invalid IL or missing references)
		//IL_0258: Unknown result type (might be due to invalid IL or missing references)
		//IL_025d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0262: Unknown result type (might be due to invalid IL or missing references)
		//IL_0236: Unknown result type (might be due to invalid IL or missing references)
		//IL_023a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0240: Unknown result type (might be due to invalid IL or missing references)
		//IL_0245: Unknown result type (might be due to invalid IL or missing references)
		//IL_024a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0266: Unknown result type (might be due to invalid IL or missing references)
		//IL_026b: Unknown result type (might be due to invalid IL or missing references)
		//IL_026d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0272: Unknown result type (might be due to invalid IL or missing references)
		//IL_0276: Unknown result type (might be due to invalid IL or missing references)
		//IL_027b: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_02ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_02b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_02b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_0291: Unknown result type (might be due to invalid IL or missing references)
		//IL_0295: Unknown result type (might be due to invalid IL or missing references)
		//IL_029b: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a5: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val3;
		Bounds bounds;
		if (!Is2D)
		{
			if (!Mesh.convex)
			{
				float num = 0f;
				Vector3 val = segmentPosition + segmentOffset;
				Vector3 val2 = ((Collider)Mesh).ClosestPointOnBounds(val);
				val3 = val2 - ((Component)Mesh).transform.position;
				num = ((Vector3)(ref val3)).magnitude;
				bool flag = false;
				float num2 = 1f;
				if (val2 == val)
				{
					flag = true;
					num2 = 7f;
					val2 = ((Component)Mesh).transform.position;
				}
				Vector3 val4 = val2 - val;
				Vector3 normalized = ((Vector3)(ref val4)).normalized;
				float num3 = segmentRadius * 2f;
				bounds = ((Collider)Mesh).bounds;
				val3 = ((Bounds)(ref bounds)).extents;
				Vector3 val5 = val - normalized * (num3 + ((Vector3)(ref val3)).magnitude);
				float num4 = ((Vector3)(ref val4)).magnitude + segmentRadius * 2f + num;
				bounds = ((Collider)Mesh).bounds;
				val3 = ((Bounds)(ref bounds)).extents;
				float num5 = num4 + ((Vector3)(ref val3)).magnitude;
				val3 = val - val2;
				if (((Vector3)(ref val3)).magnitude < segmentRadius * num2)
				{
					Ray val6 = default(Ray);
					((Ray)(ref val6))..ctor(val5, normalized);
					RaycastHit val7 = default(RaycastHit);
					if (((Collider)Mesh).Raycast(val6, ref val7, num5))
					{
						val3 = val - ((RaycastHit)(ref val7)).point;
						if (((Vector3)(ref val3)).magnitude < segmentRadius * num2)
						{
							Vector3 val8 = ((RaycastHit)(ref val7)).point - val;
							Vector3 val9 = ((!flag) ? (val8 - ((Vector3)(ref val8)).normalized * segmentRadius) : (val8 + ((Vector3)(ref val8)).normalized * segmentRadius));
							val3 = ((RaycastHit)(ref val7)).point - val;
							float num6 = Vector3.Dot(((Vector3)(ref val3)).normalized, normalized);
							if (flag && num6 > 0f)
							{
								val9 = val8 - ((Vector3)(ref val8)).normalized * segmentRadius;
							}
							segmentPosition += val9;
							return true;
						}
					}
				}
				return false;
			}
			Vector3 val10 = segmentPosition + segmentOffset;
			float num7 = 1f;
			Vector3 val11 = Physics.ClosestPoint(val10, (Collider)(object)Mesh, ((Component)Mesh).transform.position, ((Component)Mesh).transform.rotation);
			if (Vector3.Distance(val11, val10) > segmentRadius * 1.01f)
			{
				return false;
			}
			Vector3 val12 = val11 - val10;
			if (val12 == Vector3.zero)
			{
				return false;
			}
			RaycastHit val13 = default(RaycastHit);
			((Collider)Mesh).Raycast(new Ray(val10, ((Vector3)(ref val12)).normalized), ref val13, segmentRadius * num7);
			if (Object.op_Implicit((Object)(object)((RaycastHit)(ref val13)).transform))
			{
				segmentPosition = ((RaycastHit)(ref val13)).point + ((RaycastHit)(ref val13)).normal * segmentRadius;
				return true;
			}
		}
		else
		{
			Vector2 val14 = Vector2.op_Implicit(segmentPosition + segmentOffset);
			Vector2 val18;
			if (((Collider2D)Poly2D).OverlapPoint(val14))
			{
				bounds = ((Collider2D)Poly2D).bounds;
				Vector3 val15 = ((Bounds)(ref bounds)).center - Vector2.op_Implicit(val14);
				val15.z = 0f;
				bounds = ((Collider2D)Poly2D).bounds;
				Vector3 center = ((Bounds)(ref bounds)).center;
				Vector3 val16 = val15;
				bounds = ((Collider2D)Poly2D).bounds;
				val3 = ((Bounds)(ref bounds)).max;
				Ray val17 = default(Ray);
				((Ray)(ref val17))..ctor(center - val16 * ((Vector3)(ref val3)).magnitude, val15);
				float num8 = 0f;
				bounds = ((Collider2D)Poly2D).bounds;
				((Bounds)(ref bounds)).IntersectRay(val17, ref num8);
				val18 = ((!(num8 > 0f)) ? ((Collider2D)Poly2D).ClosestPoint(val14) : ((Collider2D)Poly2D).ClosestPoint(Vector2.op_Implicit(((Ray)(ref val17)).GetPoint(num8))));
			}
			else
			{
				val18 = ((Collider2D)Poly2D).ClosestPoint(val14);
			}
			Vector2 val19 = val18 - val14;
			Vector2 normalized2 = ((Vector2)(ref val19)).normalized;
			if (Physics2D.Raycast(val14, normalized2, filter, r, segmentRadius) > 0 && (Object)(object)((RaycastHit2D)(ref r[0])).transform == (Object)(object)base.Transform)
			{
				segmentPosition = Vector2.op_Implicit(val18 + ((RaycastHit2D)(ref r[0])).normal * segmentRadius);
				return true;
			}
		}
		return false;
	}

	public static void PushOutFromMeshCollider(MeshCollider mesh, Collision collision, float segmentColliderRadius, ref Vector3 pos)
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ec: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00aa: Unknown result type (might be due to invalid IL or missing references)
		Vector3 point = ((ContactPoint)(ref collision.contacts[0])).point;
		Vector3 val = ((ContactPoint)(ref collision.contacts[0])).normal;
		RaycastHit val2 = default(RaycastHit);
		if (((Collider)mesh).Raycast(new Ray(pos + val * segmentColliderRadius * 2f, -val), ref val2, segmentColliderRadius * 5f))
		{
			val = ((RaycastHit)(ref val2)).point - pos;
			float sqrMagnitude = ((Vector3)(ref val)).sqrMagnitude;
			if (sqrMagnitude > 0f && sqrMagnitude < segmentColliderRadius * segmentColliderRadius)
			{
				pos = ((RaycastHit)(ref val2)).point - val * (segmentColliderRadius / Mathf.Sqrt(sqrMagnitude)) * 0.9f;
			}
		}
		else
		{
			val = point - pos;
			float sqrMagnitude2 = ((Vector3)(ref val)).sqrMagnitude;
			if (sqrMagnitude2 > 0f && sqrMagnitude2 < segmentColliderRadius * segmentColliderRadius)
			{
				pos = point - val * (segmentColliderRadius / Mathf.Sqrt(sqrMagnitude2)) * 0.9f;
			}
		}
	}

	public static void PushOutFromMesh(MeshCollider mesh, Collision collision, float pointRadius, ref Vector3 point)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00db: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_0106: Unknown result type (might be due to invalid IL or missing references)
		//IL_0108: Unknown result type (might be due to invalid IL or missing references)
		//IL_0110: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0100: Unknown result type (might be due to invalid IL or missing references)
		//IL_0134: Unknown result type (might be due to invalid IL or missing references)
		//IL_0139: Unknown result type (might be due to invalid IL or missing references)
		//IL_011f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0124: Unknown result type (might be due to invalid IL or missing references)
		//IL_013c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0141: Unknown result type (might be due to invalid IL or missing references)
		//IL_0143: Unknown result type (might be due to invalid IL or missing references)
		//IL_0148: Unknown result type (might be due to invalid IL or missing references)
		//IL_0159: Unknown result type (might be due to invalid IL or missing references)
		//IL_015c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0161: Unknown result type (might be due to invalid IL or missing references)
		//IL_0166: Unknown result type (might be due to invalid IL or missing references)
		//IL_0183: Unknown result type (might be due to invalid IL or missing references)
		//IL_0187: Unknown result type (might be due to invalid IL or missing references)
		//IL_018d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0192: Unknown result type (might be due to invalid IL or missing references)
		//IL_0197: Unknown result type (might be due to invalid IL or missing references)
		//IL_016b: Unknown result type (might be due to invalid IL or missing references)
		//IL_016f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0175: Unknown result type (might be due to invalid IL or missing references)
		//IL_017a: Unknown result type (might be due to invalid IL or missing references)
		//IL_017f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0199: Unknown result type (might be due to invalid IL or missing references)
		//IL_019c: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_01af: Unknown result type (might be due to invalid IL or missing references)
		//IL_01dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d8: Unknown result type (might be due to invalid IL or missing references)
		float num = 0f;
		Vector3 val = ((Collider)mesh).ClosestPointOnBounds(point);
		Vector3 val2 = val - ((Component)mesh).transform.position;
		num = ((Vector3)(ref val2)).magnitude;
		bool flag = false;
		float num2 = 1f;
		if (val == point)
		{
			flag = true;
			num2 = 7f;
			val = ((Component)mesh).transform.position;
		}
		Vector3 val3 = val - point;
		Vector3 normalized = ((Vector3)(ref val3)).normalized;
		Vector3 val4 = point;
		float num3 = pointRadius * 2f;
		Bounds bounds = ((Collider)mesh).bounds;
		val2 = ((Bounds)(ref bounds)).extents;
		Vector3 val5 = val4 - normalized * (num3 + ((Vector3)(ref val2)).magnitude);
		float num4 = ((Vector3)(ref val3)).magnitude + pointRadius * 2f + num;
		bounds = ((Collider)mesh).bounds;
		val2 = ((Bounds)(ref bounds)).extents;
		float num5 = num4 + ((Vector3)(ref val2)).magnitude;
		val2 = point - val;
		if (!(((Vector3)(ref val2)).magnitude < pointRadius * num2))
		{
			return;
		}
		Vector3 val6;
		if (!flag)
		{
			val6 = ((ContactPoint)(ref collision.contacts[0])).point;
		}
		else
		{
			Ray val7 = default(Ray);
			((Ray)(ref val7))..ctor(val5, normalized);
			RaycastHit val8 = default(RaycastHit);
			val6 = ((!((Collider)mesh).Raycast(val7, ref val8, num5)) ? ((ContactPoint)(ref collision.contacts[0])).point : ((RaycastHit)(ref val8)).point);
		}
		val2 = point - val6;
		if (((Vector3)(ref val2)).magnitude < pointRadius * num2)
		{
			Vector3 val9 = val6 - point;
			Vector3 val10 = ((!flag) ? (val9 - ((Vector3)(ref val9)).normalized * pointRadius) : (val9 + ((Vector3)(ref val9)).normalized * pointRadius));
			val2 = val6 - point;
			float num6 = Vector3.Dot(((Vector3)(ref val2)).normalized, normalized);
			if (flag && num6 > 0f)
			{
				val10 = val9 - ((Vector3)(ref val9)).normalized * pointRadius;
			}
			point += val10;
		}
	}
}


using FIMSpace;
using UnityEngine;

public class FImp_ColliderData_Sphere : FImp_ColliderData_Base
{
	private float SphereRadius;

	public SphereCollider Sphere { get; private set; }

	public CircleCollider2D Sphere2D { get; private set; }

	public FImp_ColliderData_Sphere(SphereCollider collider)
	{
		Is2D = false;
		base.Transform = ((Component)collider).transform;
		base.Collider = (Collider)(object)collider;
		Sphere = collider;
		base.ColliderType = EFColliderType.Sphere;
		RefreshColliderData();
	}

	public FImp_ColliderData_Sphere(CircleCollider2D collider)
	{
		Is2D = true;
		base.Transform = ((Component)collider).transform;
		base.Collider2D = (Collider2D)(object)collider;
		Sphere2D = collider;
		base.ColliderType = EFColliderType.Sphere;
		RefreshColliderData();
	}

	public override void RefreshColliderData()
	{
		if (!base.IsStatic)
		{
			if ((Object)(object)Sphere2D == (Object)null)
			{
				SphereRadius = CalculateTrueRadiusOfSphereCollider(((Component)Sphere).transform, Sphere.radius);
				base.RefreshColliderData();
			}
			else
			{
				SphereRadius = CalculateTrueRadiusOfSphereCollider(((Component)Sphere2D).transform, Sphere2D.radius);
				base.RefreshColliderData();
			}
		}
	}

	public override bool PushIfInside(ref Vector3 point, float pointRadius, Vector3 pointOffset)
	{
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		if (!Is2D)
		{
			return PushOutFromSphereCollider(Sphere, pointRadius, ref point, SphereRadius, pointOffset);
		}
		return PushOutFromSphereCollider(Sphere2D, pointRadius, ref point, SphereRadius, pointOffset);
	}

	public static bool PushOutFromSphereCollider(SphereCollider sphere, float segmentColliderRadius, ref Vector3 segmentPos, Vector3 segmentOffset)
	{
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		return PushOutFromSphereCollider(sphere, segmentColliderRadius, ref segmentPos, CalculateTrueRadiusOfSphereCollider(sphere), segmentOffset);
	}

	public static bool PushOutFromSphereCollider(SphereCollider sphere, float segmentColliderRadius, ref Vector3 segmentPos, float collidingSphereRadius, Vector3 segmentOffset)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ((Component)sphere).transform.position + ((Component)sphere).transform.TransformVector(sphere.center);
		float num = collidingSphereRadius + segmentColliderRadius;
		Vector3 val2 = segmentPos + segmentOffset - val;
		float sqrMagnitude = ((Vector3)(ref val2)).sqrMagnitude;
		if (sqrMagnitude > 0f && sqrMagnitude < num * num)
		{
			segmentPos = val - segmentOffset + val2 * (num / Mathf.Sqrt(sqrMagnitude));
			return true;
		}
		return false;
	}

	public static bool PushOutFromSphereCollider(CircleCollider2D sphere, float segmentColliderRadius, ref Vector3 segmentPos, float collidingSphereRadius, Vector3 segmentOffset)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ((Component)sphere).transform.position + ((Component)sphere).transform.TransformVector(Vector2.op_Implicit(((Collider2D)sphere).offset));
		val.z = 0f;
		float num = collidingSphereRadius + segmentColliderRadius;
		Vector3 val2 = segmentPos;
		val2.z = 0f;
		Vector3 val3 = val2 + segmentOffset - val;
		float sqrMagnitude = ((Vector3)(ref val3)).sqrMagnitude;
		if (sqrMagnitude > 0f && sqrMagnitude < num * num)
		{
			segmentPos = val - segmentOffset + val3 * (num / Mathf.Sqrt(sqrMagnitude));
			return true;
		}
		return false;
	}

	public static float CalculateTrueRadiusOfSphereCollider(SphereCollider sphere)
	{
		return CalculateTrueRadiusOfSphereCollider(((Component)sphere).transform, sphere.radius);
	}

	public static float CalculateTrueRadiusOfSphereCollider(CircleCollider2D sphere)
	{
		return CalculateTrueRadiusOfSphereCollider(((Component)sphere).transform, sphere.radius);
	}

	public static float CalculateTrueRadiusOfSphereCollider(Transform transform, float componentRadius)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		float num = componentRadius;
		if (transform.lossyScale.x > transform.lossyScale.y)
		{
			if (transform.lossyScale.x > transform.lossyScale.z)
			{
				return num * transform.lossyScale.x;
			}
			return num * transform.lossyScale.z;
		}
		if (transform.lossyScale.y > transform.lossyScale.z)
		{
			return num * transform.lossyScale.y;
		}
		return num * transform.lossyScale.z;
	}
}


using FIMSpace;
using UnityEngine;

public class FImp_ColliderData_Terrain : FImp_ColliderData_Base
{
	public TerrainCollider TerrCollider { get; private set; }

	public Terrain TerrainComponent { get; private set; }

	public FImp_ColliderData_Terrain(TerrainCollider collider)
	{
		base.Collider = (Collider)(object)collider;
		base.Transform = ((Component)collider).transform;
		TerrCollider = collider;
		base.ColliderType = EFColliderType.Terrain;
		TerrainComponent = ((Component)collider).GetComponent<Terrain>();
	}

	public override bool PushIfInside(ref Vector3 segmentPosition, float segmentRadius, Vector3 segmentOffset)
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_0097: Unknown result type (might be due to invalid IL or missing references)
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_011a: Unknown result type (might be due to invalid IL or missing references)
		//IL_011b: Unknown result type (might be due to invalid IL or missing references)
		//IL_011c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0121: Unknown result type (might be due to invalid IL or missing references)
		//IL_0143: Unknown result type (might be due to invalid IL or missing references)
		//IL_0147: Unknown result type (might be due to invalid IL or missing references)
		//IL_014d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0152: Unknown result type (might be due to invalid IL or missing references)
		//IL_0157: Unknown result type (might be due to invalid IL or missing references)
		//IL_012b: Unknown result type (might be due to invalid IL or missing references)
		//IL_012f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0135: Unknown result type (might be due to invalid IL or missing references)
		//IL_013a: Unknown result type (might be due to invalid IL or missing references)
		//IL_013f: Unknown result type (might be due to invalid IL or missing references)
		//IL_015b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0160: Unknown result type (might be due to invalid IL or missing references)
		//IL_0162: Unknown result type (might be due to invalid IL or missing references)
		//IL_0167: Unknown result type (might be due to invalid IL or missing references)
		if (segmentPosition.x + segmentRadius < TerrainComponent.GetPosition().x - segmentRadius || segmentPosition.x > TerrainComponent.GetPosition().x + TerrainComponent.terrainData.size.x || segmentPosition.z + segmentRadius < TerrainComponent.GetPosition().z - segmentRadius || segmentPosition.z > TerrainComponent.GetPosition().z + TerrainComponent.terrainData.size.z)
		{
			return false;
		}
		Vector3 val = segmentPosition + segmentOffset;
		Vector3 val2 = val;
		val2.y = ((Component)TerrCollider).transform.position.y + TerrainComponent.SampleHeight(val);
		Vector3 val3 = val - val2;
		float magnitude = ((Vector3)(ref val3)).magnitude;
		float num = 1f;
		if (val.y < val2.y)
		{
			num = 4f;
		}
		else if (val.y + segmentRadius * 2f < val2.y)
		{
			num = 8f;
		}
		if (magnitude < segmentRadius * num)
		{
			Vector3 val4 = val2 - val;
			Vector3 val5 = ((!(num > 1f)) ? (val4 - ((Vector3)(ref val4)).normalized * segmentRadius) : (val4 + ((Vector3)(ref val4)).normalized * segmentRadius));
			segmentPosition += val5;
			return true;
		}
		return false;
	}

	public static void PushOutFromTerrain(TerrainCollider terrainCollider, float segmentRadius, ref Vector3 point)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fd: Unknown result type (might be due to invalid IL or missing references)
		//IL_0102: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_00db: Unknown result type (might be due to invalid IL or missing references)
		//IL_00df: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ef: Unknown result type (might be due to invalid IL or missing references)
		//IL_010b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0110: Unknown result type (might be due to invalid IL or missing references)
		//IL_0112: Unknown result type (might be due to invalid IL or missing references)
		//IL_0117: Unknown result type (might be due to invalid IL or missing references)
		Terrain component = ((Component)terrainCollider).GetComponent<Terrain>();
		Vector3 val = point;
		val.y = ((Component)terrainCollider).transform.position.y + component.SampleHeight(point) + segmentRadius;
		Ray val2 = default(Ray);
		((Ray)(ref val2))..ctor(val, Vector3.down);
		RaycastHit val3 = default(RaycastHit);
		if (((Collider)terrainCollider).Raycast(val2, ref val3, segmentRadius * 2f))
		{
			Vector3 val4 = point - ((RaycastHit)(ref val3)).point;
			float magnitude = ((Vector3)(ref val4)).magnitude;
			float num = 1f;
			if (((RaycastHit)(ref val3)).point.y > point.y + segmentRadius * 0.9f)
			{
				num = 8f;
			}
			else if (((RaycastHit)(ref val3)).point.y > point.y)
			{
				num = 4f;
			}
			if (magnitude < segmentRadius * num)
			{
				Vector3 val5 = ((RaycastHit)(ref val3)).point - point;
				Vector3 val6 = ((!(num > 1f)) ? (val5 - ((Vector3)(ref val5)).normalized * segmentRadius) : (val5 + ((Vector3)(ref val5)).normalized * segmentRadius));
				point += val6;
			}
		}
	}
}


using UnityEngine;

public class FDebug_PerformanceTest
{
	public void ResetMinMax()
	{
	}

	public void Start(GameObject owner, bool onlyIfSelected = true)
	{
	}

	public void Pause()
	{
	}

	public void Continue()
	{
	}

	public void Finish(bool onlyIfSelected = true)
	{
	}
}


using System;
using System.Diagnostics;
using UnityEngine;

public static class FEditor_OneShotLog
{
	public static bool CanDrawLog(string id, int delayToNextCallInSeconds = int.MaxValue, int callLimitBeforeTimeMove = 1, int logSeparation = 0)
	{
		int id2 = Process.GetCurrentProcess().Id;
		if (PlayerPrefs.GetInt(id + "s", 0) != id2)
		{
			PlayerPrefs.SetInt(id + "s", id2);
			PlayerPrefs.SetString(id + "acc", DateTime.Now.ToBinary().ToString());
			PlayerPrefs.SetInt(id + "counter", 0);
			PlayerPrefs.SetInt(id + "sep", logSeparation);
			if (delayToNextCallInSeconds == int.MaxValue)
			{
				return true;
			}
		}
		else if (delayToNextCallInSeconds == int.MaxValue)
		{
			return false;
		}
		string @string = PlayerPrefs.GetString(id + "acc");
		int num = PlayerPrefs.GetInt(id + "counter");
		int @int = PlayerPrefs.GetInt(id + "sep");
		if (long.TryParse(@string, out var result))
		{
			DateTime value = DateTime.FromBinary(result);
			if (DateTime.Now.Subtract(value).TotalSeconds > (double)delayToNextCallInSeconds)
			{
				PlayerPrefs.SetInt(id + "counter", 0);
				num = 0;
				PlayerPrefs.SetString(id + "acc", DateTime.Now.ToBinary().ToString());
			}
			@int++;
			PlayerPrefs.SetInt(id + "sep", @int);
			if (@int >= logSeparation)
			{
				@int = 0;
				PlayerPrefs.SetInt(id + "sep", @int);
				num++;
				PlayerPrefs.SetInt(id + "counter", num);
				if (num - 1 < callLimitBeforeTimeMove)
				{
					return true;
				}
			}
			return false;
		}
		return false;
	}

	public static bool EditorCanDrawLog(string id, int delayToNextCallInSeconds = int.MaxValue, int callLimitBeforeTimeMove = 1, int logSeparation = 0)
	{
		return false;
	}
}


using UnityEngine;

public class FEditor_StylesIn
{
	public static GUIStyle GrayBackground => Style(Color32.op_Implicit(new Color32((byte)128, (byte)128, (byte)127, (byte)76)));

	public static GUIStyle LGrayBackground => Style(Color32.op_Implicit(new Color32((byte)128, (byte)128, (byte)127, (byte)36)));

	public static GUIStyle LBlueBackground => Style(Color32.op_Implicit(new Color32((byte)0, (byte)128, byte.MaxValue, (byte)12)));

	public static GUIStyle LNavy => Style(Color32.op_Implicit(new Color32((byte)167, (byte)228, (byte)243, (byte)44)));

	public static GUIStyle Emerald => Style(Color32.op_Implicit(new Color32((byte)0, (byte)200, (byte)100, (byte)44)));

	public static GUIStyle GreenBackground => Style(Color32.op_Implicit(new Color32((byte)0, (byte)225, (byte)86, (byte)45)));

	public static GUIStyle BlueBackground => Style(Color32.op_Implicit(new Color32((byte)0, (byte)128, byte.MaxValue, (byte)76)));

	public static GUIStyle RedBackground => Style(Color32.op_Implicit(new Color32((byte)225, (byte)72, (byte)72, (byte)45)));

	public static GUIStyle YellowBackground => Style(Color32.op_Implicit(new Color32((byte)225, (byte)244, (byte)11, (byte)45)));

	public static GUIStyle Style(Color bgColor)
	{
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Expected O, but got Unknown
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Expected O, but got Unknown
		GUIStyle val = new GUIStyle(GUI.skin.box);
		Color[] pixels = (Color[])(object)new Color[1] { bgColor };
		Texture2D val2 = new Texture2D(1, 1);
		val2.SetPixels(pixels);
		val2.Apply();
		val.normal.background = val2;
		return val;
	}

	public static void DrawUILine(Color color, int thickness = 2, int padding = 10)
	{
	}
}


using System.Collections.Generic;
using UnityEngine;

public static class FGUI_Finders
{
	public static Component FoundAnimator;

	private static bool checkForAnim = true;

	private static int clicks = 0;

	public static void ResetFinders(bool resetClicks = true)
	{
		checkForAnim = true;
		FoundAnimator = null;
		if (resetClicks)
		{
			clicks = 0;
		}
	}

	public static bool CheckForAnimator(GameObject root, bool needAnimatorBox = true, bool drawInactiveWarning = true, int clicksTohide = 1)
	{
		bool flag = false;
		if (checkForAnim)
		{
			FoundAnimator = SearchForParentWithAnimator(root);
		}
		if (Object.op_Implicit((Object)(object)FoundAnimator))
		{
			Component foundAnimator = FoundAnimator;
			Animation val = (Animation)(object)((foundAnimator is Animation) ? foundAnimator : null);
			Component foundAnimator2 = FoundAnimator;
			Animator val2 = (Animator)(object)((foundAnimator2 is Animator) ? foundAnimator2 : null);
			if (Object.op_Implicit((Object)(object)val) && ((Behaviour)val).enabled)
			{
				flag = true;
			}
			if (Object.op_Implicit((Object)(object)val2))
			{
				if (((Behaviour)val2).enabled)
				{
					flag = true;
				}
				if ((Object)(object)val2.runtimeAnimatorController == (Object)null)
				{
					drawInactiveWarning = false;
					flag = false;
				}
			}
			if (needAnimatorBox && drawInactiveWarning && flag)
			{
			}
		}
		else if (needAnimatorBox)
		{
			_ = clicks;
		}
		checkForAnim = false;
		return flag;
	}

	public static Component SearchForParentWithAnimator(GameObject root)
	{
		Animation componentInChildren = root.GetComponentInChildren<Animation>();
		if (Object.op_Implicit((Object)(object)componentInChildren))
		{
			return (Component)(object)componentInChildren;
		}
		Animator componentInChildren2 = root.GetComponentInChildren<Animator>();
		if (Object.op_Implicit((Object)(object)componentInChildren2))
		{
			return (Component)(object)componentInChildren2;
		}
		if ((Object)(object)root.transform.parent != (Object)null)
		{
			Transform parent = root.transform.parent;
			while ((Object)(object)parent != (Object)null)
			{
				componentInChildren = ((Component)parent).GetComponent<Animation>();
				if (Object.op_Implicit((Object)(object)componentInChildren))
				{
					return (Component)(object)componentInChildren;
				}
				componentInChildren2 = ((Component)parent).GetComponent<Animator>();
				if (Object.op_Implicit((Object)(object)componentInChildren2))
				{
					return (Component)(object)componentInChildren2;
				}
				parent = parent.parent;
			}
		}
		return null;
	}

	public static SkinnedMeshRenderer GetBoneSearchArray(Transform root)
	{
		List<SkinnedMeshRenderer> list = new List<SkinnedMeshRenderer>();
		SkinnedMeshRenderer val = null;
		Transform[] componentsInChildren = ((Component)root).GetComponentsInChildren<Transform>();
		for (int i = 0; i < componentsInChildren.Length; i++)
		{
			SkinnedMeshRenderer component = ((Component)componentsInChildren[i]).GetComponent<SkinnedMeshRenderer>();
			if (Object.op_Implicit((Object)(object)component))
			{
				list.Add(component);
			}
		}
		if (list.Count == 0)
		{
			Transform val2 = root;
			while ((Object)(object)val2 != (Object)null && !((Object)(object)val2.parent == (Object)null))
			{
				val2 = val2.parent;
			}
			componentsInChildren = ((Component)val2).GetComponentsInChildren<Transform>();
			for (int i = 0; i < componentsInChildren.Length; i++)
			{
				SkinnedMeshRenderer component2 = ((Component)componentsInChildren[i]).GetComponent<SkinnedMeshRenderer>();
				if (!list.Contains(component2) && Object.op_Implicit((Object)(object)component2))
				{
					list.Add(component2);
				}
			}
		}
		if (list.Count > 1)
		{
			val = list[0];
			for (int j = 1; j < list.Count; j++)
			{
				if (list[j].bones.Length > val.bones.Length)
				{
					val = list[j];
				}
			}
		}
		else if (list.Count > 0)
		{
			val = list[0];
		}
		if ((Object)(object)val == (Object)null)
		{
			return null;
		}
		return val;
	}

	public static bool IsChildOf(Transform child, Transform rootParent)
	{
		Transform val = child;
		while ((Object)(object)val != (Object)null && (Object)(object)val != (Object)(object)rootParent)
		{
			val = val.parent;
		}
		if ((Object)(object)val == (Object)null)
		{
			return false;
		}
		return true;
	}

	public static Transform GetLastChild(Transform rootParent)
	{
		Transform val = rootParent;
		while (val.childCount > 0)
		{
			val = val.GetChild(0);
		}
		return val;
	}

	public static bool? IsRightOrLeft(string name, bool includeNotSure = false)
	{
		string text = name.ToLower();
		if (text.Contains("right"))
		{
			return true;
		}
		if (text.Contains("left"))
		{
			return false;
		}
		if (text.StartsWith("r_"))
		{
			return true;
		}
		if (text.StartsWith("l_"))
		{
			return false;
		}
		if (text.EndsWith("_r"))
		{
			return true;
		}
		if (text.EndsWith("_l"))
		{
			return false;
		}
		if (text.StartsWith("r."))
		{
			return true;
		}
		if (text.StartsWith("l."))
		{
			return false;
		}
		if (text.EndsWith(".r"))
		{
			return true;
		}
		if (text.EndsWith(".l"))
		{
			return false;
		}
		if (includeNotSure)
		{
			if (text.Contains("r_"))
			{
				return true;
			}
			if (text.Contains("l_"))
			{
				return false;
			}
			if (text.Contains("_r"))
			{
				return true;
			}
			if (text.Contains("_l"))
			{
				return false;
			}
			if (text.Contains("r."))
			{
				return true;
			}
			if (text.Contains("l."))
			{
				return false;
			}
			if (text.Contains(".r"))
			{
				return true;
			}
			if (text.Contains(".l"))
			{
				return false;
			}
		}
		return null;
	}

	public static bool? IsRightOrLeft(Transform child, Transform itsRoot)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = itsRoot.InverseTransformPoint(child.position);
		if (val.x < 0f)
		{
			return false;
		}
		if (val.x > 0f)
		{
			return true;
		}
		return null;
	}

	public static bool HaveKey(string text, string[] keys)
	{
		for (int i = 0; i < keys.Length; i++)
		{
			if (text.Contains(keys[i]))
			{
				return true;
			}
		}
		return false;
	}
}


using System;
using FIMSpace.FTools;
using UnityEngine;

[Serializable]
public abstract class FIK_ProcessorBase
{
	[Range(0f, 1f)]
	public float IKWeight = 1f;

	public Vector3 IKTargetPosition;

	public Quaternion IKTargetRotation;

	public Vector3 LastLocalDirection;

	public Vector3 LocalDirection;

	[NonSerialized]
	public bool CallPreCalibrate = true;

	public float fullLength { get; protected set; }

	public bool Initialized { get; protected set; }

	public FIK_IKBoneBase[] Bones { get; protected set; }

	public FIK_IKBoneBase StartBone => Bones[0];

	public FIK_IKBoneBase EndBone => Bones[Bones.Length - 1];

	public Quaternion StartBoneRotationOffset { get; set; } = Quaternion.identity;

	public virtual void Init(Transform root)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		StartBoneRotationOffset = Quaternion.identity;
	}

	public virtual void PreCalibrate()
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		if (CallPreCalibrate)
		{
			for (FIK_IKBoneBase fIK_IKBoneBase = Bones[0]; fIK_IKBoneBase != null; fIK_IKBoneBase = fIK_IKBoneBase.Child)
			{
				fIK_IKBoneBase.transform.localRotation = fIK_IKBoneBase.InitialLocalRotation;
			}
		}
	}

	public virtual void Update()
	{
	}

	public static float EaseInOutQuint(float start, float end, float value)
	{
		value /= 0.5f;
		end -= start;
		if (value < 1f)
		{
			return end * 0.5f * value * value * value * value * value + start;
		}
		value -= 2f;
		return end * 0.5f * (value * value * value * value * value + 2f) + start;
	}
}


using System;
using FIMSpace.FTools;
using UnityEngine;

[Serializable]
public abstract class FIK_IKBoneBase
{
	public float sqrMagn = 0.1f;

	public float BoneLength = 0.1f;

	public float MotionWeight = 1f;

	public Vector3 InitialLocalPosition;

	public Quaternion InitialLocalRotation;

	public Quaternion LastKeyLocalRotation;

	public FIK_IKBoneBase Child { get; private set; }

	public Transform transform { get; protected set; }

	public FIK_IKBoneBase(Transform t)
	{
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		transform = t;
		if (Object.op_Implicit((Object)(object)transform))
		{
			InitialLocalPosition = transform.localPosition;
			InitialLocalRotation = transform.localRotation;
			LastKeyLocalRotation = t.localRotation;
		}
	}

	public virtual void SetChild(FIK_IKBoneBase child)
	{
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		if (child != null)
		{
			Child = child;
			Vector3 val = child.transform.position - transform.position;
			sqrMagn = ((Vector3)(ref val)).sqrMagnitude;
			val = child.transform.position - transform.position;
			BoneLength = ((Vector3)(ref val)).sqrMagnitude;
		}
	}
}


using System;
using FIMSpace;
using FIMSpace.FTools;
using UnityEngine;

[Serializable]
public class FIK_CCDProcessor : FIK_ProcessorBase
{
	[Serializable]
	public class CCDIKBone : FIK_IKBoneBase
	{
		[Range(0f, 180f)]
		public float AngleLimit = 45f;

		[Range(0f, 180f)]
		public float TwistAngleLimit = 5f;

		public Vector3 ForwardOrientation;

		public float FrameWorldLength = 1f;

		public Vector2 HingeLimits = Vector2.zero;

		public Quaternion PreviousHingeRotation;

		public float PreviousHingeAngle;

		public Vector3 LastIKLocPosition;

		public Quaternion LastIKLocRotation;

		public CCDIKBone IKParent { get; private set; }

		public CCDIKBone IKChild { get; private set; }

		public CCDIKBone(Transform t)
			: base(t)
		{
		}//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)


		public void Init(CCDIKBone child, CCDIKBone parent)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			LastIKLocPosition = base.transform.localPosition;
			IKParent = parent;
			if (child != null)
			{
				SetChild(child);
			}
			IKChild = child;
		}

		public override void SetChild(FIK_IKBoneBase child)
		{
			base.SetChild(child);
		}

		public void AngleLimiting()
		{
			//IL_0001: Unknown result type (might be due to invalid IL or missing references)
			//IL_0006: Unknown result type (might be due to invalid IL or missing references)
			//IL_0011: Unknown result type (might be due to invalid IL or missing references)
			//IL_0016: Unknown result type (might be due to invalid IL or missing references)
			//IL_001b: Unknown result type (might be due to invalid IL or missing references)
			//IL_001c: Unknown result type (might be due to invalid IL or missing references)
			//IL_001d: Unknown result type (might be due to invalid IL or missing references)
			//IL_001f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0024: Unknown result type (might be due to invalid IL or missing references)
			//IL_005d: Unknown result type (might be due to invalid IL or missing references)
			//IL_005e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0063: Unknown result type (might be due to invalid IL or missing references)
			//IL_0064: Unknown result type (might be due to invalid IL or missing references)
			//IL_0065: Unknown result type (might be due to invalid IL or missing references)
			//IL_003e: Unknown result type (might be due to invalid IL or missing references)
			//IL_003f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0044: Unknown result type (might be due to invalid IL or missing references)
			//IL_0075: Unknown result type (might be due to invalid IL or missing references)
			//IL_007a: Unknown result type (might be due to invalid IL or missing references)
			//IL_007b: Unknown result type (might be due to invalid IL or missing references)
			//IL_0053: Unknown result type (might be due to invalid IL or missing references)
			//IL_0054: Unknown result type (might be due to invalid IL or missing references)
			//IL_0059: Unknown result type (might be due to invalid IL or missing references)
			Quaternion val = Quaternion.Inverse(LastKeyLocalRotation) * base.transform.localRotation;
			Quaternion val2 = val;
			if (Vector2.op_Implicit(HingeLimits).VIsZero())
			{
				if (AngleLimit < 180f)
				{
					val2 = LimitSpherical(val2);
				}
				if (TwistAngleLimit < 180f)
				{
					val2 = LimitZ(val2);
				}
			}
			else
			{
				val2 = LimitHinge(val2);
			}
			if (!val2.QIsSame(val))
			{
				base.transform.localRotation = LastKeyLocalRotation * val2;
			}
		}

		private Quaternion LimitSpherical(Quaternion rotation)
		{
			//IL_0000: Unknown result type (might be due to invalid IL or missing references)
			//IL_000a: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0011: Unknown result type (might be due to invalid IL or missing references)
			//IL_0016: Unknown result type (might be due to invalid IL or missing references)
			//IL_0017: Unknown result type (might be due to invalid IL or missing references)
			//IL_001d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0022: Unknown result type (might be due to invalid IL or missing references)
			//IL_0023: Unknown result type (might be due to invalid IL or missing references)
			//IL_002e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0033: Unknown result type (might be due to invalid IL or missing references)
			//IL_0034: Unknown result type (might be due to invalid IL or missing references)
			//IL_0035: Unknown result type (might be due to invalid IL or missing references)
			//IL_0037: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0041: Unknown result type (might be due to invalid IL or missing references)
			//IL_0046: Unknown result type (might be due to invalid IL or missing references)
			//IL_0047: Unknown result type (might be due to invalid IL or missing references)
			//IL_0008: Unknown result type (might be due to invalid IL or missing references)
			if (rotation.QIsZero())
			{
				return rotation;
			}
			Vector3 val = rotation * ForwardOrientation;
			Quaternion val2 = Quaternion.RotateTowards(Quaternion.identity, Quaternion.FromToRotation(ForwardOrientation, val), AngleLimit);
			return Quaternion.FromToRotation(val, val2 * ForwardOrientation) * rotation;
		}

		private Quaternion LimitZ(Quaternion currentRotation)
		{
			//IL_0028: Unknown result type (might be due to invalid IL or missing references)
			//IL_002a: Unknown result type (might be due to invalid IL or missing references)
			//IL_002f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0034: Unknown result type (might be due to invalid IL or missing references)
			//IL_0035: Unknown result type (might be due to invalid IL or missing references)
			//IL_0036: Unknown result type (might be due to invalid IL or missing references)
			//IL_0040: Unknown result type (might be due to invalid IL or missing references)
			//IL_0041: Unknown result type (might be due to invalid IL or missing references)
			//IL_0042: Unknown result type (might be due to invalid IL or missing references)
			//IL_0047: Unknown result type (might be due to invalid IL or missing references)
			//IL_0051: Unknown result type (might be due to invalid IL or missing references)
			//IL_0052: Unknown result type (might be due to invalid IL or missing references)
			//IL_0053: Unknown result type (might be due to invalid IL or missing references)
			//IL_0058: Unknown result type (might be due to invalid IL or missing references)
			//IL_0059: Unknown result type (might be due to invalid IL or missing references)
			//IL_005e: Unknown result type (might be due to invalid IL or missing references)
			//IL_006e: Unknown result type (might be due to invalid IL or missing references)
			//IL_006f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0076: Unknown result type (might be due to invalid IL or missing references)
			//IL_006c: Unknown result type (might be due to invalid IL or missing references)
			Vector3 val = default(Vector3);
			((Vector3)(ref val))..ctor(ForwardOrientation.y, ForwardOrientation.z, ForwardOrientation.x);
			Vector3 val2 = currentRotation * ForwardOrientation;
			Vector3 val3 = val;
			Vector3.OrthoNormalize(ref val2, ref val3);
			val = currentRotation * val;
			Vector3.OrthoNormalize(ref val2, ref val);
			Quaternion val4 = Quaternion.FromToRotation(val, val3) * currentRotation;
			if (TwistAngleLimit <= 0f)
			{
				return val4;
			}
			return Quaternion.RotateTowards(val4, currentRotation, TwistAngleLimit);
		}

		private Quaternion LimitHinge(Quaternion rotation)
		{
			//IL_0000: Unknown result type (might be due to invalid IL or missing references)
			//IL_0002: Unknown result type (might be due to invalid IL or missing references)
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0012: Unknown result type (might be due to invalid IL or missing references)
			//IL_0017: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			//IL_001e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0023: Unknown result type (might be due to invalid IL or missing references)
			//IL_0028: Unknown result type (might be due to invalid IL or missing references)
			//IL_002d: Unknown result type (might be due to invalid IL or missing references)
			//IL_002e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0033: Unknown result type (might be due to invalid IL or missing references)
			//IL_0062: Unknown result type (might be due to invalid IL or missing references)
			//IL_0064: Unknown result type (might be due to invalid IL or missing references)
			//IL_0069: Unknown result type (might be due to invalid IL or missing references)
			//IL_006e: Unknown result type (might be due to invalid IL or missing references)
			//IL_006f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0070: Unknown result type (might be due to invalid IL or missing references)
			//IL_0071: Unknown result type (might be due to invalid IL or missing references)
			//IL_0076: Unknown result type (might be due to invalid IL or missing references)
			//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
			//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
			//IL_00c1: Unknown result type (might be due to invalid IL or missing references)
			//IL_00c7: Unknown result type (might be due to invalid IL or missing references)
			Quaternion val = Quaternion.FromToRotation(rotation * ForwardOrientation, ForwardOrientation) * rotation * Quaternion.Inverse(PreviousHingeRotation);
			float num = Quaternion.Angle(Quaternion.identity, val);
			Vector3 val2 = default(Vector3);
			((Vector3)(ref val2))..ctor(ForwardOrientation.z, ForwardOrientation.x, ForwardOrientation.y);
			Vector3 val3 = Vector3.Cross(val2, ForwardOrientation);
			if (Vector3.Dot(val * val2, val3) > 0f)
			{
				num = 0f - num;
			}
			PreviousHingeAngle = Mathf.Clamp(PreviousHingeAngle + num, HingeLimits.x, HingeLimits.y);
			PreviousHingeRotation = Quaternion.AngleAxis(PreviousHingeAngle, ForwardOrientation);
			return PreviousHingeRotation;
		}
	}

	public CCDIKBone[] IKBones;

	public bool ContinousSolving = true;

	[Range(0f, 1f)]
	public float SyncWithAnimator = 1f;

	[Range(1f, 12f)]
	public int ReactionQuality = 2;

	[Range(0f, 1f)]
	public float Smoothing;

	[Range(0f, 1.5f)]
	public float StretchToTarget;

	public AnimationCurve StretchCurve = AnimationCurve.EaseInOut(0f, 0f, 1f, 1f);

	public bool Use2D;

	public bool Invert;

	public CCDIKBone StartIKBone => IKBones[0];

	public CCDIKBone EndIKBone => IKBones[IKBones.Length - 1];

	public float ActiveLength { get; private set; }

	public FIK_CCDProcessor(Transform[] bonesChain)
	{
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		IKBones = new CCDIKBone[bonesChain.Length];
		FIK_IKBoneBase[] bones = new CCDIKBone[IKBones.Length];
		base.Bones = bones;
		for (int i = 0; i < bonesChain.Length; i++)
		{
			IKBones[i] = new CCDIKBone(bonesChain[i]);
			base.Bones[i] = IKBones[i];
		}
		IKTargetPosition = base.EndBone.transform.position;
		IKTargetRotation = base.EndBone.transform.rotation;
	}

	public override void Init(Transform root)
	{
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00da: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f5: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_010c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0111: Unknown result type (might be due to invalid IL or missing references)
		//IL_0116: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b8: Unknown result type (might be due to invalid IL or missing references)
		if (base.Initialized)
		{
			return;
		}
		base.fullLength = 0f;
		for (int i = 0; i < base.Bones.Length; i++)
		{
			CCDIKBone cCDIKBone = IKBones[i];
			CCDIKBone child = null;
			CCDIKBone parent = null;
			if (i > 0)
			{
				parent = IKBones[i - 1];
			}
			if (i < base.Bones.Length - 1)
			{
				child = IKBones[i + 1];
			}
			if (i < base.Bones.Length - 1)
			{
				IKBones[i].Init(child, parent);
				base.fullLength += cCDIKBone.BoneLength;
				cCDIKBone.ForwardOrientation = Quaternion.Inverse(cCDIKBone.transform.rotation) * (IKBones[i + 1].transform.position - cCDIKBone.transform.position);
			}
			else
			{
				IKBones[i].Init(child, parent);
				cCDIKBone.ForwardOrientation = Quaternion.Inverse(cCDIKBone.transform.rotation) * (IKBones[IKBones.Length - 1].transform.position - IKBones[0].transform.position);
			}
		}
		base.Initialized = true;
	}

	public override void Update()
	{
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b8: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_04a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_04ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0104: Unknown result type (might be due to invalid IL or missing references)
		//IL_0109: Unknown result type (might be due to invalid IL or missing references)
		//IL_010a: Unknown result type (might be due to invalid IL or missing references)
		//IL_010f: Unknown result type (might be due to invalid IL or missing references)
		//IL_04c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_04d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_04d8: Unknown result type (might be due to invalid IL or missing references)
		//IL_04dd: Unknown result type (might be due to invalid IL or missing references)
		//IL_065a: Unknown result type (might be due to invalid IL or missing references)
		//IL_065f: Unknown result type (might be due to invalid IL or missing references)
		//IL_066b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0670: Unknown result type (might be due to invalid IL or missing references)
		//IL_0676: Unknown result type (might be due to invalid IL or missing references)
		//IL_067c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0681: Unknown result type (might be due to invalid IL or missing references)
		//IL_0686: Unknown result type (might be due to invalid IL or missing references)
		//IL_068b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0694: Unknown result type (might be due to invalid IL or missing references)
		//IL_0699: Unknown result type (might be due to invalid IL or missing references)
		//IL_069c: Unknown result type (might be due to invalid IL or missing references)
		//IL_06a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_06ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_06ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_06d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_06e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_0523: Unknown result type (might be due to invalid IL or missing references)
		//IL_052e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0533: Unknown result type (might be due to invalid IL or missing references)
		//IL_0538: Unknown result type (might be due to invalid IL or missing references)
		//IL_053c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0541: Unknown result type (might be due to invalid IL or missing references)
		//IL_0549: Unknown result type (might be due to invalid IL or missing references)
		//IL_054e: Unknown result type (might be due to invalid IL or missing references)
		//IL_055b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0560: Unknown result type (might be due to invalid IL or missing references)
		//IL_0562: Unknown result type (might be due to invalid IL or missing references)
		//IL_0564: Unknown result type (might be due to invalid IL or missing references)
		//IL_0566: Unknown result type (might be due to invalid IL or missing references)
		//IL_056b: Unknown result type (might be due to invalid IL or missing references)
		//IL_056f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0574: Unknown result type (might be due to invalid IL or missing references)
		//IL_0576: Unknown result type (might be due to invalid IL or missing references)
		//IL_0578: Unknown result type (might be due to invalid IL or missing references)
		//IL_0310: Unknown result type (might be due to invalid IL or missing references)
		//IL_031b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0320: Unknown result type (might be due to invalid IL or missing references)
		//IL_0325: Unknown result type (might be due to invalid IL or missing references)
		//IL_0327: Unknown result type (might be due to invalid IL or missing references)
		//IL_032e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0333: Unknown result type (might be due to invalid IL or missing references)
		//IL_0338: Unknown result type (might be due to invalid IL or missing references)
		//IL_0340: Unknown result type (might be due to invalid IL or missing references)
		//IL_0347: Unknown result type (might be due to invalid IL or missing references)
		//IL_0359: Unknown result type (might be due to invalid IL or missing references)
		//IL_0360: Unknown result type (might be due to invalid IL or missing references)
		//IL_037a: Unknown result type (might be due to invalid IL or missing references)
		//IL_037f: Unknown result type (might be due to invalid IL or missing references)
		//IL_038a: Unknown result type (might be due to invalid IL or missing references)
		//IL_038f: Unknown result type (might be due to invalid IL or missing references)
		//IL_016e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0179: Unknown result type (might be due to invalid IL or missing references)
		//IL_017e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0183: Unknown result type (might be due to invalid IL or missing references)
		//IL_018a: Unknown result type (might be due to invalid IL or missing references)
		//IL_018f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0194: Unknown result type (might be due to invalid IL or missing references)
		//IL_019f: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_05a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_05a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_05ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_05b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_05b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_05c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_05c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_05cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_05e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_05e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_05e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_05eb: Unknown result type (might be due to invalid IL or missing references)
		//IL_05fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0606: Unknown result type (might be due to invalid IL or missing references)
		//IL_060b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0610: Unknown result type (might be due to invalid IL or missing references)
		//IL_0615: Unknown result type (might be due to invalid IL or missing references)
		//IL_0621: Unknown result type (might be due to invalid IL or missing references)
		//IL_0623: Unknown result type (might be due to invalid IL or missing references)
		//IL_0400: Unknown result type (might be due to invalid IL or missing references)
		//IL_040b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0410: Unknown result type (might be due to invalid IL or missing references)
		//IL_0415: Unknown result type (might be due to invalid IL or missing references)
		//IL_0417: Unknown result type (might be due to invalid IL or missing references)
		//IL_041e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0423: Unknown result type (might be due to invalid IL or missing references)
		//IL_0428: Unknown result type (might be due to invalid IL or missing references)
		//IL_0430: Unknown result type (might be due to invalid IL or missing references)
		//IL_0437: Unknown result type (might be due to invalid IL or missing references)
		//IL_0449: Unknown result type (might be due to invalid IL or missing references)
		//IL_0450: Unknown result type (might be due to invalid IL or missing references)
		//IL_046a: Unknown result type (might be due to invalid IL or missing references)
		//IL_046f: Unknown result type (might be due to invalid IL or missing references)
		//IL_047a: Unknown result type (might be due to invalid IL or missing references)
		//IL_047f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0249: Unknown result type (might be due to invalid IL or missing references)
		//IL_0254: Unknown result type (might be due to invalid IL or missing references)
		//IL_0259: Unknown result type (might be due to invalid IL or missing references)
		//IL_025e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0265: Unknown result type (might be due to invalid IL or missing references)
		//IL_026a: Unknown result type (might be due to invalid IL or missing references)
		//IL_026f: Unknown result type (might be due to invalid IL or missing references)
		//IL_027a: Unknown result type (might be due to invalid IL or missing references)
		//IL_027f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0284: Unknown result type (might be due to invalid IL or missing references)
		//IL_01db: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_02b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_029b: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a4: Unknown result type (might be due to invalid IL or missing references)
		if (!base.Initialized || IKWeight <= 0f)
		{
			return;
		}
		CCDIKBone cCDIKBone = IKBones[0];
		if (ContinousSolving)
		{
			while (cCDIKBone != null)
			{
				cCDIKBone.LastKeyLocalRotation = cCDIKBone.transform.localRotation;
				cCDIKBone.transform.localPosition = cCDIKBone.LastIKLocPosition;
				cCDIKBone.transform.localRotation = cCDIKBone.LastIKLocRotation;
				cCDIKBone = cCDIKBone.IKChild;
			}
		}
		else if (SyncWithAnimator > 0f)
		{
			while (cCDIKBone != null)
			{
				cCDIKBone.LastKeyLocalRotation = cCDIKBone.transform.localRotation;
				cCDIKBone = cCDIKBone.IKChild;
			}
		}
		if (ReactionQuality < 0)
		{
			ReactionQuality = 1;
		}
		Vector3 val = Vector3.zero;
		if (ReactionQuality > 1)
		{
			val = GetGoalPivotOffset();
		}
		for (int i = 0; i < ReactionQuality && (i < 1 || ((Vector3)(ref val)).sqrMagnitude != 0f || !(Smoothing > 0f) || !(GetVelocityDifference() < Smoothing * Smoothing)); i++)
		{
			LastLocalDirection = RefreshLocalDirection();
			Vector3 val2 = IKTargetPosition + val;
			cCDIKBone = IKBones[IKBones.Length - 2];
			if (!Use2D)
			{
				if (!Invert)
				{
					while (cCDIKBone != null)
					{
						float num = cCDIKBone.MotionWeight * IKWeight;
						if (num > 0f)
						{
							Quaternion val3 = Quaternion.FromToRotation(base.Bones[base.Bones.Length - 1].transform.position - cCDIKBone.transform.position, val2 - cCDIKBone.transform.position) * cCDIKBone.transform.rotation;
							if (num < 1f)
							{
								cCDIKBone.transform.rotation = Quaternion.Lerp(cCDIKBone.transform.rotation, val3, num);
							}
							else
							{
								cCDIKBone.transform.rotation = val3;
							}
						}
						cCDIKBone.AngleLimiting();
						cCDIKBone = cCDIKBone.IKParent;
					}
					continue;
				}
				while (cCDIKBone != null)
				{
					cCDIKBone.AngleLimiting();
					cCDIKBone = cCDIKBone.IKParent;
				}
				for (cCDIKBone = IKBones[0]; cCDIKBone != null; cCDIKBone = cCDIKBone.IKChild)
				{
					float num2 = cCDIKBone.MotionWeight * IKWeight;
					if (num2 > 0f)
					{
						Quaternion val4 = Quaternion.FromToRotation(base.Bones[base.Bones.Length - 1].transform.position - cCDIKBone.transform.position, val2 - cCDIKBone.transform.position) * cCDIKBone.transform.rotation;
						if (num2 < 1f)
						{
							cCDIKBone.transform.rotation = Quaternion.Lerp(cCDIKBone.transform.rotation, val4, num2);
						}
						else
						{
							cCDIKBone.transform.rotation = val4;
						}
					}
				}
				continue;
			}
			if (!Invert)
			{
				while (cCDIKBone != null)
				{
					float num3 = cCDIKBone.MotionWeight * IKWeight;
					if (num3 > 0f)
					{
						Vector3 val5 = base.Bones[base.Bones.Length - 1].transform.position - cCDIKBone.transform.position;
						Vector3 val6 = val2 - cCDIKBone.transform.position;
						cCDIKBone.transform.rotation = Quaternion.AngleAxis(Mathf.DeltaAngle(Mathf.Atan2(val5.x, val5.y) * 57.29578f, Mathf.Atan2(val6.x, val6.y) * 57.29578f) * num3, Vector3.back) * cCDIKBone.transform.rotation;
					}
					cCDIKBone.AngleLimiting();
					cCDIKBone = cCDIKBone.IKParent;
				}
				continue;
			}
			while (cCDIKBone != null)
			{
				cCDIKBone.AngleLimiting();
				cCDIKBone = cCDIKBone.IKParent;
			}
			for (cCDIKBone = IKBones[0]; cCDIKBone != null; cCDIKBone = cCDIKBone.IKChild)
			{
				float num4 = cCDIKBone.MotionWeight * IKWeight;
				if (num4 > 0f)
				{
					Vector3 val7 = base.Bones[base.Bones.Length - 1].transform.position - cCDIKBone.transform.position;
					Vector3 val8 = val2 - cCDIKBone.transform.position;
					cCDIKBone.transform.rotation = Quaternion.AngleAxis(Mathf.DeltaAngle(Mathf.Atan2(val7.x, val7.y) * 57.29578f, Mathf.Atan2(val8.x, val8.y) * 57.29578f) * num4, Vector3.back) * cCDIKBone.transform.rotation;
				}
			}
		}
		LastLocalDirection = RefreshLocalDirection();
		if (StretchToTarget > 0f)
		{
			Vector3 val9 = IKTargetPosition - EndIKBone.transform.position;
			float num5 = ((Vector3)(ref val9)).magnitude;
			ActiveLength = Mathf.Epsilon;
			cCDIKBone = IKBones[0];
			int num6 = 0;
			float num7 = Mathf.Max(1f, StretchToTarget);
			while (cCDIKBone.IKChild != null && !(num5 <= 0f))
			{
				Vector3 val10 = IKTargetPosition - cCDIKBone.transform.position;
				Vector3 normalized = ((Vector3)(ref val10)).normalized;
				Vector3 position = cCDIKBone.transform.position;
				Vector3 position2 = cCDIKBone.IKChild.transform.position;
				Vector3 val11 = position2 - position;
				Vector3 normalized2 = ((Vector3)(ref val11)).normalized;
				float num8 = Vector3.Dot(normalized2, normalized);
				if (num8 > 0f)
				{
					float num9 = cCDIKBone.BoneLength * num7 * num8;
					if (num9 > num5)
					{
						num9 = num5;
					}
					Vector3 val12 = position2 + normalized2 * num9;
					cCDIKBone.IKChild.transform.position = Vector3.Lerp(position2, val12, StretchToTarget);
					cCDIKBone.transform.rotation = cCDIKBone.transform.rotation * Quaternion.FromToRotation(position2 - position, cCDIKBone.Child.transform.position - cCDIKBone.transform.position);
					num5 -= Vector3.Distance(position2, val12);
				}
				cCDIKBone = cCDIKBone.IKChild;
				num6++;
			}
		}
		for (cCDIKBone = IKBones[0]; cCDIKBone != null; cCDIKBone = cCDIKBone.IKChild)
		{
			cCDIKBone.LastIKLocRotation = cCDIKBone.transform.localRotation;
			cCDIKBone.LastIKLocPosition = cCDIKBone.transform.localPosition;
			Quaternion val13 = cCDIKBone.LastIKLocRotation * Quaternion.Inverse(cCDIKBone.InitialLocalRotation);
			cCDIKBone.transform.localRotation = Quaternion.Lerp(cCDIKBone.LastIKLocRotation, val13 * cCDIKBone.LastKeyLocalRotation, SyncWithAnimator);
			if (IKWeight < 1f)
			{
				cCDIKBone.transform.localRotation = Quaternion.Lerp(cCDIKBone.LastKeyLocalRotation, cCDIKBone.transform.localRotation, IKWeight);
			}
		}
	}

	protected Vector3 GetGoalPivotOffset()
	{
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00db: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		if (!GoalPivotOffsetDetected())
		{
			return Vector3.zero;
		}
		Vector3 val = IKTargetPosition - IKBones[0].transform.position;
		Vector3 normalized = ((Vector3)(ref val)).normalized;
		Vector3 val2 = default(Vector3);
		((Vector3)(ref val2))..ctor(normalized.y, normalized.z, normalized.x);
		if (IKBones[IKBones.Length - 2].AngleLimit < 180f || IKBones[IKBones.Length - 2].TwistAngleLimit < 180f)
		{
			val2 = IKBones[IKBones.Length - 2].transform.rotation * IKBones[IKBones.Length - 2].ForwardOrientation;
		}
		return Vector3.Cross(normalized, val2) * IKBones[IKBones.Length - 2].BoneLength * 0.5f;
	}

	private bool GoalPivotOffsetDetected()
	{
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		if (!base.Initialized)
		{
			return false;
		}
		Vector3 val = base.Bones[base.Bones.Length - 1].transform.position - base.Bones[0].transform.position;
		Vector3 val2 = IKTargetPosition - base.Bones[0].transform.position;
		float magnitude = ((Vector3)(ref val)).magnitude;
		float magnitude2 = ((Vector3)(ref val2)).magnitude;
		if (magnitude2 == 0f)
		{
			return false;
		}
		if (magnitude == 0f)
		{
			return false;
		}
		if (magnitude < magnitude2)
		{
			return false;
		}
		if (magnitude < base.fullLength - base.Bones[base.Bones.Length - 2].BoneLength * 0.1f)
		{
			return false;
		}
		if (magnitude2 > magnitude)
		{
			return false;
		}
		if (Vector3.Dot(val / magnitude, val2 / magnitude2) < 0.999f)
		{
			return false;
		}
		return true;
	}

	private Vector3 RefreshLocalDirection()
	{
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		LocalDirection = base.Bones[0].transform.InverseTransformDirection(base.Bones[base.Bones.Length - 1].transform.position - base.Bones[0].transform.position);
		return LocalDirection;
	}

	private float GetVelocityDifference()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		return Vector3.SqrMagnitude(LocalDirection - LastLocalDirection);
	}

	public void AutoLimitAngle(float angleLimit = 60f, float twistAngleLimit = 50f)
	{
		if (IKBones == null)
		{
			return;
		}
		float num = 1f / (float)IKBones.Length;
		if (Invert)
		{
			for (int i = 0; i < IKBones.Length; i++)
			{
				IKBones[i].AngleLimit = angleLimit * Mathf.Min(1f, (1f - (float)(i + 1) * num) * 3f);
				IKBones[i].TwistAngleLimit = twistAngleLimit * Mathf.Min(1f, (1f - (float)(i + 1) * num) * 4.5f);
			}
		}
		else
		{
			for (int j = 0; j < IKBones.Length; j++)
			{
				IKBones[j].AngleLimit = angleLimit * Mathf.Min(1f, (float)(j + 1) * num * 3f);
				IKBones[j].TwistAngleLimit = twistAngleLimit * Mathf.Min(1f, (float)(j + 1) * num * 4.5f);
			}
		}
	}

	public void AutoWeightBones(float baseValue = 1f)
	{
		float num = baseValue / ((float)base.Bones.Length * 1.3f);
		if (Invert)
		{
			for (int i = 0; i < base.Bones.Length; i++)
			{
				base.Bones[i].MotionWeight = 1f - (baseValue - num * (float)i);
			}
		}
		else
		{
			for (int j = 0; j < base.Bones.Length; j++)
			{
				base.Bones[j].MotionWeight = baseValue - num * (float)j;
			}
		}
	}

	public void AutoWeightBones(AnimationCurve weightCurve)
	{
		if (Invert)
		{
			for (int i = 0; i < base.Bones.Length; i++)
			{
				base.Bones[i].MotionWeight = Mathf.Clamp(1f - weightCurve.Evaluate((float)i / (float)base.Bones.Length), 0f, 1f);
			}
		}
		else
		{
			for (int j = 0; j < base.Bones.Length; j++)
			{
				base.Bones[j].MotionWeight = Mathf.Clamp(weightCurve.Evaluate((float)j / (float)base.Bones.Length), 0f, 1f);
			}
		}
	}
}


using System;
using UnityEngine;

[Serializable]
public class CCDIKBone : FIK_IKBoneBase
{
	[Range(0f, 180f)]
	public float AngleLimit = 45f;

	[Range(0f, 180f)]
	public float TwistAngleLimit = 5f;

	public Vector3 ForwardOrientation;

	public float FrameWorldLength = 1f;

	public Vector2 HingeLimits = Vector2.zero;

	public Quaternion PreviousHingeRotation;

	public float PreviousHingeAngle;

	public Vector3 LastIKLocPosition;

	public Quaternion LastIKLocRotation;

	public CCDIKBone IKParent { get; private set; }

	public CCDIKBone IKChild { get; private set; }

	public CCDIKBone(Transform t)
		: base(t)
	{
	}//IL_0022: Unknown result type (might be due to invalid IL or missing references)
	//IL_0027: Unknown result type (might be due to invalid IL or missing references)


	public void Init(CCDIKBone child, CCDIKBone parent)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		LastIKLocPosition = base.transform.localPosition;
		IKParent = parent;
		if (child != null)
		{
			SetChild(child);
		}
		IKChild = child;
	}

	public override void SetChild(FIK_IKBoneBase child)
	{
		base.SetChild(child);
	}

	public void AngleLimiting()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_005d: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		Quaternion val = Quaternion.Inverse(LastKeyLocalRotation) * base.transform.localRotation;
		Quaternion val2 = val;
		if (Vector2.op_Implicit(HingeLimits).VIsZero())
		{
			if (AngleLimit < 180f)
			{
				val2 = LimitSpherical(val2);
			}
			if (TwistAngleLimit < 180f)
			{
				val2 = LimitZ(val2);
			}
		}
		else
		{
			val2 = LimitHinge(val2);
		}
		if (!val2.QIsSame(val))
		{
			base.transform.localRotation = LastKeyLocalRotation * val2;
		}
	}

	private Quaternion LimitSpherical(Quaternion rotation)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		if (rotation.QIsZero())
		{
			return rotation;
		}
		Vector3 val = rotation * ForwardOrientation;
		Quaternion val2 = Quaternion.RotateTowards(Quaternion.identity, Quaternion.FromToRotation(ForwardOrientation, val), AngleLimit);
		return Quaternion.FromToRotation(val, val2 * ForwardOrientation) * rotation;
	}

	private Quaternion LimitZ(Quaternion currentRotation)
	{
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = default(Vector3);
		((Vector3)(ref val))..ctor(ForwardOrientation.y, ForwardOrientation.z, ForwardOrientation.x);
		Vector3 val2 = currentRotation * ForwardOrientation;
		Vector3 val3 = val;
		Vector3.OrthoNormalize(ref val2, ref val3);
		val = currentRotation * val;
		Vector3.OrthoNormalize(ref val2, ref val);
		Quaternion val4 = Quaternion.FromToRotation(val, val3) * currentRotation;
		if (TwistAngleLimit <= 0f)
		{
			return val4;
		}
		return Quaternion.RotateTowards(val4, currentRotation, TwistAngleLimit);
	}

	private Quaternion LimitHinge(Quaternion rotation)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0062: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0069: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_006f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c7: Unknown result type (might be due to invalid IL or missing references)
		Quaternion val = Quaternion.FromToRotation(rotation * ForwardOrientation, ForwardOrientation) * rotation * Quaternion.Inverse(PreviousHingeRotation);
		float num = Quaternion.Angle(Quaternion.identity, val);
		Vector3 val2 = default(Vector3);
		((Vector3)(ref val2))..ctor(ForwardOrientation.z, ForwardOrientation.x, ForwardOrientation.y);
		Vector3 val3 = Vector3.Cross(val2, ForwardOrientation);
		if (Vector3.Dot(val * val2, val3) > 0f)
		{
			num = 0f - num;
		}
		PreviousHingeAngle = Mathf.Clamp(PreviousHingeAngle + num, HingeLimits.x, HingeLimits.y);
		PreviousHingeRotation = Quaternion.AngleAxis(PreviousHingeAngle, ForwardOrientation);
		return PreviousHingeRotation;
	}
}


using System;
using FIMSpace.FTools;
using UnityEngine;

[Serializable]
public class FimpIK_Limb : FIK_ProcessorBase
{
	public class IKBone : FIK_IKBoneBase
	{
		[SerializeField]
		private Quaternion targetToLocalSpace;

		[SerializeField]
		private Vector3 defaultLocalPoleNormal;

		public Vector3 right { get; private set; }

		public Vector3 up { get; private set; }

		public Vector3 forward { get; private set; }

		public Vector3 srcPosition { get; private set; }

		public Quaternion srcRotation { get; private set; }

		public IKBone(Transform t)
			: base(t)
		{
		}

		public void Init(Transform root, Vector3 childPosition, Vector3 orientationNormal)
		{
			//IL_0001: Unknown result type (might be due to invalid IL or missing references)
			//IL_0002: Unknown result type (might be due to invalid IL or missing references)
			//IL_0009: Unknown result type (might be due to invalid IL or missing references)
			//IL_0010: Unknown result type (might be due to invalid IL or missing references)
			//IL_0015: Unknown result type (might be due to invalid IL or missing references)
			//IL_001a: Unknown result type (might be due to invalid IL or missing references)
			//IL_002e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0033: Unknown result type (might be due to invalid IL or missing references)
			//IL_0040: Unknown result type (might be due to invalid IL or missing references)
			//IL_0045: Unknown result type (might be due to invalid IL or missing references)
			//IL_0057: Unknown result type (might be due to invalid IL or missing references)
			//IL_005c: Unknown result type (might be due to invalid IL or missing references)
			//IL_006e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0073: Unknown result type (might be due to invalid IL or missing references)
			RefreshOrientations(childPosition, orientationNormal);
			Vector3 val = childPosition - base.transform.position;
			sqrMagn = ((Vector3)(ref val)).sqrMagnitude;
			LastKeyLocalRotation = base.transform.localRotation;
			right = base.transform.InverseTransformDirection(root.right);
			up = base.transform.InverseTransformDirection(root.up);
			forward = base.transform.InverseTransformDirection(root.forward);
			CaptureSourceAnimation();
		}

		public void RefreshOrientations(Vector3 childPosition, Vector3 orientationNormal)
		{
			//IL_0000: Unknown result type (might be due to invalid IL or missing references)
			//IL_0001: Unknown result type (might be due to invalid IL or missing references)
			//IL_000e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0015: Unknown result type (might be due to invalid IL or missing references)
			//IL_001a: Unknown result type (might be due to invalid IL or missing references)
			//IL_001f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0027: Unknown result type (might be due to invalid IL or missing references)
			//IL_0028: Unknown result type (might be due to invalid IL or missing references)
			//IL_0035: Unknown result type (might be due to invalid IL or missing references)
			//IL_0036: Unknown result type (might be due to invalid IL or missing references)
			//IL_0037: Unknown result type (might be due to invalid IL or missing references)
			//IL_003c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0044: Unknown result type (might be due to invalid IL or missing references)
			//IL_0049: Unknown result type (might be due to invalid IL or missing references)
			//IL_004a: Unknown result type (might be due to invalid IL or missing references)
			//IL_004f: Unknown result type (might be due to invalid IL or missing references)
			//IL_005b: Unknown result type (might be due to invalid IL or missing references)
			//IL_0060: Unknown result type (might be due to invalid IL or missing references)
			//IL_0065: Unknown result type (might be due to invalid IL or missing references)
			//IL_0066: Unknown result type (might be due to invalid IL or missing references)
			//IL_006b: Unknown result type (might be due to invalid IL or missing references)
			if (!(orientationNormal == Vector3.zero))
			{
				Vector3 val = childPosition - base.transform.position;
				((Vector3)(ref val)).Normalize();
				if (!(val == Vector3.zero))
				{
					Quaternion rotation = Quaternion.LookRotation(val, orientationNormal);
					targetToLocalSpace = RotationToLocal(base.transform.rotation, rotation);
					defaultLocalPoleNormal = Quaternion.Inverse(base.transform.rotation) * orientationNormal;
				}
			}
		}

		public void CaptureSourceAnimation()
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_0018: Unknown result type (might be due to invalid IL or missing references)
			srcPosition = base.transform.position;
			srcRotation = base.transform.rotation;
		}

		public static Quaternion RotationToLocal(Quaternion parent, Quaternion rotation)
		{
			//IL_0000: Unknown result type (might be due to invalid IL or missing references)
			//IL_0001: Unknown result type (might be due to invalid IL or missing references)
			//IL_0006: Unknown result type (might be due to invalid IL or missing references)
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			return Quaternion.Inverse(Quaternion.Inverse(parent) * rotation);
		}

		public Quaternion GetRotation(Vector3 direction, Vector3 orientationNormal)
		{
			//IL_0000: Unknown result type (might be due to invalid IL or missing references)
			//IL_0001: Unknown result type (might be due to invalid IL or missing references)
			//IL_0002: Unknown result type (might be due to invalid IL or missing references)
			//IL_0008: Unknown result type (might be due to invalid IL or missing references)
			//IL_000d: Unknown result type (might be due to invalid IL or missing references)
			return Quaternion.LookRotation(direction, orientationNormal) * targetToLocalSpace;
		}

		public Vector3 GetCurrentOrientationNormal()
		{
			//IL_0006: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0011: Unknown result type (might be due to invalid IL or missing references)
			return base.transform.rotation * defaultLocalPoleNormal;
		}
	}

	public enum FIK_HintMode
	{
		Default,
		MiddleForward,
		MiddleBack,
		OnGoal,
		EndForward,
		Leg,
		UnityHumanoidIK
	}

	[NonSerialized]
	[Tooltip("3-Bones limb array")]
	private IKBone[] IKBones;

	[Range(0f, 1f)]
	[Tooltip("Blend value for goal position")]
	[Space(4f)]
	public float IKPositionWeight = 1f;

	[Tooltip("Blend value for end bone rotation")]
	[Range(0f, 1f)]
	public float FootRotationWeight = 1f;

	[Tooltip("Flex style algorithm for different limbs")]
	public FIK_HintMode AutoHintMode = FIK_HintMode.MiddleForward;

	protected Vector3 targetElbowNormal = Vector3.right;

	protected Quaternion lateEndBoneRotation;

	protected Quaternion postIKAnimatorEndBoneRot;

	public Vector3 ExtraHintAdjustementOffset = Vector3.zero;

	public bool InverseHint;

	[NonSerialized]
	public float FeetStretchWeight = 1f;

	[NonSerialized]
	public float FeetStretchSensitivity = 1f;

	[NonSerialized]
	public float FeetStretchLimit = 1f;

	[NonSerialized]
	public float FeetFadeQuicker = 1f;

	[NonSerialized]
	public bool disableFeet;

	private float maxFeetAngle;

	private float maxFeetAngleFactor;

	private Vector3 ankleToFeet;

	[NonSerialized]
	public Animator HumanoidAnimator;

	[NonSerialized]
	public bool IsRight;

	private bool everyIsChild = true;

	private bool hasFeet;

	private bool hasRoot;

	[Range(0f, 1f)]
	[HideInInspector]
	public float ManualHintPositionWeight;

	[HideInInspector]
	public Vector3 IKManualHintPosition = Vector3.zero;

	[NonSerialized]
	public bool UseEndBoneMapping = true;

	private float internalRotationWeightMul = 1f;

	public Quaternion EndBoneMapping { get; protected set; }

	public IKBone FeetIKBone => IKBones[3];

	public float ScaleReference { get; protected set; }

	public Transform Root { get; protected set; }

	public IKBone StartIKBone => IKBones[0];

	public IKBone MiddleIKBone => IKBones[1];

	public IKBone EndIKBone => IKBones[2];

	public IKBone EndParentIKBone { get; private set; }

	public int BonesCount => IKBones.Length;

	public override void Update()
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0080: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d4: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00de: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0100: Unknown result type (might be due to invalid IL or missing references)
		//IL_011d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0122: Unknown result type (might be due to invalid IL or missing references)
		//IL_0115: Unknown result type (might be due to invalid IL or missing references)
		//IL_0127: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_012d: Unknown result type (might be due to invalid IL or missing references)
		//IL_012e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0145: Unknown result type (might be due to invalid IL or missing references)
		//IL_0155: Unknown result type (might be due to invalid IL or missing references)
		//IL_015a: Unknown result type (might be due to invalid IL or missing references)
		//IL_015f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0223: Unknown result type (might be due to invalid IL or missing references)
		//IL_0228: Unknown result type (might be due to invalid IL or missing references)
		//IL_0171: Unknown result type (might be due to invalid IL or missing references)
		//IL_0173: Unknown result type (might be due to invalid IL or missing references)
		//IL_0178: Unknown result type (might be due to invalid IL or missing references)
		//IL_017e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0183: Unknown result type (might be due to invalid IL or missing references)
		//IL_0188: Unknown result type (might be due to invalid IL or missing references)
		//IL_01af: Unknown result type (might be due to invalid IL or missing references)
		//IL_01bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_0197: Unknown result type (might be due to invalid IL or missing references)
		//IL_019c: Unknown result type (might be due to invalid IL or missing references)
		//IL_019e: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0210: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_01fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0203: Unknown result type (might be due to invalid IL or missing references)
		if (!base.Initialized)
		{
			return;
		}
		Refresh();
		float num = IKPositionWeight * IKWeight;
		IKBone startIKBone = StartIKBone;
		Vector3 val = MiddleIKBone.transform.position - StartIKBone.transform.position;
		startIKBone.sqrMagn = ((Vector3)(ref val)).sqrMagnitude;
		IKBone middleIKBone = MiddleIKBone;
		val = EndIKBone.transform.position - MiddleIKBone.transform.position;
		middleIKBone.sqrMagn = ((Vector3)(ref val)).sqrMagnitude;
		targetElbowNormal = GetDefaultFlexNormal();
		if (ExtraHintAdjustementOffset != Vector3.zero)
		{
			val = Vector3.Lerp(targetElbowNormal, CalculateElbowNormalToPosition(EndIKBone.transform.position + EndIKBone.transform.rotation * ExtraHintAdjustementOffset), ((Vector3)(ref ExtraHintAdjustementOffset)).magnitude);
			targetElbowNormal = ((Vector3)(ref val)).normalized;
		}
		Vector3 val2 = GetOrientationDirection(IKTargetPosition, InverseHint ? (-targetElbowNormal) : targetElbowNormal);
		if (val2 == Vector3.zero)
		{
			val2 = MiddleIKBone.transform.position - StartIKBone.transform.position;
		}
		if (num > 0f)
		{
			Quaternion val3 = StartIKBone.GetRotation(val2, targetElbowNormal) * base.StartBoneRotationOffset;
			if (num < 1f)
			{
				val3 = Quaternion.LerpUnclamped(StartIKBone.srcRotation, val3, num);
			}
			StartIKBone.transform.rotation = val3;
			Quaternion val4 = MiddleIKBone.GetRotation(IKTargetPosition - MiddleIKBone.transform.position, MiddleIKBone.GetCurrentOrientationNormal());
			if (num < 1f)
			{
				val4 = Quaternion.LerpUnclamped(MiddleIKBone.srcRotation, val4, num);
			}
			MiddleIKBone.transform.rotation = val4;
		}
		postIKAnimatorEndBoneRot = EndIKBone.transform.rotation;
		EndBoneRotation();
	}

	private Vector3 GetAutomaticFlexNormal()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0136: Unknown result type (might be due to invalid IL or missing references)
		//IL_0141: Unknown result type (might be due to invalid IL or missing references)
		//IL_014c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0151: Unknown result type (might be due to invalid IL or missing references)
		//IL_015b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0167: Unknown result type (might be due to invalid IL or missing references)
		//IL_0172: Unknown result type (might be due to invalid IL or missing references)
		//IL_0177: Unknown result type (might be due to invalid IL or missing references)
		//IL_017c: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ef: Unknown result type (might be due to invalid IL or missing references)
		//IL_01fa: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ff: Unknown result type (might be due to invalid IL or missing references)
		//IL_0209: Unknown result type (might be due to invalid IL or missing references)
		//IL_0188: Unknown result type (might be due to invalid IL or missing references)
		//IL_0193: Unknown result type (might be due to invalid IL or missing references)
		//IL_019e: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01be: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01da: Unknown result type (might be due to invalid IL or missing references)
		//IL_01dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_010a: Unknown result type (might be due to invalid IL or missing references)
		//IL_010f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0111: Unknown result type (might be due to invalid IL or missing references)
		//IL_0116: Unknown result type (might be due to invalid IL or missing references)
		//IL_011b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0120: Unknown result type (might be due to invalid IL or missing references)
		//IL_0123: Unknown result type (might be due to invalid IL or missing references)
		//IL_0128: Unknown result type (might be due to invalid IL or missing references)
		//IL_012e: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0075: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0089: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d6: Unknown result type (might be due to invalid IL or missing references)
		//IL_0246: Unknown result type (might be due to invalid IL or missing references)
		//IL_023b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0240: Unknown result type (might be due to invalid IL or missing references)
		Vector3 currentOrientationNormal = StartIKBone.GetCurrentOrientationNormal();
		switch (AutoHintMode)
		{
		case FIK_HintMode.Leg:
		{
			Vector3 val2 = IKTargetRotation * (EndIKBone.forward * internalRotationWeightMul * 2f);
			if (hasRoot)
			{
				val2 += Root.forward * 0.06f;
				Vector3 val3 = Root.InverseTransformPoint(IKTargetPosition);
				val3.y = 0f;
				val2 += (Root.TransformPoint(val3) - Root.position) * 0.025f;
			}
			float num = Vector3.Distance(MiddleIKBone.transform.position, EndIKBone.transform.position) * 0.1f;
			Vector3 val4 = CalculateElbowNormalToPosition(MiddleIKBone.srcPosition + val2 * num);
			return Vector3.LerpUnclamped(((Vector3)(ref currentOrientationNormal)).normalized, val4, 0.85f);
		}
		case FIK_HintMode.MiddleForward:
			return Vector3.LerpUnclamped(((Vector3)(ref currentOrientationNormal)).normalized, MiddleIKBone.srcRotation * MiddleIKBone.right, 0.5f);
		case FIK_HintMode.MiddleBack:
			return MiddleIKBone.srcRotation * -MiddleIKBone.right;
		case FIK_HintMode.EndForward:
		{
			Vector3 val = Vector3.Cross(MiddleIKBone.srcPosition + EndIKBone.srcRotation * EndIKBone.forward - StartIKBone.srcPosition, IKTargetPosition - StartIKBone.srcPosition);
			if (val == Vector3.zero)
			{
				return currentOrientationNormal;
			}
			return val;
		}
		case FIK_HintMode.OnGoal:
			return Vector3.LerpUnclamped(currentOrientationNormal, lateEndBoneRotation * EndIKBone.right, 0.5f);
		case FIK_HintMode.UnityHumanoidIK:
			if (Object.op_Implicit((Object)(object)HumanoidAnimator))
			{
				HumanoidAnimator.logWarnings = false;
				return CalculateElbowNormalToPosition(HumanoidAnimator.GetIKHintPosition((AvatarIKHint)(IsRight ? 1 : 0)));
			}
			break;
		}
		return currentOrientationNormal;
	}

	public void OnDrawGizmos()
	{
		_ = base.Initialized;
	}

	public virtual void SetRootReference(Transform mainParentTransform)
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		Root = mainParentTransform;
		EndBoneMapping = Quaternion.FromToRotation(EndIKBone.right, Vector3.right);
		EndBoneMapping *= Quaternion.FromToRotation(EndIKBone.up, Vector3.up);
		if (Object.op_Implicit((Object)(object)mainParentTransform))
		{
			hasRoot = true;
		}
	}

	public void RefreshLength()
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = StartIKBone.transform.position - MiddleIKBone.transform.position;
		ScaleReference = ((Vector3)(ref val)).magnitude;
	}

	public void RefreshScaleReference()
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = StartIKBone.transform.position - MiddleIKBone.transform.position;
		ScaleReference = ((Vector3)(ref val)).magnitude;
	}

	private float GetCurrentLegToAnkleLength()
	{
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		float epsilon = Mathf.Epsilon;
		Vector3 val = StartIKBone.transform.position - MiddleIKBone.transform.position;
		float num = epsilon + ((Vector3)(ref val)).magnitude;
		val = MiddleIKBone.transform.position - EndIKBone.transform.position;
		return num + ((Vector3)(ref val)).magnitude;
	}

	public float GetStretchValue(Vector3 targetPos)
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = StartIKBone.transform.position - targetPos;
		return ((Vector3)(ref val)).magnitude / GetCurrentLegToAnkleLength();
	}

	public Vector3 GetNotStretchedPositionTowards(Vector3 targetPos, float maxStretch)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = targetPos - StartIKBone.transform.position;
		return StartIKBone.transform.position + ((Vector3)(ref val)).normalized * (GetCurrentLegToAnkleLength() * maxStretch);
	}

	public void ApplyMaxStretchingPreprocessing(float maxStretch, float allowIKRotationFadeout = 2f)
	{
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0271: Unknown result type (might be due to invalid IL or missing references)
		//IL_0277: Unknown result type (might be due to invalid IL or missing references)
		//IL_0287: Unknown result type (might be due to invalid IL or missing references)
		//IL_028c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0291: Unknown result type (might be due to invalid IL or missing references)
		//IL_0294: Unknown result type (might be due to invalid IL or missing references)
		//IL_029b: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f7: Unknown result type (might be due to invalid IL or missing references)
		//IL_0225: Unknown result type (might be due to invalid IL or missing references)
		//IL_022b: Unknown result type (might be due to invalid IL or missing references)
		//IL_023b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0240: Unknown result type (might be due to invalid IL or missing references)
		//IL_0245: Unknown result type (might be due to invalid IL or missing references)
		//IL_0248: Unknown result type (might be due to invalid IL or missing references)
		//IL_024f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0254: Unknown result type (might be due to invalid IL or missing references)
		//IL_0259: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f0: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01fb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0200: Unknown result type (might be due to invalid IL or missing references)
		if (!(maxStretch < 1.1f))
		{
			return;
		}
		Vector3 val = StartIKBone.transform.position - IKTargetPosition;
		float magnitude = ((Vector3)(ref val)).magnitude;
		float currentLegToAnkleLength = GetCurrentLegToAnkleLength();
		float num = magnitude / currentLegToAnkleLength;
		if (num > maxStretch)
		{
			if (hasFeet && FeetStretchWeight > 0f)
			{
				if (maxFeetAngle > 0f)
				{
					Vector3 val2 = IKTargetPosition - StartIKBone.transform.position;
					((Vector3)(ref val2)).Normalize();
					Vector3 val3 = FeetIKBone.transform.position - EndIKBone.transform.position;
					((Vector3)(ref val3)).Normalize();
					float num2 = Vector3.Dot(val2, val3);
					num2 = Mathf.Clamp01(num2);
					val = FeetIKBone.transform.position - EndIKBone.transform.position;
					float magnitude2 = ((Vector3)(ref val)).magnitude;
					float num3 = magnitude - currentLegToAnkleLength * Mathf.Min(maxStretch, 1f);
					num3 /= magnitude2 * FeetFadeQuicker;
					float num4 = num3;
					num3 *= maxFeetAngleFactor * FeetStretchSensitivity;
					if (num3 > 1f)
					{
						num3 = 1f;
					}
					if (num4 < 1f)
					{
						num4 = 1f;
					}
					else
					{
						if (num4 > 2f)
						{
							num4 = 2f;
						}
						num4 -= 1f;
						num4 *= num4;
						num4 = 1f - num4;
					}
					float num5 = Mathf.Min(FeetStretchLimit, (1f - num2) * (90f / maxFeetAngle) * num3 * FeetStretchWeight);
					if (num > 1.09f)
					{
						num4 *= 1f - Mathf.InverseLerp(1.09f, 1.23f, num);
					}
					if (num5 != 0f)
					{
						OffsetHeel(num5, num4);
					}
					val = StartIKBone.transform.position - IKTargetPosition;
					magnitude = ((Vector3)(ref val)).magnitude;
					num = magnitude / currentLegToAnkleLength;
				}
				if (num > maxStretch)
				{
					float num6 = maxStretch * currentLegToAnkleLength;
					Vector3 position = StartIKBone.transform.position;
					val = IKTargetPosition - StartIKBone.transform.position;
					IKTargetPosition = position + ((Vector3)(ref val)).normalized * num6;
				}
			}
			else
			{
				float num7 = maxStretch * currentLegToAnkleLength;
				Vector3 position2 = StartIKBone.transform.position;
				val = IKTargetPosition - StartIKBone.transform.position;
				IKTargetPosition = position2 + ((Vector3)(ref val)).normalized * num7;
			}
			if (allowIKRotationFadeout > 0f)
			{
				float num8 = num - maxStretch;
				num8 = Mathf.Clamp01(num8 * allowIKRotationFadeout);
				internalRotationWeightMul = 1f - num8;
			}
		}
		else
		{
			internalRotationWeightMul = 1f;
		}
	}

	private void PrepareFeet()
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = EndIKBone.transform.position - MiddleIKBone.transform.position;
		((Vector3)(ref val)).Normalize();
		ankleToFeet = FeetIKBone.transform.position - EndIKBone.transform.position;
		((Vector3)(ref ankleToFeet)).Normalize();
		maxFeetAngle = Vector3.Angle(ankleToFeet, val);
		maxFeetAngleFactor = 90f / maxFeetAngle;
	}

	internal void OffsetHeel(float heelRot, float feetCompensate = 1f)
	{
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003e: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_0099: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_011b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0120: Unknown result type (might be due to invalid IL or missing references)
		//IL_0121: Unknown result type (might be due to invalid IL or missing references)
		//IL_0126: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0107: Unknown result type (might be due to invalid IL or missing references)
		//IL_010c: Unknown result type (might be due to invalid IL or missing references)
		//IL_010f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e8: Unknown result type (might be due to invalid IL or missing references)
		if (!hasFeet || disableFeet)
		{
			return;
		}
		Quaternion iKTargetRotation = IKTargetRotation;
		Vector3 val = FeetIKBone.transform.position - EndIKBone.transform.position;
		Vector3 val2 = Quaternion.Inverse(iKTargetRotation) * val;
		Vector3 val3 = ((!UseEndBoneMapping) ? (IKTargetRotation * EndIKBone.right) : (IKTargetRotation * Vector3.right));
		Quaternion val4 = Quaternion.AngleAxis(heelRot * maxFeetAngle, val3);
		val2 = (IKTargetRotation = val4 * iKTargetRotation) * val2 - val;
		if (feetCompensate > 0f)
		{
			Quaternion val5 = Quaternion.Inverse(val4) * FeetIKBone.transform.rotation;
			if (feetCompensate >= 1f)
			{
				FeetIKBone.transform.rotation = val5;
			}
			else
			{
				FeetIKBone.transform.rotation = Quaternion.Lerp(FeetIKBone.transform.rotation, val5, feetCompensate);
			}
		}
		IKTargetPosition -= val2;
	}

	public IKBone GetBone(int index)
	{
		return IKBones[index];
	}

	public override void Init(Transform root)
	{
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00de: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fe: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_0068: Unknown result type (might be due to invalid IL or missing references)
		if (!base.Initialized)
		{
			Vector3 val = Vector3.Cross(MiddleIKBone.transform.position - StartIKBone.transform.position, EndIKBone.transform.position - MiddleIKBone.transform.position);
			if (val != Vector3.zero)
			{
				targetElbowNormal = val;
			}
			base.fullLength = 0f;
			StartIKBone.Init(root, MiddleIKBone.transform.position, targetElbowNormal);
			MiddleIKBone.Init(root, EndIKBone.transform.position, targetElbowNormal);
			EndIKBone.Init(root, EndIKBone.transform.position + (EndIKBone.transform.position - MiddleIKBone.transform.position), targetElbowNormal);
			base.fullLength = base.Bones[0].BoneLength + base.Bones[1].BoneLength;
			RefreshDefaultFlexNormal();
			if ((Object)(object)EndIKBone.transform.parent != (Object)(object)MiddleIKBone.transform)
			{
				everyIsChild = false;
			}
			else if ((Object)(object)MiddleIKBone.transform.parent != (Object)(object)StartIKBone.transform)
			{
				everyIsChild = false;
			}
			else
			{
				everyIsChild = true;
			}
			SetRootReference(root);
			if (Application.isPlaying)
			{
				base.Initialized = true;
			}
			if (hasFeet)
			{
				PrepareFeet();
			}
			if (everyIsChild)
			{
				EndParentIKBone = MiddleIKBone;
			}
			else
			{
				EndParentIKBone = new IKBone(EndIKBone.transform.parent);
			}
		}
	}

	public void SetBones(Transform startBone, Transform midBone, Transform endBone)
	{
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0094: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		IKBones = new IKBone[3];
		IKBones[0] = new IKBone(startBone);
		IKBones[1] = new IKBone(midBone);
		IKBones[2] = new IKBone(endBone);
		base.Bones = new FIK_IKBoneBase[3]
		{
			IKBones[0],
			IKBones[1],
			IKBones[2]
		};
		IKBones[0].SetChild(IKBones[1]);
		IKBones[1].SetChild(IKBones[2]);
		IKTargetPosition = endBone.position;
		IKTargetRotation = endBone.rotation;
	}

	public void SetLegWithFeet(Transform startBone, Transform midBone, Transform endBone, Transform feet)
	{
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ca: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cf: Unknown result type (might be due to invalid IL or missing references)
		IKBones = new IKBone[4];
		IKBones[0] = new IKBone(startBone);
		IKBones[1] = new IKBone(midBone);
		IKBones[2] = new IKBone(endBone);
		IKBones[3] = new IKBone(feet);
		base.Bones = new FIK_IKBoneBase[4]
		{
			IKBones[0],
			IKBones[1],
			IKBones[2],
			IKBones[3]
		};
		IKBones[0].SetChild(IKBones[1]);
		IKBones[1].SetChild(IKBones[2]);
		IKBones[2].SetChild(IKBones[3]);
		IKTargetPosition = endBone.position;
		IKTargetRotation = endBone.rotation;
		hasFeet = true;
	}

	public void SetBones(Transform startBone, Transform endBone)
	{
		SetBones(startBone, endBone.parent, endBone);
	}

	protected virtual void Refresh()
	{
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		RefreshAnimatorCoords();
		if (!everyIsChild)
		{
			MiddleIKBone.RefreshOrientations(EndIKBone.transform.position, targetElbowNormal);
		}
	}

	protected virtual void EndBoneRotation()
	{
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		float num = FootRotationWeight * IKWeight * internalRotationWeightMul;
		if (num > 0f)
		{
			if (UseEndBoneMapping)
			{
				if (num < 1f)
				{
					EndIKBone.transform.rotation = Quaternion.SlerpUnclamped(postIKAnimatorEndBoneRot, IKTargetRotation * EndBoneMapping, num);
				}
				else
				{
					EndIKBone.transform.rotation = IKTargetRotation * EndBoneMapping;
				}
			}
			else if (num < 1f)
			{
				EndIKBone.transform.rotation = Quaternion.SlerpUnclamped(postIKAnimatorEndBoneRot, IKTargetRotation, num);
			}
			else
			{
				EndIKBone.transform.rotation = IKTargetRotation;
			}
		}
		lateEndBoneRotation = EndIKBone.transform.rotation;
	}

	public override void PreCalibrate()
	{
		base.PreCalibrate();
		RefreshScaleReference();
	}

	public void RefreshAnimatorCoords()
	{
		StartIKBone.CaptureSourceAnimation();
		MiddleIKBone.CaptureSourceAnimation();
		EndIKBone.CaptureSourceAnimation();
		if (!everyIsChild && MiddleIKBone != EndParentIKBone)
		{
			EndParentIKBone.CaptureSourceAnimation();
		}
	}

	protected Vector3 GetDefaultFlexNormal()
	{
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		if (ManualHintPositionWeight > 0f)
		{
			if (ManualHintPositionWeight >= 1f)
			{
				return CalculateElbowNormalToPosition(IKManualHintPosition);
			}
			Vector3 automaticFlexNormal = GetAutomaticFlexNormal();
			return Vector3.LerpUnclamped(((Vector3)(ref automaticFlexNormal)).normalized, CalculateElbowNormalToPosition(IKManualHintPosition), ManualHintPositionWeight);
		}
		return GetAutomaticFlexNormal();
	}

	public Vector3 CalculateElbowNormalToPosition(Vector3 targetElbowPos)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		return Vector3.Cross(targetElbowPos - StartIKBone.transform.position, EndIKBone.transform.position - StartIKBone.transform.position);
	}

	public void RefreshDefaultFlexNormal()
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = Vector3.Cross(MiddleIKBone.transform.position - StartIKBone.transform.position, EndIKBone.transform.position - MiddleIKBone.transform.position);
		if (val != Vector3.zero)
		{
			targetElbowNormal = val;
		}
	}

	protected Vector3 GetOrientationDirection(Vector3 ikPosition, Vector3 orientationNormal)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_008d: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ikPosition - StartIKBone.transform.position;
		if (val == Vector3.zero)
		{
			return Vector3.zero;
		}
		float sqrMagnitude = ((Vector3)(ref val)).sqrMagnitude;
		float num = Mathf.Sqrt(sqrMagnitude);
		float num2 = (sqrMagnitude + StartIKBone.sqrMagn - MiddleIKBone.sqrMagn) / 2f / num;
		float num3 = Mathf.Sqrt(Mathf.Clamp(StartIKBone.sqrMagn - num2 * num2, 0f, float.PositiveInfinity));
		Vector3 val2 = Vector3.Cross(val / num, orientationNormal);
		return Quaternion.LookRotation(val, val2) * new Vector3(0f, num3, num2);
	}
}


using UnityEngine;

public class IKBone : FIK_IKBoneBase
{
	[SerializeField]
	private Quaternion targetToLocalSpace;

	[SerializeField]
	private Vector3 defaultLocalPoleNormal;

	public Vector3 right { get; private set; }

	public Vector3 up { get; private set; }

	public Vector3 forward { get; private set; }

	public Vector3 srcPosition { get; private set; }

	public Quaternion srcRotation { get; private set; }

	public IKBone(Transform t)
		: base(t)
	{
	}

	public void Init(Transform root, Vector3 childPosition, Vector3 orientationNormal)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_006e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		RefreshOrientations(childPosition, orientationNormal);
		Vector3 val = childPosition - base.transform.position;
		sqrMagn = ((Vector3)(ref val)).sqrMagnitude;
		LastKeyLocalRotation = base.transform.localRotation;
		right = base.transform.InverseTransformDirection(root.right);
		up = base.transform.InverseTransformDirection(root.up);
		forward = base.transform.InverseTransformDirection(root.forward);
		CaptureSourceAnimation();
	}

	public void RefreshOrientations(Vector3 childPosition, Vector3 orientationNormal)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		//IL_001a: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		if (!(orientationNormal == Vector3.zero))
		{
			Vector3 val = childPosition - base.transform.position;
			((Vector3)(ref val)).Normalize();
			if (!(val == Vector3.zero))
			{
				Quaternion rotation = Quaternion.LookRotation(val, orientationNormal);
				targetToLocalSpace = RotationToLocal(base.transform.rotation, rotation);
				defaultLocalPoleNormal = Quaternion.Inverse(base.transform.rotation) * orientationNormal;
			}
		}
	}

	public void CaptureSourceAnimation()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		srcPosition = base.transform.position;
		srcRotation = base.transform.rotation;
	}

	public static Quaternion RotationToLocal(Quaternion parent, Quaternion rotation)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		return Quaternion.Inverse(Quaternion.Inverse(parent) * rotation);
	}

	public Quaternion GetRotation(Vector3 direction, Vector3 orientationNormal)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		return Quaternion.LookRotation(direction, orientationNormal) * targetToLocalSpace;
	}

	public Vector3 GetCurrentOrientationNormal()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		return base.transform.rotation * defaultLocalPoleNormal;
	}
}


public enum FIK_HintMode
{
	Default,
	MiddleForward,
	MiddleBack,
	OnGoal,
	EndForward,
	Leg,
	UnityHumanoidIK
}


using FIMSpace.FTools;
using UnityEngine;

public class FElasticTransform
{
	public Transform transform;

	private FElasticTransform elChild;

	private FElasticTransform elParent;

	[FPD_Suffix(0f, 1f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float RotationRapidness = 0.1f;

	private Quaternion proceduralRotation;

	private float delta = 0.01f;

	public FMuscle_Vector3 PositionMuscle { get; private set; }

	public Vector3 ProceduralPosition { get; private set; }

	public Vector3 sourceAnimationPosition { get; private set; }

	public void Initialize(Transform transform)
	{
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		if (!((Object)(object)transform == (Object)null))
		{
			this.transform = transform;
			ProceduralPosition = transform.position;
			proceduralRotation = transform.rotation;
			sourceAnimationPosition = transform.position;
			PositionMuscle = new FMuscle_Vector3();
			PositionMuscle.Initialize(transform.position);
		}
	}

	public void OverrideProceduralPosition(Vector3 newPos)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		ProceduralPosition = newPos;
	}

	public void OverrideProceduralPositionHard(Vector3 newPos)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		ProceduralPosition = newPos;
		PositionMuscle.OverrideProceduralPosition(newPos);
		sourceAnimationPosition = newPos;
	}

	public void OverrideProceduralRotation(Quaternion newRot)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		proceduralRotation = newRot;
	}

	public void CaptureSourceAnimation()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		sourceAnimationPosition = transform.position;
	}

	public void SetChild(FElasticTransform child)
	{
		elChild = child;
	}

	public FElasticTransform GetElasticChild()
	{
		return elChild;
	}

	public void SetParent(FElasticTransform parent)
	{
		elParent = parent;
	}

	public void UpdateElasticPosition(float delta)
	{
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		this.delta = delta;
		if (elParent != null)
		{
			FElasticTransform obj = (((Object)(object)elParent.transform == (Object)null) ? elParent.elParent : elParent);
			Quaternion rotation = obj.transform.rotation;
			Vector3 desired = obj.ProceduralPosition + rotation * transform.localPosition;
			PositionMuscle.Update(delta, desired);
			ProceduralPosition = PositionMuscle.ProceduralPosition;
		}
		else
		{
			ProceduralPosition = transform.position;
		}
	}

	public void UpdateElasticPosition(float delta, Vector3 influenceOffset)
	{
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Unknown result type (might be due to invalid IL or missing references)
		this.delta = delta;
		if (elParent != null)
		{
			PositionMuscle.MotionInfluence(influenceOffset);
			UpdateElasticPosition(delta);
		}
		else
		{
			ProceduralPosition = transform.position;
		}
	}

	public void UpdateElasticRotation(float blending)
	{
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		if (elChild != null)
		{
			Quaternion val = ((!(blending < 1f)) ? GetTargetRotation(elChild.ProceduralPosition, transform.TransformDirection(elChild.transform.localPosition), ProceduralPosition) : GetTargetRotation(elChild.BlendVector(elChild.ProceduralPosition, blending), transform.TransformDirection(elChild.transform.localPosition), blending));
			if (RotationRapidness < 1f)
			{
				proceduralRotation = Quaternion.Lerp(proceduralRotation, val, Mathf.Min(1f, delta * (10f + RotationRapidness * 50f)));
				transform.rotation = proceduralRotation;
			}
			else
			{
				transform.rotation = val;
			}
		}
	}

	public Vector3 BlendVector(Vector3 target, float blend)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		return Vector3.LerpUnclamped(sourceAnimationPosition, target, blend);
	}

	public Quaternion GetTargetRotation(Vector3 lookPos, Vector3 localOffset, float blending)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0004: Unknown result type (might be due to invalid IL or missing references)
		//IL_000a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = lookPos - BlendVector(ProceduralPosition, blending);
		return Quaternion.FromToRotation(localOffset, ((Vector3)(ref val)).normalized) * transform.rotation;
	}

	public Quaternion GetTargetRotation(Vector3 lookPos, Vector3 localOffset, Vector3 pos)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = lookPos - pos;
		return Quaternion.FromToRotation(localOffset, ((Vector3)(ref val)).normalized) * transform.rotation;
	}
}


using UnityEngine;

public abstract class FMuscle_Motor
{
	protected float proceduralValue;

	protected float dampingAcceleration;

	protected float dynamicAcceleration;

	protected float accelerationSign;

	public float OutValue { get; protected set; }

	public bool IsWorking()
	{
		return dynamicAcceleration != 0f;
	}

	public void Push(float value)
	{
		dynamicAcceleration += value;
	}

	public void Initialize(float initValue)
	{
		OutValue = initValue;
		proceduralValue = initValue;
		dampingAcceleration = 0f;
		dynamicAcceleration = 0f;
		accelerationSign = 0f;
	}

	protected abstract float GetDiff(float current, float desired);

	public void Update(float delta, float current, float desired, float acceleration, float accelerationLimit, float damping, float brakePower)
	{
		float diff = GetDiff(current, desired);
		accelerationSign = Mathf.Sign(diff);
		dampingAcceleration = diff;
		dampingAcceleration = Mathf.Clamp(dampingAcceleration, 0f - damping, damping) * damping;
		float num = dampingAcceleration * delta;
		if (diff > 0f)
		{
			if (num > diff)
			{
				num = diff;
			}
		}
		else if (num < diff)
		{
			num = diff;
		}
		proceduralValue += num;
		float num2 = 1f;
		if (Mathf.Sign(dynamicAcceleration) != accelerationSign)
		{
			num2 = 1f + Mathf.Abs(diff) / ((1f - brakePower) * 10f + 8f);
		}
		float num3 = diff;
		if (num3 < 0f)
		{
			num3 = 0f - num3;
		}
		float num4 = 5f + (1f - brakePower) * 85f;
		if (num3 < num4)
		{
			num2 *= Mathf.Min(1f, num3 / num4);
		}
		if (num2 < 0f)
		{
			num2 = 0f - num2;
		}
		if (delta > 0.04f)
		{
			delta = 0.04f;
		}
		dynamicAcceleration += acceleration * accelerationSign * delta * num2;
		dynamicAcceleration = Mathf.Clamp(dynamicAcceleration, 0f - accelerationLimit, accelerationLimit);
		if (dynamicAcceleration < 5E-06f && dynamicAcceleration > -5E-06f)
		{
			dynamicAcceleration = 0f;
		}
		proceduralValue += dynamicAcceleration * delta;
		OutValue = proceduralValue;
	}

	public void OverrideValue(float newValue)
	{
		proceduralValue = newValue;
	}

	public void OffsetValue(float off)
	{
		proceduralValue += off;
	}
}


using FIMSpace.FTools;

public class FMuscle_Float : FMuscle_Motor
{
	protected override float GetDiff(float current, float desired)
	{
		return desired - current;
	}
}


using FIMSpace.FTools;
using UnityEngine;

public class FMuscle_Angle : FMuscle_Motor
{
	protected override float GetDiff(float current, float desired)
	{
		return Mathf.DeltaAngle(current, desired);
	}
}


using System;
using System.Collections;
using FIMSpace.FTools;
using UnityEngine;

[Serializable]
public class FMuscle_Vector3
{
	[HideInInspector]
	public Vector3 DesiredPosition;

	private FMuscle_Float x;

	private FMuscle_Float y;

	private FMuscle_Float z;

	[FPD_Suffix(0f, 10000f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float Acceleration = 10000f;

	[FPD_Suffix(0f, 10000f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float AccelerationLimit = 5000f;

	[FPD_Suffix(0f, 50f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float Damping = 10f;

	[FPD_Suffix(0f, 1f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float BrakePower = 0.2f;

	public Vector3 ProceduralPosition { get; private set; }

	public bool Initialized { get; private set; }

	public void Initialize(Vector3 initPosition)
	{
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		x = new FMuscle_Float();
		y = new FMuscle_Float();
		z = new FMuscle_Float();
		x.Initialize(initPosition.x);
		y.Initialize(initPosition.y);
		z.Initialize(initPosition.z);
		ProceduralPosition = initPosition;
		Initialized = true;
	}

	public bool IsWorking()
	{
		if (!x.IsWorking() && !y.IsWorking())
		{
			return z.IsWorking();
		}
		return true;
	}

	public void Push(Vector3 value)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		x.Push(value.x);
		y.Push(value.y);
		z.Push(value.z);
	}

	public void Reset(Vector3 value)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		x.Initialize(value.x);
		y.Initialize(value.y);
		z.Initialize(value.z);
	}

	public void Push(float v)
	{
		x.Push(v);
		y.Push(v);
		z.Push(v);
	}

	public void MotionInfluence(Vector3 offset)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		x.OffsetValue(offset.x);
		y.OffsetValue(offset.y);
		z.OffsetValue(offset.z);
		ProceduralPosition += offset;
	}

	public void Update(float delta, Vector3 desired, float acceleration, float accelerationLimit, float damping, float brakePower)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		x.Update(delta, ProceduralPosition.x, desired.x, acceleration, accelerationLimit, damping, brakePower);
		y.Update(delta, ProceduralPosition.y, desired.y, acceleration, accelerationLimit, damping, brakePower);
		z.Update(delta, ProceduralPosition.z, desired.z, acceleration, accelerationLimit, damping, brakePower);
		ProceduralPosition = new Vector3(x.OutValue, y.OutValue, z.OutValue);
	}

	public Vector3 Update(float delta, Vector3 desired)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		x.Update(delta, ProceduralPosition.x, desired.x, Acceleration, AccelerationLimit, Damping, BrakePower);
		y.Update(delta, ProceduralPosition.y, desired.y, Acceleration, AccelerationLimit, Damping, BrakePower);
		z.Update(delta, ProceduralPosition.z, desired.z, Acceleration, AccelerationLimit, Damping, BrakePower);
		ProceduralPosition = new Vector3(x.OutValue, y.OutValue, z.OutValue);
		return ProceduralPosition;
	}

	public IEnumerator PushImpulseCoroutine(Vector3 power, float duration, bool fadeOutPower = false, float delay = 0f)
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		if (delay > 0f)
		{
			yield return (object)new WaitForSeconds(delay);
		}
		float elapsed = 0f;
		Push(0.0001f);
		while (elapsed / duration < 1f)
		{
			if (!fadeOutPower)
			{
				Push(power * Time.deltaTime * 60f);
			}
			else
			{
				Push(power * (1f - elapsed / duration) * Time.deltaTime * 60f);
			}
			elapsed += Time.deltaTime;
			yield return null;
		}
	}

	public static void Lerp(ref FMuscle_Vector3 source, FMuscle_Vector3 a, FMuscle_Vector3 b, float t)
	{
		if (a != null && b != null && source != null)
		{
			source.Acceleration = Mathf.LerpUnclamped(a.Acceleration, b.Acceleration, t);
			source.AccelerationLimit = Mathf.LerpUnclamped(a.AccelerationLimit, b.AccelerationLimit, t);
			source.BrakePower = Mathf.LerpUnclamped(a.BrakePower, b.BrakePower, t);
			source.Damping = Mathf.LerpUnclamped(a.Damping, b.Damping, t);
		}
	}

	public void OverrideProceduralPosition(Vector3 newPos)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		ProceduralPosition = newPos;
		DesiredPosition = newPos;
		x.OverrideValue(newPos.x);
		y.OverrideValue(newPos.y);
		z.OverrideValue(newPos.z);
	}
}


using System;
using System.Collections;
using FIMSpace.FTools;
using UnityEngine;

[Serializable]
public class FMuscle_Quaternion
{
	[HideInInspector]
	public Quaternion DesiredRotation;

	private FMuscle_Float x;

	private FMuscle_Float y;

	private FMuscle_Float z;

	private FMuscle_Float w;

	[FPD_Suffix(0f, 10000f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float Acceleration = 5000f;

	[FPD_Suffix(0f, 10000f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float AccelerationLimit = 1000f;

	[FPD_Suffix(0f, 50f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float Damping = 10f;

	[FPD_Suffix(0f, 1f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float BrakePower = 0.2f;

	public Quaternion ProceduralRotation { get; private set; }

	public bool IsCorrect => x != null;

	public void Initialize(Quaternion initRotation)
	{
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_0071: Unknown result type (might be due to invalid IL or missing references)
		x = new FMuscle_Float();
		y = new FMuscle_Float();
		z = new FMuscle_Float();
		w = new FMuscle_Float();
		x.Initialize(initRotation.x);
		y.Initialize(initRotation.y);
		z.Initialize(initRotation.z);
		w.Initialize(initRotation.w);
		ProceduralRotation = initRotation;
	}

	public bool IsWorking()
	{
		if (!x.IsWorking() && !y.IsWorking() && !z.IsWorking())
		{
			return w.IsWorking();
		}
		return true;
	}

	public void Push(Quaternion value)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		x.Push(value.x);
		y.Push(value.y);
		z.Push(value.z);
		w.Push(value.w);
	}

	public void Push(float v)
	{
		x.Push(v);
		y.Push(v);
		z.Push(v);
		w.Push(v);
	}

	public void Push(Quaternion value, float multiply)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		x.Push(value.x * multiply);
		y.Push(value.y * multiply);
		z.Push(value.z * multiply);
		w.Push(value.w * multiply);
	}

	public void Update(float delta, Quaternion desired, float acceleration, float accelerationLimit, float damping, float brakePower)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bd: Unknown result type (might be due to invalid IL or missing references)
		x.Update(delta, ProceduralRotation.x, desired.x, acceleration, accelerationLimit, damping, brakePower);
		y.Update(delta, ProceduralRotation.y, desired.y, acceleration, accelerationLimit, damping, brakePower);
		z.Update(delta, ProceduralRotation.z, desired.z, acceleration, accelerationLimit, damping, brakePower);
		w.Update(delta, ProceduralRotation.w, desired.w, acceleration, accelerationLimit, damping, brakePower);
		ProceduralRotation = new Quaternion(x.OutValue, y.OutValue, z.OutValue, w.OutValue);
	}

	public void Update(float delta, Quaternion desired)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_0101: Unknown result type (might be due to invalid IL or missing references)
		x.Update(delta, ProceduralRotation.x, desired.x, Acceleration, AccelerationLimit, Damping, BrakePower);
		y.Update(delta, ProceduralRotation.y, desired.y, Acceleration, AccelerationLimit, Damping, BrakePower);
		z.Update(delta, ProceduralRotation.z, desired.z, Acceleration, AccelerationLimit, Damping, BrakePower);
		w.Update(delta, ProceduralRotation.w, desired.w, Acceleration, AccelerationLimit, Damping, BrakePower);
		ProceduralRotation = new Quaternion(x.OutValue, y.OutValue, z.OutValue, w.OutValue);
	}

	public void UpdateEnsured(float delta, Quaternion desired)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		Update(delta, EnsureQuaternionContinuity(ProceduralRotation, desired));
	}

	public static Quaternion EnsureQuaternionContinuity(Quaternion latestRot, Quaternion targetRot)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		Quaternion val = default(Quaternion);
		((Quaternion)(ref val))..ctor(0f - targetRot.x, 0f - targetRot.y, 0f - targetRot.z, 0f - targetRot.w);
		Quaternion val2 = default(Quaternion);
		((Quaternion)(ref val2))..ctor(Mathf.LerpUnclamped(latestRot.x, targetRot.x, 0.5f), Mathf.LerpUnclamped(latestRot.y, targetRot.y, 0.5f), Mathf.LerpUnclamped(latestRot.z, targetRot.z, 0.5f), Mathf.LerpUnclamped(latestRot.w, targetRot.w, 0.5f));
		Quaternion val3 = default(Quaternion);
		((Quaternion)(ref val3))..ctor(Mathf.LerpUnclamped(latestRot.x, val.x, 0.5f), Mathf.LerpUnclamped(latestRot.y, val.y, 0.5f), Mathf.LerpUnclamped(latestRot.z, val.z, 0.5f), Mathf.LerpUnclamped(latestRot.w, val.w, 0.5f));
		float num = Quaternion.Angle(latestRot, val2);
		if (!(Quaternion.Angle(latestRot, val3) < num))
		{
			return targetRot;
		}
		return val;
	}

	public IEnumerator PushImpulseCoroutine(Quaternion power, float duration, bool fadeOutPower = false, float delay = 0f)
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		if (delay > 0f)
		{
			yield return (object)new WaitForSeconds(delay);
		}
		float elapsed = 0f;
		Push(0.001f);
		while (elapsed / duration < 1f)
		{
			if (!fadeOutPower)
			{
				Push(power, Time.deltaTime * 60f);
			}
			else
			{
				Push(power, (1f - elapsed / duration) * Time.deltaTime * 60f);
			}
			elapsed += Time.deltaTime;
			yield return null;
		}
	}

	public static void Lerp(ref FMuscle_Quaternion source, FMuscle_Quaternion a, FMuscle_Quaternion b, float t)
	{
		if (a != null && b != null && source != null)
		{
			source.Acceleration = Mathf.LerpUnclamped(a.Acceleration, b.Acceleration, t);
			source.AccelerationLimit = Mathf.LerpUnclamped(a.AccelerationLimit, b.AccelerationLimit, t);
			source.BrakePower = Mathf.LerpUnclamped(a.BrakePower, b.BrakePower, t);
			source.Damping = Mathf.LerpUnclamped(a.Damping, b.Damping, t);
		}
	}

	public void OverrideProceduralRotation(Quaternion rotation)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		ProceduralRotation = rotation;
		DesiredRotation = rotation;
		x.OverrideValue(rotation.x);
		y.OverrideValue(rotation.y);
		z.OverrideValue(rotation.z);
		w.OverrideValue(rotation.w);
	}
}


using System;
using System.Collections;
using FIMSpace.FTools;
using UnityEngine;

[Serializable]
public class FMuscle_Eulers
{
	[HideInInspector]
	public Vector3 DesiredEulerAngles;

	private FMuscle_Angle x;

	private FMuscle_Angle y;

	private FMuscle_Angle z;

	[FPD_Suffix(0f, 10000f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float Acceleration = 5000f;

	[FPD_Suffix(0f, 10000f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float AccelerationLimit = 1000f;

	[FPD_Suffix(0f, 50f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float Damping = 10f;

	[FPD_Suffix(0f, 1f, FPD_SuffixAttribute.SuffixMode.From0to100, "%", true, 0)]
	public float BrakePower = 0.2f;

	public Vector3 ProceduralEulerAngles { get; private set; }

	public Quaternion ProceduralRotation => Quaternion.Euler(ProceduralEulerAngles);

	public void Initialize(Vector3 initEulerAngles)
	{
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_0049: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		x = new FMuscle_Angle();
		y = new FMuscle_Angle();
		z = new FMuscle_Angle();
		x.Initialize(initEulerAngles.x);
		y.Initialize(initEulerAngles.y);
		z.Initialize(initEulerAngles.z);
		ProceduralEulerAngles = initEulerAngles;
	}

	public void Initialize(Quaternion initRotation)
	{
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		Initialize(((Quaternion)(ref initRotation)).eulerAngles);
	}

	public bool IsWorking()
	{
		if (!x.IsWorking() && !y.IsWorking())
		{
			return z.IsWorking();
		}
		return true;
	}

	public void Push(Vector3 value)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		x.Push(value.x);
		y.Push(value.y);
		z.Push(value.z);
	}

	public void Push(float v)
	{
		x.Push(v);
		y.Push(v);
		z.Push(v);
	}

	public void Push(Vector3 value, float multiply)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		x.Push(value.x * multiply);
		y.Push(value.y * multiply);
		z.Push(value.z * multiply);
	}

	public void Update(float delta, Vector3 desired, float acceleration, float accelerationLimit, float damping, float brakePower)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008e: Unknown result type (might be due to invalid IL or missing references)
		x.Update(delta, ProceduralEulerAngles.x, desired.x, acceleration, accelerationLimit, damping, brakePower);
		y.Update(delta, ProceduralEulerAngles.y, desired.y, acceleration, accelerationLimit, damping, brakePower);
		z.Update(delta, ProceduralEulerAngles.z, desired.z, acceleration, accelerationLimit, damping, brakePower);
		ProceduralEulerAngles = new Vector3(x.OutValue, y.OutValue, z.OutValue);
	}

	public Vector3 Update(float delta, Vector3 desired)
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		x.Update(delta, ProceduralEulerAngles.x, desired.x, Acceleration, AccelerationLimit, Damping, BrakePower);
		y.Update(delta, ProceduralEulerAngles.y, desired.y, Acceleration, AccelerationLimit, Damping, BrakePower);
		z.Update(delta, ProceduralEulerAngles.z, desired.z, Acceleration, AccelerationLimit, Damping, BrakePower);
		ProceduralEulerAngles = new Vector3(x.OutValue, y.OutValue, z.OutValue);
		return ProceduralEulerAngles;
	}

	public void Update(float delta, Quaternion desired)
	{
		//IL_0004: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		Update(delta, ((Quaternion)(ref desired)).eulerAngles);
	}

	public IEnumerator PushImpulseCoroutine(Vector3 power, float duration, bool fadeOutPower = false, float delay = 0f)
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		if (delay > 0f)
		{
			yield return (object)new WaitForSeconds(delay);
		}
		float elapsed = 0f;
		Push(0.001f);
		while (elapsed / duration < 1f)
		{
			if (!fadeOutPower)
			{
				Push(power, Time.deltaTime * 60f);
			}
			else
			{
				Push(power, (1f - elapsed / duration) * Time.deltaTime * 60f);
			}
			elapsed += Time.deltaTime;
			yield return null;
		}
	}

	public static void Lerp(ref FMuscle_Eulers source, FMuscle_Eulers a, FMuscle_Eulers b, float t)
	{
		if (a != null && b != null && source != null)
		{
			source.Acceleration = Mathf.LerpUnclamped(a.Acceleration, b.Acceleration, t);
			source.AccelerationLimit = Mathf.LerpUnclamped(a.AccelerationLimit, b.AccelerationLimit, t);
			source.BrakePower = Mathf.LerpUnclamped(a.BrakePower, b.BrakePower, t);
			source.Damping = Mathf.LerpUnclamped(a.Damping, b.Damping, t);
		}
	}
}


using FIMSpace;
using FIMSpace.FTools;
using UnityEngine;

public class UniRotateBone
{
	private Vector3 dynamicUpReference = Vector3.up;

	public Transform transform { get; protected set; }

	public Vector3 initialLocalPosition { get; protected set; }

	public Quaternion initialLocalRotation { get; protected set; }

	public Vector3 initialLocalPositionInRootSpace { get; protected set; }

	public Quaternion initialLocalRotationInRootSpace { get; protected set; }

	public Vector3 right { get; protected set; }

	public Vector3 up { get; protected set; }

	public Vector3 forward { get; protected set; }

	public Vector3 dright { get; protected set; }

	public Vector3 dup { get; protected set; }

	public Vector3 dforward { get; protected set; }

	public Vector3 fromParentForward { get; protected set; }

	public Vector3 fromParentCross { get; protected set; }

	public Vector3 keyframedPosition { get; protected set; }

	public Quaternion keyframedRotation { get; protected set; }

	public Quaternion mapping { get; protected set; }

	public Quaternion dmapping { get; protected set; }

	public Transform root { get; protected set; }

	public Vector3 forwardReference { get; private set; }

	public Vector3 upReference { get; private set; }

	public Vector3 rightCrossReference { get; private set; }

	public UniRotateBone(Transform t, Transform root)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00dc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0101: Unknown result type (might be due to invalid IL or missing references)
		//IL_0106: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_0135: Unknown result type (might be due to invalid IL or missing references)
		//IL_011f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0124: Unknown result type (might be due to invalid IL or missing references)
		//IL_0127: Unknown result type (might be due to invalid IL or missing references)
		//IL_0141: Unknown result type (might be due to invalid IL or missing references)
		//IL_0147: Unknown result type (might be due to invalid IL or missing references)
		//IL_014c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0151: Unknown result type (might be due to invalid IL or missing references)
		//IL_015d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0162: Unknown result type (might be due to invalid IL or missing references)
		//IL_0167: Unknown result type (might be due to invalid IL or missing references)
		//IL_0173: Unknown result type (might be due to invalid IL or missing references)
		//IL_0179: Unknown result type (might be due to invalid IL or missing references)
		//IL_017e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0183: Unknown result type (might be due to invalid IL or missing references)
		//IL_0188: Unknown result type (might be due to invalid IL or missing references)
		//IL_0194: Unknown result type (might be due to invalid IL or missing references)
		//IL_0199: Unknown result type (might be due to invalid IL or missing references)
		//IL_019e: Unknown result type (might be due to invalid IL or missing references)
		//IL_01aa: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_01bf: Unknown result type (might be due to invalid IL or missing references)
		transform = t;
		initialLocalPosition = transform.localPosition;
		initialLocalRotation = transform.localRotation;
		if (Object.op_Implicit((Object)(object)root))
		{
			initialLocalPositionInRootSpace = root.InverseTransformPoint(t.position);
			initialLocalRotationInRootSpace = root.rotation.QToLocal(t.rotation);
		}
		forward = transform.InverseTransformDirection(root.forward);
		up = transform.InverseTransformDirection(root.up);
		right = transform.InverseTransformDirection(root.right);
		dforward = Quaternion.FromToRotation(forward, Vector3.forward) * Vector3.forward;
		dup = Quaternion.FromToRotation(up, Vector3.up) * Vector3.up;
		dright = Quaternion.FromToRotation(right, Vector3.right) * Vector3.right;
		if (Object.op_Implicit((Object)(object)t.parent))
		{
			Vector3 val = GetFromParentForward();
			fromParentForward = ((Vector3)(ref val)).normalized;
		}
		else
		{
			fromParentForward = forward;
		}
		fromParentCross = -Vector3.Cross(fromParentForward, forward);
		mapping = Quaternion.FromToRotation(right, Vector3.right);
		mapping *= Quaternion.FromToRotation(up, Vector3.up);
		dmapping = Quaternion.FromToRotation(fromParentForward, Vector3.right);
		dmapping *= Quaternion.FromToRotation(up, Vector3.up);
		this.root = root;
	}

	public Vector3 GetFromParentForward()
	{
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		return transform.InverseTransformDirection(transform.position - transform.parent.position);
	}

	public Quaternion GetRootCompensateRotation(Quaternion initPelvisInWorld, Quaternion currInWorld, float armsRootCompensate)
	{
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		Quaternion localRotation;
		if (armsRootCompensate > 0f)
		{
			localRotation = currInWorld.QToLocal(transform.parent.rotation);
			localRotation = initPelvisInWorld.QToWorld(localRotation);
			if (armsRootCompensate < 1f)
			{
				localRotation = Quaternion.Lerp(transform.parent.rotation, localRotation, armsRootCompensate);
			}
		}
		else
		{
			localRotation = transform.parent.rotation;
		}
		return localRotation;
	}

	public void RefreshCustomAxis(Vector3 up, Vector3 forward)
	{
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_0073: Unknown result type (might be due to invalid IL or missing references)
		//IL_0079: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		if (!((Object)(object)transform == (Object)null))
		{
			forwardReference = Quaternion.Inverse(transform.parent.rotation) * root.rotation * forward;
			upReference = Quaternion.Inverse(transform.parent.rotation) * root.rotation * up;
			rightCrossReference = Vector3.Cross(upReference, forwardReference);
		}
	}

	public void RefreshCustomAxis(Vector3 up, Vector3 forward, Quaternion customParentRot)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0034: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0046: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		forwardReference = Quaternion.Inverse(customParentRot) * root.rotation * forward;
		upReference = Quaternion.Inverse(customParentRot) * root.rotation * up;
		rightCrossReference = Vector3.Cross(upReference, forwardReference);
	}

	public Quaternion RotateCustomAxis(float x, float y, UniRotateBone oRef)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_005f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = Quaternion.AngleAxis(y, oRef.upReference) * Quaternion.AngleAxis(x, rightCrossReference) * oRef.forwardReference;
		Vector3 val2 = oRef.upReference;
		Vector3.OrthoNormalize(ref val, ref val2);
		Vector3 val3 = val;
		dynamicUpReference = val2;
		Vector3.OrthoNormalize(ref val3, ref dynamicUpReference);
		return transform.parent.rotation * Quaternion.LookRotation(val3, dynamicUpReference) * Quaternion.Inverse(transform.parent.rotation * Quaternion.LookRotation(oRef.forwardReference, oRef.upReference));
	}

	internal Quaternion GetSourcePoseRotation()
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		return root.rotation.QToWorld(initialLocalRotationInRootSpace);
	}

	public Vector2 GetCustomLookAngles(Vector3 direction, UniRotateBone orientationsReference)
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		//IL_0070: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = Quaternion.Inverse(transform.parent.rotation) * ((Vector3)(ref direction)).normalized;
		Vector2 zero = Vector2.zero;
		zero.y = AngleAroundAxis(orientationsReference.forwardReference, val, orientationsReference.upReference);
		Vector3 axis = Vector3.Cross(orientationsReference.upReference, val);
		Vector3 firstDirection = val - Vector3.Project(val, orientationsReference.upReference);
		zero.x = AngleAroundAxis(firstDirection, val, axis);
		return zero;
	}

	public static float AngleAroundAxis(Vector3 firstDirection, Vector3 secondDirection, Vector3 axis)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0003: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		firstDirection -= Vector3.Project(firstDirection, axis);
		secondDirection -= Vector3.Project(secondDirection, axis);
		return Vector3.Angle(firstDirection, secondDirection) * (float)((!(Vector3.Dot(axis, Vector3.Cross(firstDirection, secondDirection)) < 0f)) ? 1 : (-1));
	}

	public Quaternion DynamicMapping()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0012: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_003d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		return Quaternion.FromToRotation(right, transform.InverseTransformDirection(root.right)) * Quaternion.FromToRotation(up, transform.InverseTransformDirection(root.up));
	}

	public void CaptureKeyframeAnimation()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		keyframedPosition = transform.position;
		keyframedRotation = transform.rotation;
	}

	public void RotateBy(float x, float y, float z)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		Quaternion val = transform.rotation;
		if (x != 0f)
		{
			val *= Quaternion.AngleAxis(x, right);
		}
		if (y != 0f)
		{
			val *= Quaternion.AngleAxis(y, up);
		}
		if (z != 0f)
		{
			val *= Quaternion.AngleAxis(z, forward);
		}
		transform.rotation = val;
	}

	public void RotateBy(Vector3 angles)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		RotateBy(angles.x, angles.y, angles.z);
	}

	public void RotateBy(Vector3 angles, float blend)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		RotateBy(BlendAngle(angles.x, blend), BlendAngle(angles.y, blend), BlendAngle(angles.z, blend));
	}

	public void RotateByDynamic(Vector3 angles)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		RotateByDynamic(angles.x, angles.y, angles.z);
	}

	public void RotateByDynamic(float x, float y, float z)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_0093: Unknown result type (might be due to invalid IL or missing references)
		//IL_006a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_008c: Unknown result type (might be due to invalid IL or missing references)
		Quaternion val = transform.rotation;
		if (x != 0f)
		{
			val *= Quaternion.AngleAxis(x, transform.InverseTransformDirection(root.right));
		}
		if (y != 0f)
		{
			val *= Quaternion.AngleAxis(y, transform.InverseTransformDirection(root.up));
		}
		if (z != 0f)
		{
			val *= Quaternion.AngleAxis(z, transform.InverseTransformDirection(root.forward));
		}
		transform.rotation = val;
	}

	public Quaternion GetAngleRotation(float x, float y, float z)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_0036: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_0044: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		Quaternion val = Quaternion.identity;
		if (x != 0f)
		{
			val *= Quaternion.AngleAxis(x, right);
		}
		if (y != 0f)
		{
			val *= Quaternion.AngleAxis(y, up);
		}
		if (z != 0f)
		{
			val *= Quaternion.AngleAxis(z, forward);
		}
		return val;
	}

	public Quaternion GetAngleRotationDynamic(float x, float y, float z)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0005: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0039: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_004c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0087: Unknown result type (might be due to invalid IL or missing references)
		//IL_0064: Unknown result type (might be due to invalid IL or missing references)
		//IL_0072: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_007c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0081: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		Quaternion val = Quaternion.identity;
		if (x != 0f)
		{
			val *= Quaternion.AngleAxis(x, transform.InverseTransformDirection(root.right));
		}
		if (y != 0f)
		{
			val *= Quaternion.AngleAxis(y, transform.InverseTransformDirection(root.up));
		}
		if (z != 0f)
		{
			val *= Quaternion.AngleAxis(z, transform.InverseTransformDirection(root.forward));
		}
		return val;
	}

	public Quaternion GetAngleRotationDynamic(Vector3 angles)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		return GetAngleRotationDynamic(angles.x, angles.y, angles.z);
	}

	public void RotateByDynamic(Vector3 angles, float blend)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		RotateByDynamic(BlendAngle(angles.x, blend), BlendAngle(angles.y, blend), BlendAngle(angles.z, blend));
	}

	public void RotateByDynamic(float x, float y, float z, float blend)
	{
		RotateByDynamic(BlendAngle(x, blend), BlendAngle(y, blend), BlendAngle(z, blend));
	}

	public void RotateByDynamic(float x, float y, float z, Quaternion orientation)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_001c: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0032: Unknown result type (might be due to invalid IL or missing references)
		//IL_0037: Unknown result type (might be due to invalid IL or missing references)
		//IL_0040: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_004a: Unknown result type (might be due to invalid IL or missing references)
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0059: Unknown result type (might be due to invalid IL or missing references)
		//IL_005e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0063: Unknown result type (might be due to invalid IL or missing references)
		//IL_0096: Unknown result type (might be due to invalid IL or missing references)
		//IL_006c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0074: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0080: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_008f: Unknown result type (might be due to invalid IL or missing references)
		Quaternion val = transform.rotation;
		if (x != 0f)
		{
			val *= Quaternion.AngleAxis(x, transform.InverseTransformDirection(orientation * Vector3.right));
		}
		if (y != 0f)
		{
			val *= Quaternion.AngleAxis(y, transform.InverseTransformDirection(orientation * Vector3.up));
		}
		if (z != 0f)
		{
			val *= Quaternion.AngleAxis(z, transform.InverseTransformDirection(orientation * Vector3.forward));
		}
		transform.rotation = val;
	}

	public void RotateXBy(float angle)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		Transform obj = transform;
		obj.rotation *= Quaternion.AngleAxis(angle, right);
	}

	public void RotateYBy(float angle)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		Transform obj = transform;
		obj.rotation *= Quaternion.AngleAxis(angle, up);
	}

	public void RotateZBy(float angle)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		Transform obj = transform;
		obj.rotation *= Quaternion.AngleAxis(angle, forward);
	}

	public void PreCalibrate()
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_0018: Unknown result type (might be due to invalid IL or missing references)
		transform.localPosition = initialLocalPosition;
		transform.localRotation = initialLocalRotation;
	}

	public Quaternion RotationTowards(Vector3 toDir)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = transform.TransformDirection(fromParentForward);
		return Quaternion.FromToRotation(((Vector3)(ref val)).normalized, ((Vector3)(ref toDir)).normalized) * transform.rotation;
	}

	public Quaternion RotationTowardsDynamic(Vector3 toDir)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_001b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0020: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_002f: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = transform.position - transform.parent.position;
		return Quaternion.FromToRotation(((Vector3)(ref val)).normalized, ((Vector3)(ref toDir)).normalized) * transform.rotation;
	}

	public static float BlendAngle(float angle, float blend)
	{
		return Mathf.LerpAngle(0f, angle, blend);
	}

	public Vector3 Dir(Vector3 forward)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		return transform.TransformDirection(forward);
	}

	public Vector3 IDir(Vector3 forward)
	{
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		return transform.InverseTransformDirection(forward);
	}
}


using UnityEngine;

public class FBasic_Rotator : MonoBehaviour
{
	public Vector3 RotationAxis = new Vector3(0f, 1f, 0f);

	public float RotationSpeed = 100f;

	public bool UnscaledDeltaTime;

	protected virtual void Update()
	{
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0030: Unknown result type (might be due to invalid IL or missing references)
		//IL_0035: Unknown result type (might be due to invalid IL or missing references)
		float num = ((!UnscaledDeltaTime) ? Time.deltaTime : Time.unscaledDeltaTime);
		Transform transform = ((Component)this).transform;
		transform.localRotation *= Quaternion.AngleAxis(num * RotationSpeed, RotationAxis);
	}
}


using UnityEngine;

public class FBasic_FreeCameraBehaviour : MonoBehaviour
{
	[Tooltip("How fast camera should fly")]
	[Header("> Hold right mouse button to rotate camera <")]
	public float SpeedMultiplier = 10f;

	[Tooltip("Value of acceleration smoothness")]
	public float AccelerationSmothnessValue = 10f;

	[Tooltip("Value of rotation smoothness")]
	public float RotationSmothnessValue = 10f;

	public float MouseSensitivity = 5f;

	private float turboModeMultiply = 5f;

	private Vector3 speeds;

	private float ySpeed;

	private Vector3 rotation;

	private float turbo = 1f;

	private void Start()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_001d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		speeds = Vector3.zero;
		ySpeed = 0f;
		Quaternion val = ((Component)this).transform.rotation;
		rotation = ((Quaternion)(ref val)).eulerAngles;
	}

	private void Update()
	{
		//IL_0140: Unknown result type (might be due to invalid IL or missing references)
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_015b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0160: Unknown result type (might be due to invalid IL or missing references)
		//IL_0171: Unknown result type (might be due to invalid IL or missing references)
		//IL_017c: Unknown result type (might be due to invalid IL or missing references)
		//IL_018c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0191: Unknown result type (might be due to invalid IL or missing references)
		//IL_01a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_01bd: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01de: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f4: Unknown result type (might be due to invalid IL or missing references)
		//IL_0287: Unknown result type (might be due to invalid IL or missing references)
		//IL_028c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0297: Unknown result type (might be due to invalid IL or missing references)
		//IL_02a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_02ac: Unknown result type (might be due to invalid IL or missing references)
		//IL_02b7: Unknown result type (might be due to invalid IL or missing references)
		//IL_02bc: Unknown result type (might be due to invalid IL or missing references)
		float axis = Input.GetAxis("Vertical");
		float axis2 = Input.GetAxis("Horizontal");
		float num = axis * Time.smoothDeltaTime * SpeedMultiplier;
		float num2 = axis2 * Time.smoothDeltaTime * SpeedMultiplier;
		if (Input.GetKey((KeyCode)304))
		{
			turbo = Mathf.Lerp(turbo, turboModeMultiply, Time.smoothDeltaTime * 5f);
		}
		else
		{
			turbo = Mathf.Lerp(turbo, 1f, Time.smoothDeltaTime * 5f);
		}
		num *= turbo;
		num2 *= turbo;
		if (Input.GetMouseButton(1))
		{
			rotation.x -= Input.GetAxis("Mouse Y") * 1f * MouseSensitivity;
			rotation.y += Input.GetAxis("Mouse X") * 1f * MouseSensitivity;
		}
		speeds.z = Mathf.Lerp(speeds.z, num, Time.smoothDeltaTime * AccelerationSmothnessValue);
		speeds.x = Mathf.Lerp(speeds.x, num2, Time.smoothDeltaTime * AccelerationSmothnessValue);
		Transform transform = ((Component)this).transform;
		transform.position += ((Component)this).transform.forward * speeds.z;
		Transform transform2 = ((Component)this).transform;
		transform2.position += ((Component)this).transform.right * speeds.x;
		Transform transform3 = ((Component)this).transform;
		transform3.position += ((Component)this).transform.up * speeds.y;
		((Component)this).transform.rotation = Quaternion.Slerp(((Component)this).transform.rotation, Quaternion.Euler(rotation), Time.smoothDeltaTime * RotationSmothnessValue);
		if (Input.GetKey((KeyCode)306))
		{
			ySpeed = Mathf.Lerp(ySpeed, 1f, Time.smoothDeltaTime * AccelerationSmothnessValue);
		}
		else if (Input.GetButton("Jump"))
		{
			ySpeed = Mathf.Lerp(ySpeed, -1f, Time.smoothDeltaTime * AccelerationSmothnessValue);
		}
		else
		{
			ySpeed = Mathf.Lerp(ySpeed, 0f, Time.smoothDeltaTime * AccelerationSmothnessValue);
		}
		Transform transform4 = ((Component)this).transform;
		transform4.position += Vector3.down * ySpeed * turbo * Time.smoothDeltaTime * SpeedMultiplier;
	}

	public void FixedUpdate()
	{
		if (Input.GetMouseButton(1))
		{
			Cursor.lockState = (CursorLockMode)1;
			Cursor.visible = false;
		}
		else
		{
			Cursor.lockState = (CursorLockMode)0;
			Cursor.visible = true;
		}
	}
}


using FIMSpace.Basics;
using UnityEngine;

[DefaultExecutionOrder(1000)]
public class FBasic_TPPCameraBehaviour : MonoBehaviour
{
	[Header("Transform to be followed by camera")]
	public Transform ToFollow;

	[Header("Offset in position in reference to target transform (focus point)")]
	public Vector3 FollowingOffset = new Vector3(0f, 1.5f, 0f);

	[Header("Offset in position in reference to camera orientation")]
	public Vector3 FollowingOffsetDirection = new Vector3(0f, 0f, 0f);

	[Header("Clamp values for zoom of camera")]
	public Vector2 DistanceRanges = new Vector2(5f, 10f);

	private float targetDistance;

	private float animatedDistance;

	public Vector2 RotationRanges = new Vector2(-5f, 60f);

	private Vector2 targetSphericRotation = new Vector2(0f, 0f);

	private Vector2 animatedSphericRotation = new Vector2(0f, 0f);

	[Tooltip("Sensitivity value for rotating camera around following object")]
	[Space(10f)]
	public float RotationSensitivity = 10f;

	[Header("If you want camera rotation to be smooth")]
	[Range(0.1f, 1f)]
	public float RotationSpeed = 1f;

	[Header("If you want camera to follow target with some smoothness")]
	[Range(0f, 1f)]
	public float HardFollowValue = 1f;

	[Header("If you want to hold cursor (cursor switch on TAB)")]
	public bool LockCursor = true;

	private bool rotateCamera = true;

	private RaycastHit sightObstacleHit;

	[Header("Layer mask to check obstacles in sight ray")]
	public LayerMask SightLayerMask;

	private Vector3 targetPosition;

	[Header("How far forward raycast should check collision for camera")]
	public float CollisionOffset = 1f;

	public EFUpdateClock UpdateClock;

	private void Start()
	{
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_004b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_005a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_0066: Unknown result type (might be due to invalid IL or missing references)
		targetDistance = (DistanceRanges.x + DistanceRanges.y) / 2f;
		animatedDistance = DistanceRanges.y;
		targetSphericRotation = new Vector2(((Component)this).transform.eulerAngles.y, ((Component)this).transform.eulerAngles.x);
		animatedSphericRotation = targetSphericRotation;
	}

	private void UpdateMethods()
	{
		InputCalculations();
		ZoomCalculations();
		FollowCalculations();
		RaycastCalculations();
		SwitchCalculations();
	}

	private void LateUpdate()
	{
		if (UpdateClock == EFUpdateClock.LateUpdate)
		{
			UpdateMethods();
		}
	}

	private void Update()
	{
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Invalid comparison between Unknown and I4
		//IL_0028: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Invalid comparison between Unknown and I4
		if (Input.GetMouseButtonDown(1) && (int)Cursor.lockState != 1)
		{
			HelperSwitchCursor();
		}
		if ((Input.GetKey((KeyCode)27) || Input.GetKeyDown((KeyCode)9)) && (int)Cursor.lockState == 1)
		{
			HelperSwitchCursor();
		}
		if (UpdateClock == EFUpdateClock.Update)
		{
			UpdateMethods();
		}
	}

	private void FixedUpdate()
	{
		if (UpdateClock == EFUpdateClock.FixedUpdate)
		{
			UpdateMethods();
		}
	}

	private void InputCalculations()
	{
		//IL_0026: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Invalid comparison between Unknown and I4
		targetDistance -= Input.GetAxis("Mouse ScrollWheel") * 5f;
		if (rotateCamera && (int)Cursor.lockState == 1)
		{
			targetSphericRotation.x += Input.GetAxis("Mouse X") * RotationSensitivity;
			targetSphericRotation.y -= Input.GetAxis("Mouse Y") * RotationSensitivity;
		}
	}

	private void ZoomCalculations()
	{
		if (!Object.op_Implicit((Object)(object)((RaycastHit)(ref sightObstacleHit)).transform))
		{
			targetDistance = Mathf.Clamp(targetDistance, DistanceRanges.x, DistanceRanges.y);
		}
		animatedDistance = Mathf.Lerp(animatedDistance, targetDistance, Time.deltaTime * 8f);
	}

	private void FollowCalculations()
	{
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_009f: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fa: Unknown result type (might be due to invalid IL or missing references)
		//IL_0133: Unknown result type (might be due to invalid IL or missing references)
		//IL_0134: Unknown result type (might be due to invalid IL or missing references)
		//IL_011f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0124: Unknown result type (might be due to invalid IL or missing references)
		//IL_012c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0131: Unknown result type (might be due to invalid IL or missing references)
		targetSphericRotation.y = HelperClampAngle(targetSphericRotation.y, RotationRanges.x, RotationRanges.y);
		if (RotationSpeed < 1f)
		{
			animatedSphericRotation = new Vector2(Mathf.LerpAngle(animatedSphericRotation.x, targetSphericRotation.x, Time.deltaTime * 30f * RotationSpeed), Mathf.LerpAngle(animatedSphericRotation.y, targetSphericRotation.y, Time.deltaTime * 30f * RotationSpeed));
		}
		else
		{
			animatedSphericRotation = targetSphericRotation;
		}
		Quaternion rotation = Quaternion.Euler(animatedSphericRotation.y, animatedSphericRotation.x, 0f);
		((Component)this).transform.rotation = rotation;
		Vector3 val = ((Component)ToFollow).transform.position + FollowingOffset;
		if (HardFollowValue < 1f)
		{
			float num = Mathf.Lerp(0.5f, 40f, HardFollowValue);
			val = Vector3.Lerp(targetPosition, val, Time.deltaTime * num);
		}
		targetPosition = val;
	}

	private void RaycastCalculations()
	{
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0011: Unknown result type (might be due to invalid IL or missing references)
		//IL_0016: Unknown result type (might be due to invalid IL or missing references)
		//IL_0022: Unknown result type (might be due to invalid IL or missing references)
		//IL_0027: Unknown result type (might be due to invalid IL or missing references)
		//IL_002c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0031: Unknown result type (might be due to invalid IL or missing references)
		//IL_004d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0052: Unknown result type (might be due to invalid IL or missing references)
		//IL_0055: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_005c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0061: Unknown result type (might be due to invalid IL or missing references)
		//IL_006b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0080: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ff: Unknown result type (might be due to invalid IL or missing references)
		//IL_0104: Unknown result type (might be due to invalid IL or missing references)
		//IL_0109: Unknown result type (might be due to invalid IL or missing references)
		//IL_009e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a5: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b5: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = ((Component)ToFollow).transform.position + FollowingOffset + ((Component)this).transform.TransformVector(FollowingOffsetDirection);
		Quaternion val2 = Quaternion.Euler(targetSphericRotation.y, targetSphericRotation.x, 0f);
		Ray val3 = default(Ray);
		((Ray)(ref val3))..ctor(val, val2 * -Vector3.forward);
		if (Physics.Raycast(val3, ref sightObstacleHit, targetDistance + CollisionOffset, LayerMask.op_Implicit(SightLayerMask), (QueryTriggerInteraction)1))
		{
			((Component)this).transform.position = ((RaycastHit)(ref sightObstacleHit)).point - ((Ray)(ref val3)).direction * CollisionOffset;
			return;
		}
		Vector3 val4 = ((Component)this).transform.rotation * -Vector3.forward * animatedDistance;
		((Component)this).transform.position = targetPosition + val4 + ((Component)this).transform.TransformVector(FollowingOffsetDirection);
	}

	private void SwitchCalculations()
	{
		if (LockCursor && Input.GetKeyDown((KeyCode)9))
		{
			HelperSwitchCursor();
			if (Cursor.visible)
			{
				rotateCamera = false;
			}
			else
			{
				rotateCamera = true;
			}
		}
	}

	private float HelperClampAngle(float angle, float min, float max)
	{
		if (angle < -360f)
		{
			angle += 360f;
		}
		if (angle > 360f)
		{
			angle -= 360f;
		}
		return Mathf.Clamp(angle, min, max);
	}

	private void HelperSwitchCursor()
	{
		if (Cursor.visible)
		{
			if (Application.isFocused)
			{
				Cursor.lockState = (CursorLockMode)1;
				Cursor.visible = false;
			}
		}
		else
		{
			Cursor.lockState = (CursorLockMode)0;
			Cursor.visible = true;
		}
	}
}


using UnityEngine;

public abstract class FBasic_MaterialScriptBase : MonoBehaviour
{
	protected Material RendererMaterial;

	protected Renderer ObjectRenderer;

	protected Material GetRendererMaterial()
	{
		//IL_00be: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c8: Expected O, but got Unknown
		if (!Application.isPlaying && (Object)(object)ObjectRenderer != (Object)null && (Object)(object)ObjectRenderer.sharedMaterial != (Object)(object)RendererMaterial)
		{
			RendererMaterial = null;
		}
		if ((Object)(object)RendererMaterial == (Object)null || (Object)(object)ObjectRenderer == (Object)null)
		{
			Renderer val = ((Component)this).gameObject.GetComponent<Renderer>();
			if ((Object)(object)val == (Object)null)
			{
				val = ((Component)this).gameObject.GetComponentInChildren<Renderer>();
			}
			if ((Object)(object)val == (Object)null)
			{
				Debug.Log((object)("<color=red>No renderer in " + ((Object)((Component)this).gameObject).name + "!</color>"));
				return null;
			}
			ObjectRenderer = val;
			if (Application.isPlaying)
			{
				RendererMaterial = val.material;
			}
			else
			{
				RendererMaterial = new Material(val.sharedMaterial);
			}
		}
		return RendererMaterial;
	}
}


using FIMSpace.Basics;
using UnityEngine;

public class FBasic_DuplicateObjects : MonoBehaviour
{
	public enum FEDuplicateDirection
	{
		GoIterative,
		GoFromCenter
	}

	public enum FEDuplicateOrigin
	{
		FromToDuplicate,
		FromComponent
	}

	[Tooltip("Put here object which you want duplicate")]
	public GameObject ToDuplicate;

	[Tooltip("How many copies in which axis")]
	public Vector3 DuplicatesCount = new Vector3(3f, 1f, 3f);

	[Tooltip("How far from each other should be created copies")]
	public Vector3 Offsets = new Vector3(3f, 0f, 3f);

	public Vector3 Randomize = new Vector3(0f, 0f, 0f);

	public Vector3 RandomRotate = new Vector3(0f, 0f, 0f);

	public Vector3 RandomScale = new Vector3(0f, 0f, 0f);

	public int Seed;

	[Tooltip("If you want raycast from up and put objects for example on terrain")]
	public bool PlaceOnGround;

	[Tooltip("Duplicates will be created when entered playmode")]
	public bool DuplicateAtStart;

	public float GizmosSize = 1f;

	public FEDuplicateDirection DuplicationType;

	public FEDuplicateOrigin DuplicationOrigin;

	private void Start()
	{
		if (DuplicateAtStart)
		{
			Duplicate();
		}
	}

	private void Reset()
	{
		Seed = Random.Range(-2147483646, 2147483646);
	}

	public void Duplicate()
	{
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_0077: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00db: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0150: Unknown result type (might be due to invalid IL or missing references)
		//IL_0161: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_01bf: Unknown result type (might be due to invalid IL or missing references)
		//IL_01c4: Unknown result type (might be due to invalid IL or missing references)
		//IL_01cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e8: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f7: Unknown result type (might be due to invalid IL or missing references)
		//IL_01fc: Unknown result type (might be due to invalid IL or missing references)
		//IL_0225: Unknown result type (might be due to invalid IL or missing references)
		//IL_0315: Unknown result type (might be due to invalid IL or missing references)
		//IL_0316: Unknown result type (might be due to invalid IL or missing references)
		//IL_0321: Unknown result type (might be due to invalid IL or missing references)
		//IL_0342: Unknown result type (might be due to invalid IL or missing references)
		//IL_0363: Unknown result type (might be due to invalid IL or missing references)
		//IL_038f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0392: Unknown result type (might be due to invalid IL or missing references)
		//IL_0397: Unknown result type (might be due to invalid IL or missing references)
		//IL_03a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0402: Unknown result type (might be due to invalid IL or missing references)
		//IL_0407: Unknown result type (might be due to invalid IL or missing references)
		//IL_0418: Unknown result type (might be due to invalid IL or missing references)
		//IL_0471: Unknown result type (might be due to invalid IL or missing references)
		//IL_0476: Unknown result type (might be due to invalid IL or missing references)
		//IL_047b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0484: Unknown result type (might be due to invalid IL or missing references)
		//IL_049a: Unknown result type (might be due to invalid IL or missing references)
		//IL_049f: Unknown result type (might be due to invalid IL or missing references)
		//IL_04a9: Unknown result type (might be due to invalid IL or missing references)
		//IL_04ae: Unknown result type (might be due to invalid IL or missing references)
		//IL_04b3: Unknown result type (might be due to invalid IL or missing references)
		//IL_04dc: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)ToDuplicate == (Object)null)
		{
			return;
		}
		Random.InitState(Seed);
		Vector3 val = ((DuplicationOrigin != FEDuplicateOrigin.FromComponent) ? ToDuplicate.transform.position : ((Component)this).transform.position);
		if (DuplicationType == FEDuplicateDirection.GoIterative)
		{
			RaycastHit val4 = default(RaycastHit);
			for (int i = 0; (float)i < DuplicatesCount.x; i++)
			{
				for (int j = 0; (float)j < DuplicatesCount.y; j++)
				{
					for (int k = 0; (float)k < DuplicatesCount.z; k++)
					{
						if (DuplicationOrigin == FEDuplicateOrigin.FromToDuplicate && i == 0 && j == 0 && k == 0)
						{
							continue;
						}
						Vector3 val2 = val;
						val2.x += (float)i * Offsets.x;
						val2.y += (float)j * Offsets.y;
						val2.z += (float)k * Offsets.z;
						GameObject val3 = Object.Instantiate<GameObject>(ToDuplicate);
						val3.transform.position = val2 + GetRandomVector();
						Transform transform = val3.transform;
						transform.rotation *= Quaternion.Euler(Random.Range(0f - RandomRotate.x, RandomRotate.x), Random.Range(0f - RandomRotate.y, RandomRotate.y), Random.Range(0f - RandomRotate.z, RandomRotate.z));
						Vector3 localScale = val3.transform.localScale + new Vector3(Random.Range(0f - RandomScale.x, RandomScale.x), Random.Range(0f - RandomScale.y, RandomScale.y), Random.Range(0f - RandomScale.z, RandomScale.z));
						val3.transform.localScale = localScale;
						if (PlaceOnGround)
						{
							Physics.Raycast(val3.transform.position + Vector3.up * 100f, Vector3.down, ref val4, 200f);
							if (Object.op_Implicit((Object)(object)((RaycastHit)(ref val4)).transform))
							{
								val3.transform.position = ((RaycastHit)(ref val4)).point;
							}
						}
					}
				}
			}
		}
		else
		{
			if (DuplicationType != FEDuplicateDirection.GoFromCenter)
			{
				return;
			}
			Vector3 val5 = default(Vector3);
			RaycastHit val8 = default(RaycastHit);
			for (int l = 0; (float)l < DuplicatesCount.x; l++)
			{
				for (int m = 0; (float)m < DuplicatesCount.y; m++)
				{
					for (int n = 0; (float)n < DuplicatesCount.z; n++)
					{
						float num = 1f;
						float num2 = 1f;
						float num3 = 1f;
						if (l % 2 == 1)
						{
							num = -1f;
						}
						if (m % 2 == 1)
						{
							num2 = -1f;
						}
						if (n % 2 == 1)
						{
							num3 = -1f;
						}
						((Vector3)(ref val5))..ctor((float)l, (float)m, (float)n);
						if (l == 0)
						{
							val5.x = 0.5f;
						}
						if (m == 0)
						{
							val5.y = 0.5f;
						}
						if (n == 0)
						{
							val5.z = 0.5f;
						}
						Vector3 val6 = val;
						val6.x += val5.x * Offsets.x * num;
						val6.y += val5.y * Offsets.y * num2;
						val6.z += val5.z * Offsets.z * num3;
						GameObject val7 = Object.Instantiate<GameObject>(ToDuplicate);
						val7.transform.position = val6 + GetRandomVector();
						Transform transform2 = val7.transform;
						transform2.rotation *= Quaternion.Euler(Random.Range(0f - RandomRotate.x, RandomRotate.x), Random.Range(0f - RandomRotate.y, RandomRotate.y), Random.Range(0f - RandomRotate.z, RandomRotate.z));
						Vector3 localScale2 = val7.transform.localScale + new Vector3(Random.Range(0f - RandomScale.x, RandomScale.x), Random.Range(0f - RandomScale.y, RandomScale.y), Random.Range(0f - RandomScale.z, RandomScale.z));
						val7.transform.localScale = localScale2;
						if (PlaceOnGround)
						{
							Physics.Raycast(val7.transform.position + Vector3.up * 100f, Vector3.down, ref val8, 200f);
							if (Object.op_Implicit((Object)(object)((RaycastHit)(ref val8)).transform))
							{
								val7.transform.position = ((RaycastHit)(ref val8)).point;
							}
						}
					}
				}
			}
		}
	}

	private void OnDrawGizmos()
	{
		//IL_003c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0029: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_007e: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cb: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ce: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_00d8: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_01dd: Unknown result type (might be due to invalid IL or missing references)
		//IL_01de: Unknown result type (might be due to invalid IL or missing references)
		//IL_01e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_020a: Unknown result type (might be due to invalid IL or missing references)
		//IL_022b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0243: Unknown result type (might be due to invalid IL or missing references)
		//IL_0246: Unknown result type (might be due to invalid IL or missing references)
		//IL_024b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0250: Unknown result type (might be due to invalid IL or missing references)
		//IL_025a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0265: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)ToDuplicate == (Object)null)
		{
			return;
		}
		Random.InitState(Seed);
		Vector3 val = ((DuplicationOrigin != FEDuplicateOrigin.FromComponent) ? ToDuplicate.transform.position : ((Component)this).transform.position);
		Gizmos.color = new Color(0.2f, 0.7f, 0.2f, 0.6f);
		if (DuplicationType == FEDuplicateDirection.GoIterative)
		{
			for (int i = 0; (float)i < DuplicatesCount.x; i++)
			{
				for (int j = 0; (float)j < DuplicatesCount.y; j++)
				{
					for (int k = 0; (float)k < DuplicatesCount.z; k++)
					{
						Vector3 val2 = val;
						val2.x += (float)i * Offsets.x;
						val2.y += (float)j * Offsets.y;
						val2.z += (float)k * Offsets.z;
						Gizmos.DrawCube(val2 + GetRandomVector(), Vector3.one * 0.25f * GizmosSize);
					}
				}
			}
		}
		else
		{
			if (DuplicationType != FEDuplicateDirection.GoFromCenter)
			{
				return;
			}
			Vector3 val3 = default(Vector3);
			for (int l = 0; (float)l < DuplicatesCount.x; l++)
			{
				for (int m = 0; (float)m < DuplicatesCount.y; m++)
				{
					for (int n = 0; (float)n < DuplicatesCount.z; n++)
					{
						float num = 1f;
						float num2 = 1f;
						float num3 = 1f;
						if (l % 2 == 1)
						{
							num = -1f;
						}
						if (m % 2 == 1)
						{
							num2 = -1f;
						}
						if (n % 2 == 1)
						{
							num3 = -1f;
						}
						((Vector3)(ref val3))..ctor((float)l, (float)m, (float)n);
						if (l == 0)
						{
							val3.x = 0.5f;
						}
						if (m == 0)
						{
							val3.y = 0.5f;
						}
						if (n == 0)
						{
							val3.z = 0.5f;
						}
						Vector3 val4 = val;
						val4.x += val3.x * Offsets.x * num;
						val4.y += val3.y * Offsets.y * num2;
						val4.z += val3.z * Offsets.z * num3;
						Gizmos.DrawCube(val4 + GetRandomVector(), Vector3.one * 0.25f * GizmosSize);
					}
				}
			}
		}
	}

	private Vector3 GetRandomVector()
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0013: Unknown result type (might be due to invalid IL or missing references)
		if (Randomize == Vector3.zero)
		{
			return Randomize;
		}
		return new Vector3(Random.Range(0f - Randomize.x, Randomize.x), Random.Range(0f - Randomize.y, Randomize.y), Random.Range(0f - Randomize.z, Randomize.z));
	}
}


public enum FEDuplicateDirection
{
	GoIterative,
	GoFromCenter
}


public enum FEDuplicateOrigin
{
	FromToDuplicate,
	FromComponent
}


using FIMSpace.Basics;
using UnityEngine;

public class FBasic_MaterialTiler : FBasic_MaterialScriptBase
{
	[Header("When you scale object change")]
	[Header("something in script to apply")]
	[Space(10f)]
	[Tooltip("Texture identificator in shader")]
	public string TextureProperty = "_MainTex";

	[Tooltip("How much tiles should be multiplied according to gameObject's scale")]
	public Vector2 ScaleValues = new Vector2(1f, 1f);

	[Tooltip("When scale on Y should be same as X")]
	public bool EqualDimensions;

	private void OnValidate()
	{
		GetRendererMaterial();
		if (EqualDimensions)
		{
			ScaleValues.y = ScaleValues.x;
		}
		TileMaterialToScale();
	}

	private void TileMaterialToScale()
	{
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0023: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0065: Unknown result type (might be due to invalid IL or missing references)
		if (!((Object)(object)RendererMaterial == (Object)null) && !((Object)(object)ObjectRenderer == (Object)null))
		{
			Vector2 scaleValues = ScaleValues;
			scaleValues.x *= ((Component)this).transform.localScale.x;
			scaleValues.y *= ((Component)this).transform.localScale.z;
			RendererMaterial.SetTextureScale("_MainTex", scaleValues);
			ObjectRenderer.material = RendererMaterial;
		}
	}
}


using System.Collections.Generic;
using FIMSpace;
using UnityEngine;

public class FAnimationClips : Dictionary<string, int>
{
	public readonly Animator Animator;

	public int Layer;

	public string CurrentAnimation { get; private set; }

	public string PreviousAnimation { get; private set; }

	public FAnimationClips(Animator animator)
	{
		Animator = animator;
		CurrentAnimation = "";
		PreviousAnimation = "";
	}

	public void Add(string clipName, bool exactClipName = false)
	{
		AddClip(clipName, exactClipName);
	}

	public void AddClip(string clipName, bool exactClipName = false)
	{
		AddClip(Animator, clipName, exactClipName);
	}

	public void AddClip(Animator animator, string clipName, bool exactClipName = false)
	{
		if (!Object.op_Implicit((Object)(object)animator))
		{
			Debug.LogError((object)"No animator!");
			return;
		}
		string text = "";
		if (!exactClipName)
		{
			if (animator.StateExists(clipName, Layer))
			{
				text = clipName;
			}
			else if (animator.StateExists(clipName.CapitalizeFirstLetter()))
			{
				text = clipName.CapitalizeFirstLetter();
			}
			else if (animator.StateExists(clipName.ToLower(), Layer))
			{
				text = clipName.ToLower();
			}
			else if (animator.StateExists(clipName.ToUpper(), Layer))
			{
				text = clipName.ToUpper();
			}
		}
		else if (animator.StateExists(clipName, Layer))
		{
			text = clipName;
		}
		if (text == "")
		{
			Debug.LogWarning((object)("Clip with name " + clipName + " not exists in animator from game object " + ((Object)((Component)animator).gameObject).name));
		}
		else if (!ContainsKey(clipName))
		{
			Add(clipName, Animator.StringToHash(text));
		}
	}

	public void CrossFadeInFixedTime(string clip, float transitionTime = 0.25f, float timeOffset = 0f, bool startOver = false)
	{
		if (ContainsKey(clip))
		{
			RefreshClipMemory(clip);
			if (startOver)
			{
				Animator.CrossFadeInFixedTime(base[clip], transitionTime, Layer, timeOffset);
			}
			else if (!IsPlaying(clip))
			{
				Animator.CrossFadeInFixedTime(base[clip], transitionTime, Layer, timeOffset);
			}
		}
	}

	public void CrossFade(string clip, float transitionTime = 0.25f, float timeOffset = 0f, bool startOver = false)
	{
		if (ContainsKey(clip))
		{
			RefreshClipMemory(clip);
			if (startOver)
			{
				Animator.CrossFade(base[clip], transitionTime, Layer, timeOffset);
			}
			else if (!IsPlaying(clip))
			{
				Animator.CrossFade(base[clip], transitionTime, Layer, timeOffset);
			}
		}
	}

	private void RefreshClipMemory(string name)
	{
		if (name != CurrentAnimation)
		{
			PreviousAnimation = CurrentAnimation;
			CurrentAnimation = name;
		}
	}

	public void SetFloat(string parameter, float value = 0f, float deltaSpeed = 60f)
	{
		float @float = Animator.GetFloat(parameter);
		@float = ((!(deltaSpeed >= 60f)) ? FLogicMethods.FLerp(@float, value, Time.deltaTime * deltaSpeed) : value);
		Animator.SetFloat(parameter, @float);
	}

	public void SetFloatUnscaledDelta(string parameter, float value = 0f, float deltaSpeed = 60f)
	{
		float @float = Animator.GetFloat(parameter);
		@float = ((!(deltaSpeed >= 60f)) ? FLogicMethods.FLerp(@float, value, Time.unscaledDeltaTime * deltaSpeed) : value);
		Animator.SetFloat(parameter, @float);
	}

	internal bool IsPlaying(string clip)
	{
		//IL_0043: Unknown result type (might be due to invalid IL or missing references)
		//IL_0048: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		AnimatorStateInfo val;
		if (Animator.IsInTransition(Layer))
		{
			val = Animator.GetNextAnimatorStateInfo(Layer);
			if (((AnimatorStateInfo)(ref val)).shortNameHash == base[clip])
			{
				return true;
			}
		}
		else
		{
			val = Animator.GetCurrentAnimatorStateInfo(Layer);
			if (((AnimatorStateInfo)(ref val)).shortNameHash == base[clip])
			{
				return true;
			}
		}
		return false;
	}
}


using FIMSpace;
using UnityEngine;

public class FAnimator
{
	public readonly Animator Animator;

	public string CurrentAnimation { get; private set; }

	public string PreviousAnimation { get; private set; }

	public int Layer { get; private set; }

	public FAnimator(Animator animator, int layer = 0)
	{
		Animator = animator;
		CurrentAnimation = "";
		PreviousAnimation = "";
		Layer = layer;
	}

	public bool ContainsClip(string clipName, bool exactClipName = false)
	{
		if (!Object.op_Implicit((Object)(object)Animator))
		{
			Debug.LogError((object)"No animator!");
			return false;
		}
		string text = "";
		if (!exactClipName)
		{
			if (Animator.StateExists(clipName, Layer))
			{
				text = clipName;
			}
			else if (Animator.StateExists(clipName.CapitalizeFirstLetter()))
			{
				text = clipName.CapitalizeFirstLetter();
			}
			else if (Animator.StateExists(clipName.ToLower(), Layer))
			{
				text = clipName.ToLower();
			}
			else if (Animator.StateExists(clipName.ToUpper(), Layer))
			{
				text = clipName.ToUpper();
			}
		}
		else if (Animator.StateExists(clipName, Layer))
		{
			text = clipName;
		}
		if (text == "")
		{
			Debug.LogWarning((object)("Clip with name " + clipName + " not exists in animator from game object " + ((Object)((Component)Animator).gameObject).name));
			return false;
		}
		return true;
	}

	public void CrossFadeInFixedTime(string clip, float transitionTime = 0.25f, float timeOffset = 0f, bool startOver = false)
	{
		RefreshClipMemory(clip);
		if (startOver)
		{
			Animator.CrossFadeInFixedTime(clip, transitionTime, Layer, timeOffset);
		}
		else if (!IsPlaying(clip))
		{
			Animator.CrossFadeInFixedTime(clip, transitionTime, Layer, timeOffset);
		}
	}

	public void CrossFade(string clip, float transitionTime = 0.25f, float timeOffset = 0f, bool startOver = false)
	{
		RefreshClipMemory(clip);
		if (startOver)
		{
			Animator.CrossFade(clip, transitionTime, Layer, timeOffset);
		}
		else if (!IsPlaying(clip))
		{
			Animator.CrossFade(clip, transitionTime, Layer, timeOffset);
		}
	}

	private void RefreshClipMemory(string name)
	{
		if (name != CurrentAnimation)
		{
			PreviousAnimation = CurrentAnimation;
			CurrentAnimation = name;
		}
	}

	public void SetFloat(string parameter, float value = 0f, float deltaSpeed = 60f)
	{
		float @float = Animator.GetFloat(parameter);
		@float = ((!(deltaSpeed >= 60f)) ? FLogicMethods.FLerp(@float, value, Time.deltaTime * deltaSpeed) : value);
		Animator.SetFloat(parameter, @float);
	}

	public void SetFloatUnscaledDelta(string parameter, float value = 0f, float deltaSpeed = 60f)
	{
		float @float = Animator.GetFloat(parameter);
		@float = ((!(deltaSpeed >= 60f)) ? FLogicMethods.FLerp(@float, value, Time.unscaledDeltaTime * deltaSpeed) : value);
		Animator.SetFloat(parameter, @float);
	}

	internal bool IsPlaying(string clip)
	{
		//IL_0042: Unknown result type (might be due to invalid IL or missing references)
		//IL_0047: Unknown result type (might be due to invalid IL or missing references)
		//IL_001f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0024: Unknown result type (might be due to invalid IL or missing references)
		AnimatorStateInfo val;
		if (Animator.IsInTransition(Layer))
		{
			val = Animator.GetNextAnimatorStateInfo(Layer);
			if (((AnimatorStateInfo)(ref val)).shortNameHash == Animator.StringToHash(clip))
			{
				return true;
			}
		}
		else
		{
			val = Animator.GetCurrentAnimatorStateInfo(Layer);
			if (((AnimatorStateInfo)(ref val)).shortNameHash == Animator.StringToHash(clip))
			{
				return true;
			}
		}
		return false;
	}
}


public enum EFUpdateClock
{
	Update,
	LateUpdate,
	FixedUpdate
}


using UnityEngine;

public static class AnimationGenerateUtils
{
	public static AnimationCurve ReduceKeyframes(AnimationCurve curve, float maxError)
	{
		//IL_0160: Unknown result type (might be due to invalid IL or missing references)
		//IL_0166: Expected O, but got Unknown
		//IL_0076: Unknown result type (might be due to invalid IL or missing references)
		//IL_007b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0082: Unknown result type (might be due to invalid IL or missing references)
		//IL_0108: Unknown result type (might be due to invalid IL or missing references)
		//IL_005b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		Keyframe[] array = curve.keys;
		int num = 1;
		while (array.Length > 2 && num < array.Length - 1)
		{
			Keyframe[] array2 = (Keyframe[])(object)new Keyframe[array.Length - 1];
			int num2 = 0;
			for (int i = 0; i < array.Length; i++)
			{
				if (num != i)
				{
					array2[num2] = new Keyframe(((Keyframe)(ref array[i])).time, ((Keyframe)(ref array[i])).value, ((Keyframe)(ref array[i])).inTangent, ((Keyframe)(ref array[i])).outTangent);
					num2++;
				}
			}
			AnimationCurve val = new AnimationCurve
			{
				keys = array2
			};
			float num3 = Mathf.Abs(val.Evaluate(((Keyframe)(ref array[num])).time) - ((Keyframe)(ref array[num])).value);
			float num4 = ((Keyframe)(ref array[num])).time + (((Keyframe)(ref array[num - 1])).time - ((Keyframe)(ref array[num])).time) * 0.5f;
			float num5 = ((Keyframe)(ref array[num])).time + (((Keyframe)(ref array[num + 1])).time - ((Keyframe)(ref array[num])).time) * 0.5f;
			float num6 = Mathf.Abs(val.Evaluate(num4) - curve.Evaluate(num4));
			float num7 = Mathf.Abs(val.Evaluate(num5) - curve.Evaluate(num5));
			if (num3 < maxError && num6 < maxError && num7 < maxError)
			{
				array = array2;
			}
			else
			{
				num++;
			}
		}
		return new AnimationCurve(array);
	}

	public static void LoopCurve(ref AnimationCurve curve, bool averageBoth = false, float? endTime = null)
	{
		//IL_013b: Unknown result type (might be due to invalid IL or missing references)
		//IL_014a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Unknown result type (might be due to invalid IL or missing references)
		//IL_0166: Unknown result type (might be due to invalid IL or missing references)
		//IL_0091: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e0: Unknown result type (might be due to invalid IL or missing references)
		//IL_0115: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_020c: Unknown result type (might be due to invalid IL or missing references)
		float num = 0f;
		if (curve.keys.Length != 0)
		{
			num = ((Keyframe)(ref curve.keys[0])).value;
		}
		if (!endTime.HasValue)
		{
			if (curve.keys.Length == 0)
			{
				curve.AddKey(new Keyframe(0f, num));
				curve.AddKey(new Keyframe(1f, num));
				return;
			}
			if (curve.keys.Length == 1)
			{
				curve.AddKey(new Keyframe(Mathf.Max(1f, ((Keyframe)(ref curve.keys[0])).time + 0.5f), num));
				return;
			}
			float num2 = num;
			if (averageBoth)
			{
				num2 = Mathf.Lerp(num, ((Keyframe)(ref curve.keys[curve.keys.Length - 1])).value, 0.5f);
			}
			curve.MoveKey(0, new Keyframe(((Keyframe)(ref curve.keys[0])).time, num2));
			curve.MoveKey(curve.keys.Length - 1, new Keyframe(((Keyframe)(ref curve.keys[curve.keys.Length - 1])).time, num2));
			return;
		}
		float value = endTime.Value;
		if (curve.keys.Length == 0)
		{
			curve.AddKey(new Keyframe(0f, num));
			curve.AddKey(new Keyframe(value, num));
			return;
		}
		if (curve.keys.Length == 1)
		{
			curve.AddKey(new Keyframe(value, num));
			return;
		}
		float num3 = num;
		if (averageBoth)
		{
			num3 = Mathf.Lerp(num, ((Keyframe)(ref curve.keys[curve.keys.Length - 1])).value, 0.5f);
		}
		Keyframe val = curve.keys[curve.keys.Length - 1];
		float num4 = ((Keyframe)(ref val)).time;
		if (num4 != value && num4 < value && value - num4 < value * 0.1f)
		{
			num4 = value;
		}
		curve.MoveKey(0, new Keyframe(((Keyframe)(ref curve.keys[0])).time, num3));
		curve.MoveKey(curve.keys.Length - 1, new Keyframe(num4, num3));
	}

	public static void DistrubuteCurveOnTime(ref AnimationCurve curve, float startTime, float endTime)
	{
		//IL_004e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0054: Expected O, but got Unknown
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_0086: Unknown result type (might be due to invalid IL or missing references)
		//IL_0088: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a8: Unknown result type (might be due to invalid IL or missing references)
		float time = ((Keyframe)(ref curve.keys[0])).time;
		float time2 = ((Keyframe)(ref curve.keys[curve.keys.Length - 1])).time;
		Keyframe[] array = (Keyframe[])(object)new Keyframe[curve.keys.Length];
		curve.keys.CopyTo(array, 0);
		AnimationCurve val = new AnimationCurve(array);
		while (curve.keys.Length != 0)
		{
			curve.RemoveKey(curve.keys.Length - 1);
		}
		for (int i = 0; i < val.keys.Length; i++)
		{
			Keyframe val2 = val.keys[i];
			Keyframe val3 = val2;
			((Keyframe)(ref val3)).time = Mathf.Lerp(startTime, endTime, Mathf.InverseLerp(time, time2, ((Keyframe)(ref val2)).time));
			curve.AddKey(val3);
		}
	}

	public static Quaternion EnsureQuaternionContinuity(Quaternion latestRot, Quaternion targetRot, bool normalize = false)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0009: Unknown result type (might be due to invalid IL or missing references)
		//IL_0010: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_002b: Unknown result type (might be due to invalid IL or missing references)
		//IL_003b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0041: Unknown result type (might be due to invalid IL or missing references)
		//IL_0051: Unknown result type (might be due to invalid IL or missing references)
		//IL_0057: Unknown result type (might be due to invalid IL or missing references)
		//IL_0067: Unknown result type (might be due to invalid IL or missing references)
		//IL_006d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0084: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_009a: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00cc: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e9: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ea: Unknown result type (might be due to invalid IL or missing references)
		//IL_0111: Unknown result type (might be due to invalid IL or missing references)
		//IL_010f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0104: Unknown result type (might be due to invalid IL or missing references)
		//IL_00fc: Unknown result type (might be due to invalid IL or missing references)
		Quaternion val = default(Quaternion);
		((Quaternion)(ref val))..ctor(0f - targetRot.x, 0f - targetRot.y, 0f - targetRot.z, 0f - targetRot.w);
		Quaternion val2 = default(Quaternion);
		((Quaternion)(ref val2))..ctor(Mathf.LerpUnclamped(latestRot.x, targetRot.x, 0.5f), Mathf.LerpUnclamped(latestRot.y, targetRot.y, 0.5f), Mathf.LerpUnclamped(latestRot.z, targetRot.z, 0.5f), Mathf.LerpUnclamped(latestRot.w, targetRot.w, 0.5f));
		Quaternion val3 = default(Quaternion);
		((Quaternion)(ref val3))..ctor(Mathf.LerpUnclamped(latestRot.x, val.x, 0.5f), Mathf.LerpUnclamped(latestRot.y, val.y, 0.5f), Mathf.LerpUnclamped(latestRot.z, val.z, 0.5f), Mathf.LerpUnclamped(latestRot.w, val.w, 0.5f));
		float num = Quaternion.Angle(latestRot, val2);
		float num2 = Quaternion.Angle(latestRot, val3);
		if (normalize)
		{
			if (!(num2 < num))
			{
				return ((Quaternion)(ref targetRot)).normalized;
			}
			return ((Quaternion)(ref val)).normalized;
		}
		if (!(num2 < num))
		{
			return targetRot;
		}
		return val;
	}

	public static void UpdateHumanoidIKPreview(Animator mecanim, AnimationClip clip, float time, bool restoreAnimator = true)
	{
	}
}


using System.Collections.Generic;
using FIMSpace.AnimationTools;
using UnityEngine;

public static class SkeletonRecognize
{
	public enum EWhatIsIt
	{
		Unknown,
		Humanoidal,
		Quadroped,
		Creature
	}

	public class SkeletonInfo
	{
		public Transform AnimatorTransform;

		public float LowestVsHighestLen;

		public float MostLeftVsMostRightLen;

		public float MostForwVsMostBackLen;

		public float AverageLen;

		public Transform ProbablyRootBone;

		public Transform ProbablyHips;

		public Transform ProbablyChest;

		public Transform ProbablyHead;

		public List<Transform> TrReachingGround = new List<Transform>();

		public List<Transform> TrReachingSides = new List<Transform>();

		public List<Transform> TrEnds = new List<Transform>();

		public List<Transform> ProbablySpineChain = new List<Transform>();

		public List<Transform> ProbablySpineChainShort = new List<Transform>();

		public List<List<Transform>> ProbablyRightArms = new List<List<Transform>>();

		public List<List<Transform>> ProbablyLeftArms = new List<List<Transform>>();

		public List<List<Transform>> ProbablyLeftLegs = new List<List<Transform>>();

		public List<Transform> ProbablyLeftLegRoot = new List<Transform>();

		public List<List<Transform>> ProbablyRightLegs = new List<List<Transform>>();

		public List<Transform> ProbablyRightLegRoot = new List<Transform>();

		public Vector3 LocalSpaceHighest = Vector3.zero;

		public Vector3 LocalSpaceMostRight = Vector3.zero;

		public Vector3 LocalSpaceMostForward = Vector3.zero;

		public Vector3 LocalSpaceMostBack = Vector3.zero;

		public Vector3 LocalSpaceMostLeft = Vector3.zero;

		public Vector3 LocalSpaceLowest = Vector3.zero;

		public EWhatIsIt WhatIsIt;

		public int SpineChainLength => ProbablySpineChain.Count;

		public int LeftArms => ProbablyLeftArms.Count;

		public int LeftLegs => ProbablyLeftLegs.Count;

		public int RightArms => ProbablyRightArms.Count;

		public int RightLegs => ProbablyRightLegs.Count;

		public int Legs => RightLegs + LeftLegs;

		public int Arms => LeftArms + RightArms;

		public SkeletonInfo(Transform t, List<Transform> checkOnly = null, Transform pelvisHelp = null)
		{
			//IL_007a: Unknown result type (might be due to invalid IL or missing references)
			//IL_007f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0085: Unknown result type (might be due to invalid IL or missing references)
			//IL_008a: Unknown result type (might be due to invalid IL or missing references)
			//IL_0090: Unknown result type (might be due to invalid IL or missing references)
			//IL_0095: Unknown result type (might be due to invalid IL or missing references)
			//IL_009b: Unknown result type (might be due to invalid IL or missing references)
			//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
			//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
			//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
			//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
			//IL_0114: Unknown result type (might be due to invalid IL or missing references)
			//IL_0119: Unknown result type (might be due to invalid IL or missing references)
			//IL_011e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0121: Unknown result type (might be due to invalid IL or missing references)
			//IL_0123: Unknown result type (might be due to invalid IL or missing references)
			//IL_0129: Unknown result type (might be due to invalid IL or missing references)
			//IL_012b: Unknown result type (might be due to invalid IL or missing references)
			//IL_0131: Unknown result type (might be due to invalid IL or missing references)
			//IL_0133: Unknown result type (might be due to invalid IL or missing references)
			//IL_0139: Unknown result type (might be due to invalid IL or missing references)
			//IL_013b: Unknown result type (might be due to invalid IL or missing references)
			//IL_0141: Unknown result type (might be due to invalid IL or missing references)
			//IL_0143: Unknown result type (might be due to invalid IL or missing references)
			//IL_0149: Unknown result type (might be due to invalid IL or missing references)
			//IL_014b: Unknown result type (might be due to invalid IL or missing references)
			//IL_01b0: Unknown result type (might be due to invalid IL or missing references)
			//IL_01b5: Unknown result type (might be due to invalid IL or missing references)
			//IL_01ba: Unknown result type (might be due to invalid IL or missing references)
			//IL_01bc: Unknown result type (might be due to invalid IL or missing references)
			//IL_01da: Unknown result type (might be due to invalid IL or missing references)
			//IL_01d1: Unknown result type (might be due to invalid IL or missing references)
			//IL_01d3: Unknown result type (might be due to invalid IL or missing references)
			//IL_01f6: Unknown result type (might be due to invalid IL or missing references)
			//IL_01ef: Unknown result type (might be due to invalid IL or missing references)
			//IL_01f1: Unknown result type (might be due to invalid IL or missing references)
			//IL_0214: Unknown result type (might be due to invalid IL or missing references)
			//IL_020b: Unknown result type (might be due to invalid IL or missing references)
			//IL_020d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0230: Unknown result type (might be due to invalid IL or missing references)
			//IL_0229: Unknown result type (might be due to invalid IL or missing references)
			//IL_022b: Unknown result type (might be due to invalid IL or missing references)
			//IL_024e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0245: Unknown result type (might be due to invalid IL or missing references)
			//IL_0247: Unknown result type (might be due to invalid IL or missing references)
			//IL_0263: Unknown result type (might be due to invalid IL or missing references)
			//IL_0265: Unknown result type (might be due to invalid IL or missing references)
			//IL_058c: Unknown result type (might be due to invalid IL or missing references)
			//IL_0591: Unknown result type (might be due to invalid IL or missing references)
			//IL_0593: Unknown result type (might be due to invalid IL or missing references)
			//IL_05cd: Unknown result type (might be due to invalid IL or missing references)
			//IL_05ee: Unknown result type (might be due to invalid IL or missing references)
			//IL_0603: Unknown result type (might be due to invalid IL or missing references)
			//IL_1027: Unknown result type (might be due to invalid IL or missing references)
			//IL_102c: Unknown result type (might be due to invalid IL or missing references)
			//IL_1053: Unknown result type (might be due to invalid IL or missing references)
			//IL_1058: Unknown result type (might be due to invalid IL or missing references)
			//IL_105d: Unknown result type (might be due to invalid IL or missing references)
			//IL_1085: Unknown result type (might be due to invalid IL or missing references)
			//IL_108a: Unknown result type (might be due to invalid IL or missing references)
			//IL_10a8: Unknown result type (might be due to invalid IL or missing references)
			//IL_10ad: Unknown result type (might be due to invalid IL or missing references)
			//IL_10b2: Unknown result type (might be due to invalid IL or missing references)
			//IL_10da: Unknown result type (might be due to invalid IL or missing references)
			//IL_10df: Unknown result type (might be due to invalid IL or missing references)
			//IL_10fd: Unknown result type (might be due to invalid IL or missing references)
			//IL_1102: Unknown result type (might be due to invalid IL or missing references)
			//IL_1107: Unknown result type (might be due to invalid IL or missing references)
			//IL_0777: Unknown result type (might be due to invalid IL or missing references)
			//IL_077c: Unknown result type (might be due to invalid IL or missing references)
			//IL_077e: Unknown result type (might be due to invalid IL or missing references)
			//IL_068e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0693: Unknown result type (might be due to invalid IL or missing references)
			//IL_0695: Unknown result type (might be due to invalid IL or missing references)
			//IL_079f: Unknown result type (might be due to invalid IL or missing references)
			//IL_06ab: Unknown result type (might be due to invalid IL or missing references)
			//IL_09a3: Unknown result type (might be due to invalid IL or missing references)
			//IL_09b4: Unknown result type (might be due to invalid IL or missing references)
			//IL_07b5: Unknown result type (might be due to invalid IL or missing references)
			//IL_09ed: Unknown result type (might be due to invalid IL or missing references)
			//IL_09f2: Unknown result type (might be due to invalid IL or missing references)
			//IL_0a96: Unknown result type (might be due to invalid IL or missing references)
			//IL_0a9b: Unknown result type (might be due to invalid IL or missing references)
			//IL_0a9d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0ab3: Unknown result type (might be due to invalid IL or missing references)
			//IL_0ac8: Unknown result type (might be due to invalid IL or missing references)
			//IL_0acf: Unknown result type (might be due to invalid IL or missing references)
			//IL_0a28: Unknown result type (might be due to invalid IL or missing references)
			//IL_0a2d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0a2f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0b39: Unknown result type (might be due to invalid IL or missing references)
			//IL_0b45: Unknown result type (might be due to invalid IL or missing references)
			//IL_0adb: Unknown result type (might be due to invalid IL or missing references)
			//IL_0ae0: Unknown result type (might be due to invalid IL or missing references)
			//IL_0a45: Unknown result type (might be due to invalid IL or missing references)
			//IL_0a5d: Unknown result type (might be due to invalid IL or missing references)
			//IL_0a67: Unknown result type (might be due to invalid IL or missing references)
			//IL_0a73: Unknown result type (might be due to invalid IL or missing references)
			//IL_0a78: Unknown result type (might be due to invalid IL or missing references)
			//IL_0d29: Unknown result type (might be due to invalid IL or missing references)
			//IL_0d2e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0e56: Unknown result type (might be due to invalid IL or missing references)
			//IL_0e5b: Unknown result type (might be due to invalid IL or missing references)
			//IL_0dd9: Unknown result type (might be due to invalid IL or missing references)
			//IL_0f05: Unknown result type (might be due to invalid IL or missing references)
			AnimatorTransform = t;
			Transform[] array;
			if (checkOnly != null)
			{
				array = (Transform[])(object)new Transform[checkOnly.Count];
				for (int i = 0; i < checkOnly.Count; i++)
				{
					array[i] = checkOnly[i];
				}
			}
			else
			{
				array = ((Component)AnimatorTransform).GetComponentsInChildren<Transform>(true);
			}
			if (array.Length != 0)
			{
				LocalSpaceLowest = (LocalSpaceMostLeft = (LocalSpaceMostBack = (LocalSpaceMostForward = (LocalSpaceMostRight = (LocalSpaceHighest = AnimatorTransform.InverseTransformPoint(array[0].position))))));
			}
			List<Transform> list = new List<Transform>();
			foreach (Transform val in array)
			{
				if (!((Object)(object)((Component)val).GetComponentInChildren<SkinnedMeshRenderer>() != (Object)null))
				{
					list.Add(val);
				}
			}
			for (int k = 0; k < list.Count; k++)
			{
				Transform val2 = list[k];
				if (!Object.op_Implicit((Object)(object)((Component)val2).GetComponent<SkinnedMeshRenderer>()))
				{
					Vector3 val3 = AnimatorTransform.InverseTransformPoint(val2.position);
					if (val3.x > LocalSpaceMostRight.x)
					{
						LocalSpaceMostRight = val3;
					}
					else if (val3.x < LocalSpaceMostLeft.x)
					{
						LocalSpaceMostLeft = val3;
					}
					if (val3.z > LocalSpaceMostForward.z)
					{
						LocalSpaceMostForward = val3;
					}
					else if (val3.z < LocalSpaceMostBack.z)
					{
						LocalSpaceMostBack = val3;
					}
					if (val3.y > LocalSpaceHighest.y)
					{
						LocalSpaceHighest = val3;
					}
					else if (val3.y < LocalSpaceLowest.y)
					{
						LocalSpaceLowest = val3;
					}
				}
			}
			LowestVsHighestLen = Mathf.Abs(LocalSpaceLowest.y - LocalSpaceHighest.y);
			MostLeftVsMostRightLen = Mathf.Abs(LocalSpaceMostLeft.x - LocalSpaceMostRight.x);
			MostForwVsMostBackLen = Mathf.Abs(LocalSpaceMostForward.z - LocalSpaceMostBack.z);
			AverageLen = (LowestVsHighestLen + MostLeftVsMostRightLen + MostForwVsMostBackLen) / 3f;
			_ = LowestVsHighestLen;
			for (int l = 0; l < list.Count; l++)
			{
				Transform val4 = list[l];
				if (NameContains(((Object)val4).name, ShouldersNames))
				{
					Transform bottomMostChildTransform = GetBottomMostChildTransform(val4);
					if (NotContainedYetByLimbs(bottomMostChildTransform))
					{
						TrReachingSides.Add(bottomMostChildTransform);
					}
				}
				else if (NameContains(((Object)val4).name, ElbowNames))
				{
					Transform bottomMostChildTransform2 = GetBottomMostChildTransform(val4);
					if (NotContainedYetByLimbs(bottomMostChildTransform2))
					{
						TrReachingSides.Add(bottomMostChildTransform2);
					}
				}
			}
			for (int m = 0; m < list.Count; m++)
			{
				Transform val5 = list[m];
				if (NameContains(((Object)val5).name, UpperLegNames))
				{
					Transform bottomMostChildTransform3 = GetBottomMostChildTransform(val5);
					if (NotContainedYetByLimbs(bottomMostChildTransform3))
					{
						TrReachingGround.Add(bottomMostChildTransform3);
					}
				}
				else if (NameContains(((Object)val5).name, KneeNames))
				{
					Transform bottomMostChildTransform4 = GetBottomMostChildTransform(val5);
					if (NotContainedYetByLimbs(bottomMostChildTransform4))
					{
						TrReachingGround.Add(bottomMostChildTransform4);
					}
				}
			}
			bool flag = false;
			for (int n = 0; n < list.Count; n++)
			{
				Transform val6 = list[n];
				if (NameContains(((Object)val6).name, PelvisNames))
				{
					flag = true;
					ProbablyHips = val6;
					break;
				}
			}
			bool flag2 = false;
			for (int num = 0; num < list.Count; num++)
			{
				Transform val7 = list[num];
				if (NameContains(((Object)val7).name, ChestNames))
				{
					flag2 = true;
					ProbablyChest = val7;
					break;
				}
			}
			bool flag3 = false;
			for (int num2 = 0; num2 < list.Count; num2++)
			{
				Transform val8 = list[num2];
				if (NameContains(((Object)val8).name, HeadNames))
				{
					flag3 = true;
					ProbablyHead = val8;
					break;
				}
			}
			if ((Object)(object)ProbablyHead != (Object)null && (Object)(object)ProbablyHips != (Object)null && !IsChildOf(ProbablyHead, ProbablyHips))
			{
				ProbablyHead = null;
			}
			for (int num3 = 0; num3 < list.Count; num3++)
			{
				Transform val9 = list[num3];
				if (NameContains(((Object)val9).name, RootNames))
				{
					ProbablyRootBone = val9;
					break;
				}
			}
			if (list.Count > 2)
			{
				for (int num4 = 1; num4 < list.Count; num4++)
				{
					Transform val10 = list[num4];
					if (val10.childCount != 0)
					{
						continue;
					}
					TrEnds.Add(val10);
					Vector3 val11 = Loc(val10);
					if (val11.y < LocalSpaceLowest.y + LowestVsHighestLen * 0.1f)
					{
						if (NotContainedYetByLimbs(val10))
						{
							TrReachingGround.Add(val10);
						}
					}
					else if (val11.y > LocalSpaceLowest.y + LowestVsHighestLen * 0.2f && (val11.x < MostLeftVsMostRightLen * -0.1f || val11.x > MostLeftVsMostRightLen * 0.1f) && NotContainedYetByLimbs(val10))
					{
						TrReachingSides.Add(val10);
					}
				}
			}
			if (!flag2)
			{
				List<Transform> list2 = new List<Transform>();
				for (int num5 = 0; num5 < TrReachingSides.Count; num5++)
				{
					if (Object.op_Implicit((Object)(object)((Component)list[num5]).GetComponent<SkinnedMeshRenderer>()))
					{
						continue;
					}
					Transform parent = TrReachingSides[num5].parent;
					while ((Object)(object)parent != (Object)null)
					{
						if (parent.childCount > 2)
						{
							Vector3 val12 = Loc(parent);
							if (val12.x > (0f - MostLeftVsMostRightLen) * 0.03f && val12.x < MostLeftVsMostRightLen * 0.03f)
							{
								list2.Add(parent);
								break;
							}
						}
						parent = parent.parent;
					}
				}
				if (list2.Count == 1)
				{
					ProbablyChest = list2[0];
				}
				else if (list2.Count > 1 && (Object)(object)list2[0] == (Object)(object)list2[1])
				{
					ProbablyChest = list2[0];
				}
			}
			if (!flag)
			{
				List<Transform> list3 = new List<Transform>();
				for (int num6 = 0; num6 < TrReachingGround.Count; num6++)
				{
					Transform parent2 = TrReachingGround[num6].parent;
					while ((Object)(object)parent2 != (Object)null)
					{
						if (parent2.childCount > 2)
						{
							Vector3 val13 = Loc(parent2);
							if (val13.y > LocalSpaceLowest.y + LowestVsHighestLen * 0.04f && val13.x > (0f - MostLeftVsMostRightLen) * 0.02f && val13.x < MostLeftVsMostRightLen * 0.02f)
							{
								list3.Add(parent2);
								break;
							}
						}
						parent2 = parent2.parent;
					}
				}
				if (list3.Count == 1)
				{
					ProbablyChest = list3[0];
				}
				else if (list3.Count > 1 && (Object)(object)list3[0] == (Object)(object)list3[1])
				{
					ProbablyHips = list3[0];
				}
			}
			if ((Object)(object)ProbablyHips == (Object)null)
			{
				ProbablyHips = pelvisHelp;
			}
			if (((Object)(object)ProbablyChest == (Object)null || (Object)(object)ProbablyChest == (Object)(object)ProbablyHips || ((Object)(object)ProbablyHips != (Object)null && !IsChildOf(ProbablyChest, ProbablyHips))) && Object.op_Implicit((Object)(object)ProbablyHips) && Object.op_Implicit((Object)(object)ProbablyHead))
			{
				Transform parent3 = ProbablyHead.parent;
				bool flag4 = false;
				while ((Object)(object)parent3.parent != (Object)null && (Object)(object)parent3.parent != (Object)(object)ProbablyHips)
				{
					if (parent3.childCount > 2)
					{
						for (int num7 = 0; num7 < TrReachingSides.Count; num7++)
						{
							if (IsChildOf(TrReachingSides[num7], parent3))
							{
								flag4 = true;
								break;
							}
						}
					}
					if (flag4)
					{
						break;
					}
					parent3 = parent3.parent;
				}
				if (flag4)
				{
					ProbablyChest = parent3;
				}
			}
			if ((Object)(object)ProbablyHips == (Object)null)
			{
				ProbablyHips = pelvisHelp;
			}
			if (Object.op_Implicit((Object)(object)ProbablyChest) && Object.op_Implicit((Object)(object)ProbablyHips))
			{
				if (MostForwVsMostBackLen > LowestVsHighestLen * 0.9f && Loc(ProbablyChest).z < Loc(ProbablyHips).z)
				{
					Transform probablyChest = ProbablyChest;
					ProbablyChest = ProbablyHips;
					ProbablyHips = probablyChest;
					Debug.Log((object)"Hips - Chest - Reversed Detection Swap!");
				}
				if (!flag3)
				{
					Vector3 val14 = Vector3.zero;
					for (int num8 = 0; num8 < ProbablyChest.childCount; num8++)
					{
						Transform child = ProbablyChest.GetChild(num8);
						Vector3 val15;
						if (child.childCount > 0)
						{
							for (int num9 = 0; num9 < child.childCount; num9++)
							{
								Transform child2 = child.GetChild(num9);
								val15 = Loc(child2);
								if (val15.x > (0f - MostLeftVsMostRightLen) * 0.04f && val15.x < MostLeftVsMostRightLen * 0.04f && Loc(child2).y > val14.y)
								{
									val14 = Loc(child2);
									ProbablyHead = child2;
								}
							}
						}
						val15 = Loc(child);
						if (val15.x > (0f - MostLeftVsMostRightLen) * 0.04f && val15.x < MostLeftVsMostRightLen * 0.04f && val15.y > val14.y)
						{
							val14 = Loc(child);
							ProbablyHead = child;
						}
					}
					if (Object.op_Implicit((Object)(object)ProbablyChest) && Object.op_Implicit((Object)(object)ProbablyHead) && Object.op_Implicit((Object)(object)ProbablyHips))
					{
						float num10 = Vector3.Distance(Loc(ProbablyChest), Loc(ProbablyHips));
						if ((ProbablyChest.childCount < 3 || num10 < AverageLen * 0.12f) && ProbablyHead.childCount > 1)
						{
							ProbablyChest = ProbablyHead;
							ProbablyHead = GetHighestChild(ProbablyHead, AnimatorTransform, MostLeftVsMostRightLen * 0.05f);
							if ((Object)(object)ProbablyHead == (Object)(object)ProbablyChest)
							{
								ProbablyHead = ProbablyChest.GetChild(0);
							}
						}
					}
				}
				if (Object.op_Implicit((Object)(object)ProbablyHead))
				{
					for (int num11 = TrReachingSides.Count - 1; num11 >= 0; num11--)
					{
						if (IsChildOf(TrReachingSides[num11], ProbablyHead))
						{
							TrReachingSides.RemoveAt(num11);
						}
					}
				}
				for (int num12 = TrReachingSides.Count - 1; num12 >= 0; num12--)
				{
					if (GetDepth(TrReachingSides[num12], AnimatorTransform) < 5)
					{
						TrReachingSides.RemoveAt(num12);
					}
				}
				Transform val16 = null;
				if (Object.op_Implicit((Object)(object)ProbablyHead))
				{
					ProbablySpineChain.Add(ProbablyHead);
					val16 = ProbablyHead.parent;
				}
				while ((Object)(object)val16 != (Object)null && (Object)(object)val16 != (Object)(object)ProbablyHips)
				{
					ProbablySpineChain.Add(val16);
					val16 = val16.parent;
				}
				ProbablySpineChain.Reverse();
				for (int num13 = 0; num13 < Mathf.Min(4, ProbablySpineChain.Count); num13++)
				{
					ProbablySpineChainShort.Add(ProbablySpineChain[num13]);
				}
				List<Transform> list4 = new List<Transform>();
				for (int num14 = 0; num14 < TrReachingGround.Count; num14++)
				{
					Transform val17 = TrReachingGround[num14];
					Vector3 val18 = Loc(val17);
					List<Transform> list5 = new List<Transform>();
					Transform val19 = val17;
					while ((Object)(object)val19 != (Object)null && (Object)(object)val19 != (Object)(object)ProbablyHips && (Object)(object)val19 != (Object)(object)ProbablyChest)
					{
						list5.Add(val19);
						val19 = val19.parent;
					}
					if (list5.Count >= 3)
					{
						List<Transform> item = new List<Transform>
						{
							list5[list5.Count - 1],
							list5[list5.Count - 2],
							list5[list5.Count - 3]
						};
						list4.Add(val17);
						if (val18.x < MostLeftVsMostRightLen * 0.02f)
						{
							ProbablyLeftLegs.Add(item);
							ProbablyLeftLegRoot.Add(val19);
						}
						else
						{
							ProbablyRightLegs.Add(item);
							ProbablyRightLegRoot.Add(val19);
						}
					}
				}
				for (int num15 = 0; num15 < TrReachingSides.Count; num15++)
				{
					Transform val20 = TrReachingSides[num15];
					Vector3 val21 = Loc(val20);
					List<Transform> list6 = new List<Transform>();
					Transform val22 = val20;
					while ((Object)(object)val22 != (Object)null && (Object)(object)val22 != (Object)(object)ProbablyChest)
					{
						list6.Add(val22);
						val22 = val22.parent;
					}
					if (list6.Count >= 4)
					{
						List<Transform> item2 = new List<Transform>
						{
							list6[list6.Count - 1],
							list6[list6.Count - 2],
							list6[list6.Count - 3],
							list6[list6.Count - 4]
						};
						if (val21.x < MostLeftVsMostRightLen * 0.02f)
						{
							ProbablyLeftArms.Add(item2);
						}
						else
						{
							ProbablyRightArms.Add(item2);
						}
					}
				}
				ClearDuplicates(ProbablyLeftArms, null);
				ClearDuplicates(ProbablyRightArms, null);
				ClearDuplicates(ProbablyLeftLegs, ProbablyLeftLegRoot);
				ClearDuplicates(ProbablyRightLegs, ProbablyRightLegRoot);
				if (Legs == 2 && Arms == 2)
				{
					WhatIsIt = EWhatIsIt.Humanoidal;
				}
				else if (Legs == 4 && Arms == 0)
				{
					WhatIsIt = EWhatIsIt.Quadroped;
				}
				else if (Legs > 0 || Arms > 0)
				{
					WhatIsIt = EWhatIsIt.Creature;
				}
				else
				{
					WhatIsIt = EWhatIsIt.Unknown;
				}
			}
			float num16 = Mathf.Lerp(LocalSpaceLowest.y, LocalSpaceHighest.y, 0.5f);
			Debug.DrawLine(t.TransformPoint(new Vector3(LocalSpaceMostLeft.x, LocalSpaceHighest.y, LocalSpaceMostForward.z)), t.TransformPoint(new Vector3(LocalSpaceMostLeft.x, LocalSpaceLowest.y, LocalSpaceMostForward.z)), Color.green, 12f);
			Debug.DrawLine(t.TransformPoint(new Vector3(LocalSpaceMostLeft.x, num16, LocalSpaceMostForward.z)), t.TransformPoint(new Vector3(LocalSpaceMostRight.x, num16, LocalSpaceMostForward.z)), Color.red, 12f);
			Debug.DrawLine(t.TransformPoint(new Vector3(LocalSpaceMostRight.x, num16, LocalSpaceMostForward.z)), t.TransformPoint(new Vector3(LocalSpaceMostRight.x, num16, LocalSpaceMostBack.z)), Color.blue, 12f);
		}

		private bool NotContainedYetByAny(Transform t)
		{
			if (!TrReachingSides.Contains(t) && !TrReachingGround.Contains(t) && !TrEnds.Contains(t) && (Object)(object)t != (Object)(object)ProbablyChest && (Object)(object)t != (Object)(object)ProbablyHips && (Object)(object)t != (Object)(object)ProbablyHead && (Object)(object)t != (Object)(object)ProbablyChest && (Object)(object)t != (Object)(object)ProbablyRootBone)
			{
				return (Object)(object)t != (Object)(object)AnimatorTransform;
			}
			return false;
		}

		private bool NotContainedYetByLimbs(Transform t)
		{
			if (!TrReachingSides.Contains(t))
			{
				return !TrReachingGround.Contains(t);
			}
			return false;
		}

		public Transform GetHighestChild(Transform t, Transform root, float inCenterRangeFactor)
		{
			//IL_000f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0014: Unknown result type (might be due to invalid IL or missing references)
			//IL_0019: Unknown result type (might be due to invalid IL or missing references)
			//IL_002e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0033: Unknown result type (might be due to invalid IL or missing references)
			//IL_0038: Unknown result type (might be due to invalid IL or missing references)
			//IL_003a: Unknown result type (might be due to invalid IL or missing references)
			//IL_0045: Unknown result type (might be due to invalid IL or missing references)
			//IL_004f: Unknown result type (might be due to invalid IL or missing references)
			//IL_0056: Unknown result type (might be due to invalid IL or missing references)
			//IL_0060: Unknown result type (might be due to invalid IL or missing references)
			if ((Object)(object)t == (Object)null)
			{
				return null;
			}
			Transform result = t;
			Vector3 val = root.InverseTransformPoint(t.position);
			Transform[] componentsInChildren = ((Component)t).GetComponentsInChildren<Transform>(true);
			foreach (Transform val2 in componentsInChildren)
			{
				Vector3 val3 = root.InverseTransformPoint(val2.position);
				if (val3.x > 0f - inCenterRangeFactor && val3.x < inCenterRangeFactor && val3.y > val.y)
				{
					val.y = val3.y;
					result = val2;
				}
			}
			return result;
		}

		private void ClearDuplicates(List<List<Transform>> limbs, List<Transform> roots)
		{
			if (limbs.Count <= 1)
			{
				return;
			}
			for (int i = 0; i < limbs.Count && i < limbs.Count; i++)
			{
				List<Transform> list = limbs[i];
				for (int num = limbs.Count - 1; num >= 0; num--)
				{
					if (num != i)
					{
						List<Transform> list2 = limbs[num];
						bool flag = false;
						for (int j = 0; j < list2.Count; j++)
						{
							if (list.Contains(list2[j]))
							{
								flag = true;
								break;
							}
						}
						if (flag)
						{
							limbs.RemoveAt(num);
						}
					}
				}
			}
		}

		private Vector3 Loc(Transform t)
		{
			//IL_0007: Unknown result type (might be due to invalid IL or missing references)
			//IL_000c: Unknown result type (might be due to invalid IL or missing references)
			return AnimatorTransform.InverseTransformPoint(t.position);
		}

		public string GetLog()
		{
			//IL_002e: Unknown result type (might be due to invalid IL or missing references)
			//IL_0033: Unknown result type (might be due to invalid IL or missing references)
			//IL_0053: Unknown result type (might be due to invalid IL or missing references)
			//IL_0058: Unknown result type (might be due to invalid IL or missing references)
			//IL_0078: Unknown result type (might be due to invalid IL or missing references)
			//IL_007d: Unknown result type (might be due to invalid IL or missing references)
			//IL_009d: Unknown result type (might be due to invalid IL or missing references)
			//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
			//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
			//IL_00c7: Unknown result type (might be due to invalid IL or missing references)
			//IL_00e7: Unknown result type (might be due to invalid IL or missing references)
			//IL_00ec: Unknown result type (might be due to invalid IL or missing references)
			string text = "< " + ((Object)AnimatorTransform).name + " >\n";
			text += "\nGenerate Guides:\n";
			string text2 = text;
			Vector3 val = LocalSpaceHighest;
			text = text2 + "Highest: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
			string text3 = text;
			val = LocalSpaceLowest;
			text = text3 + "Lowest: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
			string text4 = text;
			val = LocalSpaceMostLeft;
			text = text4 + "Left: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
			string text5 = text;
			val = LocalSpaceMostRight;
			text = text5 + "Right: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
			string text6 = text;
			val = LocalSpaceMostForward;
			text = text6 + "Forward: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
			string text7 = text;
			val = LocalSpaceMostBack;
			text = text7 + "Back: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
			text += "\n\nGenerated Helper Measurements: \n";
			text = text + "UpDown: " + LowestVsHighestLen + "     ";
			text = text + "LeftRight: " + MostLeftVsMostRightLen + "     ";
			text = text + "ForwBack: " + MostForwVsMostBackLen + "     ";
			text = text + "Avr: " + AverageLen + "     ";
			text += "\n\nDetected Propabilities: \n";
			text = text + "ProbablyHips: " + ((object)ProbablyHips)?.ToString() + "     ";
			text = text + "ProbablyChest: " + ((object)ProbablyChest)?.ToString() + "     ";
			text = text + "ProbablyHead: " + ((object)ProbablyHead)?.ToString() + "     ";
			text += "\n\nLimb End Detections: \n";
			text = text + "Reaching Ground: " + TrReachingGround.Count + "     ";
			text = text + "Reaching Sides: " + TrReachingSides.Count + "     ";
			text = text + "Spine Chain Length: " + ProbablySpineChain.Count + " (" + ProbablySpineChainShort.Count + ")     ";
			text += "\n\nDetected Propabilities: \n";
			text = text + "Probably Left Arms: " + ProbablyLeftArms.Count + "     ";
			text = text + "Probably Right Arms: " + ProbablyRightArms.Count + "     ";
			text = text + "Probably Left Legs: " + ProbablyLeftLegs.Count + "     ";
			text = text + "Probably Right Legs: " + ProbablyRightLegs.Count + "     ";
			text += "\n\n\nTr Ends: \n";
			for (int i = 0; i < TrEnds.Count; i++)
			{
				if (!((Object)(object)TrEnds[i] == (Object)null))
				{
					text = text + ((Object)TrEnds[i]).name + "     ";
				}
			}
			text += "\n\nTr Reaching Ground: \n";
			for (int j = 0; j < TrReachingGround.Count; j++)
			{
				if (!((Object)(object)TrReachingGround[j] == (Object)null))
				{
					text = text + ((Object)TrReachingGround[j]).name + "     ";
				}
			}
			text += "\n\nTr Reaching Sides: \n";
			for (int k = 0; k < TrReachingSides.Count; k++)
			{
				if (!((Object)(object)TrReachingSides[k] == (Object)null))
				{
					text = text + ((Object)TrReachingSides[k]).name + "     ";
				}
			}
			if (ProbablyLeftArms.Count > 0)
			{
				text += "\n\nDebug Left Arms: \n";
				for (int l = 0; l < ProbablyLeftArms.Count; l++)
				{
					if (ProbablyLeftArms[l] != null)
					{
						text = text + "[" + l + "] ";
						for (int m = 0; m < ProbablyLeftArms[l].Count; m++)
						{
							text = text + ((Object)ProbablyLeftArms[l][m]).name + "  ";
						}
						text += "\n";
					}
				}
			}
			if (ProbablySpineChainShort.Count > 0)
			{
				text += "\n\nDebug Spine Chain: \n";
				for (int n = 0; n < ProbablySpineChainShort.Count; n++)
				{
					if (!((Object)(object)ProbablySpineChainShort[n] == (Object)null))
					{
						text = text + ((Object)ProbablySpineChainShort[n]).name + "  ";
					}
				}
			}
			return text + "\n\n";
		}

		public static int GetDepth(Transform t, Transform skelRootBone)
		{
			int num = 0;
			if ((Object)(object)t == (Object)(object)skelRootBone)
			{
				return 0;
			}
			if ((Object)(object)t == (Object)null)
			{
				return 0;
			}
			if ((Object)(object)t.parent == (Object)null)
			{
				return 0;
			}
			while ((Object)(object)t != (Object)null && (Object)(object)t != (Object)(object)skelRootBone)
			{
				t = t.parent;
				num++;
			}
			return num;
		}
	}

	public static Component FoundAnimator;

	private static bool checkForAnim = true;

	private static int clicks = 0;

	public static readonly string[] SpineNames = new string[1] { "spine" };

	public static readonly string[] NeckNames = new string[1] { "neck" };

	public static readonly string[] HeadNames = new string[1] { "head" };

	public static readonly string[] RootNames = new string[3] { "root", "origin", "skel" };

	public static readonly string[] PelvisNames = new string[3] { "pelvis", "hips", "pelv" };

	public static readonly string[] ChestNames = new string[2] { "chest", "upperspine" };

	public static readonly string[] ShouldersNames = new string[3] { "shoulde", "collarbon", "clavicl" };

	public static readonly string[] UpperLegNames = new string[2] { "upperleg", "thigh" };

	public static readonly string[] KneeNames = new string[3] { "knee", "calf", "lowerleg" };

	public static readonly string[] ElbowNames = new string[2] { "elbow", "lowerarm" };

	public static bool IsChildOf(Transform child, Transform parent)
	{
		Transform val = child;
		while ((Object)(object)val != (Object)null)
		{
			if ((Object)(object)val == (Object)(object)parent)
			{
				return true;
			}
			val = val.parent;
		}
		return false;
	}

	public static Transform GetBottomMostChildTransform(Transform parent)
	{
		Transform[] componentsInChildren = ((Component)parent).GetComponentsInChildren<Transform>(true);
		int num = 0;
		Transform result = parent;
		for (int i = 0; i < componentsInChildren.Length; i++)
		{
			if (!((Object)(object)componentsInChildren[i] == (Object)(object)parent))
			{
				Transform val = componentsInChildren[i];
				int num2 = 0;
				while ((Object)(object)val.parent != (Object)(object)parent && (Object)(object)val.parent != (Object)null)
				{
					num2++;
					val = val.parent;
				}
				if (num2 > num)
				{
					num = num2;
					result = componentsInChildren[i];
				}
			}
		}
		return result;
	}

	public static Transform GetContinousChildTransform(Transform root)
	{
		Transform result = null;
		if (root.childCount > 0)
		{
			if (root.childCount == 1)
			{
				return root.GetChild(0);
			}
			int num = 0;
			Transform child = root.GetChild(0);
			for (int i = 0; i < root.childCount; i++)
			{
				int num2 = CountChildChainLength(root.GetChild(i));
				if (num2 > num)
				{
					num = num2;
					child = root.GetChild(i);
				}
			}
			result = child;
		}
		return result;
	}

	public static int CountChildChainLength(Transform root)
	{
		if ((Object)(object)root == (Object)null)
		{
			return 0;
		}
		if (root.childCount == 0)
		{
			return 0;
		}
		return GetDepth(GetBottomMostChildTransform(root), root);
	}

	public static int GetDepth(Transform t, Transform skelRootBone)
	{
		int num = 0;
		if ((Object)(object)t == (Object)(object)skelRootBone)
		{
			return 0;
		}
		if ((Object)(object)t == (Object)null)
		{
			return 0;
		}
		if ((Object)(object)t.parent == (Object)null)
		{
			return 0;
		}
		while ((Object)(object)t != (Object)null && (Object)(object)t != (Object)(object)skelRootBone)
		{
			t = t.parent;
			num++;
		}
		return num;
	}

	public static Transform GetParent(Transform start, int depth)
	{
		if ((Object)(object)start == (Object)null)
		{
			return null;
		}
		Transform parent = start.parent;
		for (int i = 0; i < depth; i++)
		{
			if ((Object)(object)parent == (Object)null)
			{
				break;
			}
			parent = parent.parent;
		}
		return parent;
	}

	public static Transform GetLastChild(Transform rootParent)
	{
		Transform val = rootParent;
		while (val.childCount > 0)
		{
			val = val.GetChild(0);
		}
		return val;
	}

	public static bool? IsRightOrLeft(string name, bool includeNotSure = false)
	{
		string text = name.ToLower();
		if (text.Contains("right"))
		{
			return true;
		}
		if (text.Contains("left"))
		{
			return false;
		}
		if (text.StartsWith("r_"))
		{
			return true;
		}
		if (text.StartsWith("l_"))
		{
			return false;
		}
		if (text.EndsWith("_r"))
		{
			return true;
		}
		if (text.EndsWith("_l"))
		{
			return false;
		}
		if (text.StartsWith("r."))
		{
			return true;
		}
		if (text.StartsWith("l."))
		{
			return false;
		}
		if (text.EndsWith(".r"))
		{
			return true;
		}
		if (text.EndsWith(".l"))
		{
			return false;
		}
		if (includeNotSure)
		{
			if (text.Contains("r_"))
			{
				return true;
			}
			if (text.Contains("l_"))
			{
				return false;
			}
			if (text.Contains("_r"))
			{
				return true;
			}
			if (text.Contains("_l"))
			{
				return false;
			}
			if (text.Contains("r."))
			{
				return true;
			}
			if (text.Contains("l."))
			{
				return false;
			}
			if (text.Contains(".r"))
			{
				return true;
			}
			if (text.Contains(".l"))
			{
				return false;
			}
		}
		return null;
	}

	public static bool? IsRightOrLeft(Transform child, Transform itsRoot)
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_000d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0021: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = itsRoot.InverseTransformPoint(child.position);
		if (val.x < 0f)
		{
			return false;
		}
		if (val.x > 0f)
		{
			return true;
		}
		return null;
	}

	public static void ResetFinders(bool resetClicks = true)
	{
		checkForAnim = true;
		FoundAnimator = null;
		if (resetClicks)
		{
			clicks = 0;
		}
	}

	public static bool CheckForAnimator(GameObject root, bool needAnimatorBox = true, bool drawInactiveWarning = true, int clicksTohide = 1)
	{
		bool flag = false;
		if (checkForAnim)
		{
			FoundAnimator = SearchForParentWithAnimator(root);
		}
		if (Object.op_Implicit((Object)(object)FoundAnimator))
		{
			Component foundAnimator = FoundAnimator;
			Animation val = (Animation)(object)((foundAnimator is Animation) ? foundAnimator : null);
			Component foundAnimator2 = FoundAnimator;
			Animator val2 = (Animator)(object)((foundAnimator2 is Animator) ? foundAnimator2 : null);
			if (Object.op_Implicit((Object)(object)val) && ((Behaviour)val).enabled)
			{
				flag = true;
			}
			if (Object.op_Implicit((Object)(object)val2))
			{
				if (((Behaviour)val2).enabled)
				{
					flag = true;
				}
				if ((Object)(object)val2.runtimeAnimatorController == (Object)null)
				{
					drawInactiveWarning = false;
					flag = false;
				}
			}
			if (needAnimatorBox && drawInactiveWarning && flag)
			{
			}
		}
		else if (needAnimatorBox)
		{
			_ = clicks;
		}
		checkForAnim = false;
		return flag;
	}

	public static Component SearchForParentWithAnimator(GameObject root)
	{
		Animation componentInChildren = root.GetComponentInChildren<Animation>();
		if (Object.op_Implicit((Object)(object)componentInChildren))
		{
			return (Component)(object)componentInChildren;
		}
		Animator componentInChildren2 = root.GetComponentInChildren<Animator>();
		if (Object.op_Implicit((Object)(object)componentInChildren2))
		{
			return (Component)(object)componentInChildren2;
		}
		if ((Object)(object)root.transform.parent != (Object)null)
		{
			Transform parent = root.transform.parent;
			while ((Object)(object)parent != (Object)null)
			{
				componentInChildren = ((Component)parent).GetComponent<Animation>();
				if (Object.op_Implicit((Object)(object)componentInChildren))
				{
					return (Component)(object)componentInChildren;
				}
				componentInChildren2 = ((Component)parent).GetComponent<Animator>();
				if (Object.op_Implicit((Object)(object)componentInChildren2))
				{
					return (Component)(object)componentInChildren2;
				}
				parent = parent.parent;
			}
		}
		return null;
	}

	public static SkinnedMeshRenderer GetBoneSearchArray(Transform root)
	{
		List<SkinnedMeshRenderer> list = new List<SkinnedMeshRenderer>();
		SkinnedMeshRenderer val = null;
		Transform[] componentsInChildren = ((Component)root).GetComponentsInChildren<Transform>();
		for (int i = 0; i < componentsInChildren.Length; i++)
		{
			SkinnedMeshRenderer component = ((Component)componentsInChildren[i]).GetComponent<SkinnedMeshRenderer>();
			if (Object.op_Implicit((Object)(object)component))
			{
				list.Add(component);
			}
		}
		if (list.Count == 0)
		{
			Transform val2 = root;
			while ((Object)(object)val2 != (Object)null && !((Object)(object)val2.parent == (Object)null))
			{
				val2 = val2.parent;
			}
			componentsInChildren = ((Component)val2).GetComponentsInChildren<Transform>();
			for (int i = 0; i < componentsInChildren.Length; i++)
			{
				SkinnedMeshRenderer component2 = ((Component)componentsInChildren[i]).GetComponent<SkinnedMeshRenderer>();
				if (!list.Contains(component2) && Object.op_Implicit((Object)(object)component2))
				{
					list.Add(component2);
				}
			}
		}
		if (list.Count > 1)
		{
			val = list[0];
			for (int j = 1; j < list.Count; j++)
			{
				if (list[j].bones.Length > val.bones.Length)
				{
					val = list[j];
				}
			}
		}
		else if (list.Count > 0)
		{
			val = list[0];
		}
		if ((Object)(object)val == (Object)null)
		{
			return null;
		}
		return val;
	}

	public static bool HaveKey(string text, string[] keys)
	{
		for (int i = 0; i < keys.Length; i++)
		{
			if (text.Contains(keys[i]))
			{
				return true;
			}
		}
		return false;
	}

	public static bool NameContains(string name, string[] names)
	{
		string text = name.ToLower();
		text = text.Replace("-", "");
		text = text.Replace(" ", "");
		text = text.Replace("_", "");
		text = text.Replace("|", "");
		text = text.Replace("@", "");
		for (int i = 0; i < names.Length; i++)
		{
			if (text.Contains(names[i]))
			{
				return true;
			}
		}
		return false;
	}
}


public enum EWhatIsIt
{
	Unknown,
	Humanoidal,
	Quadroped,
	Creature
}


using System.Collections.Generic;
using UnityEngine;

public class SkeletonInfo
{
	public Transform AnimatorTransform;

	public float LowestVsHighestLen;

	public float MostLeftVsMostRightLen;

	public float MostForwVsMostBackLen;

	public float AverageLen;

	public Transform ProbablyRootBone;

	public Transform ProbablyHips;

	public Transform ProbablyChest;

	public Transform ProbablyHead;

	public List<Transform> TrReachingGround = new List<Transform>();

	public List<Transform> TrReachingSides = new List<Transform>();

	public List<Transform> TrEnds = new List<Transform>();

	public List<Transform> ProbablySpineChain = new List<Transform>();

	public List<Transform> ProbablySpineChainShort = new List<Transform>();

	public List<List<Transform>> ProbablyRightArms = new List<List<Transform>>();

	public List<List<Transform>> ProbablyLeftArms = new List<List<Transform>>();

	public List<List<Transform>> ProbablyLeftLegs = new List<List<Transform>>();

	public List<Transform> ProbablyLeftLegRoot = new List<Transform>();

	public List<List<Transform>> ProbablyRightLegs = new List<List<Transform>>();

	public List<Transform> ProbablyRightLegRoot = new List<Transform>();

	public Vector3 LocalSpaceHighest = Vector3.zero;

	public Vector3 LocalSpaceMostRight = Vector3.zero;

	public Vector3 LocalSpaceMostForward = Vector3.zero;

	public Vector3 LocalSpaceMostBack = Vector3.zero;

	public Vector3 LocalSpaceMostLeft = Vector3.zero;

	public Vector3 LocalSpaceLowest = Vector3.zero;

	public EWhatIsIt WhatIsIt;

	public int SpineChainLength => ProbablySpineChain.Count;

	public int LeftArms => ProbablyLeftArms.Count;

	public int LeftLegs => ProbablyLeftLegs.Count;

	public int RightArms => ProbablyRightArms.Count;

	public int RightLegs => ProbablyRightLegs.Count;

	public int Legs => RightLegs + LeftLegs;

	public int Arms => LeftArms + RightArms;

	public SkeletonInfo(Transform t, List<Transform> checkOnly = null, Transform pelvisHelp = null)
	{
		//IL_007a: Unknown result type (might be due to invalid IL or missing references)
		//IL_007f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0085: Unknown result type (might be due to invalid IL or missing references)
		//IL_008a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0090: Unknown result type (might be due to invalid IL or missing references)
		//IL_0095: Unknown result type (might be due to invalid IL or missing references)
		//IL_009b: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a0: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a6: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b1: Unknown result type (might be due to invalid IL or missing references)
		//IL_00b6: Unknown result type (might be due to invalid IL or missing references)
		//IL_0114: Unknown result type (might be due to invalid IL or missing references)
		//IL_0119: Unknown result type (might be due to invalid IL or missing references)
		//IL_011e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0121: Unknown result type (might be due to invalid IL or missing references)
		//IL_0123: Unknown result type (might be due to invalid IL or missing references)
		//IL_0129: Unknown result type (might be due to invalid IL or missing references)
		//IL_012b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0131: Unknown result type (might be due to invalid IL or missing references)
		//IL_0133: Unknown result type (might be due to invalid IL or missing references)
		//IL_0139: Unknown result type (might be due to invalid IL or missing references)
		//IL_013b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0141: Unknown result type (might be due to invalid IL or missing references)
		//IL_0143: Unknown result type (might be due to invalid IL or missing references)
		//IL_0149: Unknown result type (might be due to invalid IL or missing references)
		//IL_014b: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b0: Unknown result type (might be due to invalid IL or missing references)
		//IL_01b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ba: Unknown result type (might be due to invalid IL or missing references)
		//IL_01bc: Unknown result type (might be due to invalid IL or missing references)
		//IL_01da: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d1: Unknown result type (might be due to invalid IL or missing references)
		//IL_01d3: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f6: Unknown result type (might be due to invalid IL or missing references)
		//IL_01ef: Unknown result type (might be due to invalid IL or missing references)
		//IL_01f1: Unknown result type (might be due to invalid IL or missing references)
		//IL_0214: Unknown result type (might be due to invalid IL or missing references)
		//IL_020b: Unknown result type (might be due to invalid IL or missing references)
		//IL_020d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0230: Unknown result type (might be due to invalid IL or missing references)
		//IL_0229: Unknown result type (might be due to invalid IL or missing references)
		//IL_022b: Unknown result type (might be due to invalid IL or missing references)
		//IL_024e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0245: Unknown result type (might be due to invalid IL or missing references)
		//IL_0247: Unknown result type (might be due to invalid IL or missing references)
		//IL_0263: Unknown result type (might be due to invalid IL or missing references)
		//IL_0265: Unknown result type (might be due to invalid IL or missing references)
		//IL_058c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0591: Unknown result type (might be due to invalid IL or missing references)
		//IL_0593: Unknown result type (might be due to invalid IL or missing references)
		//IL_05cd: Unknown result type (might be due to invalid IL or missing references)
		//IL_05ee: Unknown result type (might be due to invalid IL or missing references)
		//IL_0603: Unknown result type (might be due to invalid IL or missing references)
		//IL_1027: Unknown result type (might be due to invalid IL or missing references)
		//IL_102c: Unknown result type (might be due to invalid IL or missing references)
		//IL_1053: Unknown result type (might be due to invalid IL or missing references)
		//IL_1058: Unknown result type (might be due to invalid IL or missing references)
		//IL_105d: Unknown result type (might be due to invalid IL or missing references)
		//IL_1085: Unknown result type (might be due to invalid IL or missing references)
		//IL_108a: Unknown result type (might be due to invalid IL or missing references)
		//IL_10a8: Unknown result type (might be due to invalid IL or missing references)
		//IL_10ad: Unknown result type (might be due to invalid IL or missing references)
		//IL_10b2: Unknown result type (might be due to invalid IL or missing references)
		//IL_10da: Unknown result type (might be due to invalid IL or missing references)
		//IL_10df: Unknown result type (might be due to invalid IL or missing references)
		//IL_10fd: Unknown result type (might be due to invalid IL or missing references)
		//IL_1102: Unknown result type (might be due to invalid IL or missing references)
		//IL_1107: Unknown result type (might be due to invalid IL or missing references)
		//IL_0777: Unknown result type (might be due to invalid IL or missing references)
		//IL_077c: Unknown result type (might be due to invalid IL or missing references)
		//IL_077e: Unknown result type (might be due to invalid IL or missing references)
		//IL_068e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0693: Unknown result type (might be due to invalid IL or missing references)
		//IL_0695: Unknown result type (might be due to invalid IL or missing references)
		//IL_079f: Unknown result type (might be due to invalid IL or missing references)
		//IL_06ab: Unknown result type (might be due to invalid IL or missing references)
		//IL_09a3: Unknown result type (might be due to invalid IL or missing references)
		//IL_09b4: Unknown result type (might be due to invalid IL or missing references)
		//IL_07b5: Unknown result type (might be due to invalid IL or missing references)
		//IL_09ed: Unknown result type (might be due to invalid IL or missing references)
		//IL_09f2: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a96: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a9b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a9d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0ab3: Unknown result type (might be due to invalid IL or missing references)
		//IL_0ac8: Unknown result type (might be due to invalid IL or missing references)
		//IL_0acf: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a28: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a2d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a2f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0b39: Unknown result type (might be due to invalid IL or missing references)
		//IL_0b45: Unknown result type (might be due to invalid IL or missing references)
		//IL_0adb: Unknown result type (might be due to invalid IL or missing references)
		//IL_0ae0: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a45: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a5d: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a67: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a73: Unknown result type (might be due to invalid IL or missing references)
		//IL_0a78: Unknown result type (might be due to invalid IL or missing references)
		//IL_0d29: Unknown result type (might be due to invalid IL or missing references)
		//IL_0d2e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0e56: Unknown result type (might be due to invalid IL or missing references)
		//IL_0e5b: Unknown result type (might be due to invalid IL or missing references)
		//IL_0dd9: Unknown result type (might be due to invalid IL or missing references)
		//IL_0f05: Unknown result type (might be due to invalid IL or missing references)
		AnimatorTransform = t;
		Transform[] array;
		if (checkOnly != null)
		{
			array = (Transform[])(object)new Transform[checkOnly.Count];
			for (int i = 0; i < checkOnly.Count; i++)
			{
				array[i] = checkOnly[i];
			}
		}
		else
		{
			array = ((Component)AnimatorTransform).GetComponentsInChildren<Transform>(true);
		}
		if (array.Length != 0)
		{
			LocalSpaceLowest = (LocalSpaceMostLeft = (LocalSpaceMostBack = (LocalSpaceMostForward = (LocalSpaceMostRight = (LocalSpaceHighest = AnimatorTransform.InverseTransformPoint(array[0].position))))));
		}
		List<Transform> list = new List<Transform>();
		foreach (Transform val in array)
		{
			if (!((Object)(object)((Component)val).GetComponentInChildren<SkinnedMeshRenderer>() != (Object)null))
			{
				list.Add(val);
			}
		}
		for (int k = 0; k < list.Count; k++)
		{
			Transform val2 = list[k];
			if (!Object.op_Implicit((Object)(object)((Component)val2).GetComponent<SkinnedMeshRenderer>()))
			{
				Vector3 val3 = AnimatorTransform.InverseTransformPoint(val2.position);
				if (val3.x > LocalSpaceMostRight.x)
				{
					LocalSpaceMostRight = val3;
				}
				else if (val3.x < LocalSpaceMostLeft.x)
				{
					LocalSpaceMostLeft = val3;
				}
				if (val3.z > LocalSpaceMostForward.z)
				{
					LocalSpaceMostForward = val3;
				}
				else if (val3.z < LocalSpaceMostBack.z)
				{
					LocalSpaceMostBack = val3;
				}
				if (val3.y > LocalSpaceHighest.y)
				{
					LocalSpaceHighest = val3;
				}
				else if (val3.y < LocalSpaceLowest.y)
				{
					LocalSpaceLowest = val3;
				}
			}
		}
		LowestVsHighestLen = Mathf.Abs(LocalSpaceLowest.y - LocalSpaceHighest.y);
		MostLeftVsMostRightLen = Mathf.Abs(LocalSpaceMostLeft.x - LocalSpaceMostRight.x);
		MostForwVsMostBackLen = Mathf.Abs(LocalSpaceMostForward.z - LocalSpaceMostBack.z);
		AverageLen = (LowestVsHighestLen + MostLeftVsMostRightLen + MostForwVsMostBackLen) / 3f;
		_ = LowestVsHighestLen;
		for (int l = 0; l < list.Count; l++)
		{
			Transform val4 = list[l];
			if (NameContains(((Object)val4).name, ShouldersNames))
			{
				Transform bottomMostChildTransform = GetBottomMostChildTransform(val4);
				if (NotContainedYetByLimbs(bottomMostChildTransform))
				{
					TrReachingSides.Add(bottomMostChildTransform);
				}
			}
			else if (NameContains(((Object)val4).name, ElbowNames))
			{
				Transform bottomMostChildTransform2 = GetBottomMostChildTransform(val4);
				if (NotContainedYetByLimbs(bottomMostChildTransform2))
				{
					TrReachingSides.Add(bottomMostChildTransform2);
				}
			}
		}
		for (int m = 0; m < list.Count; m++)
		{
			Transform val5 = list[m];
			if (NameContains(((Object)val5).name, UpperLegNames))
			{
				Transform bottomMostChildTransform3 = GetBottomMostChildTransform(val5);
				if (NotContainedYetByLimbs(bottomMostChildTransform3))
				{
					TrReachingGround.Add(bottomMostChildTransform3);
				}
			}
			else if (NameContains(((Object)val5).name, KneeNames))
			{
				Transform bottomMostChildTransform4 = GetBottomMostChildTransform(val5);
				if (NotContainedYetByLimbs(bottomMostChildTransform4))
				{
					TrReachingGround.Add(bottomMostChildTransform4);
				}
			}
		}
		bool flag = false;
		for (int n = 0; n < list.Count; n++)
		{
			Transform val6 = list[n];
			if (NameContains(((Object)val6).name, PelvisNames))
			{
				flag = true;
				ProbablyHips = val6;
				break;
			}
		}
		bool flag2 = false;
		for (int num = 0; num < list.Count; num++)
		{
			Transform val7 = list[num];
			if (NameContains(((Object)val7).name, ChestNames))
			{
				flag2 = true;
				ProbablyChest = val7;
				break;
			}
		}
		bool flag3 = false;
		for (int num2 = 0; num2 < list.Count; num2++)
		{
			Transform val8 = list[num2];
			if (NameContains(((Object)val8).name, HeadNames))
			{
				flag3 = true;
				ProbablyHead = val8;
				break;
			}
		}
		if ((Object)(object)ProbablyHead != (Object)null && (Object)(object)ProbablyHips != (Object)null && !IsChildOf(ProbablyHead, ProbablyHips))
		{
			ProbablyHead = null;
		}
		for (int num3 = 0; num3 < list.Count; num3++)
		{
			Transform val9 = list[num3];
			if (NameContains(((Object)val9).name, RootNames))
			{
				ProbablyRootBone = val9;
				break;
			}
		}
		if (list.Count > 2)
		{
			for (int num4 = 1; num4 < list.Count; num4++)
			{
				Transform val10 = list[num4];
				if (val10.childCount != 0)
				{
					continue;
				}
				TrEnds.Add(val10);
				Vector3 val11 = Loc(val10);
				if (val11.y < LocalSpaceLowest.y + LowestVsHighestLen * 0.1f)
				{
					if (NotContainedYetByLimbs(val10))
					{
						TrReachingGround.Add(val10);
					}
				}
				else if (val11.y > LocalSpaceLowest.y + LowestVsHighestLen * 0.2f && (val11.x < MostLeftVsMostRightLen * -0.1f || val11.x > MostLeftVsMostRightLen * 0.1f) && NotContainedYetByLimbs(val10))
				{
					TrReachingSides.Add(val10);
				}
			}
		}
		if (!flag2)
		{
			List<Transform> list2 = new List<Transform>();
			for (int num5 = 0; num5 < TrReachingSides.Count; num5++)
			{
				if (Object.op_Implicit((Object)(object)((Component)list[num5]).GetComponent<SkinnedMeshRenderer>()))
				{
					continue;
				}
				Transform parent = TrReachingSides[num5].parent;
				while ((Object)(object)parent != (Object)null)
				{
					if (parent.childCount > 2)
					{
						Vector3 val12 = Loc(parent);
						if (val12.x > (0f - MostLeftVsMostRightLen) * 0.03f && val12.x < MostLeftVsMostRightLen * 0.03f)
						{
							list2.Add(parent);
							break;
						}
					}
					parent = parent.parent;
				}
			}
			if (list2.Count == 1)
			{
				ProbablyChest = list2[0];
			}
			else if (list2.Count > 1 && (Object)(object)list2[0] == (Object)(object)list2[1])
			{
				ProbablyChest = list2[0];
			}
		}
		if (!flag)
		{
			List<Transform> list3 = new List<Transform>();
			for (int num6 = 0; num6 < TrReachingGround.Count; num6++)
			{
				Transform parent2 = TrReachingGround[num6].parent;
				while ((Object)(object)parent2 != (Object)null)
				{
					if (parent2.childCount > 2)
					{
						Vector3 val13 = Loc(parent2);
						if (val13.y > LocalSpaceLowest.y + LowestVsHighestLen * 0.04f && val13.x > (0f - MostLeftVsMostRightLen) * 0.02f && val13.x < MostLeftVsMostRightLen * 0.02f)
						{
							list3.Add(parent2);
							break;
						}
					}
					parent2 = parent2.parent;
				}
			}
			if (list3.Count == 1)
			{
				ProbablyChest = list3[0];
			}
			else if (list3.Count > 1 && (Object)(object)list3[0] == (Object)(object)list3[1])
			{
				ProbablyHips = list3[0];
			}
		}
		if ((Object)(object)ProbablyHips == (Object)null)
		{
			ProbablyHips = pelvisHelp;
		}
		if (((Object)(object)ProbablyChest == (Object)null || (Object)(object)ProbablyChest == (Object)(object)ProbablyHips || ((Object)(object)ProbablyHips != (Object)null && !IsChildOf(ProbablyChest, ProbablyHips))) && Object.op_Implicit((Object)(object)ProbablyHips) && Object.op_Implicit((Object)(object)ProbablyHead))
		{
			Transform parent3 = ProbablyHead.parent;
			bool flag4 = false;
			while ((Object)(object)parent3.parent != (Object)null && (Object)(object)parent3.parent != (Object)(object)ProbablyHips)
			{
				if (parent3.childCount > 2)
				{
					for (int num7 = 0; num7 < TrReachingSides.Count; num7++)
					{
						if (IsChildOf(TrReachingSides[num7], parent3))
						{
							flag4 = true;
							break;
						}
					}
				}
				if (flag4)
				{
					break;
				}
				parent3 = parent3.parent;
			}
			if (flag4)
			{
				ProbablyChest = parent3;
			}
		}
		if ((Object)(object)ProbablyHips == (Object)null)
		{
			ProbablyHips = pelvisHelp;
		}
		if (Object.op_Implicit((Object)(object)ProbablyChest) && Object.op_Implicit((Object)(object)ProbablyHips))
		{
			if (MostForwVsMostBackLen > LowestVsHighestLen * 0.9f && Loc(ProbablyChest).z < Loc(ProbablyHips).z)
			{
				Transform probablyChest = ProbablyChest;
				ProbablyChest = ProbablyHips;
				ProbablyHips = probablyChest;
				Debug.Log((object)"Hips - Chest - Reversed Detection Swap!");
			}
			if (!flag3)
			{
				Vector3 val14 = Vector3.zero;
				for (int num8 = 0; num8 < ProbablyChest.childCount; num8++)
				{
					Transform child = ProbablyChest.GetChild(num8);
					Vector3 val15;
					if (child.childCount > 0)
					{
						for (int num9 = 0; num9 < child.childCount; num9++)
						{
							Transform child2 = child.GetChild(num9);
							val15 = Loc(child2);
							if (val15.x > (0f - MostLeftVsMostRightLen) * 0.04f && val15.x < MostLeftVsMostRightLen * 0.04f && Loc(child2).y > val14.y)
							{
								val14 = Loc(child2);
								ProbablyHead = child2;
							}
						}
					}
					val15 = Loc(child);
					if (val15.x > (0f - MostLeftVsMostRightLen) * 0.04f && val15.x < MostLeftVsMostRightLen * 0.04f && val15.y > val14.y)
					{
						val14 = Loc(child);
						ProbablyHead = child;
					}
				}
				if (Object.op_Implicit((Object)(object)ProbablyChest) && Object.op_Implicit((Object)(object)ProbablyHead) && Object.op_Implicit((Object)(object)ProbablyHips))
				{
					float num10 = Vector3.Distance(Loc(ProbablyChest), Loc(ProbablyHips));
					if ((ProbablyChest.childCount < 3 || num10 < AverageLen * 0.12f) && ProbablyHead.childCount > 1)
					{
						ProbablyChest = ProbablyHead;
						ProbablyHead = GetHighestChild(ProbablyHead, AnimatorTransform, MostLeftVsMostRightLen * 0.05f);
						if ((Object)(object)ProbablyHead == (Object)(object)ProbablyChest)
						{
							ProbablyHead = ProbablyChest.GetChild(0);
						}
					}
				}
			}
			if (Object.op_Implicit((Object)(object)ProbablyHead))
			{
				for (int num11 = TrReachingSides.Count - 1; num11 >= 0; num11--)
				{
					if (IsChildOf(TrReachingSides[num11], ProbablyHead))
					{
						TrReachingSides.RemoveAt(num11);
					}
				}
			}
			for (int num12 = TrReachingSides.Count - 1; num12 >= 0; num12--)
			{
				if (GetDepth(TrReachingSides[num12], AnimatorTransform) < 5)
				{
					TrReachingSides.RemoveAt(num12);
				}
			}
			Transform val16 = null;
			if (Object.op_Implicit((Object)(object)ProbablyHead))
			{
				ProbablySpineChain.Add(ProbablyHead);
				val16 = ProbablyHead.parent;
			}
			while ((Object)(object)val16 != (Object)null && (Object)(object)val16 != (Object)(object)ProbablyHips)
			{
				ProbablySpineChain.Add(val16);
				val16 = val16.parent;
			}
			ProbablySpineChain.Reverse();
			for (int num13 = 0; num13 < Mathf.Min(4, ProbablySpineChain.Count); num13++)
			{
				ProbablySpineChainShort.Add(ProbablySpineChain[num13]);
			}
			List<Transform> list4 = new List<Transform>();
			for (int num14 = 0; num14 < TrReachingGround.Count; num14++)
			{
				Transform val17 = TrReachingGround[num14];
				Vector3 val18 = Loc(val17);
				List<Transform> list5 = new List<Transform>();
				Transform val19 = val17;
				while ((Object)(object)val19 != (Object)null && (Object)(object)val19 != (Object)(object)ProbablyHips && (Object)(object)val19 != (Object)(object)ProbablyChest)
				{
					list5.Add(val19);
					val19 = val19.parent;
				}
				if (list5.Count >= 3)
				{
					List<Transform> item = new List<Transform>
					{
						list5[list5.Count - 1],
						list5[list5.Count - 2],
						list5[list5.Count - 3]
					};
					list4.Add(val17);
					if (val18.x < MostLeftVsMostRightLen * 0.02f)
					{
						ProbablyLeftLegs.Add(item);
						ProbablyLeftLegRoot.Add(val19);
					}
					else
					{
						ProbablyRightLegs.Add(item);
						ProbablyRightLegRoot.Add(val19);
					}
				}
			}
			for (int num15 = 0; num15 < TrReachingSides.Count; num15++)
			{
				Transform val20 = TrReachingSides[num15];
				Vector3 val21 = Loc(val20);
				List<Transform> list6 = new List<Transform>();
				Transform val22 = val20;
				while ((Object)(object)val22 != (Object)null && (Object)(object)val22 != (Object)(object)ProbablyChest)
				{
					list6.Add(val22);
					val22 = val22.parent;
				}
				if (list6.Count >= 4)
				{
					List<Transform> item2 = new List<Transform>
					{
						list6[list6.Count - 1],
						list6[list6.Count - 2],
						list6[list6.Count - 3],
						list6[list6.Count - 4]
					};
					if (val21.x < MostLeftVsMostRightLen * 0.02f)
					{
						ProbablyLeftArms.Add(item2);
					}
					else
					{
						ProbablyRightArms.Add(item2);
					}
				}
			}
			ClearDuplicates(ProbablyLeftArms, null);
			ClearDuplicates(ProbablyRightArms, null);
			ClearDuplicates(ProbablyLeftLegs, ProbablyLeftLegRoot);
			ClearDuplicates(ProbablyRightLegs, ProbablyRightLegRoot);
			if (Legs == 2 && Arms == 2)
			{
				WhatIsIt = EWhatIsIt.Humanoidal;
			}
			else if (Legs == 4 && Arms == 0)
			{
				WhatIsIt = EWhatIsIt.Quadroped;
			}
			else if (Legs > 0 || Arms > 0)
			{
				WhatIsIt = EWhatIsIt.Creature;
			}
			else
			{
				WhatIsIt = EWhatIsIt.Unknown;
			}
		}
		float num16 = Mathf.Lerp(LocalSpaceLowest.y, LocalSpaceHighest.y, 0.5f);
		Debug.DrawLine(t.TransformPoint(new Vector3(LocalSpaceMostLeft.x, LocalSpaceHighest.y, LocalSpaceMostForward.z)), t.TransformPoint(new Vector3(LocalSpaceMostLeft.x, LocalSpaceLowest.y, LocalSpaceMostForward.z)), Color.green, 12f);
		Debug.DrawLine(t.TransformPoint(new Vector3(LocalSpaceMostLeft.x, num16, LocalSpaceMostForward.z)), t.TransformPoint(new Vector3(LocalSpaceMostRight.x, num16, LocalSpaceMostForward.z)), Color.red, 12f);
		Debug.DrawLine(t.TransformPoint(new Vector3(LocalSpaceMostRight.x, num16, LocalSpaceMostForward.z)), t.TransformPoint(new Vector3(LocalSpaceMostRight.x, num16, LocalSpaceMostBack.z)), Color.blue, 12f);
	}

	private bool NotContainedYetByAny(Transform t)
	{
		if (!TrReachingSides.Contains(t) && !TrReachingGround.Contains(t) && !TrEnds.Contains(t) && (Object)(object)t != (Object)(object)ProbablyChest && (Object)(object)t != (Object)(object)ProbablyHips && (Object)(object)t != (Object)(object)ProbablyHead && (Object)(object)t != (Object)(object)ProbablyChest && (Object)(object)t != (Object)(object)ProbablyRootBone)
		{
			return (Object)(object)t != (Object)(object)AnimatorTransform;
		}
		return false;
	}

	private bool NotContainedYetByLimbs(Transform t)
	{
		if (!TrReachingSides.Contains(t))
		{
			return !TrReachingGround.Contains(t);
		}
		return false;
	}

	public Transform GetHighestChild(Transform t, Transform root, float inCenterRangeFactor)
	{
		//IL_000f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0014: Unknown result type (might be due to invalid IL or missing references)
		//IL_0019: Unknown result type (might be due to invalid IL or missing references)
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_003a: Unknown result type (might be due to invalid IL or missing references)
		//IL_0045: Unknown result type (might be due to invalid IL or missing references)
		//IL_004f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0056: Unknown result type (might be due to invalid IL or missing references)
		//IL_0060: Unknown result type (might be due to invalid IL or missing references)
		if ((Object)(object)t == (Object)null)
		{
			return null;
		}
		Transform result = t;
		Vector3 val = root.InverseTransformPoint(t.position);
		Transform[] componentsInChildren = ((Component)t).GetComponentsInChildren<Transform>(true);
		foreach (Transform val2 in componentsInChildren)
		{
			Vector3 val3 = root.InverseTransformPoint(val2.position);
			if (val3.x > 0f - inCenterRangeFactor && val3.x < inCenterRangeFactor && val3.y > val.y)
			{
				val.y = val3.y;
				result = val2;
			}
		}
		return result;
	}

	private void ClearDuplicates(List<List<Transform>> limbs, List<Transform> roots)
	{
		if (limbs.Count <= 1)
		{
			return;
		}
		for (int i = 0; i < limbs.Count && i < limbs.Count; i++)
		{
			List<Transform> list = limbs[i];
			for (int num = limbs.Count - 1; num >= 0; num--)
			{
				if (num != i)
				{
					List<Transform> list2 = limbs[num];
					bool flag = false;
					for (int j = 0; j < list2.Count; j++)
					{
						if (list.Contains(list2[j]))
						{
							flag = true;
							break;
						}
					}
					if (flag)
					{
						limbs.RemoveAt(num);
					}
				}
			}
		}
	}

	private Vector3 Loc(Transform t)
	{
		//IL_0007: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		return AnimatorTransform.InverseTransformPoint(t.position);
	}

	public string GetLog()
	{
		//IL_002e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0033: Unknown result type (might be due to invalid IL or missing references)
		//IL_0053: Unknown result type (might be due to invalid IL or missing references)
		//IL_0058: Unknown result type (might be due to invalid IL or missing references)
		//IL_0078: Unknown result type (might be due to invalid IL or missing references)
		//IL_007d: Unknown result type (might be due to invalid IL or missing references)
		//IL_009d: Unknown result type (might be due to invalid IL or missing references)
		//IL_00a2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c2: Unknown result type (might be due to invalid IL or missing references)
		//IL_00c7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00e7: Unknown result type (might be due to invalid IL or missing references)
		//IL_00ec: Unknown result type (might be due to invalid IL or missing references)
		string text = "< " + ((Object)AnimatorTransform).name + " >\n";
		text += "\nGenerate Guides:\n";
		string text2 = text;
		Vector3 val = LocalSpaceHighest;
		text = text2 + "Highest: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
		string text3 = text;
		val = LocalSpaceLowest;
		text = text3 + "Lowest: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
		string text4 = text;
		val = LocalSpaceMostLeft;
		text = text4 + "Left: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
		string text5 = text;
		val = LocalSpaceMostRight;
		text = text5 + "Right: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
		string text6 = text;
		val = LocalSpaceMostForward;
		text = text6 + "Forward: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
		string text7 = text;
		val = LocalSpaceMostBack;
		text = text7 + "Back: " + ((object)(Vector3)(ref val)/*cast due to .constrained prefix*/).ToString() + "     ";
		text += "\n\nGenerated Helper Measurements: \n";
		text = text + "UpDown: " + LowestVsHighestLen + "     ";
		text = text + "LeftRight: " + MostLeftVsMostRightLen + "     ";
		text = text + "ForwBack: " + MostForwVsMostBackLen + "     ";
		text = text + "Avr: " + AverageLen + "     ";
		text += "\n\nDetected Propabilities: \n";
		text = text + "ProbablyHips: " + ((object)ProbablyHips)?.ToString() + "     ";
		text = text + "ProbablyChest: " + ((object)ProbablyChest)?.ToString() + "     ";
		text = text + "ProbablyHead: " + ((object)ProbablyHead)?.ToString() + "     ";
		text += "\n\nLimb End Detections: \n";
		text = text + "Reaching Ground: " + TrReachingGround.Count + "     ";
		text = text + "Reaching Sides: " + TrReachingSides.Count + "     ";
		text = text + "Spine Chain Length: " + ProbablySpineChain.Count + " (" + ProbablySpineChainShort.Count + ")     ";
		text += "\n\nDetected Propabilities: \n";
		text = text + "Probably Left Arms: " + ProbablyLeftArms.Count + "     ";
		text = text + "Probably Right Arms: " + ProbablyRightArms.Count + "     ";
		text = text + "Probably Left Legs: " + ProbablyLeftLegs.Count + "     ";
		text = text + "Probably Right Legs: " + ProbablyRightLegs.Count + "     ";
		text += "\n\n\nTr Ends: \n";
		for (int i = 0; i < TrEnds.Count; i++)
		{
			if (!((Object)(object)TrEnds[i] == (Object)null))
			{
				text = text + ((Object)TrEnds[i]).name + "     ";
			}
		}
		text += "\n\nTr Reaching Ground: \n";
		for (int j = 0; j < TrReachingGround.Count; j++)
		{
			if (!((Object)(object)TrReachingGround[j] == (Object)null))
			{
				text = text + ((Object)TrReachingGround[j]).name + "     ";
			}
		}
		text += "\n\nTr Reaching Sides: \n";
		for (int k = 0; k < TrReachingSides.Count; k++)
		{
			if (!((Object)(object)TrReachingSides[k] == (Object)null))
			{
				text = text + ((Object)TrReachingSides[k]).name + "     ";
			}
		}
		if (ProbablyLeftArms.Count > 0)
		{
			text += "\n\nDebug Left Arms: \n";
			for (int l = 0; l < ProbablyLeftArms.Count; l++)
			{
				if (ProbablyLeftArms[l] != null)
				{
					text = text + "[" + l + "] ";
					for (int m = 0; m < ProbablyLeftArms[l].Count; m++)
					{
						text = text + ((Object)ProbablyLeftArms[l][m]).name + "  ";
					}
					text += "\n";
				}
			}
		}
		if (ProbablySpineChainShort.Count > 0)
		{
			text += "\n\nDebug Spine Chain: \n";
			for (int n = 0; n < ProbablySpineChainShort.Count; n++)
			{
				if (!((Object)(object)ProbablySpineChainShort[n] == (Object)null))
				{
					text = text + ((Object)ProbablySpineChainShort[n]).name + "  ";
				}
			}
		}
		return text + "\n\n";
	}

	public static int GetDepth(Transform t, Transform skelRootBone)
	{
		int num = 0;
		if ((Object)(object)t == (Object)(object)skelRootBone)
		{
			return 0;
		}
		if ((Object)(object)t == (Object)null)
		{
			return 0;
		}
		if ((Object)(object)t.parent == (Object)null)
		{
			return 0;
		}
		while ((Object)(object)t != (Object)null && (Object)(object)t != (Object)(object)skelRootBone)
		{
			t = t.parent;
			num++;
		}
		return num;
	}
}


using System;
using System.Collections.Generic;
using FIMSpace.Generating;
using UnityEngine;

public static class FGenerators
{
	public class DefinedRandom
	{
		private Random random;

		public int Seed { get; private set; }

		public DefinedRandom(int seed)
		{
			random = new Random(seed);
		}

		public void ReInitializeSeed(int seed)
		{
			random = new Random(seed);
		}

		public float GetRandom()
		{
			return FGenerators.GetRandom(random);
		}

		public float GetRandom(float from, float to)
		{
			return FGenerators.GetRandom(from, to, random);
		}

		public float GetRandomPlusMinus(float range)
		{
			return FGenerators.GetRandomPlusMinus(range, random);
		}

		public int GetRandom(int from, int to)
		{
			return FGenerators.GetRandom(from, to, random);
		}

		public int GetRandomInclusive(int from, int to)
		{
			return FGenerators.GetRandomInclusive(from, to, random);
		}

		public int GetRandom(FIMSpace.Generating.MinMax minMax)
		{
			return FGenerators.GetRandom(minMax, random);
		}

		public bool GetRandomFlip()
		{
			return FGenerators.GetRandomFlip(random);
		}
	}

	private static Random random = new Random();

	public static string lastPath = "";

	private static float _editorUiScaling;

	public static readonly Color Color_Remove = new Color(1f, 0.825f, 0.825f, 1f);

	public static Random GlobalRandomInstance => random;

	public static int LatestSeed { get; private set; }

	public static string GetLastPath => lastPath;

	public static float EditorUIScale => GetEditorUIScale();

	public static GameObject InstantiateObject(GameObject obj)
	{
		return Object.Instantiate<GameObject>(obj);
	}

	public static void ClearGenerated<T>(List<T> generated) where T : Object
	{
		if (generated == null)
		{
			return;
		}
		for (int i = 0; i < generated.Count; i++)
		{
			if (!((Object)(object)generated[i] == (Object)null))
			{
				if (generated[i] is Component)
				{
					object obj = generated[i];
					DestroyObject((Object)((obj is Component) ? obj : null));
				}
				else
				{
					DestroyObject((Object)(object)generated[i]);
				}
			}
		}
		generated.Clear();
	}

	public static bool CheckIfIsNull(object o)
	{
		if (o == null)
		{
			return true;
		}
		return false;
	}

	public static bool Exists(object o)
	{
		return CheckIfExist_NOTNULL(o);
	}

	public static bool NotNull(object o)
	{
		return CheckIfExist_NOTNULL(o);
	}

	public static bool IsNull(object o)
	{
		return CheckIfIsNull(o);
	}

	public static bool CheckIfExist_NOTNULL(object o)
	{
		return !CheckIfIsNull(o);
	}

	public static bool IsChildOf(Transform child, Transform rootParent)
	{
		Transform val = child;
		while ((Object)(object)val != (Object)null && (Object)(object)val != (Object)(object)rootParent)
		{
			val = val.parent;
		}
		if ((Object)(object)val == (Object)null)
		{
			return false;
		}
		return true;
	}

	public static void DestroyObject(Object obj, bool allowDestroyAssets = false)
	{
		if (!(obj == (Object)null))
		{
			Object.Destroy(obj);
		}
	}

	public static bool RefIsNull(object varMat)
	{
		if (CheckIfIsNull(varMat))
		{
			return true;
		}
		if (varMat == null)
		{
			return true;
		}
		if (varMat == null)
		{
			return true;
		}
		if (varMat.Equals(null))
		{
			return true;
		}
		return false;
	}

	public static void SetSeed(int seed)
	{
		random = new Random(seed);
		LatestSeed = seed;
	}

	public static bool GetRandomFlip()
	{
		return GetRandomFlip(random);
	}

	public static bool GetRandomFlip(Random rand)
	{
		return GetRandom(0, 2, rand) == 1;
	}

	public static float GetRandom()
	{
		return GetRandom(random);
	}

	public static int GetRandomInclusive(int from, int to)
	{
		return GetRandomInclusive(from, to, random);
	}

	public static int GetRandomInclusive(int from, int to, Random rand)
	{
		return rand.Next(from, to + 1);
	}

	public static float GetRandom(Random rand)
	{
		return (float)rand.NextDouble();
	}

	public static Vector2 SwampToBeRising(Vector2 minMax)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		//IL_002a: Unknown result type (might be due to invalid IL or missing references)
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		if (minMax.y < minMax.x)
		{
			float x = minMax.x;
			minMax.x = minMax.y;
			minMax.y = x;
		}
		return minMax;
	}

	public static float GetRandomSwap(float from, float to, Random rand)
	{
		if (from > to)
		{
			float num = from;
			from = to;
			to = num;
		}
		return GetRandom(from, to, rand);
	}

	public static float GetRandomSwap(float from, float to)
	{
		return GetRandomSwap(from, to, random);
	}

	public static float GetRandomPlusMinus(float plusminus)
	{
		return GetRandomPlusMinus(plusminus, random);
	}

	public static float GetRandomPlusMinus(float plusminus, Random rand)
	{
		return GetRandom(0f - plusminus, plusminus, rand);
	}

	public static float GetRandom(float from, float to)
	{
		return GetRandom(from, to, random);
	}

	public static float GetRandom(float from, float to, Random rand)
	{
		return from + (float)rand.NextDouble() * (to - from);
	}

	public static Vector3 GetRandom(Vector3 plusMinusRangesPerAxis)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0006: Unknown result type (might be due to invalid IL or missing references)
		return GetRandom(plusMinusRangesPerAxis, random);
	}

	public static Vector3 GetRandom(Vector3 plusMinusRangesPerAxis, Random rand)
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_0004: Unknown result type (might be due to invalid IL or missing references)
		//IL_000b: Unknown result type (might be due to invalid IL or missing references)
		//IL_001e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0025: Unknown result type (might be due to invalid IL or missing references)
		//IL_0038: Unknown result type (might be due to invalid IL or missing references)
		//IL_003f: Unknown result type (might be due to invalid IL or missing references)
		//IL_0050: Unknown result type (might be due to invalid IL or missing references)
		Vector3 val = plusMinusRangesPerAxis;
		val.x = GetRandom(0f - val.x, val.x, rand);
		val.y = GetRandom(0f - val.y, val.y, rand);
		val.z = GetRandom(0f - val.z, val.z, rand);
		return val;
	}

	public static int GetRandom(int from, int to)
	{
		return GetRandom(from, to, random);
	}

	public static int GetRandom(int from, int to, Random rand)
	{
		return rand.Next(from, to);
	}

	public static int GetRandom(FIMSpace.Generating.MinMax minMax)
	{
		return GetRandom(minMax, random);
	}

	public static int GetRandom(FIMSpace.Generating.MinMax minMax, Random rand)
	{
		return (int)((float)minMax.Min + (float)rand.NextDouble() * (float)(minMax.Max + 1 - minMax.Min));
	}

	public static void GetIncrementalTo<T>(List<T> list) where T : Object
	{
	}

	public static void GetSimilarTo<T>(List<T> list) where T : Object
	{
	}

	public static int IndexOfFirstNumber(string name)
	{
		for (int i = 0; i < name.Length; i++)
		{
			if (int.TryParse(name[i].ToString(), out var _))
			{
				return i;
			}
		}
		return -1;
	}

	public static List<T> CopyList<T>(List<T> cellsInstructions)
	{
		List<T> list = new List<T>();
		for (int i = 0; i < cellsInstructions.Count; i++)
		{
			list.Add(cellsInstructions[i]);
		}
		return list;
	}

	public static bool IsRightMouseButton()
	{
		//IL_000e: Unknown result type (might be due to invalid IL or missing references)
		//IL_0015: Invalid comparison between Unknown and I4
		if (Event.current == null)
		{
			return false;
		}
		if ((int)Event.current.type == 12 && Event.current.button == 1)
		{
			return true;
		}
		return false;
	}

	public static float InspectorViewWidth()
	{
		return 0f;
	}

	public static Rect GUILastRect()
	{
		//IL_0002: Unknown result type (might be due to invalid IL or missing references)
		//IL_0008: Unknown result type (might be due to invalid IL or missing references)
		return default(Rect);
	}

	public static void ResetCoords(this Transform t)
	{
		//IL_0001: Unknown result type (might be due to invalid IL or missing references)
		//IL_000c: Unknown result type (might be due to invalid IL or missing references)
		//IL_0017: Unknown result type (might be due to invalid IL or missing references)
		t.localPosition = Vector3.zero;
		t.localRotation = Quaternion.identity;
		t.localScale = Vector3.one;
	}

	public static Vector2 GetEventMousePosition()
	{
		//IL_0000: Unknown result type (might be due to invalid IL or missing references)
		return Vector2.zero;
	}

	public static ScriptableObject GenerateScriptable(ScriptableObject reference, string exampleFilename = "", string playerPrefId = "LastFGenSaveDir")
	{
		return reference;
	}

	public static void DrawScriptableModificatorList<T>(List<T> toDraw, GUIStyle style, string title, ref bool foldout, bool newButton = false, bool moveButtons = false, Object toDirty = null, string first = "[Base]", string defaultFilename = "New Scriptable File") where T : ScriptableObject
	{
	}

	public static void AddScriptableToSimple(ScriptableObject parent, ScriptableObject toAdd, bool reload = true)
	{
	}

	public static bool AssetContainsAsset(Object subAsset, Object parentAsset)
	{
		return false;
	}

	public static void AddScriptableTo(ScriptableObject toAdd, Object parentAsset, bool checkIfAlreadyContains = true, bool reload = true)
	{
	}

	public static bool IsAssetSaved(Object asset)
	{
		return false;
	}

	public static void SwapElements<T>(List<T> list, int index1, int index2, bool loop = false)
	{
		if (index1 == index2)
		{
			return;
		}
		if (loop)
		{
			if (index1 >= list.Count)
			{
				index1 -= list.Count;
			}
			if (index1 < 0)
			{
				index1 += list.Count;
			}
			if (index2 >= list.Count)
			{
				index2 -= list.Count;
			}
			if (index2 < 0)
			{
				index2 += list.Count;
			}
		}
		T value = list[index1];
		list[index1] = list[index2];
		list[index2] = value;
	}

	public static void SwapElements<T>(T[] list, int index1, int index2)
	{
		if (index1 != index2)
		{
			T val = list[index1];
			list[index1] = list[index2];
			list[index2] = val;
		}
	}

	public static void CheckForNulls<T>(List<T> classes)
	{
		for (int num = classes.Count - 1; num >= 0; num--)
		{
			if (classes[num] == null)
			{
				classes.RemoveAt(num);
			}
		}
	}

	public static bool IndexInListRange<T>(List<T> list, int index)
	{
		if (list == null)
		{
			return false;
		}
		if (index < 0)
		{
			return false;
		}
		if (index >= list.Count)
		{
			return false;
		}
		return true;
	}

	public static T GetListElementOrNull<T>(this List<T> list, int index) where T : class
	{
		if (list == null)
		{
			return null;
		}
		if (index < 0)
		{
			return null;
		}
		if (index >= list.Count)
		{
			return null;
		}
		if (CheckIfIsNull(list[index]))
		{
			return null;
		}
		return list[index];
	}

	public static void AdjustCount<T>(List<T> list, int targetCount, bool addNulls = false) where T : class, new()
	{
		if (list.Count == targetCount)
		{
			return;
		}
		if (list.Count < targetCount)
		{
			if (addNulls)
			{
				while (list.Count < targetCount)
				{
					list.Add(null);
				}
			}
			else
			{
				while (list.Count < targetCount)
				{
					list.Add(new T());
				}
			}
		}
		else
		{
			while (list.Count > targetCount)
			{
				list.RemoveAt(list.Count - 1);
			}
		}
	}

	public static void Shuffle<T>(this IList<T> list)
	{
		list.Shuffle(random);
	}

	public static void Shuffle<T>(this IList<T> list, Random random)
	{
		int num = list.Count;
		while (num > 1)
		{
			num--;
			int index = random.Next(num + 1);
			T value = list[index];
			list[index] = list[num];
			list[num] = value;
		}
	}

	public static float GetEditorUIScale()
	{
		return 1f;
	}
}


using System;

public class DefinedRandom
{
	private Random random;

	public int Seed { get; private set; }

	public DefinedRandom(int seed)
	{
		random = new Random(seed);
	}

	public void ReInitializeSeed(int seed)
	{
		random = new Random(seed);
	}

	public float GetRandom()
	{
		return FGenerators.GetRandom(random);
	}

	public float GetRandom(float from, float to)
	{
		return FGenerators.GetRandom(from, to, random);
	}

	public float GetRandomPlusMinus(float range)
	{
		return FGenerators.GetRandomPlusMinus(range, random);
	}

	public int GetRandom(int from, int to)
	{
		return FGenerators.GetRandom(from, to, random);
	}

	public int GetRandomInclusive(int from, int to)
	{
		return FGenerators.GetRandomInclusive(from, to, random);
	}

	public int GetRandom(MinMax minMax)
	{
		return FGenerators.GetRandom(minMax, random);
	}

	public bool GetRandomFlip()
	{
		return FGenerators.GetRandomFlip(random);
	}
}


using System;
using System.Collections.Generic;
using FIMSpace;
using FIMSpace.Generating;
using UnityEngine;

[Serializable]
public class PrefabReference
{
	[SerializeField]
	private GameObject Prefab;

	private GameObject tempReplacePrefab;

	[SerializeField]
	private Collider MainCollider;

	private Collider tempReplaceCollider;

	private int id;

	public int subID;

	private Texture tex;

	public static GUILayoutOption[] opt;

	public static GUILayoutOption[] opt2;

	public static GUILayoutOption[] opt3;

	public static bool StopReloadLayoutOptions;

	[HideInInspector]
	[SerializeField]
	protected Mesh _refMesh;

	[HideInInspector]
	[SerializeField]
	protected Collider _refCol;

	public GameObject CoreGameObject => Prefab;

	public Collider CoreCollider => MainCollider;

	public GameObject GameObject
	{
		get
		{
			if ((Object)(object)tempReplacePrefab != (Object)null)
			{
				return tempReplacePrefab;
			}
			return Prefab;
		}
	}

	public Collider Collider
	{
		get
		{
			if ((Object)(object)tempReplaceCollider != (Object)null)
			{
				return tempReplaceCollider;
			}
			return MainCollider;
		}
	}

	public Texture Preview
	{
		get
		{
			if ((Object)(object)Prefab == (Object)null)
			{
				tex = null;
				return null;
			}
			if ((Object)(object)tex == (Object)null || id != ((Object)Prefab).GetInstanceID())
			{
				id = ((Object)Prefab).GetInstanceID();
			}
			return tex;
		}
	}

	protected virtual void DrawGUIWithPrefab(Color color, int previewSize = 72, string predicate = "", Action clickCallback = null, Action removeCallback = null, bool drawThumbnail = true, bool drawPrefabField = true)
	{
	}

	protected virtual void DrawGUIWithoutPrefab(int previewSize = 72, string predicate = "", Action removeCallback = null, bool drawPrefabField = true)
	{
	}

	public virtual void OnPrefabChanges()
	{
	}

	public static void DrawPrefabField(PrefabReference prefabRef, Color defaultColor, string predicate = "", int previewSize = 72, Action clickCallback = null, Action removeCallback = null, bool drawThumbnail = true, Object toDiry = null, bool drawPrefabField = true, bool drawAdditionalButtons = true)
	{
	}

	public static void DrawPrefabsList<T>(List<T> list, ref bool foldout, ref int selected, ref bool thumbnails, Color defaultC, Color selectedC, float viewWidth = 500f, int previewSize = 72, bool searchButtons = false, Object toDirty = null, bool allowAdding = true) where T : PrefabReference, new()
	{
	}

	public Mesh GetMesh(bool refresh = false)
	{
		if ((Object)(object)Prefab == (Object)null)
		{
			return null;
		}
		if (refresh)
		{
			_refMesh = null;
		}
		else if (Object.op_Implicit((Object)(object)_refMesh))
		{
			if ((Object)(object)MainCollider == (Object)null)
			{
				GetCollider();
			}
			return _refMesh;
		}
		List<SkinnedMeshRenderer> list = FTransformMethods.FindComponentsInAllChildren<SkinnedMeshRenderer>(Prefab.transform, includeInactive: false, tryGetMultipleOutOfSingleObject: false);
		for (int i = 0; i < list.Count; i++)
		{
			if (Object.op_Implicit((Object)(object)list[i]) && Object.op_Implicit((Object)(object)list[i].sharedMesh))
			{
				_refMesh = list[i].sharedMesh;
				if ((Object)(object)MainCollider == (Object)null)
				{
					GetCollider();
				}
				return _refMesh;
			}
		}
		List<MeshFilter> list2 = FTransformMethods.FindComponentsInAllChildren<MeshFilter>(Prefab.transform, includeInactive: false, tryGetMultipleOutOfSingleObject: false);
		for (int j = 0; j < list2.Count; j++)
		{
			if (Object.op_Implicit((Object)(object)list2[j]) && Object.op_Implicit((Object)(object)list2[j].sharedMesh))
			{
				_refMesh = list2[j].sharedMesh;
				if ((Object)(object)MainCollider == (Object)null)
				{
					GetCollider();
				}
				return _refMesh;
			}
		}
		if ((Object)(object)MainCollider == (Object)null)
		{
			MainCollider = FTransformMethods.FindComponentInAllChildren<Collider>(Prefab.transform);
		}
		return _refMesh;
	}

	public Collider GetCollider()
	{
		if ((Object)(object)Prefab == (Object)null)
		{
			return null;
		}
		if (Object.op_Implicit((Object)(object)_refCol))
		{
			if ((Object)(object)MainCollider == (Object)null)
			{
				MainCollider = _refCol;
			}
			return _refCol;
		}
		List<Collider> list = FTransformMethods.FindComponentsInAllChildren<Collider>(Prefab.transform, includeInactive: false, tryGetMultipleOutOfSingleObject: false);
		for (int i = 0; i < list.Count; i++)
		{
			if (Object.op_Implicit((Object)(object)list[i]))
			{
				_refCol = list[i];
				if ((Object)(object)MainCollider == (Object)null)
				{
					MainCollider = _refCol;
				}
				return _refCol;
			}
		}
		if ((Object)(object)_refCol == (Object)null)
		{
			_refCol = Prefab.GetComponent<Collider>();
		}
		if ((Object)(object)MainCollider == (Object)null)
		{
			MainCollider = _refCol;
		}
		return _refCol;
	}

	public void SetPrefab(GameObject pf)
	{
		Prefab = pf;
	}

	public void SetCollider(Collider pf)
	{
		MainCollider = pf;
	}

	public void TemporaryReplace(GameObject tempRepl)
	{
		if ((Object)(object)tempRepl == (Object)null)
		{
			tempReplacePrefab = null;
			tempReplaceCollider = null;
		}
		else
		{
			tempReplacePrefab = tempRepl;
			tempReplaceCollider = tempRepl.GetComponentInChildren<Collider>();
		}
	}
}


using System;
using FIMSpace.Generating;
using UnityEngine;

[Serializable]
public struct MinMax
{
	public int Min;

	public int Max;

	public bool IsZero
	{
		get
		{
			if (Min == 0)
			{
				return Max == 0;
			}
			return false;
		}
	}

	public static FIMSpace.Generating.MinMax zero => new FIMSpace.Generating.MinMax(0, 0);

	public Vector2 ToVector2 => new Vector2((float)Min, (float)Max);

	public Vector2Int ToVector2Int => new Vector2Int(Min, Max);

	public MinMax(int min, int max)
	{
		Min = min;
		Max = max;
	}

	public int GetRandom()
	{
		return (int)((float)Min + FGenerators.GetRandom() * (float)(Max + 1 - Min));
	}
}


using System;

[Serializable]
public struct MinMaxF
{
	public float Min;

	public float Max;

	public MinMaxF(float min, float max)
	{
		Min = min;
		Max = max;
	}
}


using FIMSpace.FProceduralAnimation;
using UnityEngine;

[CreateAssetMenu(fileName = "LA Leg Motion Settings", menuName = "FImpossible Creations/Legs Animator/Leg Motion Preset", order = 0)]
public class LegMotionSettingsPreset : ScriptableObject
{
	[Header("Settings for single leg - leg animation style")]
	public LegsAnimator.LegStepAnimatingParameters Settings;

	private void Reset()
	{
		Settings = new LegsAnimator.LegStepAnimatingParameters();
		Settings.RefreshDefaultCurves();
	}
}


